2020-11-19 20:47:25.524 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |delta |field_comment_format |langcode |revision_id |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|30        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/8e/e7/abb7bfe3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>谢阳</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">10</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   如果不是 X…X01，那么有两种可能。第一，该线程重复获取同一把锁。此时，Java 虚拟机会将锁记录清零，以代表该锁被重复获取。第二，其他线程持有该锁。此时，Java 虚拟机会将这把锁膨胀为重量级锁，并且阻塞当前线程。
   <br>
   <br>老师这段不太明白。1 锁记录清零怎么理解？改变锁对象的标记字段吗？2 锁膨胀的时候其他线程还持有锁对象吧，这个时候膨胀会具体做什么操作？如果操作了锁对象的标记字段会影响稍后释放锁的cas吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/c9/f44cb7f3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>爪哇夜未眠</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">10</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   太抽象了，老师能画点儿图吗……
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 不好意思哈，因为网上有很多图，忘了放个链接了。<br><br>你可以参考wiki.openjdk.java.net/display/HotSpot/Synchronization中的图。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">7</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   恩，今天才补上小结，因为听不明白了，后来反复听以及补上锁的相关知识才有点明白。
   <br>我认为雨迪确实应该补上点图，这样才更容易理解，否则确实抽象，另外，我觉得讲解的次序有点小问题。
   <br>如果这样讲就更容易理解了（个人见解）
   <br>1:讲解一下锁的本质，锁到底是个什么东西？锁的特点容易理解，毕竟都见过摸过用过
   <br>
   <br>2:讲解一下锁的分类和特点，什么表锁、行锁、自旋锁、可重用锁、轻量锁、重量锁、阻塞锁、线程锁、进程锁、分布式锁、偏向锁等等吧！都是站在不同的角度或层级根据锁的特点，为了好区分给锁起的名字
   <br>
   <br>3:讲解一下JVM中的各种锁，讲解一下他们的特点和实现，然后讲解一下咱们本节的主角是属于哪一种或哪几种锁
   <br>
   <br>4:我的理解，锁的本质-在程序世界里是一种保证资源正确竞争的机制，如果没有对同一资源竞争也就没有了锁存在的意义，在计算世界中资源引起竞争的核心基本是空间，有其是计算机的内存空间，当然数据肯定也是一种引起激烈竞争的资源，不过往往会体现到空间上去，因为计算机中的数据必定存于某空间地址之中的
   <br>
   <br>5:感觉明白可重用锁的实现原理了，这个也是雨迪讲的最细致的一种实现方式，恩，非常感谢🙏
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 多谢建议！<br><br>本文的讲解流程是从通用锁算法到针对特殊情况的锁算法来的。一开始monitorenter是用重型锁的，然后为了针对没有竞争锁的情况有了轻型锁，再然后为了针对只有一个线程持有某个锁的情况有了偏向锁。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/57/449e76fb.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>QlDoors</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">5</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   练习试了无数遍，都没有偏向锁，后来上网查才发现需要加-XX:BiasedLockingStartupDelay=0。
   <br>
   <br>http://zhizus.com/2018-09-03-%E5%81%8F%E5%90%91%E9%94%81.html
   <br>
   <br>注意：Hotspot虚拟机在开机启动后有个延迟（4s），经过延迟后才会对每个创建的对象开启偏向锁。我们可以通过设置下面的参数来修改这个延迟，或者直接sleep一段时间-XX:BiasedLockingStartupDelay=0
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1Y9r3uuNQ1c5cbsk7XeVBEiamwwGsa7DuawliaFr6NG9yNZhdasOKXVdUpu1F3kVFibFWWZibeawjbg/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>code-arti...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   “当进行解锁操作时，如果当前锁记录（你可以将一个线程的所有锁记录想象成一个栈结构，每次加锁压入一条锁记录，解锁弹出一条锁记录，当前锁记录指的便是栈顶的锁记录）的值为 0，则代表重复进入同一把锁，直接返回即可。”
   <br>这种情况也需要弹出当前锁记录的吧？ 不然锁记录一直是0不变了。 如果是我这样理解的话，重复获取同一把锁的话，不是简单地清零，而应该是把0作为一条新的锁记录压入栈顶。
   <br>不知道我这样理解对不？请老师指点
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 对的！赞</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/cd/e1/368f872c.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>NEO🍋</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师关于偏向锁有个疑问 “它针对的是锁仅会被同一线程持有的情况。” 如果只有一个线程持有锁 还有必要加锁吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 哈，这个属于应用程序的问题，JVM只是观察到这种情况，并尝试做出优化。<br><br>有一种可能，就是很长一段时间内，只有一个线程频繁加锁，后面换成另外的线程，这样前面那段时间可以用偏向锁。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/c9/cb/7b6802cc.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>贾智文</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   文中说轻量级锁因为内存对齐所以标识位是00，那么为什么重量级锁的时候，存储内容也是指针，却没有内存对齐呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/0e/b1/aab3759b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>何yuan</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一直认为synchronized是重量锁，是否也不一定？jvm处理的时候是先将当偏向锁处理，然后慢慢膨胀为重量级锁的是吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 默认情况下是的。以前有个延缓毫秒数-XX:BiasedLockingStartupDelay，一开始用轻量级锁，在启动四秒之后才开始用偏向锁。我记得Java 9还是10默认值改为0了。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/b5/8bc4790b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_98716...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-18
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师请教个问题：
   <br>1：锁从偏向一直到重量级的过程是"单向不可逆"的，这个"单向不可逆"是限制在对象的整个生命周期，还是在对象到达了某个状态后再次有线程使用其作为锁对象还会继续重复这个过程？从每撤销一次对象的epoch值就会+1，而这个+1代表的就是偏向锁升级为轻量级锁，而每个对象又维护了一个epoch值代表对象撤销次数（偏向锁-&gt;轻量级锁次数），是不是就代表这个锁升级的过程会在不同的时间段重复发生n词？
   <br>2：为什么要设置一个最大的撤销次数（epoch值），意义在哪里？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 1. 单向不可逆 针对一个对象的整个生命周期。<br><br>epoch+1发生在多次同一类型的实例的偏向锁撤销之后，存放在类型(Class)那里的。<br><br>2. 当频繁检测到某个类的实例出现撤销偏向锁的，就代表这个类不适合用来搞偏向锁。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   请教一下，不是很明白epoch的作用，偏向锁默认被撤销20次使偏向锁失效才更新这个字段，没有想明白epoch的必要性
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/70/3a/6b82e940.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>(^o^)</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   “否则，Java 虚拟机会尝试用 CAS 操作，比较锁对象的标记字段的值是否为当前锁记录的地址。如果是，则替换为锁记录中的值，也就是锁对象原本的标记字段。此时，该线程已经成功释放这把锁。
   <br>
   <br>如果不是，则意味着这把锁已经被膨胀为重量级锁。”升级为重量级锁的过程，会改变锁对象的什么信息呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/09/5c/b5d79d20.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>李亮亮</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一个撤销阀值为40，一个撤销阀值为20 ，20这个表示超过这个次数那个这个偏向锁就换代了。epoch的值加1，如果撤销次数超过40就证明这个类不适合使用偏向锁。照这个数据来讲是不是意味着差不多换2代就表示该类不适合偏向锁了，不知道我理解的对不？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/e4/6e/ef9aece4.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>ゞ、今生绝...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   雨迪老师，我有个疑问：假设线程A加锁，CAS将锁对象对象头替换成指向线程A的Lock Record的地址，在这里，原值：对象mark word中的内容，也就是hashcode，期望值：本线程Lock Record地址，对象：锁对象，在替换成功后我们说线程A获得了锁，OK，线程A开始执行同步代码块，在它执行完之前，线程B来获取锁，发现属于轻量级锁标志，于是CAS替换mark word，此时CAS的原值仍然为为锁对象的mark word吧，而此时锁对象mark word中记录的不再是hashcode而是指向线程A的Lock Record的地址，但是对于CAS它管你对象头存的是什么，现在获取到什么，什么就是原值，于是：原值：对象头中指向线程A中LR的地址，期望值：线程B中LR（目前对他来说，是将锁对象中指向线程A中LR的地址存入本线程LR）的地址，目标对象：锁对象，怎么会CAS不成功？于是现在线程B也获取到锁，两个线程都会在执行同步代码块！我觉得我理解的哪块不对？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/91/51/234f9a73.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>王肖武</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   “当进行加锁操作时，Java 虚拟机会判断是否已经是重量级锁。如果不是，它会在当前线程的当前栈桢中划出一块空间，作为该锁的锁记录，并且将锁对象的标记字段复制到该锁记录中。”
   <br>有个疑问麻烦老师帮解答一下：栈帧不是一遍连续的空间吗？大小不是固定的吗？划出的空间是从哪里分配出来的呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/db/a4/3a1112ca.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>lincoln���...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   您好，文章写的挺好，读完有个问题想请教下：
   <br>当t1线程获取了某个对象锁（lock1）的偏向锁，还没执行完的时候，另外一个线程t2也尝试获取这个对象锁(lock1)，我看文章上说需要撤销偏向锁，等到达安全点的时候，再将偏向锁替换成轻量级锁。
   <br>我有个问题：两个线程同时竞争同一把锁的情况，轻量级锁也解决不了吧，只能用重量级锁解决吧？为什么还要替换成轻量级锁呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/09/30/ff83622b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>LINEZH</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   有一个疑问, JVM是如何选择使用重量锁/轻量锁/自旋锁呢? 是在执行的时候根据锁和线程的情况决定吗, 能不能说的具体一点?
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/0e/1b/1902d6fa.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>第9根烟</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   这边验证了Object.hashCode() 不会关闭该对象的偏向锁。。不知道最后答案是什么？哪里有全篇的课后作业的答案？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/60/d9/829ac53b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>fangxuan</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-05
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   单线程情况下，开启偏向锁和不开启偏向锁，性能上有什么差别吗？差别在哪儿？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>yihang</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-27
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师您好，我是这几天才开始学习这个专栏。有这么几个问题，觉得读完文章也未能找到答案，请老师解答：
   <br>1） 如果轻量级锁已经发现有竞争，膨胀为重量级锁，那么之前拥有锁的线程，解锁时会唤醒该对象上的阻塞线程。这句话我理解了，但这时对象上的Mark Word 还是重量级锁的指针（状态10）吗？直到最后一个线程释放了锁，对象上的Mark Word 仍然保持状态 10 还是会恢复到无锁的状态（01）？还是从这往后就始终保持重量级锁的状态了？
   <br>
   <br>2）偏向锁中的 Rebias 和 revoke bias 应该是不同的概念吧，字面意思，后者应该是撤销偏向，而前者似乎是重用偏向。【如果某一类锁对象的总撤销数超过了一个阈值（对应 Java 虚拟机参数 -XX:BiasedLockingBulkRebiasThreshold，默认为 20），那么 Java 虚拟机会宣布这个类的偏向锁失效。】说实话这句话真没看懂，什么叫【这个类的偏向锁失效】，感觉这个参数是为了优化偏向锁，能够让偏向锁得以重用
   <br>我在 stackoverflow上找了一篇解释：
   <br>subsequent bulk rebias is possible if and only if number of revokes more than BiasedLockingBulkRebiasThreshold and less than BiasedLockingBulkRevokeThreshold and the latest revoke was not later than BiasedLockingDecayTime, where all escaped variables are JVM properties.
   <br>不知道他说的是否在理？请指教，地址：https://stackoverflow.com/questions/46312817/does-java-ever-rebias-an-individual-lock
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>shawn</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师对于轻量级锁可以这样理解么？如下： “轻量级锁，b线程在锁竞争时，发现锁已经被a线程占用，则b线程不进入内核态，让b线程自旋，执行空循环，等待a线程释放锁。如果，完成自旋策略还是发现a线程没有释放锁，或者让c线程占用了。则b线程试图将轻量级锁升级为重量级锁。”
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |30          |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:47:25.564 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=30 
 {executed in 5 msec}
2020-11-19 20:47:25.586 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |delta |field_comment_format |langcode |revision_id |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/8e/e7/abb7bfe3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>谢阳</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">10</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   如果不是 X…X01，那么有两种可能。第一，该线程重复获取同一把锁。此时，Java 虚拟机会将锁记录清零，以代表该锁被重复获取。第二，其他线程持有该锁。此时，Java 虚拟机会将这把锁膨胀为重量级锁，并且阻塞当前线程。
   <br>
   <br>老师这段不太明白。1 锁记录清零怎么理解？改变锁对象的标记字段吗？2 锁膨胀的时候其他线程还持有锁对象吧，这个时候膨胀会具体做什么操作？如果操作了锁对象的标记字段会影响稍后释放锁的cas吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/c9/f44cb7f3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>爪哇夜未眠</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">10</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   太抽象了，老师能画点儿图吗……
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 不好意思哈，因为网上有很多图，忘了放个链接了。<br><br>你可以参考wiki.openjdk.java.net/display/HotSpot/Synchronization中的图。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">7</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   恩，今天才补上小结，因为听不明白了，后来反复听以及补上锁的相关知识才有点明白。
   <br>我认为雨迪确实应该补上点图，这样才更容易理解，否则确实抽象，另外，我觉得讲解的次序有点小问题。
   <br>如果这样讲就更容易理解了（个人见解）
   <br>1:讲解一下锁的本质，锁到底是个什么东西？锁的特点容易理解，毕竟都见过摸过用过
   <br>
   <br>2:讲解一下锁的分类和特点，什么表锁、行锁、自旋锁、可重用锁、轻量锁、重量锁、阻塞锁、线程锁、进程锁、分布式锁、偏向锁等等吧！都是站在不同的角度或层级根据锁的特点，为了好区分给锁起的名字
   <br>
   <br>3:讲解一下JVM中的各种锁，讲解一下他们的特点和实现，然后讲解一下咱们本节的主角是属于哪一种或哪几种锁
   <br>
   <br>4:我的理解，锁的本质-在程序世界里是一种保证资源正确竞争的机制，如果没有对同一资源竞争也就没有了锁存在的意义，在计算世界中资源引起竞争的核心基本是空间，有其是计算机的内存空间，当然数据肯定也是一种引起激烈竞争的资源，不过往往会体现到空间上去，因为计算机中的数据必定存于某空间地址之中的
   <br>
   <br>5:感觉明白可重用锁的实现原理了，这个也是雨迪讲的最细致的一种实现方式，恩，非常感谢🙏
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 多谢建议！<br><br>本文的讲解流程是从通用锁算法到针对特殊情况的锁算法来的。一开始monitorenter是用重型锁的，然后为了针对没有竞争锁的情况有了轻型锁，再然后为了针对只有一个线程持有某个锁的情况有了偏向锁。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/57/449e76fb.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>QlDoors</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">5</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   练习试了无数遍，都没有偏向锁，后来上网查才发现需要加-XX:BiasedLockingStartupDelay=0。
   <br>
   <br>http://zhizus.com/2018-09-03-%E5%81%8F%E5%90%91%E9%94%81.html
   <br>
   <br>注意：Hotspot虚拟机在开机启动后有个延迟（4s），经过延迟后才会对每个创建的对象开启偏向锁。我们可以通过设置下面的参数来修改这个延迟，或者直接sleep一段时间-XX:BiasedLockingStartupDelay=0
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1Y9r3uuNQ1c5cbsk7XeVBEiamwwGsa7DuawliaFr6NG9yNZhdasOKXVdUpu1F3kVFibFWWZibeawjbg/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>code-arti...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   “当进行解锁操作时，如果当前锁记录（你可以将一个线程的所有锁记录想象成一个栈结构，每次加锁压入一条锁记录，解锁弹出一条锁记录，当前锁记录指的便是栈顶的锁记录）的值为 0，则代表重复进入同一把锁，直接返回即可。”
   <br>这种情况也需要弹出当前锁记录的吧？ 不然锁记录一直是0不变了。 如果是我这样理解的话，重复获取同一把锁的话，不是简单地清零，而应该是把0作为一条新的锁记录压入栈顶。
   <br>不知道我这样理解对不？请老师指点
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 对的！赞</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/cd/e1/368f872c.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>NEO🍋</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师关于偏向锁有个疑问 “它针对的是锁仅会被同一线程持有的情况。” 如果只有一个线程持有锁 还有必要加锁吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 哈，这个属于应用程序的问题，JVM只是观察到这种情况，并尝试做出优化。<br><br>有一种可能，就是很长一段时间内，只有一个线程频繁加锁，后面换成另外的线程，这样前面那段时间可以用偏向锁。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/c9/cb/7b6802cc.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>贾智文</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   文中说轻量级锁因为内存对齐所以标识位是00，那么为什么重量级锁的时候，存储内容也是指针，却没有内存对齐呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/0e/b1/aab3759b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>何yuan</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一直认为synchronized是重量锁，是否也不一定？jvm处理的时候是先将当偏向锁处理，然后慢慢膨胀为重量级锁的是吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 默认情况下是的。以前有个延缓毫秒数-XX:BiasedLockingStartupDelay，一开始用轻量级锁，在启动四秒之后才开始用偏向锁。我记得Java 9还是10默认值改为0了。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/b5/8bc4790b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_98716...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-18
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师请教个问题：
   <br>1：锁从偏向一直到重量级的过程是"单向不可逆"的，这个"单向不可逆"是限制在对象的整个生命周期，还是在对象到达了某个状态后再次有线程使用其作为锁对象还会继续重复这个过程？从每撤销一次对象的epoch值就会+1，而这个+1代表的就是偏向锁升级为轻量级锁，而每个对象又维护了一个epoch值代表对象撤销次数（偏向锁-&gt;轻量级锁次数），是不是就代表这个锁升级的过程会在不同的时间段重复发生n词？
   <br>2：为什么要设置一个最大的撤销次数（epoch值），意义在哪里？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 1. 单向不可逆 针对一个对象的整个生命周期。<br><br>epoch+1发生在多次同一类型的实例的偏向锁撤销之后，存放在类型(Class)那里的。<br><br>2. 当频繁检测到某个类的实例出现撤销偏向锁的，就代表这个类不适合用来搞偏向锁。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   请教一下，不是很明白epoch的作用，偏向锁默认被撤销20次使偏向锁失效才更新这个字段，没有想明白epoch的必要性
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/70/3a/6b82e940.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>(^o^)</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   “否则，Java 虚拟机会尝试用 CAS 操作，比较锁对象的标记字段的值是否为当前锁记录的地址。如果是，则替换为锁记录中的值，也就是锁对象原本的标记字段。此时，该线程已经成功释放这把锁。
   <br>
   <br>如果不是，则意味着这把锁已经被膨胀为重量级锁。”升级为重量级锁的过程，会改变锁对象的什么信息呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/09/5c/b5d79d20.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>李亮亮</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一个撤销阀值为40，一个撤销阀值为20 ，20这个表示超过这个次数那个这个偏向锁就换代了。epoch的值加1，如果撤销次数超过40就证明这个类不适合使用偏向锁。照这个数据来讲是不是意味着差不多换2代就表示该类不适合偏向锁了，不知道我理解的对不？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/e4/6e/ef9aece4.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>ゞ、今生绝...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   雨迪老师，我有个疑问：假设线程A加锁，CAS将锁对象对象头替换成指向线程A的Lock Record的地址，在这里，原值：对象mark word中的内容，也就是hashcode，期望值：本线程Lock Record地址，对象：锁对象，在替换成功后我们说线程A获得了锁，OK，线程A开始执行同步代码块，在它执行完之前，线程B来获取锁，发现属于轻量级锁标志，于是CAS替换mark word，此时CAS的原值仍然为为锁对象的mark word吧，而此时锁对象mark word中记录的不再是hashcode而是指向线程A的Lock Record的地址，但是对于CAS它管你对象头存的是什么，现在获取到什么，什么就是原值，于是：原值：对象头中指向线程A中LR的地址，期望值：线程B中LR（目前对他来说，是将锁对象中指向线程A中LR的地址存入本线程LR）的地址，目标对象：锁对象，怎么会CAS不成功？于是现在线程B也获取到锁，两个线程都会在执行同步代码块！我觉得我理解的哪块不对？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/91/51/234f9a73.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>王肖武</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   “当进行加锁操作时，Java 虚拟机会判断是否已经是重量级锁。如果不是，它会在当前线程的当前栈桢中划出一块空间，作为该锁的锁记录，并且将锁对象的标记字段复制到该锁记录中。”
   <br>有个疑问麻烦老师帮解答一下：栈帧不是一遍连续的空间吗？大小不是固定的吗？划出的空间是从哪里分配出来的呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/db/a4/3a1112ca.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>lincoln���...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   您好，文章写的挺好，读完有个问题想请教下：
   <br>当t1线程获取了某个对象锁（lock1）的偏向锁，还没执行完的时候，另外一个线程t2也尝试获取这个对象锁(lock1)，我看文章上说需要撤销偏向锁，等到达安全点的时候，再将偏向锁替换成轻量级锁。
   <br>我有个问题：两个线程同时竞争同一把锁的情况，轻量级锁也解决不了吧，只能用重量级锁解决吧？为什么还要替换成轻量级锁呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/09/30/ff83622b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>LINEZH</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   有一个疑问, JVM是如何选择使用重量锁/轻量锁/自旋锁呢? 是在执行的时候根据锁和线程的情况决定吗, 能不能说的具体一点?
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/0e/1b/1902d6fa.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>第9根烟</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   这边验证了Object.hashCode() 不会关闭该对象的偏向锁。。不知道最后答案是什么？哪里有全篇的课后作业的答案？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/60/d9/829ac53b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>fangxuan</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-05
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   单线程情况下，开启偏向锁和不开启偏向锁，性能上有什么差别吗？差别在哪儿？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>yihang</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-27
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师您好，我是这几天才开始学习这个专栏。有这么几个问题，觉得读完文章也未能找到答案，请老师解答：
   <br>1） 如果轻量级锁已经发现有竞争，膨胀为重量级锁，那么之前拥有锁的线程，解锁时会唤醒该对象上的阻塞线程。这句话我理解了，但这时对象上的Mark Word 还是重量级锁的指针（状态10）吗？直到最后一个线程释放了锁，对象上的Mark Word 仍然保持状态 10 还是会恢复到无锁的状态（01）？还是从这往后就始终保持重量级锁的状态了？
   <br>
   <br>2）偏向锁中的 Rebias 和 revoke bias 应该是不同的概念吧，字面意思，后者应该是撤销偏向，而前者似乎是重用偏向。【如果某一类锁对象的总撤销数超过了一个阈值（对应 Java 虚拟机参数 -XX:BiasedLockingBulkRebiasThreshold，默认为 20），那么 Java 虚拟机会宣布这个类的偏向锁失效。】说实话这句话真没看懂，什么叫【这个类的偏向锁失效】，感觉这个参数是为了优化偏向锁，能够让偏向锁得以重用
   <br>我在 stackoverflow上找了一篇解释：
   <br>subsequent bulk rebias is possible if and only if number of revokes more than BiasedLockingBulkRebiasThreshold and less than BiasedLockingBulkRevokeThreshold and the latest revoke was not later than BiasedLockingDecayTime, where all escaped variables are JVM properties.
   <br>不知道他说的是否在理？请指教，地址：https://stackoverflow.com/questions/46312817/does-java-ever-rebias-an-individual-lock
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>shawn</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师对于轻量级锁可以这样理解么？如下： “轻量级锁，b线程在锁竞争时，发现锁已经被a线程占用，则b线程不进入内核态，让b线程自旋，执行空循环，等待a线程释放锁。如果，完成自旋策略还是发现a线程没有释放锁，或者让c线程占用了。则b线程试图将轻量级锁升级为重量级锁。”
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |30          |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:47:25.646 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=30 
 {executed in 2 msec}
2020-11-19 20:47:25.648 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|30        |book   |0     |zh-hans  |30          |https://static001.geekbang.org/resource/image/24/01/24c2733f6cb363952b2fb1d7607f8301.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:47:25.679 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=30 
 {executed in 2 msec}
2020-11-19 20:47:25.683 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |30          |https://static001.geekbang.org/resource/image/24/01/24c2733f6cb363952b2fb1d7607f8301.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:47:25.715 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=30 
 {executed in 6 msec}
2020-11-19 20:47:25.717 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |30          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:47:25.747 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=30 
 {executed in 4 msec}
2020-11-19 20:47:25.749 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |30          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:47:25.770 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='319299995716834' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:47:25.772 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|63      |319299995716834 |0   |net_content |
|--------|----------------|----|------------|

2020-11-19 20:47:47.676 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='319299995716834' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:47:47.680 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|63      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:47:47.701 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='319299995716834', got=1, name='net_content' where item_id=63 
 {executed in 1 msec}
2020-11-19 20:47:47.723 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='319299995716834' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:47:47.725 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------|
|item_id |fsid            |got |name  |
|--------|----------------|----|------|
|64      |319299995716834 |1   |media |
|--------|----------------|----|------|

2020-11-19 20:47:47.728 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='319299995716834' 
 {executed in 1 msec}
2020-11-19 20:47:47.730 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|31        |book   |0     |319299995716834  |zh-hans  |31          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:47:47.733 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=31 
 {executed in 1 msec}
2020-11-19 20:47:47.735 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|31  |zh-hans  |book |262b556a-e638-4a77-8ddf-ac8e6af3dcd6 |31  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:47:47.755 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=31 
 {executed in 1 msec}
2020-11-19 20:47:47.757 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |319299995716834  |zh-hans  |31          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:47:47.776 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=31 
 {executed in 1 msec}
2020-11-19 20:47:47.778 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|31  |1   |3     |0            |1  |19 |31 |0  |0  |19  |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:47:47.800 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=31 
 {executed in 2 msec}
2020-11-19 20:47:47.827 INFO  jdbc.resultsettable Line:610 - 
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|31        |<p>我们先来看一个反常识的例子。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int a=0, b=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method1() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method2() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r1 = b;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        a = 2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>这里我定义了两个共享变量 a 和 b，以及两个方法。第一个方法将局部变量 r2 赋值为 a，然后将共享变量 b 赋值为 1。第二个方法将局部变量 r1 赋值为 b，然后将共享变量 a 赋值为 2。请问（r1，r2）的可能值都有哪些？</p> 
<p>在单线程环境下，我们可以先调用第一个方法，最终（r1，r2）为（1，0）；也可以先调用第二个方法，最终为（0，2）。</p> 
<p>在多线程环境下，假设这两个方法分别跑在两个不同的线程之上，如果 Java 虚拟机在执行了任一方法的第一条赋值语句之后便切换线程，那么最终结果将可能出现（0，0）的情况。</p> 
<p>除上述三种情况之外，Java 语言规范第 17.4 小节 [1] 还介绍了一种看似不可能的情况（1，2）。</p> 
<p>造成这一情况的原因有三个，分别为即时编译器的重排序，处理器的乱序执行，以及内存系统的重排序。由于后两种原因涉及具体的体系架构，我们暂且放到一边。下面我先来讲一下编译器优化的重排序是怎么一回事。</p> 
<p>首先需要说明一点，即时编译器（和处理器）需要保证程序能够遵守 as-if-serial 属性。通俗地说，就是在单线程情况下，要给程序一个顺序执行的假象。即经过重排序的执行结果要与顺序执行的结果保持一致。</p><!-- [[[read_end]]] --> 
<p>另外，如果两个操作之间存在数据依赖，那么即时编译器（和处理器）不能调整它们的顺序，否则将会造成程序语义的改变。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int a=0, b=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method1() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .. // Code uses b
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (r2 == 2) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .. 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>在上面这段代码中，我扩展了先前例子中的第一个方法。新增的代码会先使用共享变量 b 的值，然后再使用局部变量 r2 的值。</p> 
<p>此时，即时编译器有两种选择。</p> 
<p>第一，在一开始便将 a 加载至某一寄存器中，并且在接下来 b 的赋值操作以及使用 b 的代码中避免使用该寄存器。第二，在真正使用 r2 时才将 a 加载至寄存器中。这么一来，在执行使用 b 的代码时，我们不再霸占一个通用寄存器，从而减少需要借助栈空间的情况。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int a=0, b=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method1() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (..) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .. // Code uses r2 and rewrites a
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>另一个例子则是将第一个方法的代码放入一个循环中。除了原本的两条赋值语句之外，我只在循环中添加了使用 r2，并且更新 a 的代码。由于对 b 的赋值是循环无关的，即时编译器很有可能将其移出循环之前，而对 r2 的赋值语句还停留在循环之中。</p> 
<p>如果想要复现这两个场景，你可能需要添加大量有意义的局部变量，来给寄存器分配算法施加压力。</p> 
<p>可以看到，即时编译器的优化可能将原本字段访问的执行顺序打乱。在单线程环境下，由于 as-if-serial 的保证，我们无须担心顺序执行不可能发生的情况，如（r1，r2）=（1，2）。</p> 
<p>然而，在多线程情况下，这种数据竞争（data race）的情况是有可能发生的。而且，Java 语言规范将其归咎于应用程序没有作出恰当的同步操作。</p> 
<h2>Java 内存模型与 happens-before 关系</h2> 
<p>为了让应用程序能够免于数据竞争的干扰，Java 5 引入了明确定义的 Java 内存模型。其中最为重要的一个概念便是 happens-before 关系。happens-before 关系是用来描述两个操作的内存可见性的。如果操作 X happens-before 操作 Y，那么 X 的结果对于 Y 可见。</p> 
<p>在同一个线程中，字节码的先后顺序（program order）也暗含了 happens-before 关系：在程序控制流路径中靠前的字节码 happens-before 靠后的字节码。然而，这并不意味着前者一定在后者之前执行。实际上，如果后者没有观测前者的运行结果，即后者没有数据依赖于前者，那么它们可能会被重排序。</p> 
<p>除了线程内的 happens-before 关系之外，Java 内存模型还定义了下述线程间的 happens-before 关系。</p> 
<ol> 
 <li>解锁操作 happens-before 之后（这里指时钟顺序先后）对同一把锁的加锁操作。</li> 
 <li>volatile 字段的写操作 happens-before 之后（这里指时钟顺序先后）对同一字段的读操作。</li> 
 <li>线程的启动操作（即 Thread.starts()） happens-before 该线程的第一个操作。</li> 
 <li>线程的最后一个操作 happens-before 它的终止事件（即其他线程通过 Thread.isAlive() 或 Thread.join() 判断该线程是否中止）。</li> 
 <li>线程对其他线程的中断操作 happens-before 被中断线程所收到的中断事件（即被中断线程的 InterruptedException 异常，或者第三个线程针对被中断线程的 Thread.interrupted 或者 Thread.isInterrupted 调用）。</li> 
 <li>构造器中的最后一个操作 happens-before 析构器的第一个操作。</li> 
</ol> 
<p>happens-before 关系还具备传递性。如果操作 X happens-before 操作 Y，而操作 Y happens-before 操作 Z，那么操作 X happens-before 操作 Z。</p> 
<p>在文章开头的例子中，程序没有定义任何 happens-before 关系，仅拥有默认的线程内 happens-before 关系。也就是 r2 的赋值操作 happens-before b 的赋值操作，r1 的赋值操作 happens-before a 的赋值操作。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Thread1 Thread2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        | |
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b=1 |
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        | r1=b
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        | a=2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       r2=a | 
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>拥有 happens-before 关系的两对赋值操作之间没有数据依赖，因此即时编译器、处理器都可能对其进行重排序。举例来说，只要将 b 的赋值操作排在 r2 的赋值操作之前，那么便可以按照赋值 b，赋值 r1，赋值 a，赋值 r2 的顺序得到（1，2）的结果。</p> 
<p>那么如何解决这个问题呢？答案是，将 a 或者 b 设置为 volatile 字段。</p> 
<p>比如说将 b 设置为 volatile 字段。假设 r1 能够观测到 b 的赋值结果 1。显然，这需要 b 的赋值操作在时钟顺序上先于 r1 的赋值操作。根据 volatile 字段的 happens-before 关系，我们知道 b 的赋值操作 happens-before r1 的赋值操作。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int a=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       volatile int b=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method1() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method2() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r1 = b;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        a = 2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>根据同一个线程中，字节码顺序所暗含的 happens-before 关系，以及 happens-before 关系的传递性，我们可以轻易得出 r2 的赋值操作 happens-before a 的赋值操作。</p> 
<p>这也就意味着，当对 a 进行赋值时，对 r2 的赋值操作已经完成了。因此，在 b 为 volatile 字段的情况下，程序不可能出现（r1，r2）为（1，2）的情况。</p> 
<p>由此可以看出，解决这种数据竞争问题的关键在于构造一个跨线程的 happens-before 关系 ：操作 X happens-before 操作 Y，使得操作 X 之前的字节码的结果对操作 Y 之后的字节码可见。</p> 
<h2>Java 内存模型的底层实现</h2> 
<p>在理解了 Java 内存模型的概念之后，我们现在来看看它的底层实现。Java 内存模型是通过内存屏障（memory barrier）来禁止重排序的。</p> 
<p>对于即时编译器来说，它会针对前面提到的每一个 happens-before 关系，向正在编译的目标方法中插入相应的读读、读写、写读以及写写内存屏障。</p> 
<p>这些内存屏障会限制即时编译器的重排序操作。以 volatile 字段访问为例，所插入的内存屏障将不允许 volatile 字段写操作之前的内存访问被重排序至其之后；也将不允许 volatile 字段读操作之后的内存访问被重排序至其之前。</p> 
<p>然后，即时编译器将根据具体的底层体系架构，将这些内存屏障替换成具体的 CPU 指令。以我们日常接触的 X86_64 架构来说，读读、读写以及写写内存屏障是空操作（no-op），只有写读内存屏障会被替换成具体指令 [2]。</p> 
<p>在文章开头的例子中，method1 和 method2 之中的代码均属于先读后写（假设 r1 和 r2 被存储在寄存器之中）。X86_64 架构的处理器并不能将读操作重排序至写操作之后，具体可参考 Intel Software Developer Manual Volumn 3，8.2.3.3 小节。因此，我认为例子中的重排序必然是即时编译器造成的。</p> 
<p>举例来说，对于 volatile 字段，即时编译器将在 volatile 字段的读写操作前后各插入一些内存屏障。</p> 
<p>然而，在 X86_64 架构上，只有 volatile 字段写操作之后的写读内存屏障需要用具体指令来替代。（HotSpot 所选取的具体指令是 lock add DWORD PTR [rsp],0x0，而非 mfence[3]。）</p> 
<p>该具体指令的效果，可以简单理解为强制刷新处理器的写缓存。写缓存是处理器用来加速内存存储效率的一项技术。</p> 
<p>在碰到内存写操作时，处理器并不会等待该指令结束，而是直接开始下一指令，并且依赖于写缓存将更改的数据同步至主内存（main memory）之中。</p> 
<p>强制刷新写缓存，将使得当前线程写入 volatile 字段的值（以及写缓存中已有的其他内存修改），同步至主内存之中。</p> 
<p>由于内存写操作同时会无效化其他处理器所持有的、指向同一内存地址的缓存行，因此可以认为其他处理器能够立即见到该 volatile 字段的最新值。</p> 
<h2>锁，volatile 字段，final 字段与安全发布</h2> 
<p>下面我来讲讲 Java 内存模型涉及的几个关键词。</p> 
<p>前面提到，锁操作同样具备 happens-before 关系。具体来说，解锁操作 happens-before 之后对同一把锁的加锁操作。实际上，在解锁时，Java 虚拟机同样需要强制刷新缓存，使得当前线程所修改的内存对其他线程可见。</p> 
<p>需要注意的是，锁操作的 happens-before 规则的关键字是同一把锁。也就意味着，如果编译器能够（通过逃逸分析）证明某把锁仅被同一线程持有，那么它可以移除相应的加锁解锁操作。</p> 
<p>因此也就不再强制刷新缓存。举个例子，即时编译后的 synchronized (new Object()) {}，可能等同于空操作，而不会强制刷新缓存。</p> 
<p>volatile 字段可以看成一种轻量级的、不保证原子性的同步，其性能往往优于（至少不亚于）锁操作。然而，频繁地访问 volatile 字段也会因为不断地强制刷新缓存而严重影响程序的性能。</p> 
<p>在 X86_64 平台上，只有 volatile 字段的写操作会强制刷新缓存。因此，理想情况下对 volatile 字段的使用应当多读少写，并且应当只有一个线程进行写操作。</p> 
<p>volatile 字段的另一个特性是即时编译器无法将其分配到寄存器里。换句话说，volatile 字段的每次访问均需要直接从内存中读写。</p> 
<p>final 实例字段则涉及新建对象的发布问题。当一个对象包含 final 实例字段时，我们希望其他线程只能看到已初始化的 final 实例字段。</p> 
<p>因此，即时编译器会在 final 字段的写操作后插入一个写写屏障，以防某些优化将新建对象的发布（即将实例对象写入一个共享引用中）重排序至 final 字段的写操作之前。在 X86_64 平台上，写写屏障是空操作。</p> 
<p>新建对象的安全发布（safe publication）问题不仅仅包括 final 实例字段的可见性，还包括其他实例字段的可见性。</p> 
<p>当发布一个已初始化的对象时，我们希望所有已初始化的实例字段对其他线程可见。否则，其他线程可能见到一个仅部分初始化的新建对象，从而造成程序错误。这里我就不展开了。如果你感兴趣的话，可以参考这篇博客 [4]。</p> 
<h2>总结与实践</h2> 
<p>今天我主要介绍了 Java 的内存模型。</p> 
<p>Java 内存模型通过定义了一系列的 happens-before 操作，让应用程序开发者能够轻易地表达不同线程的操作之间的内存可见性。</p> 
<p>在遵守 Java 内存模型的前提下，即时编译器以及底层体系架构能够调整内存访问操作，以达到性能优化的效果。如果开发者没有正确地利用 happens-before 规则，那么将可能导致数据竞争。</p> 
<p>Java 内存模型是通过内存屏障来禁止重排序的。对于即时编译器来说，内存屏障将限制它所能做的重排序优化。对于处理器来说，内存屏障会导致缓存的刷新操作。</p> 
<p>今天的实践环节，我们来复现文章初始的例子。由于复现需要大量的线程切换事件，因此我借助了 OpenJDK CodeTools 项目的 jcstress 工具 [5]，来对该例子进行并发情况下的压力测试。具体的命令如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ mvn archetype:generate -DinteractiveMode=false -DarchetypeGroupId=org.openjdk.jcstress -DarchetypeArtifactId=jcstress-java-test-archetype -DarchetypeVersion=0.1.1 -DgroupId=org.sample -DartifactId=test -Dversion=1.0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ cd test
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ echo 'package org.sample;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.openjdk.jcstress.annotations.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.openjdk.jcstress.infra.results.IntResult2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @JCStressTest
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @Outcome(id = {"0, 0", "0, 2", "1, 0"}, expect = Expect.ACCEPTABLE, desc = "Normal outcome")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @Outcome(id = {"1, 2"}, expect = Expect.ACCEPTABLE_INTERESTING, desc = "Abnormal outcome")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @State
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class ConcurrencyTest {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int a=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int b=0; // 改成 volatile 试试？
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Actor
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void method1(IntResult2 r) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        r.r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Actor
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void method2(IntResult2 r) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        r.r1 = b;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        a = 2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }' &gt; src/main/java/org/sample/ConcurrencyTest.java
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ mvn package
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -jar target/jcstress.jar
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>如果你想要复现非安全发布的情形，那么你可以试试这一测试用例 [6]。</p> 
<p>[1] <a href="https://docs.oracle.com/javase/specs/jls/se10/html/jls-17.html#jls-17.4">https://docs.oracle.com/javase/specs/jls/se10/html/jls-17.html#jls-17.4</a><br> [2] <a href="http://gee.cs.oswego.edu/dl/jmm/cookbook.html">http://gee.cs.oswego.edu/dl/jmm/cookbook.html</a><br> [3] <a href="https://blogs.oracle.com/dave/instruction-selection-for-volatile-fences-:-mfence-vs-lock:add">https://blogs.oracle.com/dave/instruction-selection-for-volatile-fences-:-mfence-vs-lock:add</a><br> [4] <a href="http://vlkan.com/blog/post/2014/02/14/java-safe-publication/">http://vlkan.com/blog/post/2014/02/14/java-safe-publication/</a><br> [5] <a href="https://wiki.openjdk.java.net/display/CodeTools/jcstress">https://wiki.openjdk.java.net/display/CodeTools/jcstress</a><br> [6] <a href="http://hg.openjdk.java.net/code-tools/jcstress/file/64f2cf32fa0a/tests-custom/src/main/java/org/openjdk/jcstress/tests/unsafe/UnsafePublication.java">http://hg.openjdk.java.net/code-tools/jcstress/file/64f2cf32fa0a/tests-custom/src/main/java/org/openjdk/jcstress/tests/unsafe/UnsafePublication.java</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |31          |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:47:47.842 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=31 
 {executed in 3 msec}
2020-11-19 20:47:47.870 INFO  jdbc.resultsettable Line:610 - 
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>我们先来看一个反常识的例子。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int a=0, b=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method1() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method2() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r1 = b;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        a = 2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>这里我定义了两个共享变量 a 和 b，以及两个方法。第一个方法将局部变量 r2 赋值为 a，然后将共享变量 b 赋值为 1。第二个方法将局部变量 r1 赋值为 b，然后将共享变量 a 赋值为 2。请问（r1，r2）的可能值都有哪些？</p> 
<p>在单线程环境下，我们可以先调用第一个方法，最终（r1，r2）为（1，0）；也可以先调用第二个方法，最终为（0，2）。</p> 
<p>在多线程环境下，假设这两个方法分别跑在两个不同的线程之上，如果 Java 虚拟机在执行了任一方法的第一条赋值语句之后便切换线程，那么最终结果将可能出现（0，0）的情况。</p> 
<p>除上述三种情况之外，Java 语言规范第 17.4 小节 [1] 还介绍了一种看似不可能的情况（1，2）。</p> 
<p>造成这一情况的原因有三个，分别为即时编译器的重排序，处理器的乱序执行，以及内存系统的重排序。由于后两种原因涉及具体的体系架构，我们暂且放到一边。下面我先来讲一下编译器优化的重排序是怎么一回事。</p> 
<p>首先需要说明一点，即时编译器（和处理器）需要保证程序能够遵守 as-if-serial 属性。通俗地说，就是在单线程情况下，要给程序一个顺序执行的假象。即经过重排序的执行结果要与顺序执行的结果保持一致。</p><!-- [[[read_end]]] --> 
<p>另外，如果两个操作之间存在数据依赖，那么即时编译器（和处理器）不能调整它们的顺序，否则将会造成程序语义的改变。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int a=0, b=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method1() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .. // Code uses b
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (r2 == 2) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .. 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>在上面这段代码中，我扩展了先前例子中的第一个方法。新增的代码会先使用共享变量 b 的值，然后再使用局部变量 r2 的值。</p> 
<p>此时，即时编译器有两种选择。</p> 
<p>第一，在一开始便将 a 加载至某一寄存器中，并且在接下来 b 的赋值操作以及使用 b 的代码中避免使用该寄存器。第二，在真正使用 r2 时才将 a 加载至寄存器中。这么一来，在执行使用 b 的代码时，我们不再霸占一个通用寄存器，从而减少需要借助栈空间的情况。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int a=0, b=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method1() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (..) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .. // Code uses r2 and rewrites a
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>另一个例子则是将第一个方法的代码放入一个循环中。除了原本的两条赋值语句之外，我只在循环中添加了使用 r2，并且更新 a 的代码。由于对 b 的赋值是循环无关的，即时编译器很有可能将其移出循环之前，而对 r2 的赋值语句还停留在循环之中。</p> 
<p>如果想要复现这两个场景，你可能需要添加大量有意义的局部变量，来给寄存器分配算法施加压力。</p> 
<p>可以看到，即时编译器的优化可能将原本字段访问的执行顺序打乱。在单线程环境下，由于 as-if-serial 的保证，我们无须担心顺序执行不可能发生的情况，如（r1，r2）=（1，2）。</p> 
<p>然而，在多线程情况下，这种数据竞争（data race）的情况是有可能发生的。而且，Java 语言规范将其归咎于应用程序没有作出恰当的同步操作。</p> 
<h2>Java 内存模型与 happens-before 关系</h2> 
<p>为了让应用程序能够免于数据竞争的干扰，Java 5 引入了明确定义的 Java 内存模型。其中最为重要的一个概念便是 happens-before 关系。happens-before 关系是用来描述两个操作的内存可见性的。如果操作 X happens-before 操作 Y，那么 X 的结果对于 Y 可见。</p> 
<p>在同一个线程中，字节码的先后顺序（program order）也暗含了 happens-before 关系：在程序控制流路径中靠前的字节码 happens-before 靠后的字节码。然而，这并不意味着前者一定在后者之前执行。实际上，如果后者没有观测前者的运行结果，即后者没有数据依赖于前者，那么它们可能会被重排序。</p> 
<p>除了线程内的 happens-before 关系之外，Java 内存模型还定义了下述线程间的 happens-before 关系。</p> 
<ol> 
 <li>解锁操作 happens-before 之后（这里指时钟顺序先后）对同一把锁的加锁操作。</li> 
 <li>volatile 字段的写操作 happens-before 之后（这里指时钟顺序先后）对同一字段的读操作。</li> 
 <li>线程的启动操作（即 Thread.starts()） happens-before 该线程的第一个操作。</li> 
 <li>线程的最后一个操作 happens-before 它的终止事件（即其他线程通过 Thread.isAlive() 或 Thread.join() 判断该线程是否中止）。</li> 
 <li>线程对其他线程的中断操作 happens-before 被中断线程所收到的中断事件（即被中断线程的 InterruptedException 异常，或者第三个线程针对被中断线程的 Thread.interrupted 或者 Thread.isInterrupted 调用）。</li> 
 <li>构造器中的最后一个操作 happens-before 析构器的第一个操作。</li> 
</ol> 
<p>happens-before 关系还具备传递性。如果操作 X happens-before 操作 Y，而操作 Y happens-before 操作 Z，那么操作 X happens-before 操作 Z。</p> 
<p>在文章开头的例子中，程序没有定义任何 happens-before 关系，仅拥有默认的线程内 happens-before 关系。也就是 r2 的赋值操作 happens-before b 的赋值操作，r1 的赋值操作 happens-before a 的赋值操作。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Thread1 Thread2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        | |
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b=1 |
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        | r1=b
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        | a=2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       r2=a | 
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>拥有 happens-before 关系的两对赋值操作之间没有数据依赖，因此即时编译器、处理器都可能对其进行重排序。举例来说，只要将 b 的赋值操作排在 r2 的赋值操作之前，那么便可以按照赋值 b，赋值 r1，赋值 a，赋值 r2 的顺序得到（1，2）的结果。</p> 
<p>那么如何解决这个问题呢？答案是，将 a 或者 b 设置为 volatile 字段。</p> 
<p>比如说将 b 设置为 volatile 字段。假设 r1 能够观测到 b 的赋值结果 1。显然，这需要 b 的赋值操作在时钟顺序上先于 r1 的赋值操作。根据 volatile 字段的 happens-before 关系，我们知道 b 的赋值操作 happens-before r1 的赋值操作。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int a=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       volatile int b=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method1() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public void method2() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int r1 = b;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        a = 2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>根据同一个线程中，字节码顺序所暗含的 happens-before 关系，以及 happens-before 关系的传递性，我们可以轻易得出 r2 的赋值操作 happens-before a 的赋值操作。</p> 
<p>这也就意味着，当对 a 进行赋值时，对 r2 的赋值操作已经完成了。因此，在 b 为 volatile 字段的情况下，程序不可能出现（r1，r2）为（1，2）的情况。</p> 
<p>由此可以看出，解决这种数据竞争问题的关键在于构造一个跨线程的 happens-before 关系 ：操作 X happens-before 操作 Y，使得操作 X 之前的字节码的结果对操作 Y 之后的字节码可见。</p> 
<h2>Java 内存模型的底层实现</h2> 
<p>在理解了 Java 内存模型的概念之后，我们现在来看看它的底层实现。Java 内存模型是通过内存屏障（memory barrier）来禁止重排序的。</p> 
<p>对于即时编译器来说，它会针对前面提到的每一个 happens-before 关系，向正在编译的目标方法中插入相应的读读、读写、写读以及写写内存屏障。</p> 
<p>这些内存屏障会限制即时编译器的重排序操作。以 volatile 字段访问为例，所插入的内存屏障将不允许 volatile 字段写操作之前的内存访问被重排序至其之后；也将不允许 volatile 字段读操作之后的内存访问被重排序至其之前。</p> 
<p>然后，即时编译器将根据具体的底层体系架构，将这些内存屏障替换成具体的 CPU 指令。以我们日常接触的 X86_64 架构来说，读读、读写以及写写内存屏障是空操作（no-op），只有写读内存屏障会被替换成具体指令 [2]。</p> 
<p>在文章开头的例子中，method1 和 method2 之中的代码均属于先读后写（假设 r1 和 r2 被存储在寄存器之中）。X86_64 架构的处理器并不能将读操作重排序至写操作之后，具体可参考 Intel Software Developer Manual Volumn 3，8.2.3.3 小节。因此，我认为例子中的重排序必然是即时编译器造成的。</p> 
<p>举例来说，对于 volatile 字段，即时编译器将在 volatile 字段的读写操作前后各插入一些内存屏障。</p> 
<p>然而，在 X86_64 架构上，只有 volatile 字段写操作之后的写读内存屏障需要用具体指令来替代。（HotSpot 所选取的具体指令是 lock add DWORD PTR [rsp],0x0，而非 mfence[3]。）</p> 
<p>该具体指令的效果，可以简单理解为强制刷新处理器的写缓存。写缓存是处理器用来加速内存存储效率的一项技术。</p> 
<p>在碰到内存写操作时，处理器并不会等待该指令结束，而是直接开始下一指令，并且依赖于写缓存将更改的数据同步至主内存（main memory）之中。</p> 
<p>强制刷新写缓存，将使得当前线程写入 volatile 字段的值（以及写缓存中已有的其他内存修改），同步至主内存之中。</p> 
<p>由于内存写操作同时会无效化其他处理器所持有的、指向同一内存地址的缓存行，因此可以认为其他处理器能够立即见到该 volatile 字段的最新值。</p> 
<h2>锁，volatile 字段，final 字段与安全发布</h2> 
<p>下面我来讲讲 Java 内存模型涉及的几个关键词。</p> 
<p>前面提到，锁操作同样具备 happens-before 关系。具体来说，解锁操作 happens-before 之后对同一把锁的加锁操作。实际上，在解锁时，Java 虚拟机同样需要强制刷新缓存，使得当前线程所修改的内存对其他线程可见。</p> 
<p>需要注意的是，锁操作的 happens-before 规则的关键字是同一把锁。也就意味着，如果编译器能够（通过逃逸分析）证明某把锁仅被同一线程持有，那么它可以移除相应的加锁解锁操作。</p> 
<p>因此也就不再强制刷新缓存。举个例子，即时编译后的 synchronized (new Object()) {}，可能等同于空操作，而不会强制刷新缓存。</p> 
<p>volatile 字段可以看成一种轻量级的、不保证原子性的同步，其性能往往优于（至少不亚于）锁操作。然而，频繁地访问 volatile 字段也会因为不断地强制刷新缓存而严重影响程序的性能。</p> 
<p>在 X86_64 平台上，只有 volatile 字段的写操作会强制刷新缓存。因此，理想情况下对 volatile 字段的使用应当多读少写，并且应当只有一个线程进行写操作。</p> 
<p>volatile 字段的另一个特性是即时编译器无法将其分配到寄存器里。换句话说，volatile 字段的每次访问均需要直接从内存中读写。</p> 
<p>final 实例字段则涉及新建对象的发布问题。当一个对象包含 final 实例字段时，我们希望其他线程只能看到已初始化的 final 实例字段。</p> 
<p>因此，即时编译器会在 final 字段的写操作后插入一个写写屏障，以防某些优化将新建对象的发布（即将实例对象写入一个共享引用中）重排序至 final 字段的写操作之前。在 X86_64 平台上，写写屏障是空操作。</p> 
<p>新建对象的安全发布（safe publication）问题不仅仅包括 final 实例字段的可见性，还包括其他实例字段的可见性。</p> 
<p>当发布一个已初始化的对象时，我们希望所有已初始化的实例字段对其他线程可见。否则，其他线程可能见到一个仅部分初始化的新建对象，从而造成程序错误。这里我就不展开了。如果你感兴趣的话，可以参考这篇博客 [4]。</p> 
<h2>总结与实践</h2> 
<p>今天我主要介绍了 Java 的内存模型。</p> 
<p>Java 内存模型通过定义了一系列的 happens-before 操作，让应用程序开发者能够轻易地表达不同线程的操作之间的内存可见性。</p> 
<p>在遵守 Java 内存模型的前提下，即时编译器以及底层体系架构能够调整内存访问操作，以达到性能优化的效果。如果开发者没有正确地利用 happens-before 规则，那么将可能导致数据竞争。</p> 
<p>Java 内存模型是通过内存屏障来禁止重排序的。对于即时编译器来说，内存屏障将限制它所能做的重排序优化。对于处理器来说，内存屏障会导致缓存的刷新操作。</p> 
<p>今天的实践环节，我们来复现文章初始的例子。由于复现需要大量的线程切换事件，因此我借助了 OpenJDK CodeTools 项目的 jcstress 工具 [5]，来对该例子进行并发情况下的压力测试。具体的命令如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ mvn archetype:generate -DinteractiveMode=false -DarchetypeGroupId=org.openjdk.jcstress -DarchetypeArtifactId=jcstress-java-test-archetype -DarchetypeVersion=0.1.1 -DgroupId=org.sample -DartifactId=test -Dversion=1.0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ cd test
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ echo 'package org.sample;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.openjdk.jcstress.annotations.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.openjdk.jcstress.infra.results.IntResult2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @JCStressTest
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @Outcome(id = {"0, 0", "0, 2", "1, 0"}, expect = Expect.ACCEPTABLE, desc = "Normal outcome")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @Outcome(id = {"1, 2"}, expect = Expect.ACCEPTABLE_INTERESTING, desc = "Abnormal outcome")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @State
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class ConcurrencyTest {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int a=0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int b=0; // 改成 volatile 试试？
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Actor
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void method1(IntResult2 r) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        r.r2 = a;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        b = 1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Actor
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void method2(IntResult2 r) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        r.r1 = b;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        a = 2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }' &gt; src/main/java/org/sample/ConcurrencyTest.java
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ mvn package
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -jar target/jcstress.jar
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>如果你想要复现非安全发布的情形，那么你可以试试这一测试用例 [6]。</p> 
<p>[1] <a href="https://docs.oracle.com/javase/specs/jls/se10/html/jls-17.html#jls-17.4">https://docs.oracle.com/javase/specs/jls/se10/html/jls-17.html#jls-17.4</a><br> [2] <a href="http://gee.cs.oswego.edu/dl/jmm/cookbook.html">http://gee.cs.oswego.edu/dl/jmm/cookbook.html</a><br> [3] <a href="https://blogs.oracle.com/dave/instruction-selection-for-volatile-fences-:-mfence-vs-lock:add">https://blogs.oracle.com/dave/instruction-selection-for-volatile-fences-:-mfence-vs-lock:add</a><br> [4] <a href="http://vlkan.com/blog/post/2014/02/14/java-safe-publication/">http://vlkan.com/blog/post/2014/02/14/java-safe-publication/</a><br> [5] <a href="https://wiki.openjdk.java.net/display/CodeTools/jcstress">https://wiki.openjdk.java.net/display/CodeTools/jcstress</a><br> [6] <a href="http://hg.openjdk.java.net/code-tools/jcstress/file/64f2cf32fa0a/tests-custom/src/main/java/org/openjdk/jcstress/tests/unsafe/UnsafePublication.java">http://hg.openjdk.java.net/code-tools/jcstress/file/64f2cf32fa0a/tests-custom/src/main/java/org/openjdk/jcstress/tests/unsafe/UnsafePublication.java</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |31          |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:47:47.918 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=31 
 {executed in 1 msec}
2020-11-19 20:47:47.921 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title       |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|-----|----|----|
|31  |1605789267 |1605789267 |1                |zh-hans  |0       |1                             |1      |0      |13丨Java内存模型 |book |1   |31  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|-----|----|----|

2020-11-19 20:47:47.925 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=31 
 {executed in 2 msec}
2020-11-19 20:47:47.928 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title       |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|----|----|
|[unread] |1605789267 |1605789267 |1                |zh-hans  |0       |1                             |1      |0      |13丨Java内存模型 |1   |31  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|----|----|

2020-11-19 20:47:47.947 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605790067, created=1605790067, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='13丨Java内存模型', type='book', 
uid=1, vid=31 where nid=31 
 {executed in 1 msec}
2020-11-19 20:47:47.950 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605790067, created=1605790067, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='13丨Java内存模型', 
uid=1, vid=31 where nid=31 
 {executed in 1 msec}
2020-11-19 20:47:47.976 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=31 
 {executed in 2 msec}
2020-11-19 20:47:47.979 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |revision_id |
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|31        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/d4577c0c83b3d7b50d90cfa5eaa8ffca?bkt=en-07c9b0a504a370605fab38fac87650fff40fcc6a9ca5bc7a41dc25192b8daca6e8e4a1989d655a31&fid=3757516097-778750-725369704742474&time=1605788155&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-5ZQQ8Zfa4mCvdB%2BatvxVMMyj%2Fcc%3D&to=92&size=6745722&sta_dx=6745722&sta_cs=4383&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182965&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=6745722&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-3ca4ec8c46ad0b6bee0717c418002acbe9cbfda827dc22434f44762d1db6dfbd3b4da1f362016d43&sl=76480590&expires=8h&rt=pr&r=314745811&mlogid=7510865610921361892&vbdid=64799653&fin=13%E4%B8%A8Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.mp3&bflag=92,34-92&rtype=1&dp-logid=7510865610921361892&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=78cccb630bb0656e502f5eb078dde1cbf2ecb9a5b3b597ae&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=13%E4%B8%A8Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.mp3 |31          |
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:47:48.001 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=31 
 {executed in 1 msec}
2020-11-19 20:47:48.005 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |revision_id |
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/d4577c0c83b3d7b50d90cfa5eaa8ffca?bkt=en-07c9b0a504a370605fab38fac87650fff40fcc6a9ca5bc7a41dc25192b8daca6e8e4a1989d655a31&fid=3757516097-778750-725369704742474&time=1605788155&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-5ZQQ8Zfa4mCvdB%2BatvxVMMyj%2Fcc%3D&to=92&size=6745722&sta_dx=6745722&sta_cs=4383&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182965&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=6745722&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-3ca4ec8c46ad0b6bee0717c418002acbe9cbfda827dc22434f44762d1db6dfbd3b4da1f362016d43&sl=76480590&expires=8h&rt=pr&r=314745811&mlogid=7510865610921361892&vbdid=64799653&fin=13%E4%B8%A8Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.mp3&bflag=92,34-92&rtype=1&dp-logid=7510865610921361892&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=78cccb630bb0656e502f5eb078dde1cbf2ecb9a5b3b597ae&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=13%E4%B8%A8Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.mp3 |31          |
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:47:48.032 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=31 
 {executed in 3 msec}
2020-11-19 20:47:48.052 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |delta |field_comment_format |langcode |revision_id |
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|31        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/5e/ec/70c8d94d.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>大场镇车王</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师 为什么volatile内存屏障不允许所有写操作之前的读操作被重排序到写操作之后？前面不是说volatile的写操作happens before对用一字段的读操作吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: volatile字段的happens-before关系指的是在两个不同线程中，volatile的写操作 happens-before 之后对同一字段的读操作。这里有个关键字之后，指的是时间上的先后。也就是我这边写，你之后再读就一定能读得到我刚刚写的值。普通字段则没有这个保证。<br><br>屏障不允许重排序是针对即时编译器的。写后对同一字段的读，属于数据依赖，本来也不可以重排序的。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/9f/71345740.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>黑崽</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   请教个问题。刚才有说不会把volatile放到寄存器，但是应该会在栈里面对吧。直接读取主内存，读写的是栈数据，然后利用堆内存和栈上数据是利用写缓存刷新同步的？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 我可能没有在原文中讲清楚。这里指的是volatile变量不能被分配到寄存器中，但是计算还是加载到寄存器中来计算的。<br><br>所谓的分配到寄存器中，你可以理解为编译器将内存中的值缓存在寄存器中，之后一直用访问寄存器来代表对这个内存的访问的。假设我们要遍历一个数组，数组的长度是内存中的值。由于我们每次循环都要比较一次，因此编译器决定把它放在寄存器中，免得每次比较都要读一次内存。对于会更改的内存值，编译器也可以先缓存至寄存器，最后更新回内存即可。<br><br>Volatile会禁止上述优化。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/0c/2f/54f7f676.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Jerry Ch...</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   博客在哪里啊？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 文末[4]所指向的链接。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/d0/00/9d05af66.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>追梦</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，求讲解下jvm中代码如何实现的内存屏障
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 即时编译器生成的代码里会使用CPU的内存屏障指令。HotSpot采用的lock前缀的指令，lock add DWORD PTR [rsp] 0。它也会刷缓存。<br><br>至于在即时编译器里禁止重排序所使用的”内存屏障”，就是一个特殊的编译器中间表达形式节点。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>qpm</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师我提个问题。一个共享对象的变量是非volatile的，那么这个变量的写入会先写到寄存器上，再写回内存吗？那么jvm是不是无论如何都不保证啥时候变量的值会写回内存。假如另一个线程加锁访问这个变量，是不是jvm也不保证它能拿到最新数据。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 对的！如果即时编译器把那个变量放在寄存器里维护，那么另一个线程也没辙。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a0/47/620308a3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Alex 1984</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师，我在一些技术文章里看到说 volatile 的变量是存在工作内存，这个工作内存是一个什么概念？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 工作内存是JMM抽象出来的一个概念。你可以映射到实际的CPU缓存。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">22</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   恩，这节听了好几遍，也读了几遍，最后还是感觉蒙蒙的。
   <br>下面说下我的感受：
   <br>1:一图胜千言，尤其对于描述复杂的东西，这个建议其他同学也有提议的，希望雨迪采纳一下
   <br>
   <br>2:感觉有些概念没有解释，比如：
   <br>2-1:Java内存模型，这节不就是要讲Java内存类型是什么？有什么特点？为什么这么设计嘛？不过我没看到这些内容，当然，特点是讲了的 happens-before 机制
   <br>2-2:内存屏蔽，这是什么意思？它怎么就能禁止重排序啦？还有有其引申出的各种屏蔽是怎么回事呢？也没完全明白
   <br>
   <br>
   <br>3:前面讲 as-if-serial 大概明白什么意思了，多处理器为了提高效率会采用流水线的方式来执行程序指令，但是同时要保证程序执行逻辑的正确性，所以，实际执行程序的指令和代码层面上会有不同，这个是由编译器来保证的，虽然执行逻辑不同但是程序逻辑是没变的，单线程没问题，但是多线程就变得复杂一些了，光靠这种方式保证不了啦，所以引出了下文
   <br>
   <br>4:happens-before，这个概念和作用比较容易理解，线程内有这种关系，线程间更有，这个机制我认为就是为了多线程环境下为了保证程序逻辑正确性的一种方式，不过它的具体实现细节感觉没理解，不清楚他是怎么办到的
   <br>
   <br>5:volatile 这个关键字之前也学习过，作用是保证内容的修改对所有线程可见，原理是修改后同步更新所有的内容，这是因为内存和处理器直接还是存在距离的，比如：内存-一级缓存-二级缓存-各种寄存器-cpu，如果是内存-cpu，则不会有这种问题了，不过性能也就不行了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/80/bf/3041138b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>　素丶　　</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">11</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   可以配合程晓明大大的《深入理解Java内存模型》
   <br>https://www.infoq.cn/article/java_memory_model
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/3a/cb/97dee373.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>啃yi嘴泥</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-24
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">7</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师你好，关于指令重排序有点不太理解，指令重排序的粒度是方法级别的，还是整个源文件级别的。文中说道，b 加了volatile后，能够保证 b=1 先于r1=b ，这个我能理解，但是如何保证不会因为指令重排导致 b=1 先于r2=a发生呢？文中虽然说了，同一个线程中，字节码顺序暗含了r2=a happen before b=1，但是文中也提到了，拥有happen-before关系的两对赋值操作之间没有数据依赖，处理器可以指令重排序。r2=a 和b=1之间没有数据依赖呀！不好意思，这块有点迷糊，老师能给详细解答下不？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 首先，b加了volatile之后，并不能保证b=1一定先于r1=b，而是保证r1=b始终能够看到b的最新值。比如说b=1;b=2，之后在另一个CPU上执行r1=b，那么r1会被赋值为2。如果先执行r1=b，然后在另外一个CPU上执行b=1和b=2，那么r1将看到b=1之前的值。<br><br>在没有标记volatile的时候，同一线程中，r2=a和b=1存在happens before关系，但因为没有数据依赖可以重排列。一旦标记了volatile，即时编译器和CPU需要考虑到多线程happens-before关系，因此不能自由地重排序。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/56/43/abb7bfe3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>阿巍-豆夫</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-03
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   关于Volatile, 我想问下，如果是单个cpu的系统上运行多线程的程序，是不是这个volative就没有效果了？ 因为大家都使用同一个寄存器。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 理论上，因为都使用同一套缓存，所以不需要volatile。实际实现中，对编译器不能重排列的限制还是存在的，但具体的memory barrier指令的实现是no-op。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/12/51/f309515c.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>冬末未末</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-27
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   happen-before 在这里不能理解成在什么之前发生，它和时间没有任何关系。个人感觉解释成“生效可见于” 更准确。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/0d/5d/e50cf9c7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Kenneth</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-30
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   同求讲解该问题，谢谢老师！：
   <br>啃yi嘴泥
   <br>老师你好，关于指令重排序有点不太理解，指令重排序的粒度是方法级别的，还是整个源文件级别的。文中说道，b 加了volatile后，能够保证 b=1 先于r1=b ，这个我能理解，但是如何保证不会因为指令重排导致 b=1 先于r2=a发生呢？文中虽然说了，同一个线程中，字节码顺序暗含了r2=a happen before b=1，但是文中也提到了，拥有happen-before关系的两对赋值操作之间没有数据依赖，处理器可以指令重排序。r2=a 和b=1之间没有数据依赖呀！不好意思，这块有点迷糊，老师能给详细解答下不？
   <br>2018-08-24
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 嗯，我回到原问题上哈</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/f8/0e/de697f9b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>熊猫酒仙</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，既然有写缓存，是不是也有读缓存呢？强制刷新写缓存，无效化相应的内存数据，那么这些内存数据的读缓存也就失效了，需要重新加载最新数据，是否可以这样理解？
   <br>
   <br>另外强制刷新写缓存是否也有粒度一说？就是我们加的锁也有粒度之分，那么所触发的强制刷新写缓存的区域可能不一样？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/16/48/00/5451e224.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>MacHIne���...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   大大，我的理解是这样 上面的volatile并没有保证 读写 b的顺序 而唯一出现(1,2)的可能就是 a的写入在读取前 b的写入也在读取前 而根据hb规则 当出现b的写入在读取前时 编译器无法对1线程进行重排序 那么对
   <br>a的读取就发生在了写入前， 也就避免了 （1，2），请问这样想对吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epLLXBLBLgticobxvBYRezd304Y66Q8ibYCl7mG9dvTHGrx9obRcn7ZmJBcib3ibsQPIX3xIbNYiaAUrOA/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_c991e...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，你答复的有一段话，我有疑问
   <br>首先，b加了volatile之后，并不能保证b=1一定先于r1=b，而是保证r1=b始终能够看到b的最新值。比如说b=1;b=2，之后在另一个CPU上执行r1=b，那么r1会被赋值为2。如果先执行r1=b，然后在另外一个CPU上执行b=1和b=2，那么r1将看到b=1之前的值。
   <br>
   <br>这段话意思是，虽然有happens-before关系，但是如果读在一个线程，而且执行时间在，另外线程的写之前，那其实是读不到最新的值的，是这样吗。 这块是有时序问题吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/2b/3c/1d18cb88.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>snowDreams</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   JMM仅使用一篇文章讲解,总有点意犹未尽的感觉
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/db/a4/3a1112ca.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>lincoln���...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   请教个问题，看到留言里面有回复：“在解释执行时，字节码之间也有内存屏障”。这句话意思是不是：解释执行过程中也会动态生成并插入内存屏障，而不是.class文件字节码之间有内存屏障？因为我比较了volatile字段和普通字段的写操作的字节码，没看出来有什么区别。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>zzr</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   编译器为啥要重排序
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJngnbXIXoL0odUt5Ma172x44j0Y9xicdJqpJ3wRXqiaeqxEfJM50FtkHj3cBTKoFuGg5FlXDcLdf1w/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>NickNYU</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师，看了很久您的文章，感觉收益颇丰，有个小建议，能否讲到某些知识点的时候，附上JVM的源码就更好了。因为源码更直观一些
   <br>谢谢老师
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/5e/b1/51746dc2.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>侯布阁</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   请问老师，解释执行是一行一行执行的，此时会有指令重排序吗？
  </div> <!----> <!---->
 </div></li> |0     |full_html            |zh-hans  |31          |
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:47:48.101 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=31 
 {executed in 4 msec}
2020-11-19 20:47:48.121 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |delta |field_comment_format |langcode |revision_id |
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/5e/ec/70c8d94d.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>大场镇车王</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师 为什么volatile内存屏障不允许所有写操作之前的读操作被重排序到写操作之后？前面不是说volatile的写操作happens before对用一字段的读操作吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: volatile字段的happens-before关系指的是在两个不同线程中，volatile的写操作 happens-before 之后对同一字段的读操作。这里有个关键字之后，指的是时间上的先后。也就是我这边写，你之后再读就一定能读得到我刚刚写的值。普通字段则没有这个保证。<br><br>屏障不允许重排序是针对即时编译器的。写后对同一字段的读，属于数据依赖，本来也不可以重排序的。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/9f/71345740.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>黑崽</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   请教个问题。刚才有说不会把volatile放到寄存器，但是应该会在栈里面对吧。直接读取主内存，读写的是栈数据，然后利用堆内存和栈上数据是利用写缓存刷新同步的？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 我可能没有在原文中讲清楚。这里指的是volatile变量不能被分配到寄存器中，但是计算还是加载到寄存器中来计算的。<br><br>所谓的分配到寄存器中，你可以理解为编译器将内存中的值缓存在寄存器中，之后一直用访问寄存器来代表对这个内存的访问的。假设我们要遍历一个数组，数组的长度是内存中的值。由于我们每次循环都要比较一次，因此编译器决定把它放在寄存器中，免得每次比较都要读一次内存。对于会更改的内存值，编译器也可以先缓存至寄存器，最后更新回内存即可。<br><br>Volatile会禁止上述优化。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/0c/2f/54f7f676.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Jerry Ch...</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   博客在哪里啊？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 文末[4]所指向的链接。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/d0/00/9d05af66.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>追梦</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，求讲解下jvm中代码如何实现的内存屏障
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 即时编译器生成的代码里会使用CPU的内存屏障指令。HotSpot采用的lock前缀的指令，lock add DWORD PTR [rsp] 0。它也会刷缓存。<br><br>至于在即时编译器里禁止重排序所使用的”内存屏障”，就是一个特殊的编译器中间表达形式节点。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>qpm</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师我提个问题。一个共享对象的变量是非volatile的，那么这个变量的写入会先写到寄存器上，再写回内存吗？那么jvm是不是无论如何都不保证啥时候变量的值会写回内存。假如另一个线程加锁访问这个变量，是不是jvm也不保证它能拿到最新数据。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 对的！如果即时编译器把那个变量放在寄存器里维护，那么另一个线程也没辙。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a0/47/620308a3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Alex 1984</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师，我在一些技术文章里看到说 volatile 的变量是存在工作内存，这个工作内存是一个什么概念？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 工作内存是JMM抽象出来的一个概念。你可以映射到实际的CPU缓存。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">22</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   恩，这节听了好几遍，也读了几遍，最后还是感觉蒙蒙的。
   <br>下面说下我的感受：
   <br>1:一图胜千言，尤其对于描述复杂的东西，这个建议其他同学也有提议的，希望雨迪采纳一下
   <br>
   <br>2:感觉有些概念没有解释，比如：
   <br>2-1:Java内存模型，这节不就是要讲Java内存类型是什么？有什么特点？为什么这么设计嘛？不过我没看到这些内容，当然，特点是讲了的 happens-before 机制
   <br>2-2:内存屏蔽，这是什么意思？它怎么就能禁止重排序啦？还有有其引申出的各种屏蔽是怎么回事呢？也没完全明白
   <br>
   <br>
   <br>3:前面讲 as-if-serial 大概明白什么意思了，多处理器为了提高效率会采用流水线的方式来执行程序指令，但是同时要保证程序执行逻辑的正确性，所以，实际执行程序的指令和代码层面上会有不同，这个是由编译器来保证的，虽然执行逻辑不同但是程序逻辑是没变的，单线程没问题，但是多线程就变得复杂一些了，光靠这种方式保证不了啦，所以引出了下文
   <br>
   <br>4:happens-before，这个概念和作用比较容易理解，线程内有这种关系，线程间更有，这个机制我认为就是为了多线程环境下为了保证程序逻辑正确性的一种方式，不过它的具体实现细节感觉没理解，不清楚他是怎么办到的
   <br>
   <br>5:volatile 这个关键字之前也学习过，作用是保证内容的修改对所有线程可见，原理是修改后同步更新所有的内容，这是因为内存和处理器直接还是存在距离的，比如：内存-一级缓存-二级缓存-各种寄存器-cpu，如果是内存-cpu，则不会有这种问题了，不过性能也就不行了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/80/bf/3041138b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>　素丶　　</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">11</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   可以配合程晓明大大的《深入理解Java内存模型》
   <br>https://www.infoq.cn/article/java_memory_model
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/3a/cb/97dee373.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>啃yi嘴泥</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-24
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">7</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师你好，关于指令重排序有点不太理解，指令重排序的粒度是方法级别的，还是整个源文件级别的。文中说道，b 加了volatile后，能够保证 b=1 先于r1=b ，这个我能理解，但是如何保证不会因为指令重排导致 b=1 先于r2=a发生呢？文中虽然说了，同一个线程中，字节码顺序暗含了r2=a happen before b=1，但是文中也提到了，拥有happen-before关系的两对赋值操作之间没有数据依赖，处理器可以指令重排序。r2=a 和b=1之间没有数据依赖呀！不好意思，这块有点迷糊，老师能给详细解答下不？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 首先，b加了volatile之后，并不能保证b=1一定先于r1=b，而是保证r1=b始终能够看到b的最新值。比如说b=1;b=2，之后在另一个CPU上执行r1=b，那么r1会被赋值为2。如果先执行r1=b，然后在另外一个CPU上执行b=1和b=2，那么r1将看到b=1之前的值。<br><br>在没有标记volatile的时候，同一线程中，r2=a和b=1存在happens before关系，但因为没有数据依赖可以重排列。一旦标记了volatile，即时编译器和CPU需要考虑到多线程happens-before关系，因此不能自由地重排序。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/56/43/abb7bfe3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>阿巍-豆夫</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-03
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   关于Volatile, 我想问下，如果是单个cpu的系统上运行多线程的程序，是不是这个volative就没有效果了？ 因为大家都使用同一个寄存器。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 理论上，因为都使用同一套缓存，所以不需要volatile。实际实现中，对编译器不能重排列的限制还是存在的，但具体的memory barrier指令的实现是no-op。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/12/51/f309515c.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>冬末未末</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-27
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   happen-before 在这里不能理解成在什么之前发生，它和时间没有任何关系。个人感觉解释成“生效可见于” 更准确。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/0d/5d/e50cf9c7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Kenneth</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-30
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   同求讲解该问题，谢谢老师！：
   <br>啃yi嘴泥
   <br>老师你好，关于指令重排序有点不太理解，指令重排序的粒度是方法级别的，还是整个源文件级别的。文中说道，b 加了volatile后，能够保证 b=1 先于r1=b ，这个我能理解，但是如何保证不会因为指令重排导致 b=1 先于r2=a发生呢？文中虽然说了，同一个线程中，字节码顺序暗含了r2=a happen before b=1，但是文中也提到了，拥有happen-before关系的两对赋值操作之间没有数据依赖，处理器可以指令重排序。r2=a 和b=1之间没有数据依赖呀！不好意思，这块有点迷糊，老师能给详细解答下不？
   <br>2018-08-24
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 嗯，我回到原问题上哈</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/f8/0e/de697f9b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>熊猫酒仙</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，既然有写缓存，是不是也有读缓存呢？强制刷新写缓存，无效化相应的内存数据，那么这些内存数据的读缓存也就失效了，需要重新加载最新数据，是否可以这样理解？
   <br>
   <br>另外强制刷新写缓存是否也有粒度一说？就是我们加的锁也有粒度之分，那么所触发的强制刷新写缓存的区域可能不一样？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/16/48/00/5451e224.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>MacHIne���...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   大大，我的理解是这样 上面的volatile并没有保证 读写 b的顺序 而唯一出现(1,2)的可能就是 a的写入在读取前 b的写入也在读取前 而根据hb规则 当出现b的写入在读取前时 编译器无法对1线程进行重排序 那么对
   <br>a的读取就发生在了写入前， 也就避免了 （1，2），请问这样想对吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epLLXBLBLgticobxvBYRezd304Y66Q8ibYCl7mG9dvTHGrx9obRcn7ZmJBcib3ibsQPIX3xIbNYiaAUrOA/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_c991e...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，你答复的有一段话，我有疑问
   <br>首先，b加了volatile之后，并不能保证b=1一定先于r1=b，而是保证r1=b始终能够看到b的最新值。比如说b=1;b=2，之后在另一个CPU上执行r1=b，那么r1会被赋值为2。如果先执行r1=b，然后在另外一个CPU上执行b=1和b=2，那么r1将看到b=1之前的值。
   <br>
   <br>这段话意思是，虽然有happens-before关系，但是如果读在一个线程，而且执行时间在，另外线程的写之前，那其实是读不到最新的值的，是这样吗。 这块是有时序问题吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/2b/3c/1d18cb88.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>snowDreams</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   JMM仅使用一篇文章讲解,总有点意犹未尽的感觉
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/db/a4/3a1112ca.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>lincoln���...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   请教个问题，看到留言里面有回复：“在解释执行时，字节码之间也有内存屏障”。这句话意思是不是：解释执行过程中也会动态生成并插入内存屏障，而不是.class文件字节码之间有内存屏障？因为我比较了volatile字段和普通字段的写操作的字节码，没看出来有什么区别。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>zzr</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   编译器为啥要重排序
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJngnbXIXoL0odUt5Ma172x44j0Y9xicdJqpJ3wRXqiaeqxEfJM50FtkHj3cBTKoFuGg5FlXDcLdf1w/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>NickNYU</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师，看了很久您的文章，感觉收益颇丰，有个小建议，能否讲到某些知识点的时候，附上JVM的源码就更好了。因为源码更直观一些
   <br>谢谢老师
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/5e/b1/51746dc2.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>侯布阁</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   请问老师，解释执行是一行一行执行的，此时会有指令重排序吗？
  </div> <!----> <!---->
 </div></li> |0     |full_html            |zh-hans  |31          |
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:47:48.151 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=31 
 {executed in 1 msec}
2020-11-19 20:47:48.153 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|31        |book   |0     |zh-hans  |31          |https://static001.geekbang.org/resource/image/56/1f/563f86ba13dcd41bdbcca1591182fd1f.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:47:48.177 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=31 
 {executed in 1 msec}
2020-11-19 20:47:48.179 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |31          |https://static001.geekbang.org/resource/image/56/1f/563f86ba13dcd41bdbcca1591182fd1f.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:47:48.205 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=31 
 {executed in 4 msec}
2020-11-19 20:47:48.208 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |31          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:47:48.232 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=31 
 {executed in 1 msec}
2020-11-19 20:47:48.234 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |31          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:47:48.256 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='967922784557471' 
 {executed in 2 msec}
2020-11-19 20:47:48.258 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|32        |book   |0     |967922784557471  |zh-hans  |32          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:47:48.261 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=32 
 {executed in 1 msec}
2020-11-19 20:47:48.263 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|32  |zh-hans  |book |0ac63470-89f2-4419-96c6-5eb27c91a88a |32  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:47:48.290 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=32 
 {executed in 1 msec}
2020-11-19 20:47:48.292 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |967922784557471  |zh-hans  |32          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:47:48.314 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=32 
 {executed in 1 msec}
2020-11-19 20:47:48.316 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|32  |1   |2     |1            |1  |32 |0  |0  |0  |1   |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:47:48.338 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=32 
 {executed in 2 msec}
2020-11-19 20:47:48.340 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------|-------------|-------|------|------------|---------|------------|
|32        |           |             |book   |0     |full_html   |zh-hans  |32          |
|----------|-----------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:47:48.344 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=32 
 {executed in 2 msec}
2020-11-19 20:47:48.346 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------|-------------|-------|------|------------|---------|------------|
|[unread]  |           |             |book   |0     |full_html   |zh-hans  |32          |
|----------|-----------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:47:48.395 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=32 
 {executed in 2 msec}
2020-11-19 20:47:48.397 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                    |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|
|32  |1605789268 |1605789268 |1                |zh-hans  |0       |1                             |1      |0      |02-模块一：Java虚拟机基本原理 (12讲) |book |1   |32  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|

2020-11-19 20:47:48.401 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=32 
 {executed in 1 msec}
2020-11-19 20:47:48.404 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                    |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|
|[unread] |1605789268 |1605789268 |1                |zh-hans  |0       |1                             |1      |0      |02-模块一：Java虚拟机基本原理 (12讲) |1   |32  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|

2020-11-19 20:47:48.427 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605790068, created=1605790068, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='02-模块一：Java虚拟机基本原理 (12讲)', 
type='book', uid=1, vid=32 where nid=32 
 {executed in 4 msec}
2020-11-19 20:47:48.432 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605790068, created=1605790068, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='02-模块一：Java虚拟机基本原理 
(12讲)', uid=1, vid=32 where nid=32 
 {executed in 1 msec}
2020-11-19 20:47:48.467 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=32 
 {executed in 1 msec}
2020-11-19 20:47:48.470 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value |revision_id |
|----------|-------|------|---------|------------------|------------|
|32        |book   |0     |zh-hans  |                  |32          |
|----------|-------|------|---------|------------------|------------|

2020-11-19 20:47:48.495 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=32 
 {executed in 1 msec}
2020-11-19 20:47:48.497 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value |revision_id |
|----------|-------|------|---------|------------------|------------|
|[unread]  |book   |0     |zh-hans  |                  |32          |
|----------|-------|------|---------|------------------|------------|

2020-11-19 20:47:48.518 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=32 
 {executed in 2 msec}
2020-11-19 20:47:48.519 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------|------|---------------------|---------|------------|
|32        |book   |                    |0     |full_html            |zh-hans  |32          |
|----------|-------|--------------------|------|---------------------|---------|------------|

2020-11-19 20:47:48.541 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=32 
 {executed in 1 msec}
2020-11-19 20:47:48.544 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------|------|---------------------|---------|------------|
|[unread]  |book   |                    |0     |full_html            |zh-hans  |32          |
|----------|-------|--------------------|------|---------------------|---------|------------|

2020-11-19 20:47:48.565 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=32 
 {executed in 1 msec}
2020-11-19 20:47:48.568 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value |
|----------|-------|------|---------|------------|------------------|
|32        |book   |0     |zh-hans  |32          |                  |
|----------|-------|------|---------|------------|------------------|

2020-11-19 20:47:48.592 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=32 
 {executed in 2 msec}
2020-11-19 20:47:48.594 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value |
|----------|-------|------|---------|------------|------------------|
|[unread]  |book   |0     |zh-hans  |32          |                  |
|----------|-------|------|---------|------------|------------------|

2020-11-19 20:47:48.617 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=32 
 {executed in 1 msec}
2020-11-19 20:47:48.619 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |32          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:47:48.643 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=32 
 {executed in 2 msec}
2020-11-19 20:47:48.646 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |32          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:47:50.531 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='371631433219725' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:47:50.533 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|65      |371631433219725 |0   |net_content |
|--------|----------------|----|------------|

2020-11-19 20:48:20.420 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='371631433219725' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:48:20.421 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|65      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:48:20.442 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='371631433219725', got=1, name='net_content' where item_id=65 
 {executed in 1 msec}
2020-11-19 20:48:20.464 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='371631433219725' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:48:20.466 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------|
|item_id |fsid            |got |name  |
|--------|----------------|----|------|
|66      |371631433219725 |1   |media |
|--------|----------------|----|------|

2020-11-19 20:48:20.469 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='371631433219725' 
 {executed in 0 msec}
2020-11-19 20:48:20.470 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|33        |book   |0     |371631433219725  |zh-hans  |33          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:48:20.473 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=33 
 {executed in 1 msec}
2020-11-19 20:48:20.475 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|33  |zh-hans  |book |d052f717-0c75-4f6b-bfee-db15833d80f6 |33  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:48:20.496 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=33 
 {executed in 1 msec}
2020-11-19 20:48:20.498 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |371631433219725  |zh-hans  |33          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:48:20.518 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=33 
 {executed in 1 msec}
2020-11-19 20:48:20.520 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|33  |1   |3     |0            |1  |32 |33 |0  |0  |32  |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:48:20.548 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=33 
 {executed in 8 msec}
2020-11-19 20:48:20.564 INFO  jdbc.resultsettable Line:610 - 
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|33        |<p>在读博士的时候，我曾经写过一个统计 Java 对象生命周期的动态分析，并且用它来跑了一些基准测试。</p> 
<p>其中一些程序的结果，恰好验证了许多研究人员的假设，即大部分的 Java 对象只存活一小段时间，而存活下来的小部分 Java 对象则会存活很长一段时间。</p> 
<p><img src="https://static001.geekbang.org/resource/image/e2/89/e235d25ca15b60a511a2d90317eb9589.png" alt=""></p> 
<p>（pmd 中 Java 对象生命周期的直方图，红色的表示被逃逸分析优化掉的对象）</p> 
<p>之所以要提到这个假设，是因为它造就了 Java 虚拟机的分代回收思想。简单来说，就是将堆空间划分为两代，分别叫做新生代和老年代。新生代用来存储新建的对象。当对象存活时间够长时，则将其移动到老年代。</p> 
<p>Java 虚拟机可以给不同代使用不同的回收算法。对于新生代，我们猜测大部分的 Java 对象只存活一小段时间，那么便可以频繁地采用耗时较短的垃圾回收算法，让大部分的垃圾都能够在新生代被回收掉。</p> 
<p>对于老年代，我们猜测大部分的垃圾已经在新生代中被回收了，而在老年代中的对象有大概率会继续存活。当真正触发针对老年代的回收时，则代表这个假设出错了，或者堆的空间已经耗尽了。</p> 
<p>这时候，Java 虚拟机往往需要做一次全堆扫描，耗时也将不计成本。（当然，现代的垃圾回收器都在并发收集的道路上发展，来避免这种全堆扫描的情况。）</p><!-- [[[read_end]]] --> 
<p>今天这一篇我们来关注一下针对新生代的 Minor GC。首先，我们来看看 Java 虚拟机中的堆具体是怎么划分的。</p> 
<h2>Java 虚拟机的堆划分</h2> 
<p>前面提到，Java 虚拟机将堆划分为新生代和老年代。其中，新生代又被划分为 Eden 区，以及两个大小相同的 Survivor 区。</p> 
<p>默认情况下，Java 虚拟机采取的是一种动态分配的策略（对应 Java 虚拟机参数 -XX:+UsePSAdaptiveSurvivorSizePolicy），根据生成对象的速率，以及 Survivor 区的使用情况动态调整 Eden 区和 Survivor 区的比例。</p> 
<p>当然，你也可以通过参数 -XX:SurvivorRatio 来固定这个比例。但是需要注意的是，其中一个 Survivor 区会一直为空，因此比例越低浪费的堆空间将越高。</p> 
<p><img src="https://static001.geekbang.org/resource/image/2c/e5/2cc29b8de676d3747416416a3523e4e5.png" alt=""></p> 
<p>通常来说，当我们调用 new 指令时，它会在 Eden 区中划出一块作为存储对象的内存。由于堆空间是线程共享的，因此直接在这里边划空间是需要进行同步的。</p> 
<p>否则，将有可能出现两个对象共用一段内存的事故。如果你还记得前两篇我用“停车位”打的比方的话，这里就相当于两个司机（线程）同时将车停入同一个停车位，因而发生剐蹭事故。</p> 
<p>Java 虚拟机的解决方法是为每个司机预先申请多个停车位，并且只允许该司机停在自己的停车位上。那么当司机的停车位用完了该怎么办呢（假设这个司机代客泊车）？</p> 
<p>答案是：再申请多个停车位便可以了。这项技术被称之为 TLAB（Thread Local Allocation Buffer，对应虚拟机参数 -XX:+UseTLAB，默认开启）。</p> 
<p>具体来说，每个线程可以向 Java 虚拟机申请一段连续的内存，比如 2048 字节，作为线程私有的 TLAB。</p> 
<p>这个操作需要加锁，线程需要维护两个指针（实际上可能更多，但重要也就两个），一个指向 TLAB 中空余内存的起始位置，一个则指向 TLAB 末尾。</p> 
<p>接下来的 new 指令，便可以直接通过指针加法（bump the pointer）来实现，即把指向空余内存位置的指针加上所请求的字节数。</p> 
<blockquote> 
 <p><span class="reference">我猜测会有留言问为什么不把 bump the pointer 翻译成指针碰撞。这里先解释一下，在英语中我们通常省略了 bump up the pointer 中的 up。在这个上下文中 bump 的含义应为“提高”。另外一个例子是当我们发布软件的新版本时，也会说 bump the version number。</span></p> 
</blockquote> 
<p>如果加法后空余内存指针的值仍小于或等于指向末尾的指针，则代表分配成功。否则，TLAB 已经没有足够的空间来满足本次新建操作。这个时候，便需要当前线程重新申请新的 TLAB。</p> 
<p>当 Eden 区的空间耗尽了怎么办？这个时候 Java 虚拟机便会触发一次 Minor GC，来收集新生代的垃圾。存活下来的对象，则会被送到 Survivor 区。</p> 
<p>前面提到，新生代共有两个 Survivor 区，我们分别用 from 和 to 来指代。其中 to 指向的 Survivior 区是空的。</p> 
<p>当发生 Minor GC 时，Eden 区和 from 指向的 Survivor 区中的存活对象会被复制到 to 指向的 Survivor 区中，然后交换 from 和 to 指针，以保证下一次 Minor GC 时，to 指向的 Survivor 区还是空的。</p> 
<p>Java 虚拟机会记录 Survivor 区中的对象一共被来回复制了几次。如果一个对象被复制的次数为 15（对应虚拟机参数 -XX:+MaxTenuringThreshold），那么该对象将被晋升（promote）至老年代。另外，如果单个 Survivor 区已经被占用了 50%（对应虚拟机参数 -XX:TargetSurvivorRatio），那么较高复制次数的对象也会被晋升至老年代。</p> 
<p>总而言之，当发生 Minor GC 时，我们应用了标记 - 复制算法，将 Survivor 区中的老存活对象晋升到老年代，然后将剩下的存活对象和 Eden 区的存活对象复制到另一个 Survivor 区中。理想情况下，Eden 区中的对象基本都死亡了，那么需要复制的数据将非常少，因此采用这种标记 - 复制算法的效果极好。</p> 
<p>Minor GC 的另外一个好处是不用对整个堆进行垃圾回收。但是，它却有一个问题，那就是老年代的对象可能引用新生代的对象。也就是说，在标记存活对象的时候，我们需要扫描老年代中的对象。如果该对象拥有对新生代对象的引用，那么这个引用也会被作为 GC Roots。</p> 
<p>这样一来，岂不是又做了一次全堆扫描呢？</p> 
<h2>卡表</h2> 
<p>HotSpot 给出的解决方案是一项叫做卡表（Card Table）的技术。该技术将整个堆划分为一个个大小为 512 字节的卡，并且维护一个卡表，用来存储每张卡的一个标识位。这个标识位代表对应的卡是否可能存有指向新生代对象的引用。如果可能存在，那么我们就认为这张卡是脏的。</p> 
<p>在进行 Minor GC 的时候，我们便可以不用扫描整个老年代，而是在卡表中寻找脏卡，并将脏卡中的对象加入到 Minor GC 的 GC Roots 里。当完成所有脏卡的扫描之后，Java 虚拟机便会将所有脏卡的标识位清零。</p> 
<p>由于 Minor GC 伴随着存活对象的复制，而复制需要更新指向该对象的引用。因此，在更新引用的同时，我们又会设置引用所在的卡的标识位。这个时候，我们可以确保脏卡中必定包含指向新生代对象的引用。</p> 
<p>在 Minor GC 之前，我们并不能确保脏卡中包含指向新生代对象的引用。其原因和如何设置卡的标识位有关。</p> 
<p>首先，如果想要保证每个可能有指向新生代对象引用的卡都被标记为脏卡，那么 Java 虚拟机需要截获每个引用型实例变量的写操作，并作出对应的写标识位操作。</p> 
<p>这个操作在解释执行器中比较容易实现。但是在即时编译器生成的机器码中，则需要插入额外的逻辑。这也就是所谓的写屏障（write barrier，注意不要和 volatile 字段的写屏障混淆）。</p> 
<p>写屏障需要尽可能地保持简洁。这是因为我们并不希望在每条引用型实例变量的写指令后跟着一大串注入的指令。</p> 
<p>因此，写屏障并不会判断更新后的引用是否指向新生代中的对象，而是宁可错杀，不可放过，一律当成可能指向新生代对象的引用。</p> 
<p>这么一来，写屏障便可精简为下面的伪代码 [1]。这里右移 9 位相当于除以 512，Java 虚拟机便是通过这种方式来从地址映射到卡表中的索引的。最终，这段代码会被编译成一条移位指令和一条存储指令。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       CARD_TABLE [this address &gt;&gt; 9] = DIRTY;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>虽然写屏障不可避免地带来一些开销，但是它能够加大 Minor GC 的吞吐率（ 应用运行时间 /(应用运行时间 + 垃圾回收时间) ）。总的来说还是值得的。不过，在高并发环境下，写屏障又带来了虚共享（false sharing）问题 [2]。</p> 
<p>在介绍对象内存布局中我曾提到虚共享问题，讲的是几个 volatile 字段出现在同一缓存行里造成的虚共享。这里的虚共享则是卡表中不同卡的标识位之间的虚共享问题。</p> 
<p>在 HotSpot 中，卡表是通过 byte 数组来实现的。对于一个 64 字节的缓存行来说，如果用它来加载部分卡表，那么它将对应 64 张卡，也就是 32KB 的内存。</p> 
<p>如果同时有两个 Java 线程，在这 32KB 内存中进行引用更新操作，那么也将造成存储卡表的同一部分的缓存行的写回、无效化或者同步操作，因而间接影响程序性能。</p> 
<p>为此，HotSpot 引入了一个新的参数 -XX:+UseCondCardMark，来尽量减少写卡表的操作。其伪代码如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       if (CARD_TABLE [this address &gt;&gt; 9] != DIRTY) 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        CARD_TABLE [this address &gt;&gt; 9] = DIRTY;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<h2>总结与实践</h2> 
<p>今天我介绍了 Java 虚拟机中垃圾回收具体实现的一些通用知识。</p> 
<p>Java 虚拟机将堆分为新生代和老年代，并且对不同代采用不同的垃圾回收算法。其中，新生代分为 Eden 区和两个大小一致的 Survivor 区，并且其中一个 Survivor 区是空的。</p> 
<p>在只针对新生代的 Minor GC 中，Eden 区和非空 Survivor 区的存活对象会被复制到空的 Survivor 区中，当 Survivor 区中的存活对象复制次数超过一定数值时，它将被晋升至老年代。</p> 
<p>因为 Minor GC 只针对新生代进行垃圾回收，所以在枚举 GC Roots 的时候，它需要考虑从老年代到新生代的引用。为了避免扫描整个老年代，Java 虚拟机引入了名为卡表的技术，大致地标出可能存在老年代到新生代引用的内存区域。</p> 
<p>由于篇幅的原因，我没有讲解 Java 虚拟机中具体的垃圾回收器。我在文章的末尾附了一段简单的介绍，如果你有兴趣的话可以参阅一下。</p> 
<p>今天的实践环节，我们来看看 Java 对象的生命周期对垃圾回收的影响。</p> 
<p>前面提到，Java 虚拟机的分代垃圾回收是基于大部分对象只存活一小段时间，小部分对象却存活一大段时间的假设的。</p> 
<p>然而，现实情况中并非每个程序都符合前面提到的假设。如果一个程序拥有中等生命周期的对象，并且刚移动到老年代便不再使用，那么将给默认的垃圾回收策略造成极大的麻烦。</p> 
<p>下面这段程序将生成 64G 的 Java 对象。并且，我通过 ALIVE_OBJECT_SIZE 这一变量来定义同时存活的 Java 对象的大小。这也是一种对于垃圾回收器来说比较直观的生命周期。</p> 
<p>当我们使用 Java 8 的默认 GC，并且将新生代的空间限制在 100M 时，试着估算当 ALIVE_OBJECT_SIZE 为多少时，这段程序不会触发 Full GC（提示一下，如果 Survivor 区没法存储所有存活对象，将发生什么。）。实际运行情况又是怎么样的？</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // Run with java -XX:+PrintGC -Xmn100M -XX:PretenureSizeThreshold=10000 LifetimeTest
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // You may also try with -XX:+PrintHeapAtGC，-XX:-UsePSAdaptiveSurvivorSizePolicy or -XX:SurvivorRatio=N
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class LifetimeTest {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final int K = 1024;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final int M = K * K;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final int G = K * M;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final int ALIVE_OBJECT_SIZE = 32 * M;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int length = ALIVE_OBJECT_SIZE / 64;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ObjectOf64Bytes[] array = new ObjectOf64Bytes[length];
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (long i = 0; i &lt; G; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        array[(int) (i % length)] = new ObjectOf64Bytes();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class ObjectOf64Bytes {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder3;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder4;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder5;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<h2>附录：Java 虚拟机中的垃圾回收器</h2> 
<p>针对新生代的垃圾回收器共有三个：Serial，Parallel Scavenge 和 Parallel New。这三个采用的都是标记 - 复制算法。其中，Serial 是一个单线程的，Parallel New 可以看成 Serial 的多线程版本。Parallel Scavenge 和 Parallel New 类似，但更加注重吞吐率。此外，Parallel Scavenge 不能与 CMS 一起使用。</p> 
<p>针对老年代的垃圾回收器也有三个：刚刚提到的 Serial Old 和 Parallel Old，以及 CMS。Serial Old 和 Parallel Old 都是标记 - 压缩算法。同样，前者是单线程的，而后者可以看成前者的多线程版本。</p> 
<p>CMS 采用的是标记 - 清除算法，并且是并发的。除了少数几个操作需要 Stop-the-world 之外，它可以在应用程序运行过程中进行垃圾回收。在并发收集失败的情况下，Java 虚拟机会使用其他两个压缩型垃圾回收器进行一次垃圾回收。由于 G1 的出现，CMS 在 Java 9 中已被废弃 [3]。</p> 
<p>G1（Garbage First）是一个横跨新生代和老年代的垃圾回收器。实际上，它已经打乱了前面所说的堆结构，直接将堆分成极其多个区域。每个区域都可以充当 Eden 区、Survivor 区或者老年代中的一个。它采用的是标记 - 压缩算法，而且和 CMS 一样都能够在应用程序运行过程中并发地进行垃圾回收。</p> 
<p>G1 能够针对每个细分的区域来进行垃圾回收。在选择进行垃圾回收的区域时，它会优先回收死亡对象较多的区域。这也是 G1 名字的由来。</p> 
<p>即将到来的 Java 11 引入了 ZGC，宣称暂停时间不超过 10ms。如果你感兴趣的话，可参考 R 大的这篇文章 [4]。</p> 
<p>[1]<br> <a href="http://psy-lob-saw.blogspot.com/2014/10/the-jvm-write-barrier-card-marking.html">http://psy-lob-saw.blogspot.com/2014/10/the-jvm-write-barrier-card-marking.html</a><br> [2]<br> <a href="https://blogs.oracle.com/dave/false-sharing-induced-by-card-table-marking">https://blogs.oracle.com/dave/false-sharing-induced-by-card-table-marking</a><br> [3]<br> <a href="http://openjdk.java.net/jeps/291">http://openjdk.java.net/jeps/291</a><br> [4] <a href="https://www.zhihu.com/question/287945354/answer/458761494">https://www.zhihu.com/question/287945354/answer/458761494</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |33          |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:48:20.582 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=33 
 {executed in 4 msec}
2020-11-19 20:48:20.599 INFO  jdbc.resultsettable Line:610 - 
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>在读博士的时候，我曾经写过一个统计 Java 对象生命周期的动态分析，并且用它来跑了一些基准测试。</p> 
<p>其中一些程序的结果，恰好验证了许多研究人员的假设，即大部分的 Java 对象只存活一小段时间，而存活下来的小部分 Java 对象则会存活很长一段时间。</p> 
<p><img src="https://static001.geekbang.org/resource/image/e2/89/e235d25ca15b60a511a2d90317eb9589.png" alt=""></p> 
<p>（pmd 中 Java 对象生命周期的直方图，红色的表示被逃逸分析优化掉的对象）</p> 
<p>之所以要提到这个假设，是因为它造就了 Java 虚拟机的分代回收思想。简单来说，就是将堆空间划分为两代，分别叫做新生代和老年代。新生代用来存储新建的对象。当对象存活时间够长时，则将其移动到老年代。</p> 
<p>Java 虚拟机可以给不同代使用不同的回收算法。对于新生代，我们猜测大部分的 Java 对象只存活一小段时间，那么便可以频繁地采用耗时较短的垃圾回收算法，让大部分的垃圾都能够在新生代被回收掉。</p> 
<p>对于老年代，我们猜测大部分的垃圾已经在新生代中被回收了，而在老年代中的对象有大概率会继续存活。当真正触发针对老年代的回收时，则代表这个假设出错了，或者堆的空间已经耗尽了。</p> 
<p>这时候，Java 虚拟机往往需要做一次全堆扫描，耗时也将不计成本。（当然，现代的垃圾回收器都在并发收集的道路上发展，来避免这种全堆扫描的情况。）</p><!-- [[[read_end]]] --> 
<p>今天这一篇我们来关注一下针对新生代的 Minor GC。首先，我们来看看 Java 虚拟机中的堆具体是怎么划分的。</p> 
<h2>Java 虚拟机的堆划分</h2> 
<p>前面提到，Java 虚拟机将堆划分为新生代和老年代。其中，新生代又被划分为 Eden 区，以及两个大小相同的 Survivor 区。</p> 
<p>默认情况下，Java 虚拟机采取的是一种动态分配的策略（对应 Java 虚拟机参数 -XX:+UsePSAdaptiveSurvivorSizePolicy），根据生成对象的速率，以及 Survivor 区的使用情况动态调整 Eden 区和 Survivor 区的比例。</p> 
<p>当然，你也可以通过参数 -XX:SurvivorRatio 来固定这个比例。但是需要注意的是，其中一个 Survivor 区会一直为空，因此比例越低浪费的堆空间将越高。</p> 
<p><img src="https://static001.geekbang.org/resource/image/2c/e5/2cc29b8de676d3747416416a3523e4e5.png" alt=""></p> 
<p>通常来说，当我们调用 new 指令时，它会在 Eden 区中划出一块作为存储对象的内存。由于堆空间是线程共享的，因此直接在这里边划空间是需要进行同步的。</p> 
<p>否则，将有可能出现两个对象共用一段内存的事故。如果你还记得前两篇我用“停车位”打的比方的话，这里就相当于两个司机（线程）同时将车停入同一个停车位，因而发生剐蹭事故。</p> 
<p>Java 虚拟机的解决方法是为每个司机预先申请多个停车位，并且只允许该司机停在自己的停车位上。那么当司机的停车位用完了该怎么办呢（假设这个司机代客泊车）？</p> 
<p>答案是：再申请多个停车位便可以了。这项技术被称之为 TLAB（Thread Local Allocation Buffer，对应虚拟机参数 -XX:+UseTLAB，默认开启）。</p> 
<p>具体来说，每个线程可以向 Java 虚拟机申请一段连续的内存，比如 2048 字节，作为线程私有的 TLAB。</p> 
<p>这个操作需要加锁，线程需要维护两个指针（实际上可能更多，但重要也就两个），一个指向 TLAB 中空余内存的起始位置，一个则指向 TLAB 末尾。</p> 
<p>接下来的 new 指令，便可以直接通过指针加法（bump the pointer）来实现，即把指向空余内存位置的指针加上所请求的字节数。</p> 
<blockquote> 
 <p><span class="reference">我猜测会有留言问为什么不把 bump the pointer 翻译成指针碰撞。这里先解释一下，在英语中我们通常省略了 bump up the pointer 中的 up。在这个上下文中 bump 的含义应为“提高”。另外一个例子是当我们发布软件的新版本时，也会说 bump the version number。</span></p> 
</blockquote> 
<p>如果加法后空余内存指针的值仍小于或等于指向末尾的指针，则代表分配成功。否则，TLAB 已经没有足够的空间来满足本次新建操作。这个时候，便需要当前线程重新申请新的 TLAB。</p> 
<p>当 Eden 区的空间耗尽了怎么办？这个时候 Java 虚拟机便会触发一次 Minor GC，来收集新生代的垃圾。存活下来的对象，则会被送到 Survivor 区。</p> 
<p>前面提到，新生代共有两个 Survivor 区，我们分别用 from 和 to 来指代。其中 to 指向的 Survivior 区是空的。</p> 
<p>当发生 Minor GC 时，Eden 区和 from 指向的 Survivor 区中的存活对象会被复制到 to 指向的 Survivor 区中，然后交换 from 和 to 指针，以保证下一次 Minor GC 时，to 指向的 Survivor 区还是空的。</p> 
<p>Java 虚拟机会记录 Survivor 区中的对象一共被来回复制了几次。如果一个对象被复制的次数为 15（对应虚拟机参数 -XX:+MaxTenuringThreshold），那么该对象将被晋升（promote）至老年代。另外，如果单个 Survivor 区已经被占用了 50%（对应虚拟机参数 -XX:TargetSurvivorRatio），那么较高复制次数的对象也会被晋升至老年代。</p> 
<p>总而言之，当发生 Minor GC 时，我们应用了标记 - 复制算法，将 Survivor 区中的老存活对象晋升到老年代，然后将剩下的存活对象和 Eden 区的存活对象复制到另一个 Survivor 区中。理想情况下，Eden 区中的对象基本都死亡了，那么需要复制的数据将非常少，因此采用这种标记 - 复制算法的效果极好。</p> 
<p>Minor GC 的另外一个好处是不用对整个堆进行垃圾回收。但是，它却有一个问题，那就是老年代的对象可能引用新生代的对象。也就是说，在标记存活对象的时候，我们需要扫描老年代中的对象。如果该对象拥有对新生代对象的引用，那么这个引用也会被作为 GC Roots。</p> 
<p>这样一来，岂不是又做了一次全堆扫描呢？</p> 
<h2>卡表</h2> 
<p>HotSpot 给出的解决方案是一项叫做卡表（Card Table）的技术。该技术将整个堆划分为一个个大小为 512 字节的卡，并且维护一个卡表，用来存储每张卡的一个标识位。这个标识位代表对应的卡是否可能存有指向新生代对象的引用。如果可能存在，那么我们就认为这张卡是脏的。</p> 
<p>在进行 Minor GC 的时候，我们便可以不用扫描整个老年代，而是在卡表中寻找脏卡，并将脏卡中的对象加入到 Minor GC 的 GC Roots 里。当完成所有脏卡的扫描之后，Java 虚拟机便会将所有脏卡的标识位清零。</p> 
<p>由于 Minor GC 伴随着存活对象的复制，而复制需要更新指向该对象的引用。因此，在更新引用的同时，我们又会设置引用所在的卡的标识位。这个时候，我们可以确保脏卡中必定包含指向新生代对象的引用。</p> 
<p>在 Minor GC 之前，我们并不能确保脏卡中包含指向新生代对象的引用。其原因和如何设置卡的标识位有关。</p> 
<p>首先，如果想要保证每个可能有指向新生代对象引用的卡都被标记为脏卡，那么 Java 虚拟机需要截获每个引用型实例变量的写操作，并作出对应的写标识位操作。</p> 
<p>这个操作在解释执行器中比较容易实现。但是在即时编译器生成的机器码中，则需要插入额外的逻辑。这也就是所谓的写屏障（write barrier，注意不要和 volatile 字段的写屏障混淆）。</p> 
<p>写屏障需要尽可能地保持简洁。这是因为我们并不希望在每条引用型实例变量的写指令后跟着一大串注入的指令。</p> 
<p>因此，写屏障并不会判断更新后的引用是否指向新生代中的对象，而是宁可错杀，不可放过，一律当成可能指向新生代对象的引用。</p> 
<p>这么一来，写屏障便可精简为下面的伪代码 [1]。这里右移 9 位相当于除以 512，Java 虚拟机便是通过这种方式来从地址映射到卡表中的索引的。最终，这段代码会被编译成一条移位指令和一条存储指令。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       CARD_TABLE [this address &gt;&gt; 9] = DIRTY;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>虽然写屏障不可避免地带来一些开销，但是它能够加大 Minor GC 的吞吐率（ 应用运行时间 /(应用运行时间 + 垃圾回收时间) ）。总的来说还是值得的。不过，在高并发环境下，写屏障又带来了虚共享（false sharing）问题 [2]。</p> 
<p>在介绍对象内存布局中我曾提到虚共享问题，讲的是几个 volatile 字段出现在同一缓存行里造成的虚共享。这里的虚共享则是卡表中不同卡的标识位之间的虚共享问题。</p> 
<p>在 HotSpot 中，卡表是通过 byte 数组来实现的。对于一个 64 字节的缓存行来说，如果用它来加载部分卡表，那么它将对应 64 张卡，也就是 32KB 的内存。</p> 
<p>如果同时有两个 Java 线程，在这 32KB 内存中进行引用更新操作，那么也将造成存储卡表的同一部分的缓存行的写回、无效化或者同步操作，因而间接影响程序性能。</p> 
<p>为此，HotSpot 引入了一个新的参数 -XX:+UseCondCardMark，来尽量减少写卡表的操作。其伪代码如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       if (CARD_TABLE [this address &gt;&gt; 9] != DIRTY) 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        CARD_TABLE [this address &gt;&gt; 9] = DIRTY;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<h2>总结与实践</h2> 
<p>今天我介绍了 Java 虚拟机中垃圾回收具体实现的一些通用知识。</p> 
<p>Java 虚拟机将堆分为新生代和老年代，并且对不同代采用不同的垃圾回收算法。其中，新生代分为 Eden 区和两个大小一致的 Survivor 区，并且其中一个 Survivor 区是空的。</p> 
<p>在只针对新生代的 Minor GC 中，Eden 区和非空 Survivor 区的存活对象会被复制到空的 Survivor 区中，当 Survivor 区中的存活对象复制次数超过一定数值时，它将被晋升至老年代。</p> 
<p>因为 Minor GC 只针对新生代进行垃圾回收，所以在枚举 GC Roots 的时候，它需要考虑从老年代到新生代的引用。为了避免扫描整个老年代，Java 虚拟机引入了名为卡表的技术，大致地标出可能存在老年代到新生代引用的内存区域。</p> 
<p>由于篇幅的原因，我没有讲解 Java 虚拟机中具体的垃圾回收器。我在文章的末尾附了一段简单的介绍，如果你有兴趣的话可以参阅一下。</p> 
<p>今天的实践环节，我们来看看 Java 对象的生命周期对垃圾回收的影响。</p> 
<p>前面提到，Java 虚拟机的分代垃圾回收是基于大部分对象只存活一小段时间，小部分对象却存活一大段时间的假设的。</p> 
<p>然而，现实情况中并非每个程序都符合前面提到的假设。如果一个程序拥有中等生命周期的对象，并且刚移动到老年代便不再使用，那么将给默认的垃圾回收策略造成极大的麻烦。</p> 
<p>下面这段程序将生成 64G 的 Java 对象。并且，我通过 ALIVE_OBJECT_SIZE 这一变量来定义同时存活的 Java 对象的大小。这也是一种对于垃圾回收器来说比较直观的生命周期。</p> 
<p>当我们使用 Java 8 的默认 GC，并且将新生代的空间限制在 100M 时，试着估算当 ALIVE_OBJECT_SIZE 为多少时，这段程序不会触发 Full GC（提示一下，如果 Survivor 区没法存储所有存活对象，将发生什么。）。实际运行情况又是怎么样的？</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // Run with java -XX:+PrintGC -Xmn100M -XX:PretenureSizeThreshold=10000 LifetimeTest
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // You may also try with -XX:+PrintHeapAtGC，-XX:-UsePSAdaptiveSurvivorSizePolicy or -XX:SurvivorRatio=N
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class LifetimeTest {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final int K = 1024;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final int M = K * K;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final int G = K * M;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final int ALIVE_OBJECT_SIZE = 32 * M;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int length = ALIVE_OBJECT_SIZE / 64;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ObjectOf64Bytes[] array = new ObjectOf64Bytes[length];
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (long i = 0; i &lt; G; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        array[(int) (i % length)] = new ObjectOf64Bytes();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class ObjectOf64Bytes {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder3;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder4;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long placeholder5;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<h2>附录：Java 虚拟机中的垃圾回收器</h2> 
<p>针对新生代的垃圾回收器共有三个：Serial，Parallel Scavenge 和 Parallel New。这三个采用的都是标记 - 复制算法。其中，Serial 是一个单线程的，Parallel New 可以看成 Serial 的多线程版本。Parallel Scavenge 和 Parallel New 类似，但更加注重吞吐率。此外，Parallel Scavenge 不能与 CMS 一起使用。</p> 
<p>针对老年代的垃圾回收器也有三个：刚刚提到的 Serial Old 和 Parallel Old，以及 CMS。Serial Old 和 Parallel Old 都是标记 - 压缩算法。同样，前者是单线程的，而后者可以看成前者的多线程版本。</p> 
<p>CMS 采用的是标记 - 清除算法，并且是并发的。除了少数几个操作需要 Stop-the-world 之外，它可以在应用程序运行过程中进行垃圾回收。在并发收集失败的情况下，Java 虚拟机会使用其他两个压缩型垃圾回收器进行一次垃圾回收。由于 G1 的出现，CMS 在 Java 9 中已被废弃 [3]。</p> 
<p>G1（Garbage First）是一个横跨新生代和老年代的垃圾回收器。实际上，它已经打乱了前面所说的堆结构，直接将堆分成极其多个区域。每个区域都可以充当 Eden 区、Survivor 区或者老年代中的一个。它采用的是标记 - 压缩算法，而且和 CMS 一样都能够在应用程序运行过程中并发地进行垃圾回收。</p> 
<p>G1 能够针对每个细分的区域来进行垃圾回收。在选择进行垃圾回收的区域时，它会优先回收死亡对象较多的区域。这也是 G1 名字的由来。</p> 
<p>即将到来的 Java 11 引入了 ZGC，宣称暂停时间不超过 10ms。如果你感兴趣的话，可参考 R 大的这篇文章 [4]。</p> 
<p>[1]<br> <a href="http://psy-lob-saw.blogspot.com/2014/10/the-jvm-write-barrier-card-marking.html">http://psy-lob-saw.blogspot.com/2014/10/the-jvm-write-barrier-card-marking.html</a><br> [2]<br> <a href="https://blogs.oracle.com/dave/false-sharing-induced-by-card-table-marking">https://blogs.oracle.com/dave/false-sharing-induced-by-card-table-marking</a><br> [3]<br> <a href="http://openjdk.java.net/jeps/291">http://openjdk.java.net/jeps/291</a><br> [4] <a href="https://www.zhihu.com/question/287945354/answer/458761494">https://www.zhihu.com/question/287945354/answer/458761494</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |33          |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:48:20.653 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=33 
 {executed in 3 msec}
2020-11-19 20:48:20.655 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title      |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|-----|----|----|
|33  |1605789270 |1605789270 |1                |zh-hans  |0       |1                             |1      |0      |12丨垃圾回收（下） |book |1   |33  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|-----|----|----|

2020-11-19 20:48:20.661 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=33 
 {executed in 2 msec}
2020-11-19 20:48:20.663 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title      |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|----|----|
|[unread] |1605789270 |1605789270 |1                |zh-hans  |0       |1                             |1      |0      |12丨垃圾回收（下） |1   |33  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|----|----|

2020-11-19 20:48:20.685 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605790100, created=1605790100, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='12丨垃圾回收（下）', type='book', 
uid=1, vid=33 where nid=33 
 {executed in 1 msec}
2020-11-19 20:48:20.687 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605790100, created=1605790100, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='12丨垃圾回收（下）', 
uid=1, vid=33 where nid=33 
 {executed in 1 msec}
2020-11-19 20:48:20.715 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=33 
 {executed in 1 msec}
2020-11-19 20:48:20.718 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |revision_id |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|33        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/25a293d5be86cd89257191a55ce256aa?bkt=en-2fb6763f1c8fb10176e6ac0745626c542f9c6991338f8e52b4ddfccb81324d53a46f79d484ed69b1&fid=3757516097-778750-585168498837700&time=1605788188&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-knRX%2B8%2Bh730I3eU9pAbi0P904tY%3D&to=92&size=5056122&sta_dx=5056122&sta_cs=2358&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182963&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5056122&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-637ee824b139e504e2ef7be05e4f2be19e3fe4a5dc44518baebab3b4e0cd08194b9634f368a8969f&sl=76480590&expires=8h&rt=pr&r=972559466&mlogid=7510874474625307362&vbdid=64799653&fin=12%E4%B8%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%88%E4%B8%8B%EF%BC%89.mp3&bflag=92,34-92&rtype=1&dp-logid=7510874474625307362&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=37cfb58296b21ea9ed8fe6e50a509f409ca053a26f347f59&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=12%E4%B8%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%88%E4%B8%8B%EF%BC%89.mp3 |33          |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:48:20.744 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=33 
 {executed in 1 msec}
2020-11-19 20:48:20.747 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |revision_id |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/25a293d5be86cd89257191a55ce256aa?bkt=en-2fb6763f1c8fb10176e6ac0745626c542f9c6991338f8e52b4ddfccb81324d53a46f79d484ed69b1&fid=3757516097-778750-585168498837700&time=1605788188&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-knRX%2B8%2Bh730I3eU9pAbi0P904tY%3D&to=92&size=5056122&sta_dx=5056122&sta_cs=2358&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182963&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5056122&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-637ee824b139e504e2ef7be05e4f2be19e3fe4a5dc44518baebab3b4e0cd08194b9634f368a8969f&sl=76480590&expires=8h&rt=pr&r=972559466&mlogid=7510874474625307362&vbdid=64799653&fin=12%E4%B8%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%88%E4%B8%8B%EF%BC%89.mp3&bflag=92,34-92&rtype=1&dp-logid=7510874474625307362&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=37cfb58296b21ea9ed8fe6e50a509f409ca053a26f347f59&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=12%E4%B8%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%88%E4%B8%8B%EF%BC%89.mp3 |33          |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:48:20.776 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=33 
 {executed in 5 msec}
2020-11-19 20:48:20.798 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |delta |field_comment_format |langcode |revision_id |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|33        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">16</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   写的非常棒，又帮我看到了一个小黑盒中的天地。
   <br>小结：
   <br>1:二八法则-适用于许多的领域，对象在JVM对内存空间的生命周期也同样符合
   <br>
   <br>2:为了更好的JVM性能以及充分利用对象生命周期的二八法则，JVM的作者将JVM的对内存空间进行了分代的处理
   <br>
   <br>3:堆内存空间=年轻代+老年代
   <br>
   <br>&nbsp;&nbsp;&nbsp;&nbsp;年轻代=Eden+from+to
   <br>&nbsp;&nbsp;&nbsp;&nbsp;年轻代用于分配新生的对象
   <br>&nbsp;&nbsp;&nbsp;&nbsp;Eden-通常用于存储新创建的对象，对内存空间是共享的，所以，直接在这里面划分空间需要进行同步
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from-当Eden区的空间耗尽时，JVM便会出发一次Minor GC 来收集新生代的垃圾，会把存活下来的对象放入Survivor区，也就是from区
   <br>注意，from和to是变动的
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to-指向的Survivor区是空的，用于当发生Minor GC 时，存储Eden和from区中的存活对象，然后再交换from和to指针，以保证下一次Minor GC 时to指向的Survivor区还是空的。
   <br>
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;老年代-用于存储存活时间更久的对象，比如：15次Minor GC 还存活的对象就放入老年代中
   <br>
   <br>4:堆内存分代后，会根据他们的不同特点来区别对待，进行垃圾回收的时候会使用不同的垃圾回收方式，针对新生代的垃圾回收器有如下三个：Serial、Parallel Scavenge、Parallel New，他们采用的都是标记-复制的垃圾回收算法。
   <br>针对老年代的垃圾回收器有如下三个：Serial Old 、Parallel Old 、CMS，他们使用的都是标记-压缩的垃圾回收算法。
   <br>
   <br>5:TLAB（Thread Local Allocation Buffer）-这个技术是用于解决多线程竞争堆内存分配问题的，核心原理是对分配一些连续的内存空间
   <br>
   <br>6:卡表-这个技术是用于解决减少老年代的全堆空间扫描
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 好长的总结，赞一个</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>javaadu</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">7</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   写得真好，搞清楚了之前没掌握透彻的概念：
   <br>（1）TLAB是为了避免对象分配时对内存的竞争
   <br>（2）卡表是为了处理minor gc时老年代对新生代的引用，为了避免整堆扫描而提出了卡表的概念
   <br>
   <br>提个问题：JVM中堆内存根系统的物理内存是如何对应的，这个可以从哪里看？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 根系统指的是？<br><br>GC roots分布在HotSpot中的每个子系统里。可以在源码中搜oops_do</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>公子_小白</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师您好
   <br>请问JVM分代收集新生代对象进入老年代，年龄为什么是15而不是其他的?
   <br>谢谢
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: HotSpot会在对象头中的标记字段里记录年龄，分配到的空间只有4位，最多只能记录到15</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/80/bf/3041138b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>　素丶　　</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   可以配合R大的文章
   <br>http://rednaxelafx.iteye.com/blog/1042471
   <br>http://rednaxelafx.iteye.com/blog/174865
   <br>http://rednaxelafx.iteye.com/blog/1044951
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/bf/b6/ee3b4ef7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>herome</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师 建议是能画点图吗 😂 每一篇都是文字。 相信画了图 不仅能让文章通俗易懂，也能让老师的文笔更好。
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 多谢建议！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLgXj6Axr2aRE3ZwickSicNhTlzP7mlevGBjZulTZlTTOyPHwLpN21Eu7RJDicWMDcBnhuRSN5IOuBWA/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>愤怒的虾干</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   1、当默认开启动态分配时，若ALIVE_OBJECT_SIZE小于33M几乎无FULL GC，大于则出现FULL GC。动态分配时Eden区大小不能小于Survivor区，即最少为新生代内存的1/3，单个Survivor区最大为新生代内存的1/3。故当ALIVE_OBJECT_SIZE大于33M时，Survivor区小于ALIVE_OBJECT_SIZE，导致Minor GC时需要复制到to区的数据大于to区容量，从而使得一部分数据提前晋升到老年区，多次提前晋升导致老年区无多余空间从而导致Full GC；当ALIVE_OBJECT_SIZE小于33M时，Survivor区容量总是近似的接近ALIVE_OBJECT_SIZE大小，使得每次Minor GC有效对象都可以复制到Survivor区，而晋升到老年代的对象大多是年龄达到次数要求，短期内不会挤满老年代空间，在有限时间内运行结束不会引发Full GC。
   <br>2、当-XX:-UsePSAdaptiveSurvivorSizePolicy or -XX:SurvivorRatio=N关闭动态分配或指定Eden、Survivor比例时，只要ALIVE_OBJECT_SIZE小于Survivor容量，有限时间运行结束不会引发Full GC。反之会导致Full GC。
   <br>@郑老师 是否是这样？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>公子_小白</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-24
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   多谢老师的回复
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>西兹兹</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师好，请问java8开始之后的元数据区的回收是如何呢？这部分属于堆外内存吗？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/48/df/0ecd8c36.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>多巴胺老邮...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   郑老师您好 ！ 一直想问问CMS收集器中并发标记这一个步骤的作用是什么 ？ 为什么还要在初始标记的基础上多进行一次Roots Tracing呢？ 希望您能有空能够回复下 thx 
   <br>
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/e4/27/73359af3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>骑车吃火锅</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   请问老师，java类是如何被卸载的？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/61/f2/ca989d6f.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Leon Wong</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-12
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师你好，写屏障不会判断引用是否指向新生代的对象，这里会不会提高MinorGC的成本呢？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1Y9r3uuNQ1c5cbsk7XeVBEiamwwGsa7DuawliaFr6NG9yNZhdasOKXVdUpu1F3kVFibFWWZibeawjbg/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>code-arti...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   通过GC_roots探索存活对象的时候，有的对象在新生代，有的对象在老年代。如果当前对象处在老年代而且在赃卡中，需要继续深度遍历对象。若不在赃卡中，就没必要进一步深度遍历下去了。不知道我的理解对不？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 对的。卡表就是为了避免探索整个老年代，而只将脏表中的对象作为GC roots。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/76/09/cf7513c8.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>nero</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   这也太狠了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/19/49/9452b2fd.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Theodore</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-04
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师您好，我想咨询一下，你是否研究过类的GC。
   <br>在大量反射、动态代理，CGLib等Bytecode框架、动态生成jsp 等动态类对象（非实例对象）在jdk1.8中是否是使用MethodHandle实现的？这些动态类的GC细节能给我提供点学习资料吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/56/41/050144c7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Jadic</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   hi，想了解下，当前线程在申请TLAB的时候是如何决定本次申请的空间大小的，如何尽量不浪费又少申请次数？谢谢。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/16/4f/7d/930b2957.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>XuYJ</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   cms不是标记清除吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>rakitten</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-25
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   有两个问题想请教一下郑老师：
   <br>1、介绍GC的文档很多，我有个疑问：GC的代码哪里能看到？
   <br>2、我们的后台服务一天内偶尔出现一次YGC耗时很长的情况（超过100ms，正常只有20ms），而且很难复现。我在想，能不能在GC发生的时候，触发一个Linux脚本，记录现场的线程信息以及堆栈信息
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/27/54/d38c34a0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小泷哥</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   可以这么理解吗：
   <br>1、卡表记录老年代执行新生代的引用
   <br>2、老年代的引用变更都会被当做堆新生代的引用，记录在卡表中。
   <br>3、只需要在老年代GC的时候，执行一次minor GC就行了，清理card table(包括CMS和G1)。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/66/75/54bb858e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>life is ...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   记载来自一个刚刚迈进程序世界的coder
   <br>
   <br>java对象的生存周期
   <br>
   <br>大部分对象的生命周期都很短，小部分对象的生命周期很长。
   <br>
   <br>因为这个特点，可以对jvm内存分代，不同代采用不同的回收方式。
   <br>
   <br>年轻代要采用频繁的回收方式，快速回收大部分垃圾。老年代则采用不频繁但彻底的回收方式。
   <br>
   <br>JVM堆的划分
   <br>
   <br>因为对象以上的特点，将堆分为两个代，老年代和新生代。新生代分为Eden和两个Survivor区。可以使用参数 “”，会动态的根据对象的生成速率以及survivor区的使用情况，调整Eden区和survivor区的比例。也可以使用参数“”，来固定Eden和survivor的比例。
   <br>
   <br>如何保证内存分配的线程安全
   <br>
   <br>堆是共享的，所有的线程都会在堆上分配内存，那么jvm是如何保证内存分配是线程安全的？答案是，每个线程都会有TLAB(thread local allocation buffer)，这个是线程私有的。首先会在TLAB上分配，如果TLAB不够用，就需要通过加锁的方式，申请TLAB。
   <br>
   <br>Eden区满了
   <br>
   <br>触发minor GC，eden和from依旧存活的对象会放置到to区。然后交换from to指针的指向。其中达到经历过一定回收次数的对象将会被晋升到老年代，对应JVM参数[]。同时如果也配置了[]参数，单个survivor区占用超过50%，经历次数较高的对象也会晋升到老年代。
   <br>
   <br>先提前说一个结论，minor GC有一个好处，发生GC时不会遍历堆内存，只会遍历Eden+survivor区！讲道理，老年代很可能拥有Eden+survivor区对象的引用，那minor GC只遍历年轻代，是怎么做到GC的呢？
   <br>
   <br>卡表
   <br>
   <br>HotSpot会将堆分割成一个个512字节大小的卡，然后维护一张卡表，每个卡在表中占据一个卡位。
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/57/449e76fb.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>QlDoors</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-12
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   &lt; 1/2 Suvivors 时，不会发生Full GC
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |33          |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:48:20.835 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=33 
 {executed in 3 msec}
2020-11-19 20:48:20.866 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |delta |field_comment_format |langcode |revision_id |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">16</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   写的非常棒，又帮我看到了一个小黑盒中的天地。
   <br>小结：
   <br>1:二八法则-适用于许多的领域，对象在JVM对内存空间的生命周期也同样符合
   <br>
   <br>2:为了更好的JVM性能以及充分利用对象生命周期的二八法则，JVM的作者将JVM的对内存空间进行了分代的处理
   <br>
   <br>3:堆内存空间=年轻代+老年代
   <br>
   <br>&nbsp;&nbsp;&nbsp;&nbsp;年轻代=Eden+from+to
   <br>&nbsp;&nbsp;&nbsp;&nbsp;年轻代用于分配新生的对象
   <br>&nbsp;&nbsp;&nbsp;&nbsp;Eden-通常用于存储新创建的对象，对内存空间是共享的，所以，直接在这里面划分空间需要进行同步
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from-当Eden区的空间耗尽时，JVM便会出发一次Minor GC 来收集新生代的垃圾，会把存活下来的对象放入Survivor区，也就是from区
   <br>注意，from和to是变动的
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to-指向的Survivor区是空的，用于当发生Minor GC 时，存储Eden和from区中的存活对象，然后再交换from和to指针，以保证下一次Minor GC 时to指向的Survivor区还是空的。
   <br>
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;老年代-用于存储存活时间更久的对象，比如：15次Minor GC 还存活的对象就放入老年代中
   <br>
   <br>4:堆内存分代后，会根据他们的不同特点来区别对待，进行垃圾回收的时候会使用不同的垃圾回收方式，针对新生代的垃圾回收器有如下三个：Serial、Parallel Scavenge、Parallel New，他们采用的都是标记-复制的垃圾回收算法。
   <br>针对老年代的垃圾回收器有如下三个：Serial Old 、Parallel Old 、CMS，他们使用的都是标记-压缩的垃圾回收算法。
   <br>
   <br>5:TLAB（Thread Local Allocation Buffer）-这个技术是用于解决多线程竞争堆内存分配问题的，核心原理是对分配一些连续的内存空间
   <br>
   <br>6:卡表-这个技术是用于解决减少老年代的全堆空间扫描
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 好长的总结，赞一个</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>javaadu</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">7</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   写得真好，搞清楚了之前没掌握透彻的概念：
   <br>（1）TLAB是为了避免对象分配时对内存的竞争
   <br>（2）卡表是为了处理minor gc时老年代对新生代的引用，为了避免整堆扫描而提出了卡表的概念
   <br>
   <br>提个问题：JVM中堆内存根系统的物理内存是如何对应的，这个可以从哪里看？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 根系统指的是？<br><br>GC roots分布在HotSpot中的每个子系统里。可以在源码中搜oops_do</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>公子_小白</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师您好
   <br>请问JVM分代收集新生代对象进入老年代，年龄为什么是15而不是其他的?
   <br>谢谢
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: HotSpot会在对象头中的标记字段里记录年龄，分配到的空间只有4位，最多只能记录到15</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/80/bf/3041138b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>　素丶　　</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   可以配合R大的文章
   <br>http://rednaxelafx.iteye.com/blog/1042471
   <br>http://rednaxelafx.iteye.com/blog/174865
   <br>http://rednaxelafx.iteye.com/blog/1044951
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/bf/b6/ee3b4ef7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>herome</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师 建议是能画点图吗 😂 每一篇都是文字。 相信画了图 不仅能让文章通俗易懂，也能让老师的文笔更好。
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 多谢建议！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLgXj6Axr2aRE3ZwickSicNhTlzP7mlevGBjZulTZlTTOyPHwLpN21Eu7RJDicWMDcBnhuRSN5IOuBWA/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>愤怒的虾干</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   1、当默认开启动态分配时，若ALIVE_OBJECT_SIZE小于33M几乎无FULL GC，大于则出现FULL GC。动态分配时Eden区大小不能小于Survivor区，即最少为新生代内存的1/3，单个Survivor区最大为新生代内存的1/3。故当ALIVE_OBJECT_SIZE大于33M时，Survivor区小于ALIVE_OBJECT_SIZE，导致Minor GC时需要复制到to区的数据大于to区容量，从而使得一部分数据提前晋升到老年区，多次提前晋升导致老年区无多余空间从而导致Full GC；当ALIVE_OBJECT_SIZE小于33M时，Survivor区容量总是近似的接近ALIVE_OBJECT_SIZE大小，使得每次Minor GC有效对象都可以复制到Survivor区，而晋升到老年代的对象大多是年龄达到次数要求，短期内不会挤满老年代空间，在有限时间内运行结束不会引发Full GC。
   <br>2、当-XX:-UsePSAdaptiveSurvivorSizePolicy or -XX:SurvivorRatio=N关闭动态分配或指定Eden、Survivor比例时，只要ALIVE_OBJECT_SIZE小于Survivor容量，有限时间运行结束不会引发Full GC。反之会导致Full GC。
   <br>@郑老师 是否是这样？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>公子_小白</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-24
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   多谢老师的回复
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>西兹兹</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师好，请问java8开始之后的元数据区的回收是如何呢？这部分属于堆外内存吗？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/48/df/0ecd8c36.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>多巴胺老邮...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   郑老师您好 ！ 一直想问问CMS收集器中并发标记这一个步骤的作用是什么 ？ 为什么还要在初始标记的基础上多进行一次Roots Tracing呢？ 希望您能有空能够回复下 thx 
   <br>
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/e4/27/73359af3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>骑车吃火锅</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   请问老师，java类是如何被卸载的？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/61/f2/ca989d6f.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Leon Wong</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-12
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师你好，写屏障不会判断引用是否指向新生代的对象，这里会不会提高MinorGC的成本呢？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1Y9r3uuNQ1c5cbsk7XeVBEiamwwGsa7DuawliaFr6NG9yNZhdasOKXVdUpu1F3kVFibFWWZibeawjbg/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>code-arti...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   通过GC_roots探索存活对象的时候，有的对象在新生代，有的对象在老年代。如果当前对象处在老年代而且在赃卡中，需要继续深度遍历对象。若不在赃卡中，就没必要进一步深度遍历下去了。不知道我的理解对不？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 对的。卡表就是为了避免探索整个老年代，而只将脏表中的对象作为GC roots。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/76/09/cf7513c8.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>nero</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   这也太狠了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/19/49/9452b2fd.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Theodore</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-04
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师您好，我想咨询一下，你是否研究过类的GC。
   <br>在大量反射、动态代理，CGLib等Bytecode框架、动态生成jsp 等动态类对象（非实例对象）在jdk1.8中是否是使用MethodHandle实现的？这些动态类的GC细节能给我提供点学习资料吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/56/41/050144c7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Jadic</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   hi，想了解下，当前线程在申请TLAB的时候是如何决定本次申请的空间大小的，如何尽量不浪费又少申请次数？谢谢。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/16/4f/7d/930b2957.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>XuYJ</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   cms不是标记清除吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>rakitten</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-25
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   有两个问题想请教一下郑老师：
   <br>1、介绍GC的文档很多，我有个疑问：GC的代码哪里能看到？
   <br>2、我们的后台服务一天内偶尔出现一次YGC耗时很长的情况（超过100ms，正常只有20ms），而且很难复现。我在想，能不能在GC发生的时候，触发一个Linux脚本，记录现场的线程信息以及堆栈信息
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/27/54/d38c34a0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小泷哥</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   可以这么理解吗：
   <br>1、卡表记录老年代执行新生代的引用
   <br>2、老年代的引用变更都会被当做堆新生代的引用，记录在卡表中。
   <br>3、只需要在老年代GC的时候，执行一次minor GC就行了，清理card table(包括CMS和G1)。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/66/75/54bb858e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>life is ...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   记载来自一个刚刚迈进程序世界的coder
   <br>
   <br>java对象的生存周期
   <br>
   <br>大部分对象的生命周期都很短，小部分对象的生命周期很长。
   <br>
   <br>因为这个特点，可以对jvm内存分代，不同代采用不同的回收方式。
   <br>
   <br>年轻代要采用频繁的回收方式，快速回收大部分垃圾。老年代则采用不频繁但彻底的回收方式。
   <br>
   <br>JVM堆的划分
   <br>
   <br>因为对象以上的特点，将堆分为两个代，老年代和新生代。新生代分为Eden和两个Survivor区。可以使用参数 “”，会动态的根据对象的生成速率以及survivor区的使用情况，调整Eden区和survivor区的比例。也可以使用参数“”，来固定Eden和survivor的比例。
   <br>
   <br>如何保证内存分配的线程安全
   <br>
   <br>堆是共享的，所有的线程都会在堆上分配内存，那么jvm是如何保证内存分配是线程安全的？答案是，每个线程都会有TLAB(thread local allocation buffer)，这个是线程私有的。首先会在TLAB上分配，如果TLAB不够用，就需要通过加锁的方式，申请TLAB。
   <br>
   <br>Eden区满了
   <br>
   <br>触发minor GC，eden和from依旧存活的对象会放置到to区。然后交换from to指针的指向。其中达到经历过一定回收次数的对象将会被晋升到老年代，对应JVM参数[]。同时如果也配置了[]参数，单个survivor区占用超过50%，经历次数较高的对象也会晋升到老年代。
   <br>
   <br>先提前说一个结论，minor GC有一个好处，发生GC时不会遍历堆内存，只会遍历Eden+survivor区！讲道理，老年代很可能拥有Eden+survivor区对象的引用，那minor GC只遍历年轻代，是怎么做到GC的呢？
   <br>
   <br>卡表
   <br>
   <br>HotSpot会将堆分割成一个个512字节大小的卡，然后维护一张卡表，每个卡在表中占据一个卡位。
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/59/57/449e76fb.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>QlDoors</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-12
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   &lt; 1/2 Suvivors 时，不会发生Full GC
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |33          |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:48:20.902 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=33 
 {executed in 1 msec}
2020-11-19 20:48:20.904 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|------------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                         |
|----------|-------|------|---------|------------|------------------------------------------------------------------------------------------|
|33        |book   |0     |zh-hans  |33          |https://static001.geekbang.org/resource/image/b8/67/b88dfa407127f119d743d5a8d4881567.jpeg |
|----------|-------|------|---------|------------|------------------------------------------------------------------------------------------|

2020-11-19 20:48:20.929 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=33 
 {executed in 2 msec}
2020-11-19 20:48:20.931 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|------------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                         |
|----------|-------|------|---------|------------|------------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |33          |https://static001.geekbang.org/resource/image/b8/67/b88dfa407127f119d743d5a8d4881567.jpeg |
|----------|-------|------|---------|------------|------------------------------------------------------------------------------------------|

2020-11-19 20:48:20.956 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=33 
 {executed in 2 msec}
2020-11-19 20:48:20.958 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |33          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:48:20.985 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=33 
 {executed in 2 msec}
2020-11-19 20:48:20.986 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |33          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:48:21.011 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='497154737482603' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:48:21.013 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|67      |497154737482603 |0   |net_content |
|--------|----------------|----|------------|

2020-11-19 20:48:38.352 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='497154737482603' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:48:38.354 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|67      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:48:38.373 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='497154737482603', got=1, name='net_content' where item_id=67 
 {executed in 1 msec}
2020-11-19 20:48:38.397 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='497154737482603' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:48:38.398 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------|
|item_id |fsid            |got |name  |
|--------|----------------|----|------|
|68      |497154737482603 |1   |media |
|--------|----------------|----|------|

2020-11-19 20:48:38.402 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='497154737482603' 
 {executed in 1 msec}
2020-11-19 20:48:38.404 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|34        |book   |0     |497154737482603  |zh-hans  |34          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:48:38.406 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=34 
 {executed in 1 msec}
2020-11-19 20:48:38.408 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|34  |zh-hans  |book |d45960bc-c9a6-46fa-baa0-377d438d7b1c |34  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:48:38.429 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=34 
 {executed in 1 msec}
2020-11-19 20:48:38.431 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |497154737482603  |zh-hans  |34          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:48:38.452 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=34 
 {executed in 1 msec}
2020-11-19 20:48:38.454 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|34  |1   |3     |0            |1  |32 |34 |0  |0  |32  |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:48:38.477 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=34 
 {executed in 3 msec}
2020-11-19 20:48:38.491 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|34        |<p>你应该听说过这么一句话：免费的其实是最贵的。</p> 
<p>Java 虚拟机的自动内存管理，将原本需要由开发人员手动回收的内存，交给垃圾回收器来自动回收。不过既然是自动机制，肯定没法做到像手动回收那般精准高效 [1] ，而且还会带来不少与垃圾回收实现相关的问题。</p> 
<p>接下来的两篇，我们会深入探索 Java 虚拟机中的垃圾回收器。今天这一篇，我们来回顾一下垃圾回收的基础知识。</p> 
<h2>引用计数法与可达性分析</h2> 
<p>垃圾回收，顾名思义，便是将已经分配出去的，但却不再使用的内存回收回来，以便能够再次分配。在 Java 虚拟机的语境下，垃圾指的是死亡的对象所占据的堆空间。这里便涉及了一个关键的问题：如何辨别一个对象是存是亡？</p> 
<p>我们先来讲一种古老的辨别方法：引用计数法（reference counting）。它的做法是为每个对象添加一个引用计数器，用来统计指向该对象的引用个数。一旦某个对象的引用计数器为 0，则说明该对象已经死亡，便可以被回收了。</p> 
<p>它的具体实现是这样子的：如果有一个引用，被赋值为某一对象，那么将该对象的引用计数器 +1。如果一个指向某一对象的引用，被赋值为其他值，那么将该对象的引用计数器 -1。也就是说，我们需要截获所有的引用更新操作，并且相应地增减目标对象的引用计数器。</p><!-- [[[read_end]]] --> 
<p>除了需要额外的空间来存储计数器，以及繁琐的更新操作，引用计数法还有一个重大的漏洞，那便是无法处理循环引用对象。</p> 
<p>举个例子，假设对象 a 与 b 相互引用，除此之外没有其他引用指向 a 或者 b。在这种情况下，a 和 b 实际上已经死了，但由于它们的引用计数器皆不为 0，在引用计数法的心中，这两个对象还活着。因此，这些循环引用对象所占据的空间将不可回收，从而造成了内存泄露。</p> 
<p><img src="https://static001.geekbang.org/resource/image/85/b9/8546a9b3c6660a31ae24bef0ef0a35b9.png" alt=""></p> 
<p>目前 Java 虚拟机的主流垃圾回收器采取的是可达性分析算法。这个算法的实质在于将一系列 GC Roots 作为初始的存活对象合集（live set），然后从该合集出发，探索所有能够被该集合引用到的对象，并将其加入到该集合中，这个过程我们也称之为标记（mark）。最终，未被探索到的对象便是死亡的，是可以回收的。</p> 
<p>那么什么是 GC Roots 呢？我们可以暂时理解为由堆外指向堆内的引用，一般而言，GC Roots 包括（但不限于）如下几种：</p> 
<ol> 
 <li>Java 方法栈桢中的局部变量；</li> 
 <li>已加载类的静态变量；</li> 
 <li>JNI handles；</li> 
 <li>已启动且未停止的 Java 线程。</li> 
</ol> 
<p>可达性分析可以解决引用计数法所不能解决的循环引用问题。举例来说，即便对象 a 和 b 相互引用，只要从 GC Roots 出发无法到达 a 或者 b，那么可达性分析便不会将它们加入存活对象合集之中。</p> 
<p>虽然可达性分析的算法本身很简明，但是在实践中还是有不少其他问题需要解决的。</p> 
<p>比如说，在多线程环境下，其他线程可能会更新已经访问过的对象中的引用，从而造成误报（将引用设置为 null）或者漏报（将引用设置为未被访问过的对象）。</p> 
<p>误报并没有什么伤害，Java 虚拟机至多损失了部分垃圾回收的机会。漏报则比较麻烦，因为垃圾回收器可能回收事实上仍被引用的对象内存。一旦从原引用访问已经被回收了的对象，则很有可能会直接导致 Java 虚拟机崩溃。</p> 
<h2>Stop-the-world 以及安全点</h2> 
<p>怎么解决这个问题呢？在 Java 虚拟机里，传统的垃圾回收算法采用的是一种简单粗暴的方式，那便是 Stop-the-world，停止其他非垃圾回收线程的工作，直到完成垃圾回收。这也就造成了垃圾回收所谓的暂停时间（GC pause）。</p> 
<p>Java 虚拟机中的 Stop-the-world 是通过安全点（safepoint）机制来实现的。当 Java 虚拟机收到 Stop-the-world 请求，它便会等待所有的线程都到达安全点，才允许请求 Stop-the-world 的线程进行独占的工作。</p> 
<p>这篇博客 [2] 还提到了一种比较另类的解释：安全词。一旦垃圾回收线程喊出了安全词，其他非垃圾回收线程便会一一停下。</p> 
<p>当然，安全点的初始目的并不是让其他线程停下，而是找到一个稳定的执行状态。在这个执行状态下，Java 虚拟机的堆栈不会发生变化。这么一来，垃圾回收器便能够“安全”地执行可达性分析。</p> 
<p>举个例子，当 Java 程序通过 JNI 执行本地代码时，如果这段代码不访问 Java 对象、调用 Java 方法或者返回至原 Java 方法，那么 Java 虚拟机的堆栈不会发生改变，也就代表着这段本地代码可以作为同一个安全点。</p> 
<p>只要不离开这个安全点，Java 虚拟机便能够在垃圾回收的同时，继续运行这段本地代码。</p> 
<p>由于本地代码需要通过 JNI 的 API 来完成上述三个操作，因此 Java 虚拟机仅需在 API 的入口处进行安全点检测（safepoint poll），测试是否有其他线程请求停留在安全点里，便可以在必要的时候挂起当前线程。</p> 
<p>除了执行 JNI 本地代码外，Java 线程还有其他几种状态：解释执行字节码、执行即时编译器生成的机器码和线程阻塞。阻塞的线程由于处于 Java 虚拟机线程调度器的掌控之下，因此属于安全点。</p> 
<p>其他几种状态则是运行状态，需要虚拟机保证在可预见的时间内进入安全点。否则，垃圾回收线程可能长期处于等待所有线程进入安全点的状态，从而变相地提高了垃圾回收的暂停时间。</p> 
<p>对于解释执行来说，字节码与字节码之间皆可作为安全点。Java 虚拟机采取的做法是，当有安全点请求时，执行一条字节码便进行一次安全点检测。</p> 
<p>执行即时编译器生成的机器码则比较复杂。由于这些代码直接运行在底层硬件之上，不受 Java 虚拟机掌控，因此在生成机器码时，即时编译器需要插入安全点检测，以避免机器码长时间没有安全点检测的情况。HotSpot 虚拟机的做法便是在生成代码的方法出口以及非计数循环的循环回边（back-edge）处插入安全点检测。</p> 
<p>那么为什么不在每一条机器码或者每一个机器码基本块处插入安全点检测呢？原因主要有两个。</p> 
<p>第一，安全点检测本身也有一定的开销。不过 HotSpot 虚拟机已经将机器码中安全点检测简化为一个内存访问操作。在有安全点请求的情况下，Java 虚拟机会将安全点检测访问的内存所在的页设置为不可读，并且定义一个 segfault 处理器，来截获因访问该不可读内存而触发 segfault 的线程，并将它们挂起。</p> 
<p>第二，即时编译器生成的机器码打乱了原本栈桢上的对象分布状况。在进入安全点时，机器码还需提供一些额外的信息，来表明哪些寄存器，或者当前栈帧上的哪些内存空间存放着指向对象的引用，以便垃圾回收器能够枚举 GC Roots。</p> 
<p>由于这些信息需要不少空间来存储，因此即时编译器会尽量避免过多的安全点检测。</p> 
<p>不过，不同的即时编译器插入安全点检测的位置也可能不同。以 Graal 为例，除了上述位置外，它还会在计数循环的循环回边处插入安全点检测。其他的虚拟机也可能选取方法入口而非方法出口来插入安全点检测。</p> 
<p>不管如何，其目的都是在可接受的性能开销以及内存开销之内，避免机器码长时间不进入安全点的情况，间接地减少垃圾回收的暂停时间。</p> 
<p>除了垃圾回收之外，Java 虚拟机其他一些对堆栈内容的一致性有要求的操作也会用到安全点这一机制。我会在涉及的时侯再进行具体的讲解。</p> 
<h2>垃圾回收的三种方式</h2> 
<p>当标记完所有的存活对象时，我们便可以进行死亡对象的回收工作了。主流的基础回收方式可分为三种。</p> 
<p>第一种是清除（sweep），即把死亡对象所占据的内存标记为空闲内存，并记录在一个空闲列表（free list）之中。当需要新建对象时，内存管理模块便会从该空闲列表中寻找空闲内存，并划分给新建的对象。</p> 
<p><img src="https://static001.geekbang.org/resource/image/f2/03/f225126be24826658ca5a899fcff5003.png" alt=""></p> 
<p>清除这种回收方式的原理及其简单，但是有两个缺点。一是会造成内存碎片。由于 Java 虚拟机的堆中对象必须是连续分布的，因此可能出现总空闲内存足够，但是无法分配的极端情况。</p> 
<p>另一个则是分配效率较低。如果是一块连续的内存空间，那么我们可以通过指针加法（pointer bumping）来做分配。而对于空闲列表，Java 虚拟机则需要逐个访问列表中的项，来查找能够放入新建对象的空闲内存。</p> 
<p>第二种是压缩（compact），即把存活的对象聚集到内存区域的起始位置，从而留下一段连续的内存空间。这种做法能够解决内存碎片化的问题，但代价是压缩算法的性能开销。</p> 
<p><img src="https://static001.geekbang.org/resource/image/41/39/415ee8e4aef12ff076b42e41660dad39.png" alt=""></p> 
<p>第三种则是复制（copy），即把内存区域分为两等分，分别用两个指针 from 和 to 来维护，并且只是用 from 指针指向的内存区域来分配内存。当发生垃圾回收时，便把存活的对象复制到 to 指针指向的内存区域中，并且交换 from 指针和 to 指针的内容。复制这种回收方式同样能够解决内存碎片化的问题，但是它的缺点也极其明显，即堆空间的使用效率极其低下。</p> 
<p><img src="https://static001.geekbang.org/resource/image/47/61/4749cad235deb1542d4ca3b232ebf261.png" alt=""></p> 
<p>当然，现代的垃圾回收器往往会综合上述几种回收方式，综合它们优点的同时规避它们的缺点。在下一篇中我们会详细介绍 Java 虚拟机中垃圾回收算法的具体实现。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了垃圾回收的一些基础知识。</p> 
<p>Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象。它从一系列 GC Roots 出发，边标记边探索所有被引用的对象。</p> 
<p>为了防止在标记过程中堆栈的状态发生改变，Java 虚拟机采取安全点机制来实现 Stop-the-world 操作，暂停其他非垃圾回收线程。</p> 
<p>回收死亡对象的内存共有三种方式，分别为：会造成内存碎片的清除、性能开销较大的压缩、以及堆使用效率较低的复制。</p> 
<p>今天的实践环节，你可以体验一下无安全点检测的计数循环带来的长暂停。你可以分别测单独跑 foo 方法或者 bar 方法的时间，然后与合起来跑的时间比较一下。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // time java SafepointTestp
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       / 你还可以使用如下几个选项
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // -XX:+PrintGC
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // -XX:+PrintGCApplicationStoppedTime 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // -XX:+PrintSafepointStatistics
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // -XX:+UseCountedLoopSafepoints
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class SafepointTest {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static double sum = 0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void foo() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 0; i &lt; 0x77777777; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        sum += Math.sqrt(i);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void bar() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 0; i &lt; 50_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Object().hashCode();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Thread(SafepointTest::foo).start();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Thread(SafepointTest::bar).start();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>[1] <a href="https://media.giphy.com/media/EZ8QO0myvsSk/giphy.gif">https://media.giphy.com/media/EZ8QO0myvsSk/giphy.gif</a><br> [2] <a href="http://psy-lob-saw.blogspot.com/2015/12/safepoints.html">http://psy-lob-saw.blogspot.com/2015/12/safepoints.html</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |34          |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:48:38.504 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=34 
 {executed in 3 msec}
2020-11-19 20:48:38.519 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>你应该听说过这么一句话：免费的其实是最贵的。</p> 
<p>Java 虚拟机的自动内存管理，将原本需要由开发人员手动回收的内存，交给垃圾回收器来自动回收。不过既然是自动机制，肯定没法做到像手动回收那般精准高效 [1] ，而且还会带来不少与垃圾回收实现相关的问题。</p> 
<p>接下来的两篇，我们会深入探索 Java 虚拟机中的垃圾回收器。今天这一篇，我们来回顾一下垃圾回收的基础知识。</p> 
<h2>引用计数法与可达性分析</h2> 
<p>垃圾回收，顾名思义，便是将已经分配出去的，但却不再使用的内存回收回来，以便能够再次分配。在 Java 虚拟机的语境下，垃圾指的是死亡的对象所占据的堆空间。这里便涉及了一个关键的问题：如何辨别一个对象是存是亡？</p> 
<p>我们先来讲一种古老的辨别方法：引用计数法（reference counting）。它的做法是为每个对象添加一个引用计数器，用来统计指向该对象的引用个数。一旦某个对象的引用计数器为 0，则说明该对象已经死亡，便可以被回收了。</p> 
<p>它的具体实现是这样子的：如果有一个引用，被赋值为某一对象，那么将该对象的引用计数器 +1。如果一个指向某一对象的引用，被赋值为其他值，那么将该对象的引用计数器 -1。也就是说，我们需要截获所有的引用更新操作，并且相应地增减目标对象的引用计数器。</p><!-- [[[read_end]]] --> 
<p>除了需要额外的空间来存储计数器，以及繁琐的更新操作，引用计数法还有一个重大的漏洞，那便是无法处理循环引用对象。</p> 
<p>举个例子，假设对象 a 与 b 相互引用，除此之外没有其他引用指向 a 或者 b。在这种情况下，a 和 b 实际上已经死了，但由于它们的引用计数器皆不为 0，在引用计数法的心中，这两个对象还活着。因此，这些循环引用对象所占据的空间将不可回收，从而造成了内存泄露。</p> 
<p><img src="https://static001.geekbang.org/resource/image/85/b9/8546a9b3c6660a31ae24bef0ef0a35b9.png" alt=""></p> 
<p>目前 Java 虚拟机的主流垃圾回收器采取的是可达性分析算法。这个算法的实质在于将一系列 GC Roots 作为初始的存活对象合集（live set），然后从该合集出发，探索所有能够被该集合引用到的对象，并将其加入到该集合中，这个过程我们也称之为标记（mark）。最终，未被探索到的对象便是死亡的，是可以回收的。</p> 
<p>那么什么是 GC Roots 呢？我们可以暂时理解为由堆外指向堆内的引用，一般而言，GC Roots 包括（但不限于）如下几种：</p> 
<ol> 
 <li>Java 方法栈桢中的局部变量；</li> 
 <li>已加载类的静态变量；</li> 
 <li>JNI handles；</li> 
 <li>已启动且未停止的 Java 线程。</li> 
</ol> 
<p>可达性分析可以解决引用计数法所不能解决的循环引用问题。举例来说，即便对象 a 和 b 相互引用，只要从 GC Roots 出发无法到达 a 或者 b，那么可达性分析便不会将它们加入存活对象合集之中。</p> 
<p>虽然可达性分析的算法本身很简明，但是在实践中还是有不少其他问题需要解决的。</p> 
<p>比如说，在多线程环境下，其他线程可能会更新已经访问过的对象中的引用，从而造成误报（将引用设置为 null）或者漏报（将引用设置为未被访问过的对象）。</p> 
<p>误报并没有什么伤害，Java 虚拟机至多损失了部分垃圾回收的机会。漏报则比较麻烦，因为垃圾回收器可能回收事实上仍被引用的对象内存。一旦从原引用访问已经被回收了的对象，则很有可能会直接导致 Java 虚拟机崩溃。</p> 
<h2>Stop-the-world 以及安全点</h2> 
<p>怎么解决这个问题呢？在 Java 虚拟机里，传统的垃圾回收算法采用的是一种简单粗暴的方式，那便是 Stop-the-world，停止其他非垃圾回收线程的工作，直到完成垃圾回收。这也就造成了垃圾回收所谓的暂停时间（GC pause）。</p> 
<p>Java 虚拟机中的 Stop-the-world 是通过安全点（safepoint）机制来实现的。当 Java 虚拟机收到 Stop-the-world 请求，它便会等待所有的线程都到达安全点，才允许请求 Stop-the-world 的线程进行独占的工作。</p> 
<p>这篇博客 [2] 还提到了一种比较另类的解释：安全词。一旦垃圾回收线程喊出了安全词，其他非垃圾回收线程便会一一停下。</p> 
<p>当然，安全点的初始目的并不是让其他线程停下，而是找到一个稳定的执行状态。在这个执行状态下，Java 虚拟机的堆栈不会发生变化。这么一来，垃圾回收器便能够“安全”地执行可达性分析。</p> 
<p>举个例子，当 Java 程序通过 JNI 执行本地代码时，如果这段代码不访问 Java 对象、调用 Java 方法或者返回至原 Java 方法，那么 Java 虚拟机的堆栈不会发生改变，也就代表着这段本地代码可以作为同一个安全点。</p> 
<p>只要不离开这个安全点，Java 虚拟机便能够在垃圾回收的同时，继续运行这段本地代码。</p> 
<p>由于本地代码需要通过 JNI 的 API 来完成上述三个操作，因此 Java 虚拟机仅需在 API 的入口处进行安全点检测（safepoint poll），测试是否有其他线程请求停留在安全点里，便可以在必要的时候挂起当前线程。</p> 
<p>除了执行 JNI 本地代码外，Java 线程还有其他几种状态：解释执行字节码、执行即时编译器生成的机器码和线程阻塞。阻塞的线程由于处于 Java 虚拟机线程调度器的掌控之下，因此属于安全点。</p> 
<p>其他几种状态则是运行状态，需要虚拟机保证在可预见的时间内进入安全点。否则，垃圾回收线程可能长期处于等待所有线程进入安全点的状态，从而变相地提高了垃圾回收的暂停时间。</p> 
<p>对于解释执行来说，字节码与字节码之间皆可作为安全点。Java 虚拟机采取的做法是，当有安全点请求时，执行一条字节码便进行一次安全点检测。</p> 
<p>执行即时编译器生成的机器码则比较复杂。由于这些代码直接运行在底层硬件之上，不受 Java 虚拟机掌控，因此在生成机器码时，即时编译器需要插入安全点检测，以避免机器码长时间没有安全点检测的情况。HotSpot 虚拟机的做法便是在生成代码的方法出口以及非计数循环的循环回边（back-edge）处插入安全点检测。</p> 
<p>那么为什么不在每一条机器码或者每一个机器码基本块处插入安全点检测呢？原因主要有两个。</p> 
<p>第一，安全点检测本身也有一定的开销。不过 HotSpot 虚拟机已经将机器码中安全点检测简化为一个内存访问操作。在有安全点请求的情况下，Java 虚拟机会将安全点检测访问的内存所在的页设置为不可读，并且定义一个 segfault 处理器，来截获因访问该不可读内存而触发 segfault 的线程，并将它们挂起。</p> 
<p>第二，即时编译器生成的机器码打乱了原本栈桢上的对象分布状况。在进入安全点时，机器码还需提供一些额外的信息，来表明哪些寄存器，或者当前栈帧上的哪些内存空间存放着指向对象的引用，以便垃圾回收器能够枚举 GC Roots。</p> 
<p>由于这些信息需要不少空间来存储，因此即时编译器会尽量避免过多的安全点检测。</p> 
<p>不过，不同的即时编译器插入安全点检测的位置也可能不同。以 Graal 为例，除了上述位置外，它还会在计数循环的循环回边处插入安全点检测。其他的虚拟机也可能选取方法入口而非方法出口来插入安全点检测。</p> 
<p>不管如何，其目的都是在可接受的性能开销以及内存开销之内，避免机器码长时间不进入安全点的情况，间接地减少垃圾回收的暂停时间。</p> 
<p>除了垃圾回收之外，Java 虚拟机其他一些对堆栈内容的一致性有要求的操作也会用到安全点这一机制。我会在涉及的时侯再进行具体的讲解。</p> 
<h2>垃圾回收的三种方式</h2> 
<p>当标记完所有的存活对象时，我们便可以进行死亡对象的回收工作了。主流的基础回收方式可分为三种。</p> 
<p>第一种是清除（sweep），即把死亡对象所占据的内存标记为空闲内存，并记录在一个空闲列表（free list）之中。当需要新建对象时，内存管理模块便会从该空闲列表中寻找空闲内存，并划分给新建的对象。</p> 
<p><img src="https://static001.geekbang.org/resource/image/f2/03/f225126be24826658ca5a899fcff5003.png" alt=""></p> 
<p>清除这种回收方式的原理及其简单，但是有两个缺点。一是会造成内存碎片。由于 Java 虚拟机的堆中对象必须是连续分布的，因此可能出现总空闲内存足够，但是无法分配的极端情况。</p> 
<p>另一个则是分配效率较低。如果是一块连续的内存空间，那么我们可以通过指针加法（pointer bumping）来做分配。而对于空闲列表，Java 虚拟机则需要逐个访问列表中的项，来查找能够放入新建对象的空闲内存。</p> 
<p>第二种是压缩（compact），即把存活的对象聚集到内存区域的起始位置，从而留下一段连续的内存空间。这种做法能够解决内存碎片化的问题，但代价是压缩算法的性能开销。</p> 
<p><img src="https://static001.geekbang.org/resource/image/41/39/415ee8e4aef12ff076b42e41660dad39.png" alt=""></p> 
<p>第三种则是复制（copy），即把内存区域分为两等分，分别用两个指针 from 和 to 来维护，并且只是用 from 指针指向的内存区域来分配内存。当发生垃圾回收时，便把存活的对象复制到 to 指针指向的内存区域中，并且交换 from 指针和 to 指针的内容。复制这种回收方式同样能够解决内存碎片化的问题，但是它的缺点也极其明显，即堆空间的使用效率极其低下。</p> 
<p><img src="https://static001.geekbang.org/resource/image/47/61/4749cad235deb1542d4ca3b232ebf261.png" alt=""></p> 
<p>当然，现代的垃圾回收器往往会综合上述几种回收方式，综合它们优点的同时规避它们的缺点。在下一篇中我们会详细介绍 Java 虚拟机中垃圾回收算法的具体实现。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了垃圾回收的一些基础知识。</p> 
<p>Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象。它从一系列 GC Roots 出发，边标记边探索所有被引用的对象。</p> 
<p>为了防止在标记过程中堆栈的状态发生改变，Java 虚拟机采取安全点机制来实现 Stop-the-world 操作，暂停其他非垃圾回收线程。</p> 
<p>回收死亡对象的内存共有三种方式，分别为：会造成内存碎片的清除、性能开销较大的压缩、以及堆使用效率较低的复制。</p> 
<p>今天的实践环节，你可以体验一下无安全点检测的计数循环带来的长暂停。你可以分别测单独跑 foo 方法或者 bar 方法的时间，然后与合起来跑的时间比较一下。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // time java SafepointTestp
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       / 你还可以使用如下几个选项
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // -XX:+PrintGC
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // -XX:+PrintGCApplicationStoppedTime 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // -XX:+PrintSafepointStatistics
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // -XX:+UseCountedLoopSafepoints
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class SafepointTest {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static double sum = 0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void foo() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 0; i &lt; 0x77777777; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        sum += Math.sqrt(i);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void bar() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 0; i &lt; 50_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Object().hashCode();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Thread(SafepointTest::foo).start();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Thread(SafepointTest::bar).start();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>[1] <a href="https://media.giphy.com/media/EZ8QO0myvsSk/giphy.gif">https://media.giphy.com/media/EZ8QO0myvsSk/giphy.gif</a><br> [2] <a href="http://psy-lob-saw.blogspot.com/2015/12/safepoints.html">http://psy-lob-saw.blogspot.com/2015/12/safepoints.html</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |34          |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:48:38.568 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=34 
 {executed in 2 msec}
2020-11-19 20:48:38.570 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title      |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|-----|----|----|
|34  |1605789270 |1605789270 |1                |zh-hans  |0       |1                             |1      |0      |11丨垃圾回收（上） |book |1   |34  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|-----|----|----|

2020-11-19 20:48:38.574 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=34 
 {executed in 1 msec}
2020-11-19 20:48:38.576 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title      |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|----|----|
|[unread] |1605789270 |1605789270 |1                |zh-hans  |0       |1                             |1      |0      |11丨垃圾回收（上） |1   |34  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-----------|----|----|

2020-11-19 20:48:38.596 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605790118, created=1605790118, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='11丨垃圾回收（上）', type='book', 
uid=1, vid=34 where nid=34 
 {executed in 1 msec}
2020-11-19 20:48:38.599 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605790118, created=1605790118, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='11丨垃圾回收（上）', 
uid=1, vid=34 where nid=34 
 {executed in 1 msec}
2020-11-19 20:48:38.625 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=34 
 {executed in 2 msec}
2020-11-19 20:48:38.630 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |revision_id |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|34        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/33141fddfc535b22db45d60ba8d0353d?bkt=en-4d166c071887761596d1004a3a3cf977635da60715e8fd5ac698e4000a963ef98bee5a112b686bdf&fid=3757516097-778750-751360983817322&time=1605788207&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-ZhTkanWJ9vVbdxbYjO%2FCggxVH6w%3D&to=92&size=5873232&sta_dx=5873232&sta_cs=4364&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182962&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5873232&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-25b3284b0a6e97e9ad7ee3a94ae22bbf6e842500a4f83b7f72075f4ff1d977f7700c68c139e2312f&sl=76480590&expires=8h&rt=pr&r=584988946&mlogid=7510879537606156637&vbdid=64799653&fin=11%E4%B8%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%88%E4%B8%8A%EF%BC%89.mp3&bflag=92,34-92&rtype=1&dp-logid=7510879537606156637&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=c77a2290e27174be426d2f0ff7b79a01431aae7a00e79feb305a5e1275657320&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=11%E4%B8%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%88%E4%B8%8A%EF%BC%89.mp3 |34          |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:48:38.659 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=34 
 {executed in 1 msec}
2020-11-19 20:48:38.662 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |revision_id |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/33141fddfc535b22db45d60ba8d0353d?bkt=en-4d166c071887761596d1004a3a3cf977635da60715e8fd5ac698e4000a963ef98bee5a112b686bdf&fid=3757516097-778750-751360983817322&time=1605788207&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-ZhTkanWJ9vVbdxbYjO%2FCggxVH6w%3D&to=92&size=5873232&sta_dx=5873232&sta_cs=4364&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182962&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5873232&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-25b3284b0a6e97e9ad7ee3a94ae22bbf6e842500a4f83b7f72075f4ff1d977f7700c68c139e2312f&sl=76480590&expires=8h&rt=pr&r=584988946&mlogid=7510879537606156637&vbdid=64799653&fin=11%E4%B8%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%88%E4%B8%8A%EF%BC%89.mp3&bflag=92,34-92&rtype=1&dp-logid=7510879537606156637&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=c77a2290e27174be426d2f0ff7b79a01431aae7a00e79feb305a5e1275657320&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=11%E4%B8%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%88%E4%B8%8A%EF%BC%89.mp3 |34          |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:48:38.695 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=34 
 {executed in 5 msec}
2020-11-19 20:48:38.715 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |delta |field_comment_format |langcode |revision_id |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|34        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-16
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">6</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   非常感谢，此篇可用通俗易懂来形容，其他同学问的问题也很棒！
   <br>
   <br>小结：
   <br>
   <br>1:垃圾回收-核心工作就是回收垃圾，哪关键点回来了。什么是垃圾？这个垃圾需要分类嘛？怎么定位垃圾？怎么回收垃圾？回收垃圾的方法都有哪些？他们都有什么优缺点？另外，就是我们为什么要学习垃圾回收？
   <br>
   <br>2:站在JVM的视角来看
   <br>垃圾-就是无用对象所占用的堆内存空间
   <br>貌似不需要垃圾分类，识别垃圾并回收就行
   <br>定位垃圾，是垃圾回收的关键点
   <br>
   <br>晚安💤，明天继续写
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>旭东</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-28
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   赞，这种循序渐进的讲法，不知道了怎么工作，还知道了为啥要设计成这样，Why和what都和谐的在一起讲了
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/24/3e/692a93f7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>茶底</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">23</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师下一期能讲一下g1算法吗。讲深一点😁
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">15</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   非常感谢，此篇可用通俗易懂来形容，其他同学问的问题也很棒！
   <br>
   <br>小结：
   <br>
   <br>1:垃圾回收-核心工作就是回收垃圾，哪关键点回来了。什么是垃圾？这个垃圾需要分类嘛？怎么定位垃圾？怎么回收垃圾？回收垃圾的方法都有哪些？他们都有什么优缺点？另外，就是我们为什么要学习垃圾回收？
   <br>
   <br>2:站在JVM的视角来看
   <br>
   <br>垃圾-就是无用对象所占用的堆内存空间
   <br>
   <br>垃圾分类-貌似不需要垃圾分类，识别垃圾并回收就行
   <br>
   <br>定位垃圾-是垃圾回收的关键点，无用的对象占用的堆空间即是垃圾，那就需要先定位无用的对象，这里的无用是不再使用的意思，咋判断呢？文中介绍了两种方法，计数法和标记法（祥看原文）核心在于能定位出无用的对象，后出现的方法往往比早出现的更好一点，这里也一样，标记法能解决计数法，解决不了的循环引用不能回收的问题，但是也存在其他的问题，误报和漏报的问题，误报浪费点垃圾回收的机会浪费点空间，漏报在多线程并发工作时可能会死JVM的，所以，比较严重，所以，JVM采用了简单粗暴的stop-the-world的方式来对待，所以，老年代的回收有卡顿的现象
   <br>
   <br>怎么回收垃圾-定位出垃圾，回收就是一个简单的事情了，当然也非常关键，把要回收的堆内存空间标记为可继续使用就行，下次有新对象能在此空间创建就行
   <br>
   <br>回收垃圾的方法-文中介绍了三种，清除、压缩、复制
   <br>
   <br>清除法-简单，但易产生碎片，可能总空间够但分配不了的问题
   <br>压缩法-能解决清除法的问题，但是复杂且耗性能
   <br>复制法-折衷一些，但是空间利用率低，总之，各有千秋
   <br>
   <br>为什么要学-这个最容易，因为面试需要、装逼需要、升职加薪需要、人类天生好奇、还有免于被鄙视及可以鄙视其他人
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 赞！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/zZiamzXOang0L4iaXa37k1wM8TqU6cqkQNCKZ9XUBWXPFndtvkXrtRGMLPur4zIvoYMHaicIU1fFibKTZJo8Lmnxug/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>suynan</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-06
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">8</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   安全点的这个地方，看得我是一脸懵逼
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">6</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   疑问❓
   <br>1:JVM的stop-the-world机制非常不友好，有哪些解决之道？原理是什么？
   <br>2:压测时出现频繁的gc容易理解，但是有时出现毛刺是因为什么呢？
   <br>3:fullgc有卡顿，对性能很不利，怎么避免呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 1. 采用并行GC可以减少需要STW的时间。它们会在即时编译器生成的代码中加入写屏障或者读屏障。<br><br>2. Y轴应该是时间，那毛刺就是长暂停。一般Full GC就会造成长暂停。<br><br>3. 通过调整新生代大小，使对象在其生命周期内都待在新生代中。这样一来，Minor GC时就可以收集完这些短命对象了。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/08/17/e63e50f3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>彩色的沙漠</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">5</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   @正是那朵玫瑰老师有几个不明白的地方，误报和漏报不太明白：
   <br>1、假设A引用开始指向A1对象：A------&gt;A1,按老师说的误报就是将引用A指向null：A------&gt;null，那么此时A1对象不是没有引用了，不就可以垃圾回收了么，为什么会错过垃圾回收的机会呢？
   <br>2、漏报，是将A引用指向一个未被访问的对象假设对象为B：A-----&gt;B,此时A引用原来指向的对象应该没有引用了吧，为什么会垃圾回收器可能会回收事实上仍被引用的对象呢？
   <br>
   <br>2018-08-15
   <br>
   <br>&nbsp;作者回复
   <br>
   <br>这里指的是，GC已经标记完成，然后其他线程进行修改的情况(也是并发GC所要解决的问题)。
   <br>
   <br>当GC标记完成，还未开始回收时，你更新了其中一个引用，使之指向null，那么原来指向的对象本可以被回收的。
   <br>
   <br>如果指向一个新的对象，这个对象可没有被标记为不能回收，垃圾回收器就直接给回收掉了
   <br>
   <br>老师我也有和@正是那朵玫瑰一样的问题，看了老师的讲解，还是不太明白。GC标记完成，那GC标记的是引用还是具体的堆空间对象。如果标记的具体的堆空间对象，并不会造成GC并发问题，误报和漏报，改变的是引用关系。请老师解答，谢谢！
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/61/f2/ca989d6f.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Leon Wong</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师你好，例子里的foo方法中的for循环，其中i变量类型我从int型改成long型后，长暂停的现象不存在了，请问是为何？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 这是C2一个诡异的地方。<br><br>for (int i=start; i&lt;limit; i++) {..}<br><br>对于int类型的循环变量i，如果满足 1) 基于该循环变量的循环出口只有一个，即i &lt; limit，2) 循环变量随着迭代的增量为常数，例子中i++即增量为1，以及循环变量的上限(当增量为负数时则是下限)为循环无关的，即limit应是循环无关，那么C2会将其判断成计数循环(counted loop)，然后默认不插入safepoint。<br><br>而对于long类型的循环变量，C2直接识别为非计数循环，需要插入safepoint。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erozFScHpVRM5OCwMW7giaM13NE7gN5iatw9Ozwu93ibRZZjmSmcfzBLSXs8tYtwW7Q2E8eUdy9lGl5A/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_488a8...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-31
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   误报和漏报，我觉得可惜这样理解，垃圾回收是先标记活的对象，后回收死的对象，那么如果标记好后，其它线程产生了垃圾，即将活的变死了，这种内存是不会释放的。另外，如果这时产生了新对象，由于没被标记为活的，所以被释放了，这就危险了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/7b/36/fd46331c.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Jussi Lee</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-29
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一、垃圾回收算法
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1、引用计数法（文中已经介绍，主要的缺点是无法处理循环引用；在每次引用的产生和消除的时候，会伴随着一个加法或者减法的操作，对性能有一定的影响）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2、标记清除法（从根节点出发开始所有可达的对象，未被标记的就是垃圾对象。主要缺点是产生空间碎片）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3、复制算法（将原空间分为两块，每次使用其中一块，在垃圾回收时，进行复制，然后转换使用的内存空间。主要的缺点是将系统的内存折半。主要适用于存活对象少，垃圾对象多的情况下）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4、标记压缩法（从根出发对所有可达对象进行一次标记，然后进行压缩。最后进行清理）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5、分代算法（每一种垃圾回收算法都有其优缺点。分代算法是根据对象的特点分成几块，新建的对象放入新生代区域，当一个对象经历了几次复制后还存活则放入老年代。老年代因为对象存活率高复制算法不适用，因此采取标记清除或者标记压缩）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6、分区算法（把堆空间划分为连续的不同小区间。降低了GC产生的影响）
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/15/16/0aae41a1.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>no13bus</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   昨天看书正好看到这章节，真的不错
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/24/3e/692a93f7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>茶底</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师下一期能讲一下g1算法吗。讲深一点😁
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/9f/71345740.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>黑崽</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   第二，即时编译器生成的机器码打乱了原本栈桢上的对象分布状况。没明白这个原因。第一个原因中解释，只要去访问一个内存地址就可以知道是不是要暂停了，那我只有判断完暂停以后再去恢复寄存器中状态不就可以了？反正只有一次，这个打乱不打乱有什么区别呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 在GC时，我们需要知道哪个寄存器，以及哪个栈内存空间存放了指向对象的引用。这个信息需要记录下来。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/fc/66/d7f7ad77.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>风动静泉</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-16
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   有个内存泄露相关的问题想请教一下老师。
   <br>基本描述:
   <br>一个单线程的程序中，在其run方法中有局部变量（map list等类型），也使用了该线程类ThreadDemo的全局变量（map），线程中会去执行ftp任务（同步）。
   <br>
   <br>问题：
   <br>如果ftp任务由于某种原因阻塞了，调用ftp任务的线程ThreadDemo中的变量（局部变量和全局变量）会变成不可达状态吗？还是说此时线程也阻塞，会导致内存泄露？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>正是那朵玫...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师有几个不明白的地方，误报和漏报不太明白：
   <br>1、假设A引用开始指向A1对象：A------&gt;A1,按老师说的误报就是将引用A指向null：A------&gt;null，那么此时A1对象不是没有引用了，不就可以垃圾回收了么，为什么会错过垃圾回收的机会呢？
   <br>2、漏报，是将A引用指向一个未被访问的对象假设对象为B：A-----&gt;B,此时A引用原来指向的对象应该没有引用了吧，为什么会垃圾回收器可能会回收事实上仍被引用的对象呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 这里指的是，GC已经标记完成，然后其他线程进行修改的情况(也是并发GC所要解决的问题)。<br><br>当GC标记完成，还未开始回收时，你更新了其中一个引用，使之指向null，那么原来指向的对象本可以被回收的。<br><br>如果指向一个新的对象，这个对象可没有被标记为不能回收，垃圾回收器就直接给回收掉了</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/57/0f/1f229bf5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Void_seT</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   猜一下，作业里面的应该是Math.log(10)
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 厉害！这都看得出来！是Math.log10(i)，不过这个时间太长了，我新版本的代码是sqrt 。然后不知怎么给回滚到这个log10，而且还是乱的</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/18/07ee18ad.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>明天更美好</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   总算可以听的懂了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/b3/df/dc53c067.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>闪客sun</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-25
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师您好，关于“在多线程环境下，其他线程可能会更新已经访问过的对象中的引用”，这句没太理解，网上查资料也没找到好答案。您可以帮我看看这块该怎么理解么？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/fa/fd/ec24cba7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>fcb的鱼</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   为啥作为GC Roots 的对象是那几种呢，这里有什么讲究吗？！
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/fb/af/5a9d2b58.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>lyerox</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   正常理解，漏报是指将本来可回收对象这一次检查漏报了，而误报是将不是垃圾的对象误报成可回收对象。这样的话应该是误报的影响大才对啊。
   <br>这里漏报 和 误报应该说清楚，什么像什么上报什么吧？
  </div> <!----> <!---->
 </div></li> |0     |full_html            |zh-hans  |34          |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:48:38.754 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=34 
 {executed in 4 msec}
2020-11-19 20:48:38.787 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |delta |field_comment_format |langcode |revision_id |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-16
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">6</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   非常感谢，此篇可用通俗易懂来形容，其他同学问的问题也很棒！
   <br>
   <br>小结：
   <br>
   <br>1:垃圾回收-核心工作就是回收垃圾，哪关键点回来了。什么是垃圾？这个垃圾需要分类嘛？怎么定位垃圾？怎么回收垃圾？回收垃圾的方法都有哪些？他们都有什么优缺点？另外，就是我们为什么要学习垃圾回收？
   <br>
   <br>2:站在JVM的视角来看
   <br>垃圾-就是无用对象所占用的堆内存空间
   <br>貌似不需要垃圾分类，识别垃圾并回收就行
   <br>定位垃圾，是垃圾回收的关键点
   <br>
   <br>晚安💤，明天继续写
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>旭东</span> <span class="_1bkbsnjg_0">置顶</span>
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-28
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   赞，这种循序渐进的讲法，不知道了怎么工作，还知道了为啥要设计成这样，Why和what都和谐的在一起讲了
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/24/3e/692a93f7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>茶底</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">23</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师下一期能讲一下g1算法吗。讲深一点😁
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">15</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   非常感谢，此篇可用通俗易懂来形容，其他同学问的问题也很棒！
   <br>
   <br>小结：
   <br>
   <br>1:垃圾回收-核心工作就是回收垃圾，哪关键点回来了。什么是垃圾？这个垃圾需要分类嘛？怎么定位垃圾？怎么回收垃圾？回收垃圾的方法都有哪些？他们都有什么优缺点？另外，就是我们为什么要学习垃圾回收？
   <br>
   <br>2:站在JVM的视角来看
   <br>
   <br>垃圾-就是无用对象所占用的堆内存空间
   <br>
   <br>垃圾分类-貌似不需要垃圾分类，识别垃圾并回收就行
   <br>
   <br>定位垃圾-是垃圾回收的关键点，无用的对象占用的堆空间即是垃圾，那就需要先定位无用的对象，这里的无用是不再使用的意思，咋判断呢？文中介绍了两种方法，计数法和标记法（祥看原文）核心在于能定位出无用的对象，后出现的方法往往比早出现的更好一点，这里也一样，标记法能解决计数法，解决不了的循环引用不能回收的问题，但是也存在其他的问题，误报和漏报的问题，误报浪费点垃圾回收的机会浪费点空间，漏报在多线程并发工作时可能会死JVM的，所以，比较严重，所以，JVM采用了简单粗暴的stop-the-world的方式来对待，所以，老年代的回收有卡顿的现象
   <br>
   <br>怎么回收垃圾-定位出垃圾，回收就是一个简单的事情了，当然也非常关键，把要回收的堆内存空间标记为可继续使用就行，下次有新对象能在此空间创建就行
   <br>
   <br>回收垃圾的方法-文中介绍了三种，清除、压缩、复制
   <br>
   <br>清除法-简单，但易产生碎片，可能总空间够但分配不了的问题
   <br>压缩法-能解决清除法的问题，但是复杂且耗性能
   <br>复制法-折衷一些，但是空间利用率低，总之，各有千秋
   <br>
   <br>为什么要学-这个最容易，因为面试需要、装逼需要、升职加薪需要、人类天生好奇、还有免于被鄙视及可以鄙视其他人
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 赞！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/zZiamzXOang0L4iaXa37k1wM8TqU6cqkQNCKZ9XUBWXPFndtvkXrtRGMLPur4zIvoYMHaicIU1fFibKTZJo8Lmnxug/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>suynan</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-06
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">8</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   安全点的这个地方，看得我是一脸懵逼
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">6</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   疑问❓
   <br>1:JVM的stop-the-world机制非常不友好，有哪些解决之道？原理是什么？
   <br>2:压测时出现频繁的gc容易理解，但是有时出现毛刺是因为什么呢？
   <br>3:fullgc有卡顿，对性能很不利，怎么避免呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 1. 采用并行GC可以减少需要STW的时间。它们会在即时编译器生成的代码中加入写屏障或者读屏障。<br><br>2. Y轴应该是时间，那毛刺就是长暂停。一般Full GC就会造成长暂停。<br><br>3. 通过调整新生代大小，使对象在其生命周期内都待在新生代中。这样一来，Minor GC时就可以收集完这些短命对象了。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/08/17/e63e50f3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>彩色的沙漠</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">5</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   @正是那朵玫瑰老师有几个不明白的地方，误报和漏报不太明白：
   <br>1、假设A引用开始指向A1对象：A------&gt;A1,按老师说的误报就是将引用A指向null：A------&gt;null，那么此时A1对象不是没有引用了，不就可以垃圾回收了么，为什么会错过垃圾回收的机会呢？
   <br>2、漏报，是将A引用指向一个未被访问的对象假设对象为B：A-----&gt;B,此时A引用原来指向的对象应该没有引用了吧，为什么会垃圾回收器可能会回收事实上仍被引用的对象呢？
   <br>
   <br>2018-08-15
   <br>
   <br>&nbsp;作者回复
   <br>
   <br>这里指的是，GC已经标记完成，然后其他线程进行修改的情况(也是并发GC所要解决的问题)。
   <br>
   <br>当GC标记完成，还未开始回收时，你更新了其中一个引用，使之指向null，那么原来指向的对象本可以被回收的。
   <br>
   <br>如果指向一个新的对象，这个对象可没有被标记为不能回收，垃圾回收器就直接给回收掉了
   <br>
   <br>老师我也有和@正是那朵玫瑰一样的问题，看了老师的讲解，还是不太明白。GC标记完成，那GC标记的是引用还是具体的堆空间对象。如果标记的具体的堆空间对象，并不会造成GC并发问题，误报和漏报，改变的是引用关系。请老师解答，谢谢！
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/61/f2/ca989d6f.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Leon Wong</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师你好，例子里的foo方法中的for循环，其中i变量类型我从int型改成long型后，长暂停的现象不存在了，请问是为何？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 这是C2一个诡异的地方。<br><br>for (int i=start; i&lt;limit; i++) {..}<br><br>对于int类型的循环变量i，如果满足 1) 基于该循环变量的循环出口只有一个，即i &lt; limit，2) 循环变量随着迭代的增量为常数，例子中i++即增量为1，以及循环变量的上限(当增量为负数时则是下限)为循环无关的，即limit应是循环无关，那么C2会将其判断成计数循环(counted loop)，然后默认不插入safepoint。<br><br>而对于long类型的循环变量，C2直接识别为非计数循环，需要插入safepoint。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erozFScHpVRM5OCwMW7giaM13NE7gN5iatw9Ozwu93ibRZZjmSmcfzBLSXs8tYtwW7Q2E8eUdy9lGl5A/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_488a8...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-31
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   误报和漏报，我觉得可惜这样理解，垃圾回收是先标记活的对象，后回收死的对象，那么如果标记好后，其它线程产生了垃圾，即将活的变死了，这种内存是不会释放的。另外，如果这时产生了新对象，由于没被标记为活的，所以被释放了，这就危险了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/7b/36/fd46331c.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Jussi Lee</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-29
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一、垃圾回收算法
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1、引用计数法（文中已经介绍，主要的缺点是无法处理循环引用；在每次引用的产生和消除的时候，会伴随着一个加法或者减法的操作，对性能有一定的影响）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2、标记清除法（从根节点出发开始所有可达的对象，未被标记的就是垃圾对象。主要缺点是产生空间碎片）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3、复制算法（将原空间分为两块，每次使用其中一块，在垃圾回收时，进行复制，然后转换使用的内存空间。主要的缺点是将系统的内存折半。主要适用于存活对象少，垃圾对象多的情况下）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4、标记压缩法（从根出发对所有可达对象进行一次标记，然后进行压缩。最后进行清理）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5、分代算法（每一种垃圾回收算法都有其优缺点。分代算法是根据对象的特点分成几块，新建的对象放入新生代区域，当一个对象经历了几次复制后还存活则放入老年代。老年代因为对象存活率高复制算法不适用，因此采取标记清除或者标记压缩）
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6、分区算法（把堆空间划分为连续的不同小区间。降低了GC产生的影响）
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/15/16/0aae41a1.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>no13bus</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   昨天看书正好看到这章节，真的不错
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/24/3e/692a93f7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>茶底</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师下一期能讲一下g1算法吗。讲深一点😁
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/9f/71345740.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>黑崽</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   第二，即时编译器生成的机器码打乱了原本栈桢上的对象分布状况。没明白这个原因。第一个原因中解释，只要去访问一个内存地址就可以知道是不是要暂停了，那我只有判断完暂停以后再去恢复寄存器中状态不就可以了？反正只有一次，这个打乱不打乱有什么区别呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 在GC时，我们需要知道哪个寄存器，以及哪个栈内存空间存放了指向对象的引用。这个信息需要记录下来。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/fc/66/d7f7ad77.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>风动静泉</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-16
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   有个内存泄露相关的问题想请教一下老师。
   <br>基本描述:
   <br>一个单线程的程序中，在其run方法中有局部变量（map list等类型），也使用了该线程类ThreadDemo的全局变量（map），线程中会去执行ftp任务（同步）。
   <br>
   <br>问题：
   <br>如果ftp任务由于某种原因阻塞了，调用ftp任务的线程ThreadDemo中的变量（局部变量和全局变量）会变成不可达状态吗？还是说此时线程也阻塞，会导致内存泄露？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>正是那朵玫...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师有几个不明白的地方，误报和漏报不太明白：
   <br>1、假设A引用开始指向A1对象：A------&gt;A1,按老师说的误报就是将引用A指向null：A------&gt;null，那么此时A1对象不是没有引用了，不就可以垃圾回收了么，为什么会错过垃圾回收的机会呢？
   <br>2、漏报，是将A引用指向一个未被访问的对象假设对象为B：A-----&gt;B,此时A引用原来指向的对象应该没有引用了吧，为什么会垃圾回收器可能会回收事实上仍被引用的对象呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 这里指的是，GC已经标记完成，然后其他线程进行修改的情况(也是并发GC所要解决的问题)。<br><br>当GC标记完成，还未开始回收时，你更新了其中一个引用，使之指向null，那么原来指向的对象本可以被回收的。<br><br>如果指向一个新的对象，这个对象可没有被标记为不能回收，垃圾回收器就直接给回收掉了</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/57/0f/1f229bf5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Void_seT</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   猜一下，作业里面的应该是Math.log(10)
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 厉害！这都看得出来！是Math.log10(i)，不过这个时间太长了，我新版本的代码是sqrt 。然后不知怎么给回滚到这个log10，而且还是乱的</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/18/07ee18ad.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>明天更美好</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   总算可以听的懂了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/b3/df/dc53c067.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>闪客sun</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-25
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师您好，关于“在多线程环境下，其他线程可能会更新已经访问过的对象中的引用”，这句没太理解，网上查资料也没找到好答案。您可以帮我看看这块该怎么理解么？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/fa/fd/ec24cba7.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>fcb的鱼</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   为啥作为GC Roots 的对象是那几种呢，这里有什么讲究吗？！
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/fb/af/5a9d2b58.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>lyerox</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   正常理解，漏报是指将本来可回收对象这一次检查漏报了，而误报是将不是垃圾的对象误报成可回收对象。这样的话应该是误报的影响大才对啊。
   <br>这里漏报 和 误报应该说清楚，什么像什么上报什么吧？
  </div> <!----> <!---->
 </div></li> |0     |full_html            |zh-hans  |34          |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:48:38.822 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=34 
 {executed in 2 msec}
2020-11-19 20:48:38.824 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|34        |book   |0     |zh-hans  |34          |https://static001.geekbang.org/resource/image/52/c3/52ff1795756ef8a2a2e57df6d34420c3.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:48:38.847 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=34 
 {executed in 1 msec}
2020-11-19 20:48:38.851 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |34          |https://static001.geekbang.org/resource/image/52/c3/52ff1795756ef8a2a2e57df6d34420c3.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:48:38.881 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=34 
 {executed in 1 msec}
2020-11-19 20:48:38.883 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |34          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:48:38.907 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=34 
 {executed in 1 msec}
2020-11-19 20:48:38.909 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |34          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:48:38.935 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='18197371768393' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:48:38.937 INFO  jdbc.resultsettable Line:610 - 
|--------|---------------|----|------------|
|item_id |fsid           |got |name        |
|--------|---------------|----|------------|
|69      |18197371768393 |0   |net_content |
|--------|---------------|----|------------|

2020-11-19 20:49:02.777 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='18197371768393' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:49:02.779 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|69      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:49:02.809 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='18197371768393', got=1, name='net_content' where item_id=69 
 {executed in 1 msec}
2020-11-19 20:49:02.834 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='18197371768393' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:49:02.836 INFO  jdbc.resultsettable Line:610 - 
|--------|---------------|----|------|
|item_id |fsid           |got |name  |
|--------|---------------|----|------|
|70      |18197371768393 |1   |media |
|--------|---------------|----|------|

2020-11-19 20:49:02.839 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='18197371768393' 
 {executed in 1 msec}
2020-11-19 20:49:02.841 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|35        |book   |0     |18197371768393   |zh-hans  |35          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:49:02.845 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=35 
 {executed in 1 msec}
2020-11-19 20:49:02.847 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|35  |zh-hans  |book |1189b0da-d112-44c9-9614-a8fe844a9a43 |35  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:49:02.869 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=35 
 {executed in 1 msec}
2020-11-19 20:49:02.871 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |18197371768393   |zh-hans  |35          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:49:02.891 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=35 
 {executed in 1 msec}
2020-11-19 20:49:02.893 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|35  |1   |3     |0            |1  |32 |35 |0  |0  |32  |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:49:02.917 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=35 
 {executed in 2 msec}
2020-11-19 20:49:02.936 INFO  jdbc.resultsettable Line:610 - 
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|35        |<p>在 Java 程序中，我们拥有多种新建对象的方式。除了最为常见的 new 语句之外，我们还可以通过反射机制、Object.clone 方法、反序列化以及 Unsafe.allocateInstance 方法来新建对象。</p> 
<p>其中，Object.clone 方法和反序列化通过直接复制已有的数据，来初始化新建对象的实例字段。Unsafe.allocateInstance 方法则没有初始化实例字段，而 new 语句和反射机制，则是通过调用构造器来初始化实例字段。</p> 
<p>以 new 语句为例，它编译而成的字节码将包含用来请求内存的 new 指令，以及用来调用构造器的 invokespecial 指令。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // Foo foo = new Foo(); 编译而成的字节码
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0 new Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3 dup
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4 invokespecial Foo()
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        7 astore_1
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>提到构造器，就不得不提到 Java 对构造器的诸多约束。首先，如果一个类没有定义任何构造器的话， Java 编译器会自动添加一个无参数的构造器。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // Foo 类构造器会调用其父类 Object 的构造器
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public Foo();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0 aload_0 [this]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1 invokespecial java.lang.Object() [8]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4 return
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre><!-- [[[read_end]]] --> 
<p>然后，子类的构造器需要调用父类的构造器。如果父类存在无参数构造器的话，该调用可以是隐式的，也就是说 Java 编译器会自动添加对父类构造器的调用。但是，如果父类没有无参数构造器，那么子类的构造器则需要显式地调用父类带参数的构造器。</p> 
<p>显式调用又可分为两种，一是直接使用“super”关键字调用父类构造器，二是使用“this”关键字调用同一个类中的其他构造器。无论是直接的显式调用，还是间接的显式调用，都需要作为构造器的第一条语句，以便优先初始化继承而来的父类字段。（不过这可以通过调用其他生成参数的方法，或者字节码注入来绕开。）</p> 
<p>总而言之，当我们调用一个构造器时，它将优先调用父类的构造器，直至 Object 类。这些构造器的调用者皆为同一对象，也就是通过 new 指令新建而来的对象。</p> 
<p>你应该已经发现了其中的玄机：通过 new 指令新建出来的对象，它的内存其实涵盖了所有父类中的实例字段。也就是说，虽然子类无法访问父类的私有实例字段，或者子类的实例字段隐藏了父类的同名实例字段，但是子类的实例还是会为这些父类实例字段分配内存的。</p> 
<p>这些字段在内存中的具体分布是怎么样的呢？今天我们就来看看对象的内存布局。</p> 
<h2>压缩指针</h2> 
<p>在 Java 虚拟机中，每个 Java 对象都有一个对象头（object header），这个由标记字段和类型指针所构成。其中，标记字段用以存储 Java 虚拟机有关该对象的运行数据，如哈希码、GC 信息以及锁信息，而类型指针则指向该对象的类。</p> 
<p>在 64 位的 Java 虚拟机中，对象头的标记字段占 64 位，而类型指针又占了 64 位。也就是说，每一个 Java 对象在内存中的额外开销就是 16 个字节。以 Integer 类为例，它仅有一个 int 类型的私有字段，占 4 个字节。因此，每一个 Integer 对象的额外内存开销至少是 400%。这也是为什么 Java 要引入基本类型的原因之一。</p> 
<p>为了尽量较少对象的内存使用量，64 位 Java 虚拟机引入了压缩指针 [1] 的概念（对应虚拟机选项 -XX:+UseCompressedOops，默认开启），将堆中原本 64 位的 Java 对象指针压缩成 32 位的。</p> 
<p>这样一来，对象头中的类型指针也会被压缩成 32 位，使得对象头的大小从 16 字节降至 12 字节。当然，压缩指针不仅可以作用于对象头的类型指针，还可以作用于引用类型的字段，以及引用类型数组。</p> 
<p>那么压缩指针是什么原理呢？</p> 
<p>打个比方，路上停着的全是房车，而且每辆房车恰好占据两个停车位。现在，我们按照顺序给它们编号。也就是说，停在 0 号和 1 号停车位上的叫 0 号车，停在 2 号和 3 号停车位上的叫 1 号车，依次类推。</p> 
<p>原本的内存寻址用的是车位号。比如说我有一个值为 6 的指针，代表第 6 个车位，那么沿着这个指针可以找到 3 号车。现在我们规定指针里存的值是车号，比如 3 指代 3 号车。当需要查找 3 号车时，我便可以将该指针的值乘以 2，再沿着 6 号车位找到 3 号车。</p> 
<p>这样一来，32 位压缩指针最多可以标记 2 的 32 次方辆车，对应着 2 的 33 次方个车位。当然，房车也有大小之分。大房车占据的车位可能是三个甚至是更多。不过这并不会影响我们的寻址算法：我们只需跳过部分车号，便可以保持原本车号 *2 的寻址系统。</p> 
<p>上述模型有一个前提，你应该已经想到了，就是每辆车都从偶数号车位停起。这个概念我们称之为内存对齐（对应虚拟机选项 -XX:ObjectAlignmentInBytes，默认值为 8）。</p> 
<p>默认情况下，Java 虚拟机堆中对象的起始地址需要对齐至 8 的倍数。如果一个对象用不到 8N 个字节，那么空白的那部分空间就浪费掉了。这些浪费掉的空间我们称之为对象间的填充（padding）。</p> 
<p>在默认情况下，Java 虚拟机中的 32 位压缩指针可以寻址到 2 的 35 次方个字节，也就是 32GB 的地址空间（超过 32GB 则会关闭压缩指针）。</p> 
<p>在对压缩指针解引用时，我们需要将其左移 3 位，再加上一个固定偏移量，便可以得到能够寻址 32GB 地址空间的伪 64 位指针了。</p> 
<p>此外，我们可以通过配置刚刚提到的内存对齐选项（-XX:ObjectAlignmentInBytes）来进一步提升寻址范围。但是，这同时也可能增加对象间填充，导致压缩指针没有达到原本节省空间的效果。</p> 
<p>举例来说，如果规定每辆车都需要从偶数车位号停起，那么对于占据两个车位的小房车来说刚刚好，而对于需要三个车位的大房车来说，也仅是浪费一个车位。</p> 
<p>但是如果规定需要从 4 的倍数号车位停起，那么小房车则会浪费两个车位，而大房车至多可能浪费三个车位。</p> 
<p>当然，就算是关闭了压缩指针，Java 虚拟机还是会进行内存对齐。此外，内存对齐不仅存在于对象与对象之间，也存在于对象中的字段之间。比如说，Java 虚拟机要求 long 字段、double 字段，以及非压缩指针状态下的引用字段地址为 8 的倍数。</p> 
<p>字段内存对齐的其中一个原因，是让字段只出现在同一 CPU 的缓存行中。如果字段不是对齐的，那么就有可能出现跨缓存行的字段。也就是说，该字段的读取可能需要替换两个缓存行，而该字段的存储也会同时污染两个缓存行。这两种情况对程序的执行效率而言都是不利的。</p> 
<p>下面我来介绍一下对象内存布局另一个有趣的特性：字段重排列。</p> 
<h2>字段重排列</h2> 
<p>字段重排列，顾名思义，就是 Java 虚拟机重新分配字段的先后顺序，以达到内存对齐的目的。Java 虚拟机中有三种排列方法（对应 Java 虚拟机选项 -XX:FieldsAllocationStyle，默认值为 1），但都会遵循如下两个规则。</p> 
<p>其一，如果一个字段占据 C 个字节，那么该字段的偏移量需要对齐至 NC。这里偏移量指的是字段地址与对象的起始地址差值。</p> 
<p>以 long 类为例，它仅有一个 long 类型的实例字段。在使用了压缩指针的 64 位虚拟机中，尽管对象头的大小为 12 个字节，该 long 类型字段的偏移量也只能是 16，而中间空着的 4 个字节便会被浪费掉。</p> 
<p>其二，子类所继承字段的偏移量，需要与父类对应字段的偏移量保持一致。</p> 
<p>在具体实现中，Java 虚拟机还会对齐子类字段的起始位置。对于使用了压缩指针的 64 位虚拟机，子类第一个字段需要对齐至 4N；而对于关闭了压缩指针的 64 位虚拟机，子类第一个字段则需要对齐至 8N。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class A {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long l;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int i；
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class B extends A {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long l;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int i;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我在文中贴了一段代码，里边定义了两个类 A 和 B，其中 B 继承 A。A 和 B 各自定义了一个 long 类型的实例字段和一个 int 类型的实例字段。下面我分别打印了 B 类在启用压缩指针和未启用压缩指针时，各个字段的偏移量。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # 启用压缩指针时，B 类的字段分布
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       B object internals:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        OFFSET SIZE TYPE DESCRIPTION
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        12 4 int A.i 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        16 8 long A.l 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        24 8 long B.l 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        32 4 int B.i 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        36 4 (loss due to the next object alignment)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>当启用压缩指针时，可以看到 Java 虚拟机将 A 类的 int 字段放置于 long 字段之前，以填充因为 long 字段对齐造成的 4 字节缺口。由于对象整体大小需要对齐至 8N，因此对象的最后会有 4 字节的空白填充。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # 关闭压缩指针时，B 类的字段分布
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       B object internals:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        OFFSET SIZE TYPE DESCRIPTION
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        12 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        16 8 long A.l
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        24 4 int A.i
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        28 4 (alignment/padding gap) 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        32 8 long B.l
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        40 4 int B.i
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        44 4 (loss due to the next object alignment)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>当关闭压缩指针时，B 类字段的起始位置需对齐至 8N。这么一来，B 类字段的前后各有 4 字节的空白。那么我们可不可以将 B 类的 int 字段移至前面的空白中，从而节省这 8 字节呢？</p> 
<p>我认为是可以的，并且我修改过后的 Java 虚拟机也没有跑崩。由于 HotSpot 中的这块代码年久失修，公司的同事也已经记不得是什么原因了，那么姑且先认为是一些历史遗留问题吧。</p> 
<p>Java 8 还引入了一个新的注释 @Contended，用来解决对象字段之间的虚共享（false sharing）问题 [2]。这个注释也会影响到字段的排列。</p> 
<p>虚共享是怎么回事呢？假设两个线程分别访问同一对象中不同的 volatile 字段，逻辑上它们并没有共享内容，因此不需要同步。</p> 
<p>然而，如果这两个字段恰好在同一个缓存行中，那么对这些字段的写操作会导致缓存行的写回，也就造成了实质上的共享。（volatile 字段和缓存行的故事我会在之后的篇章中详细介绍。）</p> 
<p>Java 虚拟机会让不同的 @Contended 字段处于独立的缓存行中，因此你会看到大量的空间被浪费掉。具体的分布算法属于实现细节，随着 Java 版本的变动也比较大，因此这里就不做阐述了。</p> 
<p>如果你感兴趣，可以利用实践环节的工具，来查阅 Contended 字段的内存布局。注意使用虚拟机选项 -XX:-RestrictContended。如果你在 Java 9 以上版本试验的话，在使用 javac 编译时需要添加 --add-exports java.base/jdk.internal.vm.annotation=ALL-UNNAME</p> 
<h2>总结和实践</h2> 
<p>今天我介绍了 Java 虚拟机构造对象的方式，所构造对象的大小，以及对象的内存布局。</p> 
<p>常见的 new 语句会被编译为 new 指令，以及对构造器的调用。每个类的构造器皆会直接或者间接调用父类的构造器，并且在同一个实例中初始化相应的字段。</p> 
<p>Java 虚拟机引入了压缩指针的概念，将原本的 64 位指针压缩成 32 位。压缩指针要求 Java 虚拟机堆中对象的起始地址要对齐至 8 的倍数。Java 虚拟机还会对每个类的字段进行重排列，使得字段也能够内存对齐。</p> 
<p>今天的实践环节比较简单，你可以使用我在工具篇中介绍过的 JOL 工具，来打印你工程中的类的字段分布情况。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       curl -L -O http://central.maven.org/maven2/org/openjdk/jol/jol-cli/0.9/jol-cli-0.9-full.jar
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java -cp jol-cli-0.9-full.jar org.openjdk.jol.Main internals java.lang.String
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>[1] <a href="https://wiki.openjdk.java.net/display/HotSpot/CompressedOops">https://wiki.openjdk.java.net/display/HotSpot/CompressedOops</a><br> [2] <a href="http://openjdk.java.net/jeps/142">http://openjdk.java.net/jeps/142</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |35          |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:49:02.955 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=35 
 {executed in 2 msec}
2020-11-19 20:49:02.974 INFO  jdbc.resultsettable Line:610 - 
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>在 Java 程序中，我们拥有多种新建对象的方式。除了最为常见的 new 语句之外，我们还可以通过反射机制、Object.clone 方法、反序列化以及 Unsafe.allocateInstance 方法来新建对象。</p> 
<p>其中，Object.clone 方法和反序列化通过直接复制已有的数据，来初始化新建对象的实例字段。Unsafe.allocateInstance 方法则没有初始化实例字段，而 new 语句和反射机制，则是通过调用构造器来初始化实例字段。</p> 
<p>以 new 语句为例，它编译而成的字节码将包含用来请求内存的 new 指令，以及用来调用构造器的 invokespecial 指令。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // Foo foo = new Foo(); 编译而成的字节码
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0 new Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3 dup
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4 invokespecial Foo()
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        7 astore_1
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>提到构造器，就不得不提到 Java 对构造器的诸多约束。首先，如果一个类没有定义任何构造器的话， Java 编译器会自动添加一个无参数的构造器。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // Foo 类构造器会调用其父类 Object 的构造器
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public Foo();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0 aload_0 [this]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1 invokespecial java.lang.Object() [8]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4 return
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre><!-- [[[read_end]]] --> 
<p>然后，子类的构造器需要调用父类的构造器。如果父类存在无参数构造器的话，该调用可以是隐式的，也就是说 Java 编译器会自动添加对父类构造器的调用。但是，如果父类没有无参数构造器，那么子类的构造器则需要显式地调用父类带参数的构造器。</p> 
<p>显式调用又可分为两种，一是直接使用“super”关键字调用父类构造器，二是使用“this”关键字调用同一个类中的其他构造器。无论是直接的显式调用，还是间接的显式调用，都需要作为构造器的第一条语句，以便优先初始化继承而来的父类字段。（不过这可以通过调用其他生成参数的方法，或者字节码注入来绕开。）</p> 
<p>总而言之，当我们调用一个构造器时，它将优先调用父类的构造器，直至 Object 类。这些构造器的调用者皆为同一对象，也就是通过 new 指令新建而来的对象。</p> 
<p>你应该已经发现了其中的玄机：通过 new 指令新建出来的对象，它的内存其实涵盖了所有父类中的实例字段。也就是说，虽然子类无法访问父类的私有实例字段，或者子类的实例字段隐藏了父类的同名实例字段，但是子类的实例还是会为这些父类实例字段分配内存的。</p> 
<p>这些字段在内存中的具体分布是怎么样的呢？今天我们就来看看对象的内存布局。</p> 
<h2>压缩指针</h2> 
<p>在 Java 虚拟机中，每个 Java 对象都有一个对象头（object header），这个由标记字段和类型指针所构成。其中，标记字段用以存储 Java 虚拟机有关该对象的运行数据，如哈希码、GC 信息以及锁信息，而类型指针则指向该对象的类。</p> 
<p>在 64 位的 Java 虚拟机中，对象头的标记字段占 64 位，而类型指针又占了 64 位。也就是说，每一个 Java 对象在内存中的额外开销就是 16 个字节。以 Integer 类为例，它仅有一个 int 类型的私有字段，占 4 个字节。因此，每一个 Integer 对象的额外内存开销至少是 400%。这也是为什么 Java 要引入基本类型的原因之一。</p> 
<p>为了尽量较少对象的内存使用量，64 位 Java 虚拟机引入了压缩指针 [1] 的概念（对应虚拟机选项 -XX:+UseCompressedOops，默认开启），将堆中原本 64 位的 Java 对象指针压缩成 32 位的。</p> 
<p>这样一来，对象头中的类型指针也会被压缩成 32 位，使得对象头的大小从 16 字节降至 12 字节。当然，压缩指针不仅可以作用于对象头的类型指针，还可以作用于引用类型的字段，以及引用类型数组。</p> 
<p>那么压缩指针是什么原理呢？</p> 
<p>打个比方，路上停着的全是房车，而且每辆房车恰好占据两个停车位。现在，我们按照顺序给它们编号。也就是说，停在 0 号和 1 号停车位上的叫 0 号车，停在 2 号和 3 号停车位上的叫 1 号车，依次类推。</p> 
<p>原本的内存寻址用的是车位号。比如说我有一个值为 6 的指针，代表第 6 个车位，那么沿着这个指针可以找到 3 号车。现在我们规定指针里存的值是车号，比如 3 指代 3 号车。当需要查找 3 号车时，我便可以将该指针的值乘以 2，再沿着 6 号车位找到 3 号车。</p> 
<p>这样一来，32 位压缩指针最多可以标记 2 的 32 次方辆车，对应着 2 的 33 次方个车位。当然，房车也有大小之分。大房车占据的车位可能是三个甚至是更多。不过这并不会影响我们的寻址算法：我们只需跳过部分车号，便可以保持原本车号 *2 的寻址系统。</p> 
<p>上述模型有一个前提，你应该已经想到了，就是每辆车都从偶数号车位停起。这个概念我们称之为内存对齐（对应虚拟机选项 -XX:ObjectAlignmentInBytes，默认值为 8）。</p> 
<p>默认情况下，Java 虚拟机堆中对象的起始地址需要对齐至 8 的倍数。如果一个对象用不到 8N 个字节，那么空白的那部分空间就浪费掉了。这些浪费掉的空间我们称之为对象间的填充（padding）。</p> 
<p>在默认情况下，Java 虚拟机中的 32 位压缩指针可以寻址到 2 的 35 次方个字节，也就是 32GB 的地址空间（超过 32GB 则会关闭压缩指针）。</p> 
<p>在对压缩指针解引用时，我们需要将其左移 3 位，再加上一个固定偏移量，便可以得到能够寻址 32GB 地址空间的伪 64 位指针了。</p> 
<p>此外，我们可以通过配置刚刚提到的内存对齐选项（-XX:ObjectAlignmentInBytes）来进一步提升寻址范围。但是，这同时也可能增加对象间填充，导致压缩指针没有达到原本节省空间的效果。</p> 
<p>举例来说，如果规定每辆车都需要从偶数车位号停起，那么对于占据两个车位的小房车来说刚刚好，而对于需要三个车位的大房车来说，也仅是浪费一个车位。</p> 
<p>但是如果规定需要从 4 的倍数号车位停起，那么小房车则会浪费两个车位，而大房车至多可能浪费三个车位。</p> 
<p>当然，就算是关闭了压缩指针，Java 虚拟机还是会进行内存对齐。此外，内存对齐不仅存在于对象与对象之间，也存在于对象中的字段之间。比如说，Java 虚拟机要求 long 字段、double 字段，以及非压缩指针状态下的引用字段地址为 8 的倍数。</p> 
<p>字段内存对齐的其中一个原因，是让字段只出现在同一 CPU 的缓存行中。如果字段不是对齐的，那么就有可能出现跨缓存行的字段。也就是说，该字段的读取可能需要替换两个缓存行，而该字段的存储也会同时污染两个缓存行。这两种情况对程序的执行效率而言都是不利的。</p> 
<p>下面我来介绍一下对象内存布局另一个有趣的特性：字段重排列。</p> 
<h2>字段重排列</h2> 
<p>字段重排列，顾名思义，就是 Java 虚拟机重新分配字段的先后顺序，以达到内存对齐的目的。Java 虚拟机中有三种排列方法（对应 Java 虚拟机选项 -XX:FieldsAllocationStyle，默认值为 1），但都会遵循如下两个规则。</p> 
<p>其一，如果一个字段占据 C 个字节，那么该字段的偏移量需要对齐至 NC。这里偏移量指的是字段地址与对象的起始地址差值。</p> 
<p>以 long 类为例，它仅有一个 long 类型的实例字段。在使用了压缩指针的 64 位虚拟机中，尽管对象头的大小为 12 个字节，该 long 类型字段的偏移量也只能是 16，而中间空着的 4 个字节便会被浪费掉。</p> 
<p>其二，子类所继承字段的偏移量，需要与父类对应字段的偏移量保持一致。</p> 
<p>在具体实现中，Java 虚拟机还会对齐子类字段的起始位置。对于使用了压缩指针的 64 位虚拟机，子类第一个字段需要对齐至 4N；而对于关闭了压缩指针的 64 位虚拟机，子类第一个字段则需要对齐至 8N。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class A {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long l;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int i；
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class B extends A {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long l;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int i;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我在文中贴了一段代码，里边定义了两个类 A 和 B，其中 B 继承 A。A 和 B 各自定义了一个 long 类型的实例字段和一个 int 类型的实例字段。下面我分别打印了 B 类在启用压缩指针和未启用压缩指针时，各个字段的偏移量。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # 启用压缩指针时，B 类的字段分布
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       B object internals:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        OFFSET SIZE TYPE DESCRIPTION
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        12 4 int A.i 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        16 8 long A.l 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        24 8 long B.l 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        32 4 int B.i 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        36 4 (loss due to the next object alignment)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>当启用压缩指针时，可以看到 Java 虚拟机将 A 类的 int 字段放置于 long 字段之前，以填充因为 long 字段对齐造成的 4 字节缺口。由于对象整体大小需要对齐至 8N，因此对象的最后会有 4 字节的空白填充。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # 关闭压缩指针时，B 类的字段分布
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       B object internals:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        OFFSET SIZE TYPE DESCRIPTION
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        12 4 (object header)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        16 8 long A.l
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        24 4 int A.i
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        28 4 (alignment/padding gap) 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        32 8 long B.l
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        40 4 int B.i
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        44 4 (loss due to the next object alignment)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>当关闭压缩指针时，B 类字段的起始位置需对齐至 8N。这么一来，B 类字段的前后各有 4 字节的空白。那么我们可不可以将 B 类的 int 字段移至前面的空白中，从而节省这 8 字节呢？</p> 
<p>我认为是可以的，并且我修改过后的 Java 虚拟机也没有跑崩。由于 HotSpot 中的这块代码年久失修，公司的同事也已经记不得是什么原因了，那么姑且先认为是一些历史遗留问题吧。</p> 
<p>Java 8 还引入了一个新的注释 @Contended，用来解决对象字段之间的虚共享（false sharing）问题 [2]。这个注释也会影响到字段的排列。</p> 
<p>虚共享是怎么回事呢？假设两个线程分别访问同一对象中不同的 volatile 字段，逻辑上它们并没有共享内容，因此不需要同步。</p> 
<p>然而，如果这两个字段恰好在同一个缓存行中，那么对这些字段的写操作会导致缓存行的写回，也就造成了实质上的共享。（volatile 字段和缓存行的故事我会在之后的篇章中详细介绍。）</p> 
<p>Java 虚拟机会让不同的 @Contended 字段处于独立的缓存行中，因此你会看到大量的空间被浪费掉。具体的分布算法属于实现细节，随着 Java 版本的变动也比较大，因此这里就不做阐述了。</p> 
<p>如果你感兴趣，可以利用实践环节的工具，来查阅 Contended 字段的内存布局。注意使用虚拟机选项 -XX:-RestrictContended。如果你在 Java 9 以上版本试验的话，在使用 javac 编译时需要添加 --add-exports java.base/jdk.internal.vm.annotation=ALL-UNNAME</p> 
<h2>总结和实践</h2> 
<p>今天我介绍了 Java 虚拟机构造对象的方式，所构造对象的大小，以及对象的内存布局。</p> 
<p>常见的 new 语句会被编译为 new 指令，以及对构造器的调用。每个类的构造器皆会直接或者间接调用父类的构造器，并且在同一个实例中初始化相应的字段。</p> 
<p>Java 虚拟机引入了压缩指针的概念，将原本的 64 位指针压缩成 32 位。压缩指针要求 Java 虚拟机堆中对象的起始地址要对齐至 8 的倍数。Java 虚拟机还会对每个类的字段进行重排列，使得字段也能够内存对齐。</p> 
<p>今天的实践环节比较简单，你可以使用我在工具篇中介绍过的 JOL 工具，来打印你工程中的类的字段分布情况。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       curl -L -O http://central.maven.org/maven2/org/openjdk/jol/jol-cli/0.9/jol-cli-0.9-full.jar
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java -cp jol-cli-0.9-full.jar org.openjdk.jol.Main internals java.lang.String
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>[1] <a href="https://wiki.openjdk.java.net/display/HotSpot/CompressedOops">https://wiki.openjdk.java.net/display/HotSpot/CompressedOops</a><br> [2] <a href="http://openjdk.java.net/jeps/142">http://openjdk.java.net/jeps/142</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |35          |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:49:03.028 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=35 
 {executed in 1 msec}
2020-11-19 20:49:03.031 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title          |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|-----|----|----|
|35  |1605789271 |1605789271 |1                |zh-hans  |0       |1                             |1      |0      |10丨Java对象的内存布局 |book |1   |35  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|-----|----|----|

2020-11-19 20:49:03.035 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=35 
 {executed in 1 msec}
2020-11-19 20:49:03.052 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title          |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|----|----|
|[unread] |1605789271 |1605789271 |1                |zh-hans  |0       |1                             |1      |0      |10丨Java对象的内存布局 |1   |35  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|----|----|

2020-11-19 20:49:03.079 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605790143, created=1605790143, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='10丨Java对象的内存布局', type='book', 
uid=1, vid=35 where nid=35 
 {executed in 2 msec}
2020-11-19 20:49:03.083 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605790143, created=1605790143, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='10丨Java对象的内存布局', 
uid=1, vid=35 where nid=35 
 {executed in 2 msec}
2020-11-19 20:49:03.114 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=35 
 {executed in 2 msec}
2020-11-19 20:49:03.118 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |revision_id |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|35        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/e43d03377848690c76948dbead5f432c?bkt=en-06f5c65000af0ed669fc179de67683b7df4c793c1e381d0b59220b3b4b5cbcfebb48d02f5a050164&fid=3757516097-778750-611425326776453&time=1605788232&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-pYdVIqdEt%2FXSfAaheFBRepjsPNc%3D&to=92&size=5508981&sta_dx=5508981&sta_cs=4351&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182962&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5508981&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-88d59be81146324ba30e4667d4f973a405c6ccad9f50db1fedc9263c0f6a2f48aaa2e3ba4ef566b6&sl=76480590&expires=8h&rt=pr&r=759776603&mlogid=7510886266756971837&vbdid=64799653&fin=10%E4%B8%A8Java%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.mp3&bflag=92,34-92&rtype=1&dp-logid=7510886266756971837&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=76168191086d6f291dbdeeed6a729cb84bfd97778cbeda94&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=10%E4%B8%A8Java%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.mp3 |35          |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:49:03.149 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=35 
 {executed in 1 msec}
2020-11-19 20:49:03.152 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |revision_id |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/e43d03377848690c76948dbead5f432c?bkt=en-06f5c65000af0ed669fc179de67683b7df4c793c1e381d0b59220b3b4b5cbcfebb48d02f5a050164&fid=3757516097-778750-611425326776453&time=1605788232&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-pYdVIqdEt%2FXSfAaheFBRepjsPNc%3D&to=92&size=5508981&sta_dx=5508981&sta_cs=4351&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182962&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5508981&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-88d59be81146324ba30e4667d4f973a405c6ccad9f50db1fedc9263c0f6a2f48aaa2e3ba4ef566b6&sl=76480590&expires=8h&rt=pr&r=759776603&mlogid=7510886266756971837&vbdid=64799653&fin=10%E4%B8%A8Java%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.mp3&bflag=92,34-92&rtype=1&dp-logid=7510886266756971837&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=76168191086d6f291dbdeeed6a729cb84bfd97778cbeda94&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=10%E4%B8%A8Java%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.mp3 |35          |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:49:03.177 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=35 
 {executed in 3 msec}
2020-11-19 20:49:03.197 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |delta |field_comment_format |langcode |revision_id |
|----------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|35        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-13
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">31</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   小结
   <br>1:Java中创建对象的方式
   <br>
   <br>1-1:new -通过调用构造器来初始化实例字段
   <br>
   <br>1-2:反射-通过调用构造器来初始化实例字段
   <br>
   <br>1-3:Object.clone-通过直接复制已有的数据，来初始化新建对象的实例字段
   <br>
   <br>1-4:反序列化-通过直接复制已有的数据，来初始化新建对象的实例字段
   <br>
   <br>1-5:Unsafe.allocateInstance-没有初始化对象的实例字段
   <br>
   <br>2:Java对象的空间占用
   <br>
   <br>2-1:通过new创建的对象，涵盖了它所有父类中的对象实例的字段
   <br>
   <br>2-2:对象头，由标记字段和类型指针构成
   <br>
   <br>2-3:标记字段，用于存储Java虚拟机有关该对象的运行数据，比如：哈希码、GC信息、锁信息等
   <br>
   <br>2-4:类型指针，用于指向该对象的类
   <br>
   <br>2-5:此对象的实例字段对应的内存空间
   <br>
   <br>3:压缩指针
   <br>JVM的内存空间有限且昂贵，所以，能缩减的就缩减，通过一定的算法改进压缩类型指针的空间后仍可以寻址到对象的实例对应的类，所以，就采用了
   <br>
   <br>4:字段重排
   <br>意思是JVM会重新分配字段的位置，和我们Java源码中属性声明的位置存在差异，猜想Java编译器编译后的字节码是没有改变源码中字段声明的位置的，这样做是为了更好的实现内存对齐，内存对齐本质上会浪费一定的内存空间，不过可以减少内存行的读取次数，通过一消一涨的比对发现这样对于JVM的性能有一定的提高，所以，也就使用了这种方式，浪费点空间能提高性能也是值得的
   <br>
   <br>疑问❓
   <br>1:为什么一个子类即使无法访问父类的私有实例字段，或者子类实例字段隐藏了父类的同名实例字段，子类的实例还是会为这些父类实例字段分配内存呢？
   <br>另外，如果采用指针指向的方式定位父类实例的内容是否能更节省内存空间？
   <br>
   <br>2:五种创建对象的方式，通过new指令新建出来的对象，他的内存其实涵盖了所有父类中的实例字段，其他的方式是怎样的哪？
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/66/75/54bb858e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>life is ...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">15</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   对象头
   <br>
   <br>每个对象都有一个对象头，对象头包括两部分，标记信息和类型指针。
   <br>
   <br>标记信息包括哈希值，锁信息，GC信息。类型指针指向这个对象的class。
   <br>
   <br>两个信息分别占用8个字节，所以每个对象的额外内存为16个字节。很消耗内存。
   <br>
   <br>压缩指针
   <br>
   <br>为了减少类型指针的内存占用，将64位指针压缩至32位，进而节约内存。之前64位寻址，寻的是字节。现在32位寻址，寻的是变量。再加上内存对齐(补齐为8的倍数)，可以每次寻变量都以一定的规则寻找，并且一定可以找得到。
   <br>
   <br>内存对齐
   <br>
   <br>内存对齐的另一个好处是，使得CPU缓存行可以更好的实施。保证每个变量都只出现在一条缓存行中，不会出现跨行缓存。提高程序的执行效率。
   <br>
   <br>字段重排序
   <br>
   <br>其实就是更好的执行内存对齐标准，会调整字段在内存中的分布，达到方便寻址和节省空间的目的。
   <br>
   <br>虚共享
   <br>
   <br>当两个线程分别访问一个对象中的不同volatile字段，理论上是不涉及变量共享和同步要求的。但是如果两个volatile字段处于同一个CPU缓存行中，对其中一个volatile字段的写操作，会导致整个缓存行的写回和读取操作，进而影响到了另一个volatile变量，也就是实际上的共享问题。
   <br>
   <br>@Contented注解
   <br>
   <br>该注解就是用来解决虚共享问题的，被该注解标识的变量，会独占一个CPU缓存行。但也因此浪费了大量的内存空间。
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 赞总结！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a9/ca/2d8c4733.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>amourling</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-13
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">9</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   作者大大辛苦了，货很干，搭配《深入理解java虚拟机》会很香
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/d4/f3/b73d8abf.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>三木子</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-13
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">6</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   有一个小白问题，new一个对象(继承一个类)会调用父类构造器，这个可以理解，因为对象可能调用父类方法。那么为什么new对象会调用到object呢？这有什么用意吗？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/f9/16/99a7045d.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>倔强</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">5</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   也就是说默认情况下，小于32G的堆内存中的对象引用为4个字节，一旦堆内存大于32G，对象引用为8个字节
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7a/e0/3d5b28ef.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>清歌</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   讲内存布局没有图示。如果能配一些图来说明就更清晰了，纯文字不直观
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/12/93/3470fc43.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Mr.钧👻</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-16
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   想请教老师大大几个问题：
   <br>1、什么是CUP缓存行？
   <br>2、如果跨缓存行的字段，为什么会降低执行效率？是因为某些读取程序，一行一行的读效率较高？还是因为以行分割呢？
   <br>3、明显启用压缩指针，性能更高，但是为什么还会在64位情况下，不启用压缩指针的情况呢？ 是因为CPU运行速度更快，可以护士不压缩指针导致的内存浪费吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>发条橙子 ...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师， 对象头中的类型指针只是为了指该对象的类 ， 使用了压缩指针还有32位 。可以有32g的地址空间， 一个类能用到 32 G的地址空间么?????
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/f9/66/e8fb8ca2.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>xlogic</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-29
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   字段重排列
   <br>
   <br>其一，如果一个字段占据 C 个字节， 那么该字段的偏移量需要对齐至 NC。这里的偏移量指的是字段地址与对象的起始地址差值
   <br>
   <br>以 long 类为例，它仅有一个 long 类型的实例字段。在使用了压缩指针的 64 位虚拟机中，尽管对象头的大小为 12 个字节，该 long 类型字段的偏移量也只能是 16，而中间空着的 4 个字节便会被浪费掉。
   <br>
   <br>个人理解：1. 应该是 Long 类型；2. 因为 long 字段的占 8 个字节，所以偏移量是 N8，比12大的最接近的数就是 16，所以偏移量就是16，也就是说字段与对象的起始位置差是16。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/b5/8bc4790b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_98716...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，请教您几个问题
   <br>1：每个类都有一个对应的class对象，那么这class对象是什么时候生成的，存储jvm的哪个区域？
   <br>2：类实例对象object header中的类型指针其实就是指向该类所属class的对象的指针吗？
   <br>3：class对象的内存结构又是什么样子的呢？类似于普通Java实例对象吗？
   <br>ps：这个指针压缩的原理有些困扰到我了。。。求解惑！！！
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>everyok22</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   你文章里说： 64位的JVM中，不采用压缩指针的方式，标记字段与类型指针分别占用8个字节，而采用了压缩指针标记字段与类型指针都会压成32位（8字节）那对象头不是只占用8个字节么，为什么你说是12个字节
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 标记字段没有被压缩。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/0c/20/ae6979bd.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>大能猫</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   最近研究String时遇到一个跟Java内存相关的问题：常量池里到底有没有存放对象？
   <br>常量池主要存放两大类常量：字面量（Literal）和符号引用（Symbolic Reference）；
   <br>如果常量池里有一个“hello”的字面量，这个字面量算是一个对象吗？如果不算对象，那么它所指向的对象又存放在哪里呢
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: String literal指向的对象存放在JVM的String pool里。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/c4/f3/97599e4b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>DesertSnow</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   超类啊这是
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>天王</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-25
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一个JAVA对象可以通过new，反序列化，clone等多种方式创建对象。new的时候，首先会为对象申请内存，然后调用构造器创建对象，初始化字段，会默认调用无参构造器对象，也会先调用父类的构造器，如果父类构造器无参，则隐式调用，如果是有参构造函数，则显式调用。子类的实例会为父类实例字段分配内存。
   <br>在内存中的布局，创建对象的时候会在为对象分配内存，一个对象有对象头，对象头里面存储的是标记字段和类型指针，对象头里面有哈希码，gc等信息，类型指针存的是指向类的引用，各自占用64位，8个字节，这是每个对象额外存储的，这样所以引入了基础类型。压缩指针可以将类型指针压成32位的，节省4个字节，压缩指针还可以压缩字段以及引用类型数组。压缩指针的原理，java对象默认的起始位置是8的位数，如果一个对象用不到8N，剩下的空间就浪费了，浪费的空间叫对象间的填充。对齐方式叫内存对齐，可以通过内存对齐选项来提升寻址范围，但是也容易导致对象填充。内存对象不仅存在于对象与对象之间，也存在于字段与字段中间，字段对齐的一个原因是，让字段出现在同一CPU的缓存行中，跨缓存行会影响执行效率。字段重排列，会重新分配字段的顺序，以达到内存对齐的目的。有2个选择，一个是字段偏移量是NC，子类字段的偏移量需要与父类对应字段的偏移量保持一致。使用了压缩指针的对象，子类第一个字段需要对齐至4N，没用压缩指针的对齐至8N。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/eb/1a/579c941e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>志远</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   因此，每一个 Integer 对象的额外内存开销至少是 400%。这句话实在令人费解，400%的单位是什么，4字节？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/zZiamzXOang0L4iaXa37k1wM8TqU6cqkQNCKZ9XUBWXPFndtvkXrtRGMLPur4zIvoYMHaicIU1fFibKTZJo8Lmnxug/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>suynan</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   上班间隙悄悄看了开头的一点点，真的好多干货，准备一周时间啃完一遍
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/bc/eb/c22ef3a5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Nevermore</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   以 long 类为例，它仅有一个 long 类型的实例字段。在使用了压缩指针的 64 位虚拟机中，尽管对象头的大小为 12 个字节，该 long 类型字段的偏移量也只能是 16，而中间空着的 4 个字节便会被浪费掉。
   <br>
   <br>
   <br>long存储的值占用8个字节，默认情况是以8N的位置开始占用的，所以long一共占用20个字节。所以当存储下一个long时，只能从第24个字节的位置开始存，那么20-23的位置就被浪费了。
   <br>
   <br>老师，我这理解有问题么？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/bc/eb/c22ef3a5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Nevermore</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   在对压缩指针解引用时，我们需要将其左移 3 位，再加上一个固定偏移量，便可以得到能够寻址 32GB 地址空间的伪 64 位指针了。
   <br>
   <br>
   <br>这句话不理解，老师能否具体讲解下。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/1a/41/3d87f7ac.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>橙生北国</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-28
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   这时候写留言不知道能不能跟上，老师，请问如果我new一个对象，它会影响JVM五个区域中的几个？大概是怎么影响的。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/b5/8bc4790b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_98716...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，“堆中原本 64 位的 Java 对象指针压缩成 32 位”这几句话中的“64位java对象指针”是个啥？在哪里？为什么会影响想到对象头中类型指针？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |35          |
|----------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:49:03.234 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=35 
 {executed in 2 msec}
2020-11-19 20:49:03.256 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |delta |field_comment_format |langcode |revision_id |
|----------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-13
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">31</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   小结
   <br>1:Java中创建对象的方式
   <br>
   <br>1-1:new -通过调用构造器来初始化实例字段
   <br>
   <br>1-2:反射-通过调用构造器来初始化实例字段
   <br>
   <br>1-3:Object.clone-通过直接复制已有的数据，来初始化新建对象的实例字段
   <br>
   <br>1-4:反序列化-通过直接复制已有的数据，来初始化新建对象的实例字段
   <br>
   <br>1-5:Unsafe.allocateInstance-没有初始化对象的实例字段
   <br>
   <br>2:Java对象的空间占用
   <br>
   <br>2-1:通过new创建的对象，涵盖了它所有父类中的对象实例的字段
   <br>
   <br>2-2:对象头，由标记字段和类型指针构成
   <br>
   <br>2-3:标记字段，用于存储Java虚拟机有关该对象的运行数据，比如：哈希码、GC信息、锁信息等
   <br>
   <br>2-4:类型指针，用于指向该对象的类
   <br>
   <br>2-5:此对象的实例字段对应的内存空间
   <br>
   <br>3:压缩指针
   <br>JVM的内存空间有限且昂贵，所以，能缩减的就缩减，通过一定的算法改进压缩类型指针的空间后仍可以寻址到对象的实例对应的类，所以，就采用了
   <br>
   <br>4:字段重排
   <br>意思是JVM会重新分配字段的位置，和我们Java源码中属性声明的位置存在差异，猜想Java编译器编译后的字节码是没有改变源码中字段声明的位置的，这样做是为了更好的实现内存对齐，内存对齐本质上会浪费一定的内存空间，不过可以减少内存行的读取次数，通过一消一涨的比对发现这样对于JVM的性能有一定的提高，所以，也就使用了这种方式，浪费点空间能提高性能也是值得的
   <br>
   <br>疑问❓
   <br>1:为什么一个子类即使无法访问父类的私有实例字段，或者子类实例字段隐藏了父类的同名实例字段，子类的实例还是会为这些父类实例字段分配内存呢？
   <br>另外，如果采用指针指向的方式定位父类实例的内容是否能更节省内存空间？
   <br>
   <br>2:五种创建对象的方式，通过new指令新建出来的对象，他的内存其实涵盖了所有父类中的实例字段，其他的方式是怎样的哪？
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/66/75/54bb858e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>life is ...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">15</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   对象头
   <br>
   <br>每个对象都有一个对象头，对象头包括两部分，标记信息和类型指针。
   <br>
   <br>标记信息包括哈希值，锁信息，GC信息。类型指针指向这个对象的class。
   <br>
   <br>两个信息分别占用8个字节，所以每个对象的额外内存为16个字节。很消耗内存。
   <br>
   <br>压缩指针
   <br>
   <br>为了减少类型指针的内存占用，将64位指针压缩至32位，进而节约内存。之前64位寻址，寻的是字节。现在32位寻址，寻的是变量。再加上内存对齐(补齐为8的倍数)，可以每次寻变量都以一定的规则寻找，并且一定可以找得到。
   <br>
   <br>内存对齐
   <br>
   <br>内存对齐的另一个好处是，使得CPU缓存行可以更好的实施。保证每个变量都只出现在一条缓存行中，不会出现跨行缓存。提高程序的执行效率。
   <br>
   <br>字段重排序
   <br>
   <br>其实就是更好的执行内存对齐标准，会调整字段在内存中的分布，达到方便寻址和节省空间的目的。
   <br>
   <br>虚共享
   <br>
   <br>当两个线程分别访问一个对象中的不同volatile字段，理论上是不涉及变量共享和同步要求的。但是如果两个volatile字段处于同一个CPU缓存行中，对其中一个volatile字段的写操作，会导致整个缓存行的写回和读取操作，进而影响到了另一个volatile变量，也就是实际上的共享问题。
   <br>
   <br>@Contented注解
   <br>
   <br>该注解就是用来解决虚共享问题的，被该注解标识的变量，会独占一个CPU缓存行。但也因此浪费了大量的内存空间。
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 赞总结！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a9/ca/2d8c4733.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>amourling</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-13
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">9</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   作者大大辛苦了，货很干，搭配《深入理解java虚拟机》会很香
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/d4/f3/b73d8abf.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>三木子</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-13
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">6</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   有一个小白问题，new一个对象(继承一个类)会调用父类构造器，这个可以理解，因为对象可能调用父类方法。那么为什么new对象会调用到object呢？这有什么用意吗？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/f9/16/99a7045d.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>倔强</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">5</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   也就是说默认情况下，小于32G的堆内存中的对象引用为4个字节，一旦堆内存大于32G，对象引用为8个字节
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7a/e0/3d5b28ef.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>清歌</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   讲内存布局没有图示。如果能配一些图来说明就更清晰了，纯文字不直观
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/12/93/3470fc43.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Mr.钧👻</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-16
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   想请教老师大大几个问题：
   <br>1、什么是CUP缓存行？
   <br>2、如果跨缓存行的字段，为什么会降低执行效率？是因为某些读取程序，一行一行的读效率较高？还是因为以行分割呢？
   <br>3、明显启用压缩指针，性能更高，但是为什么还会在64位情况下，不启用压缩指针的情况呢？ 是因为CPU运行速度更快，可以护士不压缩指针导致的内存浪费吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>发条橙子 ...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师， 对象头中的类型指针只是为了指该对象的类 ， 使用了压缩指针还有32位 。可以有32g的地址空间， 一个类能用到 32 G的地址空间么?????
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/f9/66/e8fb8ca2.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>xlogic</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-29
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   字段重排列
   <br>
   <br>其一，如果一个字段占据 C 个字节， 那么该字段的偏移量需要对齐至 NC。这里的偏移量指的是字段地址与对象的起始地址差值
   <br>
   <br>以 long 类为例，它仅有一个 long 类型的实例字段。在使用了压缩指针的 64 位虚拟机中，尽管对象头的大小为 12 个字节，该 long 类型字段的偏移量也只能是 16，而中间空着的 4 个字节便会被浪费掉。
   <br>
   <br>个人理解：1. 应该是 Long 类型；2. 因为 long 字段的占 8 个字节，所以偏移量是 N8，比12大的最接近的数就是 16，所以偏移量就是16，也就是说字段与对象的起始位置差是16。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/b5/8bc4790b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_98716...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，请教您几个问题
   <br>1：每个类都有一个对应的class对象，那么这class对象是什么时候生成的，存储jvm的哪个区域？
   <br>2：类实例对象object header中的类型指针其实就是指向该类所属class的对象的指针吗？
   <br>3：class对象的内存结构又是什么样子的呢？类似于普通Java实例对象吗？
   <br>ps：这个指针压缩的原理有些困扰到我了。。。求解惑！！！
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>everyok22</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-22
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   你文章里说： 64位的JVM中，不采用压缩指针的方式，标记字段与类型指针分别占用8个字节，而采用了压缩指针标记字段与类型指针都会压成32位（8字节）那对象头不是只占用8个字节么，为什么你说是12个字节
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 标记字段没有被压缩。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/0c/20/ae6979bd.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>大能猫</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   最近研究String时遇到一个跟Java内存相关的问题：常量池里到底有没有存放对象？
   <br>常量池主要存放两大类常量：字面量（Literal）和符号引用（Symbolic Reference）；
   <br>如果常量池里有一个“hello”的字面量，这个字面量算是一个对象吗？如果不算对象，那么它所指向的对象又存放在哪里呢
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: String literal指向的对象存放在JVM的String pool里。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/c4/f3/97599e4b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>DesertSnow</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   超类啊这是
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>天王</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-25
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一个JAVA对象可以通过new，反序列化，clone等多种方式创建对象。new的时候，首先会为对象申请内存，然后调用构造器创建对象，初始化字段，会默认调用无参构造器对象，也会先调用父类的构造器，如果父类构造器无参，则隐式调用，如果是有参构造函数，则显式调用。子类的实例会为父类实例字段分配内存。
   <br>在内存中的布局，创建对象的时候会在为对象分配内存，一个对象有对象头，对象头里面存储的是标记字段和类型指针，对象头里面有哈希码，gc等信息，类型指针存的是指向类的引用，各自占用64位，8个字节，这是每个对象额外存储的，这样所以引入了基础类型。压缩指针可以将类型指针压成32位的，节省4个字节，压缩指针还可以压缩字段以及引用类型数组。压缩指针的原理，java对象默认的起始位置是8的位数，如果一个对象用不到8N，剩下的空间就浪费了，浪费的空间叫对象间的填充。对齐方式叫内存对齐，可以通过内存对齐选项来提升寻址范围，但是也容易导致对象填充。内存对象不仅存在于对象与对象之间，也存在于字段与字段中间，字段对齐的一个原因是，让字段出现在同一CPU的缓存行中，跨缓存行会影响执行效率。字段重排列，会重新分配字段的顺序，以达到内存对齐的目的。有2个选择，一个是字段偏移量是NC，子类字段的偏移量需要与父类对应字段的偏移量保持一致。使用了压缩指针的对象，子类第一个字段需要对齐至4N，没用压缩指针的对齐至8N。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/eb/1a/579c941e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>志远</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   因此，每一个 Integer 对象的额外内存开销至少是 400%。这句话实在令人费解，400%的单位是什么，4字节？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/zZiamzXOang0L4iaXa37k1wM8TqU6cqkQNCKZ9XUBWXPFndtvkXrtRGMLPur4zIvoYMHaicIU1fFibKTZJo8Lmnxug/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>suynan</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-20
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   上班间隙悄悄看了开头的一点点，真的好多干货，准备一周时间啃完一遍
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/bc/eb/c22ef3a5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Nevermore</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   以 long 类为例，它仅有一个 long 类型的实例字段。在使用了压缩指针的 64 位虚拟机中，尽管对象头的大小为 12 个字节，该 long 类型字段的偏移量也只能是 16，而中间空着的 4 个字节便会被浪费掉。
   <br>
   <br>
   <br>long存储的值占用8个字节，默认情况是以8N的位置开始占用的，所以long一共占用20个字节。所以当存储下一个long时，只能从第24个字节的位置开始存，那么20-23的位置就被浪费了。
   <br>
   <br>老师，我这理解有问题么？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/bc/eb/c22ef3a5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Nevermore</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-01-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   在对压缩指针解引用时，我们需要将其左移 3 位，再加上一个固定偏移量，便可以得到能够寻址 32GB 地址空间的伪 64 位指针了。
   <br>
   <br>
   <br>这句话不理解，老师能否具体讲解下。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/13/1a/41/3d87f7ac.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>橙生北国</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-28
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   这时候写留言不知道能不能跟上，老师，请问如果我new一个对象，它会影响JVM五个区域中的几个？大概是怎么影响的。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/b5/8bc4790b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Geek_98716...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-09-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，“堆中原本 64 位的 Java 对象指针压缩成 32 位”这几句话中的“64位java对象指针”是个啥？在哪里？为什么会影响想到对象头中类型指针？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |35          |
|----------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:49:03.290 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=35 
 {executed in 3 msec}
2020-11-19 20:49:03.292 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|35        |book   |0     |zh-hans  |35          |https://static001.geekbang.org/resource/image/8e/92/8eda743c128a33fe446358b740978792.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:49:03.318 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=35 
 {executed in 1 msec}
2020-11-19 20:49:03.321 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |35          |https://static001.geekbang.org/resource/image/8e/92/8eda743c128a33fe446358b740978792.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:49:03.346 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=35 
 {executed in 2 msec}
2020-11-19 20:49:03.348 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |35          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:49:03.374 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=35 
 {executed in 2 msec}
2020-11-19 20:49:03.376 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |35          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:49:03.398 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='1119466203911868' 
and bookchecke0_.name='net_content' 
 {executed in 0 msec}
2020-11-19 20:49:03.399 INFO  jdbc.resultsettable Line:610 - 
|--------|-----------------|----|------------|
|item_id |fsid             |got |name        |
|--------|-----------------|----|------------|
|71      |1119466203911868 |0   |net_content |
|--------|-----------------|----|------------|

2020-11-19 20:49:20.243 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='1119466203911868' 
and bookchecke0_.name='net_content' 
 {executed in 3 msec}
2020-11-19 20:49:20.246 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|71      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:49:20.272 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='1119466203911868', got=1, name='net_content' where item_id=71 
 {executed in 1 msec}
2020-11-19 20:49:20.297 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='1119466203911868' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:49:20.299 INFO  jdbc.resultsettable Line:610 - 
|--------|-----------------|----|------|
|item_id |fsid             |got |name  |
|--------|-----------------|----|------|
|72      |1119466203911868 |1   |media |
|--------|-----------------|----|------|

2020-11-19 20:49:20.303 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='1119466203911868' 
 {executed in 2 msec}
2020-11-19 20:49:20.305 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|36        |book   |0     |1119466203911868 |zh-hans  |36          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:49:20.308 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=36 
 {executed in 1 msec}
2020-11-19 20:49:20.310 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|36  |zh-hans  |book |f298485e-b6e4-428e-b46f-e6326a98bafa |36  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:49:20.332 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=36 
 {executed in 1 msec}
2020-11-19 20:49:20.334 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |1119466203911868 |zh-hans  |36          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:49:20.355 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=36 
 {executed in 1 msec}
2020-11-19 20:49:20.357 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|36  |1   |3     |0            |1  |32 |36 |0  |0  |32  |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:49:20.385 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=36 
 {executed in 5 msec}
2020-11-19 20:49:20.498 INFO  jdbc.resultsettable Line:610 - 
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|36        |<p>上回讲到，为了让所有的动物都能参加赛马，Java 7 引入了 invokedynamic 机制，允许调用任意类的“赛跑”方法。不过，我们并没有讲解 invokedynamic，而是深入地探讨了它所依赖的方法句柄。</p> 
<p>今天，我便来正式地介绍 invokedynamic 指令，讲讲它是如何生成调用点，并且允许应用程序自己决定链接至哪一个方法中的。</p> 
<h2>invokedynamic 指令</h2> 
<p>invokedynamic 是 Java 7 引入的一条新指令，用以支持动态语言的方法调用。具体来说，它将调用点（CallSite）抽象成一个 Java 类，并且将原本由 Java 虚拟机控制的方法调用以及方法链接暴露给了应用程序。在运行过程中，每一条 invokedynamic 指令将捆绑一个调用点，并且会调用该调用点所链接的方法句柄。</p> 
<p>在第一次执行 invokedynamic 指令时，Java 虚拟机会调用该指令所对应的启动方法（BootStrap Method），来生成前面提到的调用点，并且将之绑定至该 invokedynamic 指令中。在之后的运行过程中，Java 虚拟机则会直接调用绑定的调用点所链接的方法句柄。</p> 
<p>在字节码中，启动方法是用方法句柄来指定的。这个方法句柄指向一个返回类型为调用点的静态方法。该方法必须接收三个固定的参数，分别为一个 Lookup 类实例，一个用来指代目标方法名字的字符串，以及该调用点能够链接的方法句柄的类型。</p><!-- [[[read_end]]] --> 
<p>除了这三个必需参数之外，启动方法还可以接收若干个其他的参数，用来辅助生成调用点，或者定位所要链接的目标方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class Horse {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void race() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("Horse.race()"); 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class Deer {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void race() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("Deer.race()");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // javac Circuit.java
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // java Circuit
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Circuit {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void startRace(Object obj) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // aload obj
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // invokedynamic race()
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        startRace(new Horse());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // startRace(new Deer());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static CallSite bootstrap(MethodHandles.Lookup l, String name, MethodType callSiteType) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandle mh = l.findVirtual(Horse.class, name, MethodType.methodType(void.class));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return new ConstantCallSite(mh.asType(callSiteType));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我在文稿中贴了一段代码，其中便包含一个启动方法。它将接收前面提到的三个固定参数，并且返回一个链接至 Horse.race 方法的 ConstantCallSite。</p> 
<p>这里的 ConstantCallSite 是一种不可以更改链接对象的调用点。除此之外，Java 核心类库还提供多种可以更改链接对象的调用点，比如 MutableCallSite 和 VolatileCallSite。</p> 
<p>这两者的区别就好比正常字段和 volatile 字段之间的区别。此外，应用程序还可以自定义调用点类，来满足特定的重链接需求。</p> 
<p>由于 Java 暂不支持直接生成 invokedynamic 指令 [1]，所以接下来我会借助之前介绍过的字节码工具 ASM 来实现这一目的。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.io.IOException;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.nio.file.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // javac -cp /path/to/asm-all-6.0_BETA.jar:. ASMHelper.java
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // java -cp /path/to/asm-all-6.0_BETA.jar:. ASMHelper
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // java Circuit
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class ASMHelper implements Opcodes {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static class MyMethodVisitor extends MethodVisitor {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String BOOTSTRAP_CLASS_NAME = Circuit.class.getName().replace('.', '/');
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String BOOTSTRAP_METHOD_NAME = "bootstrap";
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String BOOTSTRAP_METHOD_DESC = MethodType
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .methodType(CallSite.class, MethodHandles.Lookup.class, String.class, MethodType.class)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .toMethodDescriptorString();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String TARGET_METHOD_NAME = "race";
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String TARGET_METHOD_DESC = "(Ljava/lang/Object;)V";
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public final MethodVisitor mv;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MyMethodVisitor(int api, MethodVisitor mv) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        super(api);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        this.mv = mv;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void visitCode() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitCode();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitVarInsn(ALOAD, 0);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Handle h = new Handle(H_INVOKESTATIC, BOOTSTRAP_CLASS_NAME, BOOTSTRAP_METHOD_NAME, BOOTSTRAP_METHOD_DESC, false);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitInvokeDynamicInsn(TARGET_METHOD_NAME, TARGET_METHOD_DESC, h);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitInsn(RETURN);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitMaxs(1, 1);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitEnd();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws IOException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassReader cr = new ClassReader("Circuit");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassWriter cw = new ClassWriter(cr, ClassWriter.COMPUTE_FRAMES);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassVisitor cv = new ClassVisitor(ASM6, cw) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MethodVisitor visitMethod(int access, String name, String descriptor, String signature,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        String[] exceptions) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodVisitor visitor = super.visitMethod(access, name, descriptor, signature, exceptions);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if ("startRace".equals(name)) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return new MyMethodVisitor(ASM6, visitor);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return visitor;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        };
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        cr.accept(cv, ClassReader.SKIP_FRAMES);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Files.write(Paths.get("Circuit.class"), cw.toByteArray());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>你无需理解上面这段代码的具体含义，只须了解它会更改同一目录下 Circuit 类的 startRace(Object) 方法，使之包含 invokedynamic 指令，执行所谓的赛跑方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void startRace(java.lang.Object);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: invokedynamic #80, 0 // race:(Ljava/lang/Object;)V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        6: return
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>如果你足够细心的话，你会发现该指令所调用的赛跑方法的描述符，和 Horse.race 方法或者 Deer.race 方法的描述符并不一致。这是因为 invokedynamic 指令最终调用的是方法句柄，而方法句柄会将调用者当成第一个参数。因此，刚刚提到的那两个方法恰恰符合这个描述符所对应的方法句柄类型。</p> 
<p>到目前为止，我们已经可以通过 invokedynamic 调用 Horse.race 方法了。为了支持调用任意类的 race 方法，我实现了一个简单的单态内联缓存。如果调用者的类型命中缓存中的类型，便直接调用缓存中的方法句柄，否则便更新缓存。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // 需要更改 ASMHelper.MyMethodVisitor 中的 BOOTSTRAP_CLASS_NAME
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MonomorphicInlineCache {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private final MethodHandles.Lookup lookup;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private final String name;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MonomorphicInlineCache(MethodHandles.Lookup lookup, String name) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        this.lookup = lookup;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        this.name = name;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private Class&lt;?&gt; cachedClass = null;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private MethodHandle mh = null;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void invoke(Object receiver) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (cachedClass != receiver.getClass()) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        cachedClass = receiver.getClass();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh = lookup.findVirtual(cachedClass, name, MethodType.methodType(void.class));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh.invoke(receiver);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static CallSite bootstrap(MethodHandles.Lookup l, String name, MethodType callSiteType) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MonomorphicInlineCache ic = new MonomorphicInlineCache(l, name);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandle mh = l.findVirtual(MonomorphicInlineCache.class, "invoke", MethodType.methodType(void.class, Object.class));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return new ConstantCallSite(mh.bindTo(ic));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>可以看到，尽管 invokedynamic 指令调用的是所谓的 race 方法，但是实际上我返回了一个链接至名为“invoke”的方法的调用点。由于调用点仅要求方法句柄的类型能够匹配，因此这个链接是合法的。</p> 
<p>不过，这正是 invokedynamic 的目的，也就是将调用点与目标方法的链接交由应用程序来做，并且依赖于应用程序对目标方法进行验证。所以，如果应用程序将赛跑方法链接至兔子的睡觉方法，那也只能怪应用程序自己了。</p> 
<h2>Java 8 的 Lambda 表达式</h2> 
<p>在 Java 8 中，Lambda 表达式也是借助 invokedynamic 来实现的。</p> 
<p>具体来说，Java 编译器利用 invokedynamic 指令来生成实现了函数式接口的适配器。这里的函数式接口指的是仅包括一个非 default 接口方法的接口，一般通过 @FunctionalInterface 注解。不过就算是没有使用该注解，Java 编译器也会将符合条件的接口辨认为函数式接口。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int x = ..
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       IntStream.of(1, 2, 3).map(i -&gt; i * 2).map(i -&gt; i * x);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>举个例子，上面这段代码会对 IntStream 中的元素进行两次映射。我们知道，映射方法 map 所接收的参数是 IntUnaryOperator（这是一个函数式接口）。也就是说，在运行过程中我们需要将 i-&gt;i<em>2 和 i-&gt;i</em>x 这两个 Lambda 表达式转化成 IntUnaryOperator 的实例。这个转化过程便是由 invokedynamic 来实现的。</p> 
<p>在编译过程中，Java 编译器会对 Lambda 表达式进行解语法糖（desugar），生成一个方法来保存 Lambda 表达式的内容。该方法的参数列表不仅包含原本 Lambda 表达式的参数，还包含它所捕获的变量。(注：方法引用，如 Horse::race，则不会生成生成额外的方法。)</p> 
<p>在上面那个例子中，第一个 Lambda 表达式没有捕获其他变量，而第二个 Lambda 表达式（也就是 i-&gt;i*x）则会捕获局部变量 x。这两个 Lambda 表达式对应的方法如下所示。可以看到，所捕获的变量同样也会作为参数传入生成的方法之中。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // i -&gt; i * 2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static int lambda$0(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: iload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: iconst_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        2: imul
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3: ireturn
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // i -&gt; i * x
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static int lambda$1(int, int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: iload_1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: iload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        2: imul
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3: ireturn
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>第一次执行 invokedynamic 指令时，它所对应的启动方法会通过 ASM 来生成一个适配器类。这个适配器类实现了对应的函数式接口，在我们的例子中，也就是 IntUnaryOperator。启动方法的返回值是一个 ConstantCallSite，其链接对象为一个返回适配器类实例的方法句柄。</p> 
<p>根据 Lambda 表达式是否捕获其他变量，启动方法生成的适配器类以及所链接的方法句柄皆不同。</p> 
<p>如果该 Lambda 表达式没有捕获其他变量，那么可以认为它是上下文无关的。因此，启动方法将新建一个适配器类的实例，并且生成一个特殊的方法句柄，始终返回该实例。</p> 
<p>如果该 Lambda 表达式捕获了其他变量，那么每次执行该 invokedynamic 指令，我们都要更新这些捕获了的变量，以防止它们发生了变化。</p> 
<p>另外，为了保证 Lambda 表达式的线程安全，我们无法共享同一个适配器类的实例。因此，在每次执行 invokedynamic 指令时，所调用的方法句柄都需要新建一个适配器类实例。</p> 
<p>在这种情况下，启动方法生成的适配器类将包含一个额外的静态方法，来构造适配器类的实例。该方法将接收这些捕获的参数，并且将它们保存为适配器类实例的实例字段。</p> 
<p>你可以通过虚拟机参数 -Djdk.internal.lambda.dumpProxyClasses=/DUMP/PATH 导出这些具体的适配器类。这里我导出了上面这个例子中两个 Lambda 表达式对应的适配器类。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // i-&gt;i*2 对应的适配器类
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       final class LambdaTest$$Lambda$1 implements IntUnaryOperator {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private LambdaTest$$Lambda$1();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: invokespecial java/lang/Object."&lt;init&gt;":()V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: return
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public int applyAsInt(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: iload_1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: invokestatic LambdaTest.lambda$0:(I)I
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: ireturn
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // i-&gt;i*x 对应的适配器类
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       final class LambdaTest$$Lambda$2 implements IntUnaryOperator {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private final int arg$1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private LambdaTest$$Lambda$2(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: invokespecial java/lang/Object."&lt;init&gt;":()V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        5: iload_1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        6: putfield arg$1:I
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        9: return
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static java.util.function.IntUnaryOperator get$Lambda(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: new LambdaTest$$Lambda$2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3: dup
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: iload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        5: invokespecial "&lt;init&gt;":(I)V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8: areturn
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public int applyAsInt(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: getfield arg$1:I
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: iload_1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        5: invokestatic LambdaTest.lambda$1:(II)I
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8: ireturn
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>可以看到，捕获了局部变量的 Lambda 表达式多出了一个 get$Lambda 的方法。启动方法便会所返回的调用点链接至指向该方法的方法句柄。也就是说，每次执行 invokedynamic 指令时，都会调用至这个方法中，并构造一个新的适配器类实例。</p> 
<p>这个多出来的新建实例会对程序性能造成影响吗？</p> 
<h2>Lambda 以及方法句柄的性能分析</h2> 
<p>我再次请出测试反射调用性能开销的那段代码，并将其改造成使用 Lambda 表达式的 v6 版本。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v6 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.function.IntConsumer;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) { }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ((IntConsumer) j -&gt; Test.target(j)).accept(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // ((IntConsumer) Test::target.accept(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>测量结果显示，它与直接调用的性能并无太大的区别。也就是说，即时编译器能够将转换 Lambda 表达式所使用的 invokedynamic，以及对 IntConsumer.accept 方法的调用统统内联进来，最终优化为空操作。</p> 
<p>这个其实不难理解：Lambda 表达式所使用的 invokedynamic 将绑定一个 ConstantCallSite，其链接的目标方法无法改变。因此，即时编译器会将该目标方法直接内联进来。对于这类没有捕获变量的 Lambda 表达式而言，目标方法只完成了一个动作，便是加载缓存的适配器类常量。</p> 
<p>另一方面，对 IntConsumer.accept 方法的调用实则是对适配器类的 accept 方法的调用。</p> 
<p>如果你查看了 accept 方法对应的字节码的话，你会发现它仅包含一个方法调用，调用至 Java 编译器在解 Lambda 语法糖时生成的方法。</p> 
<p>该方法的内容便是 Lambda 表达式的内容，也就是直接调用目标方法 Test.target。将这几个方法调用内联进来之后，原本对 accept 方法的调用则会被优化为空操作。</p> 
<p>下面我将之前的代码更改为带捕获变量的 v7 版本。理论上，每次调用 invokedynamic 指令，Java 虚拟机都会新建一个适配器类的实例。然而，实际运行结果还是与直接调用的性能一致。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v7 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.function.IntConsumer;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) { }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int x = 2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ((IntConsumer) j -&gt; Test.target(x + j)).accept(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>显然，即时编译器的逃逸分析又将该新建实例给优化掉了。我们可以通过虚拟机参数 -XX:-DoEscapeAnalysis 来关闭逃逸分析。果然，这时候测得的值约为直接调用的 2.5 倍。</p> 
<p>尽管逃逸分析能够去除这些额外的新建实例开销，但是它也不是时时奏效。它需要同时满足两件事：invokedynamic 指令所执行的方法句柄能够内联，和接下来的对 accept 方法的调用也能内联。</p> 
<p>只有这样，逃逸分析才能判定该适配器实例不逃逸。否则，我们会在运行过程中不停地生成适配器类实例。所以，我们应当尽量使用非捕获的 Lambda 表达式。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了 invokedynamic 指令以及 Lambda 表达式的实现。</p> 
<p>invokedymaic 指令抽象出调用点的概念，并且将调用该调用点所链接的方法句柄。在第一次执行 invokedynamic 指令时，Java 虚拟机将执行它所对应的启动方法，生成并且绑定一个调用点。之后如果再次执行该指令，Java 虚拟机则直接调用已经绑定了的调用点所链接的方法。</p> 
<p>Lambda 表达式到函数式接口的转换是通过 invokedynamic 指令来实现的。该 invokedynamic 指令对应的启动方法将通过 ASM 生成一个适配器类。</p> 
<p>对于没有捕获其他变量的 Lambda 表达式，该 invokedynamic 指令始终返回同一个适配器类的实例。对于捕获了其他变量的 Lambda 表达式，每次执行 invokedynamic 指令将新建一个适配器类实例。</p> 
<p>不管是捕获型的还是未捕获型的 Lambda 表达式，它们的性能上限皆可以达到直接调用的性能。其中，捕获型 Lambda 表达式借助了即时编译器中的逃逸分析，来避免实际的新建适配器类实例的操作。</p> 
<p>在上一篇的课后实践中，你应该测过这一段代码的性能开销了。我这边测得的结果约为直接调用的 3.5 倍。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v8 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodHandle;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodHandles;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodType;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) { }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandles.Lookup l = MethodHandles.lookup();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodType t = MethodType.methodType(void.class, int.class);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandle mh = l.findStatic(Test.class, "target", t);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh.invokeExact(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>实际上，它与使用 Lambda 表达式或者方法引用的差别在于，即时编译器无法将该方法句柄识别为常量，从而无法进行内联。那么如果将它变成常量行不行呢？</p> 
<p>一种方法便是将其赋值给 final 的静态变量，如下面的 v9 版本所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v9 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodHandle;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodHandles;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodType;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) { }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static final MethodHandle mh;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        try {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandles.Lookup l = MethodHandles.lookup();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodType t = MethodType.methodType(void.class, int.class);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh = l.findStatic(Test.class, "target", t);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        } catch (Throwable e) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        throw new RuntimeException(e);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh.invokeExact(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>这个版本测得的数据和直接调用的性能数据一致。也就是说，即时编译器能够将该方法句柄完全内联进来，成为空操作。</p> 
<p>今天的实践环节，我们来继续探索方法句柄的性能。运行下面的 v10 版本以及 v11 版本，比较它们的性能并思考为什么。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v10 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static class MyCallSite {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public final MethodHandle mh;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MyCallSite() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh = findTarget();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static MethodHandle findTarget() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        try {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandles.Lookup l = MethodHandles.lookup();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodType t = MethodType.methodType(void.class, int.class);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return l.findStatic(Test.class, "target", t);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        } catch (Throwable e) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        throw new RuntimeException(e);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final MyCallSite myCallSite = new MyCallSite();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        myCallSite.mh.invokeExact(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v11 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static class MyCallSite extends ConstantCallSite {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MyCallSite() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        super(findTarget());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static MethodHandle findTarget() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        try {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandles.Lookup l = MethodHandles.lookup();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodType t = MethodType.methodType(void.class, int.class);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return l.findStatic(Test.class, "target", t);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="61"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        } catch (Throwable e) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="62"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        throw new RuntimeException(e);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="63"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="64"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="65"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="66"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="67"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static final MyCallSite myCallSite = new MyCallSite();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="68"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="69"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="70"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="71"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="72"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="73"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="74"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="75"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="76"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="77"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="78"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        myCallSite.getTarget().invokeExact(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="79"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="80"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="81"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>感谢你的收听，我们下次再见。</p> 
<p>[1] <a href="http://openjdk.java.net/jeps/303">http://openjdk.java.net/jeps/303</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |36          |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:49:20.550 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=36 
 {executed in 7 msec}
2020-11-19 20:49:20.653 INFO  jdbc.resultsettable Line:610 - 
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>上回讲到，为了让所有的动物都能参加赛马，Java 7 引入了 invokedynamic 机制，允许调用任意类的“赛跑”方法。不过，我们并没有讲解 invokedynamic，而是深入地探讨了它所依赖的方法句柄。</p> 
<p>今天，我便来正式地介绍 invokedynamic 指令，讲讲它是如何生成调用点，并且允许应用程序自己决定链接至哪一个方法中的。</p> 
<h2>invokedynamic 指令</h2> 
<p>invokedynamic 是 Java 7 引入的一条新指令，用以支持动态语言的方法调用。具体来说，它将调用点（CallSite）抽象成一个 Java 类，并且将原本由 Java 虚拟机控制的方法调用以及方法链接暴露给了应用程序。在运行过程中，每一条 invokedynamic 指令将捆绑一个调用点，并且会调用该调用点所链接的方法句柄。</p> 
<p>在第一次执行 invokedynamic 指令时，Java 虚拟机会调用该指令所对应的启动方法（BootStrap Method），来生成前面提到的调用点，并且将之绑定至该 invokedynamic 指令中。在之后的运行过程中，Java 虚拟机则会直接调用绑定的调用点所链接的方法句柄。</p> 
<p>在字节码中，启动方法是用方法句柄来指定的。这个方法句柄指向一个返回类型为调用点的静态方法。该方法必须接收三个固定的参数，分别为一个 Lookup 类实例，一个用来指代目标方法名字的字符串，以及该调用点能够链接的方法句柄的类型。</p><!-- [[[read_end]]] --> 
<p>除了这三个必需参数之外，启动方法还可以接收若干个其他的参数，用来辅助生成调用点，或者定位所要链接的目标方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class Horse {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void race() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("Horse.race()"); 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class Deer {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void race() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("Deer.race()");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // javac Circuit.java
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // java Circuit
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Circuit {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void startRace(Object obj) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // aload obj
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // invokedynamic race()
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        startRace(new Horse());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // startRace(new Deer());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static CallSite bootstrap(MethodHandles.Lookup l, String name, MethodType callSiteType) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandle mh = l.findVirtual(Horse.class, name, MethodType.methodType(void.class));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return new ConstantCallSite(mh.asType(callSiteType));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我在文稿中贴了一段代码，其中便包含一个启动方法。它将接收前面提到的三个固定参数，并且返回一个链接至 Horse.race 方法的 ConstantCallSite。</p> 
<p>这里的 ConstantCallSite 是一种不可以更改链接对象的调用点。除此之外，Java 核心类库还提供多种可以更改链接对象的调用点，比如 MutableCallSite 和 VolatileCallSite。</p> 
<p>这两者的区别就好比正常字段和 volatile 字段之间的区别。此外，应用程序还可以自定义调用点类，来满足特定的重链接需求。</p> 
<p>由于 Java 暂不支持直接生成 invokedynamic 指令 [1]，所以接下来我会借助之前介绍过的字节码工具 ASM 来实现这一目的。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.io.IOException;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.nio.file.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // javac -cp /path/to/asm-all-6.0_BETA.jar:. ASMHelper.java
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // java -cp /path/to/asm-all-6.0_BETA.jar:. ASMHelper
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // java Circuit
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class ASMHelper implements Opcodes {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static class MyMethodVisitor extends MethodVisitor {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String BOOTSTRAP_CLASS_NAME = Circuit.class.getName().replace('.', '/');
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String BOOTSTRAP_METHOD_NAME = "bootstrap";
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String BOOTSTRAP_METHOD_DESC = MethodType
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .methodType(CallSite.class, MethodHandles.Lookup.class, String.class, MethodType.class)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .toMethodDescriptorString();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String TARGET_METHOD_NAME = "race";
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final String TARGET_METHOD_DESC = "(Ljava/lang/Object;)V";
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public final MethodVisitor mv;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MyMethodVisitor(int api, MethodVisitor mv) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        super(api);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        this.mv = mv;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void visitCode() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitCode();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitVarInsn(ALOAD, 0);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Handle h = new Handle(H_INVOKESTATIC, BOOTSTRAP_CLASS_NAME, BOOTSTRAP_METHOD_NAME, BOOTSTRAP_METHOD_DESC, false);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitInvokeDynamicInsn(TARGET_METHOD_NAME, TARGET_METHOD_DESC, h);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitInsn(RETURN);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitMaxs(1, 1);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mv.visitEnd();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws IOException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassReader cr = new ClassReader("Circuit");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassWriter cw = new ClassWriter(cr, ClassWriter.COMPUTE_FRAMES);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassVisitor cv = new ClassVisitor(ASM6, cw) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MethodVisitor visitMethod(int access, String name, String descriptor, String signature,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        String[] exceptions) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodVisitor visitor = super.visitMethod(access, name, descriptor, signature, exceptions);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if ("startRace".equals(name)) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return new MyMethodVisitor(ASM6, visitor);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return visitor;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        };
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        cr.accept(cv, ClassReader.SKIP_FRAMES);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Files.write(Paths.get("Circuit.class"), cw.toByteArray());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>你无需理解上面这段代码的具体含义，只须了解它会更改同一目录下 Circuit 类的 startRace(Object) 方法，使之包含 invokedynamic 指令，执行所谓的赛跑方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void startRace(java.lang.Object);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: invokedynamic #80, 0 // race:(Ljava/lang/Object;)V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        6: return
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>如果你足够细心的话，你会发现该指令所调用的赛跑方法的描述符，和 Horse.race 方法或者 Deer.race 方法的描述符并不一致。这是因为 invokedynamic 指令最终调用的是方法句柄，而方法句柄会将调用者当成第一个参数。因此，刚刚提到的那两个方法恰恰符合这个描述符所对应的方法句柄类型。</p> 
<p>到目前为止，我们已经可以通过 invokedynamic 调用 Horse.race 方法了。为了支持调用任意类的 race 方法，我实现了一个简单的单态内联缓存。如果调用者的类型命中缓存中的类型，便直接调用缓存中的方法句柄，否则便更新缓存。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // 需要更改 ASMHelper.MyMethodVisitor 中的 BOOTSTRAP_CLASS_NAME
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MonomorphicInlineCache {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private final MethodHandles.Lookup lookup;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private final String name;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MonomorphicInlineCache(MethodHandles.Lookup lookup, String name) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        this.lookup = lookup;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        this.name = name;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private Class&lt;?&gt; cachedClass = null;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private MethodHandle mh = null;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void invoke(Object receiver) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (cachedClass != receiver.getClass()) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        cachedClass = receiver.getClass();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh = lookup.findVirtual(cachedClass, name, MethodType.methodType(void.class));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh.invoke(receiver);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static CallSite bootstrap(MethodHandles.Lookup l, String name, MethodType callSiteType) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MonomorphicInlineCache ic = new MonomorphicInlineCache(l, name);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandle mh = l.findVirtual(MonomorphicInlineCache.class, "invoke", MethodType.methodType(void.class, Object.class));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return new ConstantCallSite(mh.bindTo(ic));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>可以看到，尽管 invokedynamic 指令调用的是所谓的 race 方法，但是实际上我返回了一个链接至名为“invoke”的方法的调用点。由于调用点仅要求方法句柄的类型能够匹配，因此这个链接是合法的。</p> 
<p>不过，这正是 invokedynamic 的目的，也就是将调用点与目标方法的链接交由应用程序来做，并且依赖于应用程序对目标方法进行验证。所以，如果应用程序将赛跑方法链接至兔子的睡觉方法，那也只能怪应用程序自己了。</p> 
<h2>Java 8 的 Lambda 表达式</h2> 
<p>在 Java 8 中，Lambda 表达式也是借助 invokedynamic 来实现的。</p> 
<p>具体来说，Java 编译器利用 invokedynamic 指令来生成实现了函数式接口的适配器。这里的函数式接口指的是仅包括一个非 default 接口方法的接口，一般通过 @FunctionalInterface 注解。不过就算是没有使用该注解，Java 编译器也会将符合条件的接口辨认为函数式接口。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       int x = ..
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       IntStream.of(1, 2, 3).map(i -&gt; i * 2).map(i -&gt; i * x);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>举个例子，上面这段代码会对 IntStream 中的元素进行两次映射。我们知道，映射方法 map 所接收的参数是 IntUnaryOperator（这是一个函数式接口）。也就是说，在运行过程中我们需要将 i-&gt;i<em>2 和 i-&gt;i</em>x 这两个 Lambda 表达式转化成 IntUnaryOperator 的实例。这个转化过程便是由 invokedynamic 来实现的。</p> 
<p>在编译过程中，Java 编译器会对 Lambda 表达式进行解语法糖（desugar），生成一个方法来保存 Lambda 表达式的内容。该方法的参数列表不仅包含原本 Lambda 表达式的参数，还包含它所捕获的变量。(注：方法引用，如 Horse::race，则不会生成生成额外的方法。)</p> 
<p>在上面那个例子中，第一个 Lambda 表达式没有捕获其他变量，而第二个 Lambda 表达式（也就是 i-&gt;i*x）则会捕获局部变量 x。这两个 Lambda 表达式对应的方法如下所示。可以看到，所捕获的变量同样也会作为参数传入生成的方法之中。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // i -&gt; i * 2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static int lambda$0(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: iload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: iconst_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        2: imul
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3: ireturn
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // i -&gt; i * x
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static int lambda$1(int, int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: iload_1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: iload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        2: imul
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3: ireturn
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>第一次执行 invokedynamic 指令时，它所对应的启动方法会通过 ASM 来生成一个适配器类。这个适配器类实现了对应的函数式接口，在我们的例子中，也就是 IntUnaryOperator。启动方法的返回值是一个 ConstantCallSite，其链接对象为一个返回适配器类实例的方法句柄。</p> 
<p>根据 Lambda 表达式是否捕获其他变量，启动方法生成的适配器类以及所链接的方法句柄皆不同。</p> 
<p>如果该 Lambda 表达式没有捕获其他变量，那么可以认为它是上下文无关的。因此，启动方法将新建一个适配器类的实例，并且生成一个特殊的方法句柄，始终返回该实例。</p> 
<p>如果该 Lambda 表达式捕获了其他变量，那么每次执行该 invokedynamic 指令，我们都要更新这些捕获了的变量，以防止它们发生了变化。</p> 
<p>另外，为了保证 Lambda 表达式的线程安全，我们无法共享同一个适配器类的实例。因此，在每次执行 invokedynamic 指令时，所调用的方法句柄都需要新建一个适配器类实例。</p> 
<p>在这种情况下，启动方法生成的适配器类将包含一个额外的静态方法，来构造适配器类的实例。该方法将接收这些捕获的参数，并且将它们保存为适配器类实例的实例字段。</p> 
<p>你可以通过虚拟机参数 -Djdk.internal.lambda.dumpProxyClasses=/DUMP/PATH 导出这些具体的适配器类。这里我导出了上面这个例子中两个 Lambda 表达式对应的适配器类。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // i-&gt;i*2 对应的适配器类
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       final class LambdaTest$$Lambda$1 implements IntUnaryOperator {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private LambdaTest$$Lambda$1();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: invokespecial java/lang/Object."&lt;init&gt;":()V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: return
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public int applyAsInt(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: iload_1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: invokestatic LambdaTest.lambda$0:(I)I
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: ireturn
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // i-&gt;i*x 对应的适配器类
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       final class LambdaTest$$Lambda$2 implements IntUnaryOperator {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private final int arg$1;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private LambdaTest$$Lambda$2(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: invokespecial java/lang/Object."&lt;init&gt;":()V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        5: iload_1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        6: putfield arg$1:I
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        9: return
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static java.util.function.IntUnaryOperator get$Lambda(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: new LambdaTest$$Lambda$2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3: dup
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: iload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        5: invokespecial "&lt;init&gt;":(I)V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8: areturn
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public int applyAsInt(int);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Code:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        0: aload_0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: getfield arg$1:I
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: iload_1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        5: invokestatic LambdaTest.lambda$1:(II)I
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8: ireturn
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>可以看到，捕获了局部变量的 Lambda 表达式多出了一个 get$Lambda 的方法。启动方法便会所返回的调用点链接至指向该方法的方法句柄。也就是说，每次执行 invokedynamic 指令时，都会调用至这个方法中，并构造一个新的适配器类实例。</p> 
<p>这个多出来的新建实例会对程序性能造成影响吗？</p> 
<h2>Lambda 以及方法句柄的性能分析</h2> 
<p>我再次请出测试反射调用性能开销的那段代码，并将其改造成使用 Lambda 表达式的 v6 版本。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v6 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.function.IntConsumer;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) { }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ((IntConsumer) j -&gt; Test.target(j)).accept(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // ((IntConsumer) Test::target.accept(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>测量结果显示，它与直接调用的性能并无太大的区别。也就是说，即时编译器能够将转换 Lambda 表达式所使用的 invokedynamic，以及对 IntConsumer.accept 方法的调用统统内联进来，最终优化为空操作。</p> 
<p>这个其实不难理解：Lambda 表达式所使用的 invokedynamic 将绑定一个 ConstantCallSite，其链接的目标方法无法改变。因此，即时编译器会将该目标方法直接内联进来。对于这类没有捕获变量的 Lambda 表达式而言，目标方法只完成了一个动作，便是加载缓存的适配器类常量。</p> 
<p>另一方面，对 IntConsumer.accept 方法的调用实则是对适配器类的 accept 方法的调用。</p> 
<p>如果你查看了 accept 方法对应的字节码的话，你会发现它仅包含一个方法调用，调用至 Java 编译器在解 Lambda 语法糖时生成的方法。</p> 
<p>该方法的内容便是 Lambda 表达式的内容，也就是直接调用目标方法 Test.target。将这几个方法调用内联进来之后，原本对 accept 方法的调用则会被优化为空操作。</p> 
<p>下面我将之前的代码更改为带捕获变量的 v7 版本。理论上，每次调用 invokedynamic 指令，Java 虚拟机都会新建一个适配器类的实例。然而，实际运行结果还是与直接调用的性能一致。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v7 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.function.IntConsumer;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) { }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int x = 2;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ((IntConsumer) j -&gt; Test.target(x + j)).accept(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>显然，即时编译器的逃逸分析又将该新建实例给优化掉了。我们可以通过虚拟机参数 -XX:-DoEscapeAnalysis 来关闭逃逸分析。果然，这时候测得的值约为直接调用的 2.5 倍。</p> 
<p>尽管逃逸分析能够去除这些额外的新建实例开销，但是它也不是时时奏效。它需要同时满足两件事：invokedynamic 指令所执行的方法句柄能够内联，和接下来的对 accept 方法的调用也能内联。</p> 
<p>只有这样，逃逸分析才能判定该适配器实例不逃逸。否则，我们会在运行过程中不停地生成适配器类实例。所以，我们应当尽量使用非捕获的 Lambda 表达式。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了 invokedynamic 指令以及 Lambda 表达式的实现。</p> 
<p>invokedymaic 指令抽象出调用点的概念，并且将调用该调用点所链接的方法句柄。在第一次执行 invokedynamic 指令时，Java 虚拟机将执行它所对应的启动方法，生成并且绑定一个调用点。之后如果再次执行该指令，Java 虚拟机则直接调用已经绑定了的调用点所链接的方法。</p> 
<p>Lambda 表达式到函数式接口的转换是通过 invokedynamic 指令来实现的。该 invokedynamic 指令对应的启动方法将通过 ASM 生成一个适配器类。</p> 
<p>对于没有捕获其他变量的 Lambda 表达式，该 invokedynamic 指令始终返回同一个适配器类的实例。对于捕获了其他变量的 Lambda 表达式，每次执行 invokedynamic 指令将新建一个适配器类实例。</p> 
<p>不管是捕获型的还是未捕获型的 Lambda 表达式，它们的性能上限皆可以达到直接调用的性能。其中，捕获型 Lambda 表达式借助了即时编译器中的逃逸分析，来避免实际的新建适配器类实例的操作。</p> 
<p>在上一篇的课后实践中，你应该测过这一段代码的性能开销了。我这边测得的结果约为直接调用的 3.5 倍。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v8 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodHandle;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodHandles;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodType;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) { }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandles.Lookup l = MethodHandles.lookup();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodType t = MethodType.methodType(void.class, int.class);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandle mh = l.findStatic(Test.class, "target", t);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh.invokeExact(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>实际上，它与使用 Lambda 表达式或者方法引用的差别在于，即时编译器无法将该方法句柄识别为常量，从而无法进行内联。那么如果将它变成常量行不行呢？</p> 
<p>一种方法便是将其赋值给 final 的静态变量，如下面的 v9 版本所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v9 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodHandle;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodHandles;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.MethodType;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) { }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static final MethodHandle mh;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        try {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandles.Lookup l = MethodHandles.lookup();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodType t = MethodType.methodType(void.class, int.class);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh = l.findStatic(Test.class, "target", t);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        } catch (Throwable e) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        throw new RuntimeException(e);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh.invokeExact(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>这个版本测得的数据和直接调用的性能数据一致。也就是说，即时编译器能够将该方法句柄完全内联进来，成为空操作。</p> 
<p>今天的实践环节，我们来继续探索方法句柄的性能。运行下面的 v10 版本以及 v11 版本，比较它们的性能并思考为什么。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v10 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static class MyCallSite {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public final MethodHandle mh;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MyCallSite() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        mh = findTarget();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static MethodHandle findTarget() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        try {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandles.Lookup l = MethodHandles.lookup();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodType t = MethodType.methodType(void.class, int.class);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return l.findStatic(Test.class, "target", t);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        } catch (Throwable e) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        throw new RuntimeException(e);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static final MyCallSite myCallSite = new MyCallSite();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        myCallSite.mh.invokeExact(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // v11 版本
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.invoke.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Test {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void target(int i) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static class MyCallSite extends ConstantCallSite {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public MyCallSite() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        super(findTarget());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static MethodHandle findTarget() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        try {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodHandles.Lookup l = MethodHandles.lookup();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        MethodType t = MethodType.methodType(void.class, int.class);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return l.findStatic(Test.class, "target", t);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="61"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        } catch (Throwable e) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="62"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        throw new RuntimeException(e);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="63"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="64"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="65"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="66"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="67"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static final MyCallSite myCallSite = new MyCallSite();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="68"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="69"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="70"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long current = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="71"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 1; i &lt;= 2_000_000_000; i++) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="72"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (i % 100_000_000 == 0) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="73"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        long temp = System.currentTimeMillis();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="74"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(temp - current);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="75"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        current = temp;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="76"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="77"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="78"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        myCallSite.getTarget().invokeExact(128);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="79"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="80"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="81"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>感谢你的收听，我们下次再见。</p> 
<p>[1] <a href="http://openjdk.java.net/jeps/303">http://openjdk.java.net/jeps/303</a></p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |36          |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:49:20.732 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=36 
 {executed in 2 msec}
2020-11-19 20:49:20.734 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                         |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------------------|-----|----|----|
|36  |1605789272 |1605789272 |1                |zh-hans  |0       |1                             |1      |0      |09丨JVM是怎么实现invokedynamic的？（下） |book |1   |36  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------------------|-----|----|----|

2020-11-19 20:49:20.737 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=36 
 {executed in 1 msec}
2020-11-19 20:49:20.739 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                         |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------------------|----|----|
|[unread] |1605789272 |1605789272 |1                |zh-hans  |0       |1                             |1      |0      |09丨JVM是怎么实现invokedynamic的？（下） |1   |36  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------------------|----|----|

2020-11-19 20:49:20.760 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605790160, created=1605790160, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='09丨JVM是怎么实现invokedynamic的？（下）', 
type='book', uid=1, vid=36 where nid=36 
 {executed in 1 msec}
2020-11-19 20:49:20.763 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605790160, created=1605790160, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='09丨JVM是怎么实现invokedynamic的？（下）', 
uid=1, vid=36 where nid=36 
 {executed in 2 msec}
2020-11-19 20:49:20.788 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=36 
 {executed in 1 msec}
2020-11-19 20:49:20.791 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |revision_id |
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|36        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/613ba392fd5af79914362c71a4c1fdec?bkt=en-29a7ad5d1913bc6f150c0dcdf8a49030e60c6c317d719b838e6037e4ee45dbc606d65a94521e1f3e&fid=3757516097-778750-1124099913543999&time=1605788249&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-qvCpusUUcKtFqoW3gNW%2B21j14%2FY%3D&to=92&size=5614307&sta_dx=5614307&sta_cs=4336&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182961&mtime=1605787493&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5614307&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-c5fe7e9cfdc30d2b725635b2b221fb2e0d18e689c940b349457d937574e11bfed61f48928fc13f3b&sl=76480590&expires=8h&rt=pr&r=213020159&mlogid=7510891030680723701&vbdid=64799653&fin=09%E4%B8%A8JVM%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%EF%BC%9F%EF%BC%88%E4%B8%8B%EF%BC%89.mp3&bflag=92,34-92&rtype=1&dp-logid=7510891030680723701&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=37cfb58296b21ea95466cced4b5cbe63ac9239cfde75fe0a&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=09%E4%B8%A8JVM%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%EF%BC%9F%EF%BC%88%E4%B8%8B%EF%BC%89.mp3 |36          |
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:49:20.817 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=36 
 {executed in 1 msec}
2020-11-19 20:49:20.820 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |revision_id |
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/613ba392fd5af79914362c71a4c1fdec?bkt=en-29a7ad5d1913bc6f150c0dcdf8a49030e60c6c317d719b838e6037e4ee45dbc606d65a94521e1f3e&fid=3757516097-778750-1124099913543999&time=1605788249&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-qvCpusUUcKtFqoW3gNW%2B21j14%2FY%3D&to=92&size=5614307&sta_dx=5614307&sta_cs=4336&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182961&mtime=1605787493&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5614307&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-c5fe7e9cfdc30d2b725635b2b221fb2e0d18e689c940b349457d937574e11bfed61f48928fc13f3b&sl=76480590&expires=8h&rt=pr&r=213020159&mlogid=7510891030680723701&vbdid=64799653&fin=09%E4%B8%A8JVM%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%EF%BC%9F%EF%BC%88%E4%B8%8B%EF%BC%89.mp3&bflag=92,34-92&rtype=1&dp-logid=7510891030680723701&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=37cfb58296b21ea95466cced4b5cbe63ac9239cfde75fe0a&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=09%E4%B8%A8JVM%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0invokedynamic%E7%9A%84%EF%BC%9F%EF%BC%88%E4%B8%8B%EF%BC%89.mp3 |36          |
|----------|-------|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:49:20.847 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=36 
 {executed in 4 msec}
2020-11-19 20:49:20.860 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |delta |field_comment_format |langcode |revision_id |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|36        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/9a/f2c0a206.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>ext4</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">6</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   我知道Java对Lambda有个规定：“The variable used in Lambda should be final or effectively final"，也就是说Lambda表达式捕获的变量必须是final或等同于final的。而文中您又讲到：“对于捕获了变量的Lambda，每次invokedynamic都需要新建适配器类实例，以防止他们发生变化”。JVM之所以这么做，是因为这种final的要求仅限于Java source层面，在bytecode层面是是无法保证的。我理解的对吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 语言里的final，是对于当前方法调用而言的。这是因为它实际上就传了个值进去。比如说你定义了int a，然后传入 i -&gt; i +a里，那么之后你对a的修改lambda是看不到的。<br><br>适配器针对的是多次不同调用，比如说每次调用你定义的final int a都不一样。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1Y9r3uuNQ1c5cbsk7XeVBEiamwwGsa7DuawliaFr6NG9yNZhdasOKXVdUpu1F3kVFibFWWZibeawjbg/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>code-arti...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">5</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一直没理解“逃逸分析”啥意思？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 逃逸分析是指通过数据流分析，判断一个对象会不会被传递到当前编译的方法之外。比如说你调用了一个方法，将一个新建的对象作为参数传递出去，如果这个方法没有被内联，则说明该新建对象会逃逸。<br><br>逃逸分析是一项比较重要的优化，我后面会详细讲。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/80/bf/3041138b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>　素丶　　</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   https://zhuanlan.zhihu.com/p/26389041
   <br>https://zhuanlan.zhihu.com/p/30936412
   <br>可以和 Shijie 大大的两篇文章配合着看。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 赞！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4Tosj3tAYvdgDfa32FAu85ibEicxhtibU4ibdm3YAgvTWwukycMlVfPwea9sL2bFSdBeymWI7iaIbg0g/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>karl</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   看了两遍 勉强有个概念了 
   <br>还是基础不够 看不懂啊
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: invokedynamic涉及到的东西很多，底层实现也在不断改进。看懂个大概就好啦</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/01/50/c832a9b2.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>微笑</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   如果该 Lambda 表达式捕获了其他变量，那么每次执行该 invokedynamic 指令，我们都要更新这些捕获了的变化。
   <br>问题：捕获的变量必须是final，为什么还会变呢，为什么会线程不安全呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/fd/08/c039f840.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小鳄鱼</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，看来上一篇和这篇，又两个问题：
   <br>1. 尽管逃逸分析能够去除这些额外的新建实例开销，但是它也不是时时奏效。那么什么情况下不奏效呢？
   <br>2. 什么情况下编译器会将句柄识别成常量？除了本文中将MethodHandler定义为常量外，在其他什么情况下能识别为常量呢
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师你好，我有两个问题，1是我看了几个有invokedynmaic指令的文件，都是invokedynamic #31, 0这种形式，似乎后面这个0没有什么作用，网上invokedynamic的解说也大多过时，我使用的是1.8.0_181版本。2. v10版本和v11版本性能的差距我猜想是v10版本不能正确的内联方法吧？虽然mh是final的，但是字节码层面已经丢失这个信息了。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 1. 这个数字0，指的是第几个bootstrap method，你多定义几个lambda，应该可以见到1 2 3等等。<br><br>2. 对的，是不能内联。不过，字节码中字段处还是会有final标志的。C2认为final实例字段在编译过程中不应该被认为是不变的，因为应用程序可能通过Unsafe来更改。Graal认为可以当成不变的，毕竟Java语言规范没有规定不可以。<br><br>V11的话，可以看出ConstantCallsite及时子类被特殊对待了。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ3TyRm5FrBNBROLeVTOyj67foqPKW99ib0t8nKKcmz9BC5h2xfLJQ0zPJlGMZQTwqjU37zwyhvcnA/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>夕林语</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   v10和v11的区别仅仅是v11的内部类继承了ConstantCallSite，ConstantCallSite是不可被更改链接的调用点，是不是说明v11的内部类被内联了？从而可以达到和直接调用近似的执行效率
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/18/cb/edb5a0a0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小橙橙</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   其实有个地方一直没有想透，为什么要学习字节码，学习字节码对我们日常开发有什么作用吗，老师能否给指点迷津一下？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 主要是了解底层实现。<br><br>对普通的日常开发可能作用不大。对于进阶的，比如分析应用的性能瓶颈，了解字节码将有所帮助。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/57/0f/1f229bf5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Void_seT</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   单态内联缓存的实现代码段，bootstrap方法的实现有问题，没有return一个CallSite类型返回值。另外，这篇有点难度了，看了三遍，勉强理解。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 多谢指出！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/7a/ec/f39349f3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小江</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师邮箱可以提供一下吗，咨询一个问题，经过btrace增强后class文件错误问题
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/84/4d/97691ff9.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>自来也</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   示例应该用jdk.internal.org.objectweb.asm.*包吧？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |36          |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:49:20.892 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=36 
 {executed in 3 msec}
2020-11-19 20:49:20.915 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |delta |field_comment_format |langcode |revision_id |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/04/9a/f2c0a206.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>ext4</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">6</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   我知道Java对Lambda有个规定：“The variable used in Lambda should be final or effectively final"，也就是说Lambda表达式捕获的变量必须是final或等同于final的。而文中您又讲到：“对于捕获了变量的Lambda，每次invokedynamic都需要新建适配器类实例，以防止他们发生变化”。JVM之所以这么做，是因为这种final的要求仅限于Java source层面，在bytecode层面是是无法保证的。我理解的对吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 语言里的final，是对于当前方法调用而言的。这是因为它实际上就传了个值进去。比如说你定义了int a，然后传入 i -&gt; i +a里，那么之后你对a的修改lambda是看不到的。<br><br>适配器针对的是多次不同调用，比如说每次调用你定义的final int a都不一样。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1Y9r3uuNQ1c5cbsk7XeVBEiamwwGsa7DuawliaFr6NG9yNZhdasOKXVdUpu1F3kVFibFWWZibeawjbg/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>code-arti...</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">5</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   一直没理解“逃逸分析”啥意思？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 逃逸分析是指通过数据流分析，判断一个对象会不会被传递到当前编译的方法之外。比如说你调用了一个方法，将一个新建的对象作为参数传递出去，如果这个方法没有被内联，则说明该新建对象会逃逸。<br><br>逃逸分析是一项比较重要的优化，我后面会详细讲。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/80/bf/3041138b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>　素丶　　</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   https://zhuanlan.zhihu.com/p/26389041
   <br>https://zhuanlan.zhihu.com/p/30936412
   <br>可以和 Shijie 大大的两篇文章配合着看。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 赞！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4Tosj3tAYvdgDfa32FAu85ibEicxhtibU4ibdm3YAgvTWwukycMlVfPwea9sL2bFSdBeymWI7iaIbg0g/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>karl</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   看了两遍 勉强有个概念了 
   <br>还是基础不够 看不懂啊
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: invokedynamic涉及到的东西很多，底层实现也在不断改进。看懂个大概就好啦</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/01/50/c832a9b2.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>微笑</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-02-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   如果该 Lambda 表达式捕获了其他变量，那么每次执行该 invokedynamic 指令，我们都要更新这些捕获了的变化。
   <br>问题：捕获的变量必须是final，为什么还会变呢，为什么会线程不安全呢？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/fd/08/c039f840.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小鳄鱼</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师，看来上一篇和这篇，又两个问题：
   <br>1. 尽管逃逸分析能够去除这些额外的新建实例开销，但是它也不是时时奏效。那么什么情况下不奏效呢？
   <br>2. 什么情况下编译器会将句柄识别成常量？除了本文中将MethodHandler定义为常量外，在其他什么情况下能识别为常量呢
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师你好，我有两个问题，1是我看了几个有invokedynmaic指令的文件，都是invokedynamic #31, 0这种形式，似乎后面这个0没有什么作用，网上invokedynamic的解说也大多过时，我使用的是1.8.0_181版本。2. v10版本和v11版本性能的差距我猜想是v10版本不能正确的内联方法吧？虽然mh是final的，但是字节码层面已经丢失这个信息了。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 1. 这个数字0，指的是第几个bootstrap method，你多定义几个lambda，应该可以见到1 2 3等等。<br><br>2. 对的，是不能内联。不过，字节码中字段处还是会有final标志的。C2认为final实例字段在编译过程中不应该被认为是不变的，因为应用程序可能通过Unsafe来更改。Graal认为可以当成不变的，毕竟Java语言规范没有规定不可以。<br><br>V11的话，可以看出ConstantCallsite及时子类被特殊对待了。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ3TyRm5FrBNBROLeVTOyj67foqPKW99ib0t8nKKcmz9BC5h2xfLJQ0zPJlGMZQTwqjU37zwyhvcnA/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>夕林语</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   v10和v11的区别仅仅是v11的内部类继承了ConstantCallSite，ConstantCallSite是不可被更改链接的调用点，是不是说明v11的内部类被内联了？从而可以达到和直接调用近似的执行效率
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/18/cb/edb5a0a0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小橙橙</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   其实有个地方一直没有想透，为什么要学习字节码，学习字节码对我们日常开发有什么作用吗，老师能否给指点迷津一下？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 主要是了解底层实现。<br><br>对普通的日常开发可能作用不大。对于进阶的，比如分析应用的性能瓶颈，了解字节码将有所帮助。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/57/0f/1f229bf5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Void_seT</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-11
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   单态内联缓存的实现代码段，bootstrap方法的实现有问题，没有return一个CallSite类型返回值。另外，这篇有点难度了，看了三遍，勉强理解。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 多谢指出！</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/7a/ec/f39349f3.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小江</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师邮箱可以提供一下吗，咨询一个问题，经过btrace增强后class文件错误问题
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/84/4d/97691ff9.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>自来也</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-08-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   示例应该用jdk.internal.org.objectweb.asm.*包吧？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |36          |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:49:20.942 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=36 
 {executed in 2 msec}
2020-11-19 20:49:20.944 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|36        |book   |0     |zh-hans  |36          |https://static001.geekbang.org/resource/image/66/0d/669bb4c80fbee3c69aee0316c37ed90d.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:49:20.969 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=36 
 {executed in 1 msec}
2020-11-19 20:49:20.972 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |36          |https://static001.geekbang.org/resource/image/66/0d/669bb4c80fbee3c69aee0316c37ed90d.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:49:21.018 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=36 
 {executed in 2 msec}
2020-11-19 20:49:21.020 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |36          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:49:21.047 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=36 
 {executed in 1 msec}
2020-11-19 20:49:21.049 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |36          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:49:21.074 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='286728008047880' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:49:21.075 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|73      |286728008047880 |0   |net_content |
|--------|----------------|----|------------|

