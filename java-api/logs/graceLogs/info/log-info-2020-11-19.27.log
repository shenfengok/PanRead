2020-11-19 20:38:09.713 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605789489, created=1605789489, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='35丨Truffle：语言实现框架', 
uid=1, vid=6 where nid=6 
 {executed in 1 msec}
2020-11-19 20:38:09.731 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=6 
 {executed in 1 msec}
2020-11-19 20:38:09.735 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |revision_id |
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|6         |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/e0e0f4bc6950b27eacd170ea4ec8ad00?bkt=en-cf7b18a7c51d907898a13b7b13545e0631f5e9d952cf07106eb82a74e8ea7ec5d9f691d08e27d0ae&fid=3757516097-778750-325310494857404&time=1605787562&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-1ilXD5sRfrMdbcOILHa8vraY91o%3D&to=92&size=7045399&sta_dx=7045399&sta_cs=4354&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182980&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=7045399&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-0236cfb400f2c681bafe60d7a3d30056dbc0edd38db81fb185d10b31b96df0c9a988ad2b8fbac99d&sl=76480590&expires=8h&rt=pr&r=902824947&mlogid=7510706658692788843&vbdid=64799653&fin=35%E4%B8%A8Truffle%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%A1%86%E6%9E%B6.mp3&bflag=92,34-92&rtype=1&dp-logid=7510706658692788843&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=92f9da3c8a3331aef8ad8cac1a175ced59f9084240b7ae57&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=35%E4%B8%A8Truffle%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%A1%86%E6%9E%B6.mp3 |6           |
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:38:09.751 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=6 
 {executed in 1 msec}
2020-11-19 20:38:09.755 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |revision_id |
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/e0e0f4bc6950b27eacd170ea4ec8ad00?bkt=en-cf7b18a7c51d907898a13b7b13545e0631f5e9d952cf07106eb82a74e8ea7ec5d9f691d08e27d0ae&fid=3757516097-778750-325310494857404&time=1605787562&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-1ilXD5sRfrMdbcOILHa8vraY91o%3D&to=92&size=7045399&sta_dx=7045399&sta_cs=4354&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182980&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=7045399&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-0236cfb400f2c681bafe60d7a3d30056dbc0edd38db81fb185d10b31b96df0c9a988ad2b8fbac99d&sl=76480590&expires=8h&rt=pr&r=902824947&mlogid=7510706658692788843&vbdid=64799653&fin=35%E4%B8%A8Truffle%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%A1%86%E6%9E%B6.mp3&bflag=92,34-92&rtype=1&dp-logid=7510706658692788843&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=92f9da3c8a3331aef8ad8cac1a175ced59f9084240b7ae57&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=35%E4%B8%A8Truffle%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%A1%86%E6%9E%B6.mp3 |6           |
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:38:09.769 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=6 
 {executed in 2 msec}
2020-11-19 20:38:09.773 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|6         |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a9/84/c87b51ce.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>xiaobang</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   感觉truffle的特化和pypy的做法有点像，老师能否评价一下这两者呢？另外，truffle的特化相当于对每份目标语言源码都要搞一个新目标语言解释器，这样似乎比较耗时间，而性能测试说明性能比其它解释器要高，能解释一下为什么吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 是挺像的。你可以看看Stefan Marr的专业学术文章<br>http://stefan-marr.de/papers/oopsla-marr-ducasse-meta-tracing-vs-partial-evaluation/<br><br>Truffle解释器本身会被partial evaluation和即时编译，相当于即时编译新目标语言了</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLqDHFficypYouwztiatvzQWAPHt2X8R0Qge0iaat9dhfTjb0AFeicS3kjWJEjjMCSbwcoCYBOjK9aia8A/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>zzj</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-27
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   想问下对于没有垃圾回收的语言，如 C++，经过 Truffle 解释后，在 JVM 上运行的时候还有 GC 吗？是有 native 方法直接调用对象的析构吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |6           |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:38:09.786 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=6 
 {executed in 2 msec}
2020-11-19 20:38:09.791 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a9/84/c87b51ce.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>xiaobang</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-15
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   感觉truffle的特化和pypy的做法有点像，老师能否评价一下这两者呢？另外，truffle的特化相当于对每份目标语言源码都要搞一个新目标语言解释器，这样似乎比较耗时间，而性能测试说明性能比其它解释器要高，能解释一下为什么吗
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 是挺像的。你可以看看Stefan Marr的专业学术文章<br>http://stefan-marr.de/papers/oopsla-marr-ducasse-meta-tracing-vs-partial-evaluation/<br><br>Truffle解释器本身会被partial evaluation和即时编译，相当于即时编译新目标语言了</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLqDHFficypYouwztiatvzQWAPHt2X8R0Qge0iaat9dhfTjb0AFeicS3kjWJEjjMCSbwcoCYBOjK9aia8A/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>zzj</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-03-27
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   想问下对于没有垃圾回收的语言，如 C++，经过 Truffle 解释后，在 JVM 上运行的时候还有 GC 吗？是有 native 方法直接调用对象的析构吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li> |0     |full_html            |zh-hans  |6           |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:38:09.805 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=6 
 {executed in 2 msec}
2020-11-19 20:38:09.807 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|6         |book   |0     |zh-hans  |6           |https://static001.geekbang.org/resource/image/a8/1c/a8388be707545fcb7a875c40c37f6c1c.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:38:09.816 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=6 
 {executed in 1 msec}
2020-11-19 20:38:09.818 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |6           |https://static001.geekbang.org/resource/image/a8/1c/a8388be707545fcb7a875c40c37f6c1c.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:38:09.827 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=6 
 {executed in 1 msec}
2020-11-19 20:38:09.829 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |6           |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:38:09.837 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=6 
 {executed in 2 msec}
2020-11-19 20:38:09.839 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |6           |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:38:09.846 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='262043916344024' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:38:09.848 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|19      |262043916344024 |0   |net_content |
|--------|----------------|----|------------|

2020-11-19 20:38:26.839 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='262043916344024' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:38:26.842 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|19      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:38:26.854 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='262043916344024', got=1, name='net_content' where item_id=19 
 {executed in 2 msec}
2020-11-19 20:38:26.868 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='262043916344024' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:38:26.870 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------|
|item_id |fsid            |got |name  |
|--------|----------------|----|------|
|20      |262043916344024 |1   |media |
|--------|----------------|----|------|

2020-11-19 20:38:26.874 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='262043916344024' 
 {executed in 1 msec}
2020-11-19 20:38:26.876 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|7         |book   |0     |262043916344024  |zh-hans  |7           |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:38:26.880 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=7 
 {executed in 1 msec}
2020-11-19 20:38:26.882 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|7   |zh-hans  |book |81bc4693-9eb4-473b-8afa-d361f74844be |7   |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:38:26.892 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=7 
 {executed in 2 msec}
2020-11-19 20:38:26.894 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |262043916344024  |zh-hans  |7           |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:38:26.902 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=7 
 {executed in 1 msec}
2020-11-19 20:38:26.905 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|7   |1   |3     |0            |1  |4  |7  |0  |0  |4   |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:38:26.915 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=7 
 {executed in 3 msec}
2020-11-19 20:38:26.923 INFO  jdbc.resultsettable Line:610 - 
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|7         |<p>最后这三篇文章，我将介绍 Oracle Labs 的 GraalVM 项目。</p> 
<p>GraalVM 是一个高性能的、支持多种编程语言的执行环境。它既可以在传统的 OpenJDK 上运行，也可以通过 AOT（Ahead-Of-Time）编译成可执行文件单独运行，甚至可以集成至数据库中运行。</p> 
<p>除此之外，它还移除了编程语言之间的边界，并且支持通过即时编译技术，将混杂了不同的编程语言的代码编译到同一段二进制码之中，从而实现不同语言之间的无缝切换。</p> 
<p>今天这一篇，我们就来讲讲 GraalVM 的基石 Graal 编译器。</p> 
<p>在之前的篇章中，特别是介绍即时编译技术的第二部分，我们反反复复提到了 Graal 编译器。这是一个用 Java 写就的即时编译器，它从 Java 9u 开始便被集成自 JDK 中，作为实验性质的即时编译器。</p> 
<p>Graal 编译器可以通过 Java 虚拟机参数<code>-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler</code>启用。当启用时，它将替换掉 HotSpot 中的 C2 编译器，并响应原本由 C2 负责的编译请求。</p> 
<p>在今天的文章中，我将详细跟你介绍一下 Graal 与 Java 虚拟机的交互、Graal 和 C2 的区别以及 Graal 的实现细节。</p><!-- [[[read_end]]] --> 
<h2>Graal 和 Java 虚拟机的交互</h2> 
<p>我们知道，即时编译器是 Java 虚拟机中相对独立的模块，它主要负责接收 Java 字节码，并生成可以直接运行的二进制码。</p> 
<p>具体来说，即时编译器与 Java 虚拟机的交互可以分为如下三个方面。</p> 
<ol> 
 <li>响应编译请求；</li> 
 <li>获取编译所需的元数据（如类、方法、字段）和反映程序执行状态的 profile；</li> 
 <li>将生成的二进制码部署至代码缓存（code cache）里。</li> 
</ol> 
<p>即时编译器通过这三个功能组成了一个响应编译请求、获取编译所需的数据，完成编译并部署的完整编译周期。</p> 
<p>传统情况下，即时编译器是与 Java 虚拟机紧耦合的。也就是说，对即时编译器的更改需要重新编译整个 Java 虚拟机。这对于开发相对活跃的 Graal 来说显然是不可接受的。</p> 
<p>为了让 Java 虚拟机与 Graal 解耦合，我们引入了<a href="http://openjdk.java.net/jeps/243">Java 虚拟机编译器接口</a>（JVM Compiler Interface，JVMCI），将上述三个功能抽象成一个 Java 层面的接口。这样一来，在 Graal 所依赖的 JVMCI 版本不变的情况下，我们仅需要替换 Graal 编译器相关的 jar 包（Java 9 以后的 jmod 文件），便可完成对 Graal 的升级。</p> 
<p>JVMCI 的作用并不局限于完成由 Java 虚拟机发出的编译请求。实际上，Java 程序可以直接调用 Graal，编译并部署指定方法。</p> 
<p>Graal 的单元测试便是基于这项技术。为了测试某项优化是否起作用，原本我们需要反复运行某一测试方法，直至 Graal 收到由 Java 虚拟机发出针对该方法的编译请求，而现在我们可以直接指定编译该方法，并进行测试。我们下一篇将介绍的 Truffle 语言实现框架，同样也是基于这项技术的。</p> 
<h2>Graal 和 C2 的区别</h2> 
<p>Graal 和 C2 最为明显的一个区别是：Graal 是用 Java 写的，而 C2 是用 C++ 写的。相对来说，Graal 更加模块化，也更容易开发与维护，毕竟，连 C2 的作者 Cliff Click 大神都不想重蹈用 C++ 开发 Java 虚拟机的覆辙。</p> 
<p>许多开发者会觉得用 C++ 写的 C2 肯定要比 Graal 快。实际上，在充分预热的情况下，Java 程序中的热点代码早已经通过即时编译转换为二进制码，在执行速度上并不亚于静态编译的 C++ 程序。</p> 
<p>再者，即便是解释执行 Graal，也仅是会减慢编译效率，而并不影响编译结果的性能。</p> 
<p>换句话说，如果 C2 和 Graal 采用相同的优化手段，那么它们的编译结果是一样的。所以，程序达到稳定状态（即不再触发新的即时编译）的性能，也就是峰值性能，将也是一样的。</p> 
<p>由于 Java 语言容易开发维护的优势，我们可以很方便地将 C2 的新优化移植到 Graal 中。反之则不然，比如，在 Graal 中被证实有效的部分逃逸分析（partial escape analysis）至今未被移植到 C2 中。</p> 
<p>Graal 和 C2 另一个优化上的分歧则是方法内联算法。相对来说，Graal 的内联算法对新语法、新语言更加友好，例如 Java 8 的 lambda 表达式以及 Scala 语言。</p> 
<p>我们曾统计过数十个 Java 或 Scala 程序的峰值性能。总体而言，Graal 编译结果的性能要优于 C2。对于 Java 程序来说，Graal 的优势并不明显；对于 Scala 程序来说，Graal 的性能优势达到了 10%。</p> 
<p>大规模使用 Scala 的 Twitter 便在他们的生产环境中部署了 Graal 编译器，并取得了 11% 的性能提升。（<a href="https://downloads.ctfassets.net/oxjq45e8ilak/6eh2A72b4IyWsWOIcig4K0/cbb664566fe86672d92ddfb210623920/Chris_Thalinger_Twitter_s_quest_for_a_wholly_Graal_runtime.pdf">Slides</a>, <a href="https://youtu.be/G-vlQaPMAxg?t=20m15s">Video</a>，该数据基于 GraalVM 社区版。）</p> 
<h2>Graal 的实现</h2> 
<p>Graal 编译器将编译过程分为前端和后端两大部分。前端用于实现平台无关的优化（如方法内联），以及小部分平台相关的优化；而后端则负责大部分的平台相关优化（如寄存器分配），以及机器码的生成。</p> 
<p>在介绍即时编译技术时，我曾提到过，Graal 和 C2 都采用了 Sea-of-Nodes IR。严格来说，这里指的是 Graal 的前端，而后端采用的是另一种非 Sea-of-Nodes 的 IR。通常，我们将前端的 IR 称之为 High-level IR，或者 HIR；后端的 IR 则称之为 Low-level IR，或者 LIR。</p> 
<p>Graal 的前端是由一个个单独的优化阶段（optimization phase）构成的。我们可以将每个优化阶段想象成一个图算法：它会接收一个规则的图，遍历图上的节点并做出优化，并且返回另一个规则的图。前端中的编译阶段除了少数几个关键的之外，其余均可以通过配置选项来开启或关闭。</p> 
<p><img src="https://static001.geekbang.org/resource/image/d9/b8/d9772c569c25eabb7c2e7af53878e3b8.png" alt=""></p> 
<p>Graal 编译器前端的优化阶段（局部）</p> 
<blockquote> 
 <p>感兴趣的同学可以阅读 Graal repo 里配置这些编译优化阶段的源文件<br> <a href="https://github.com/oracle/graal/blob/master/compiler/src/org.graalvm.compiler.core/src/org/graalvm/compiler/core/phases/HighTier.java">HighTier.java</a>，<a href="https://github.com/oracle/graal/blob/master/compiler/src/org.graalvm.compiler.core/src/org/graalvm/compiler/core/phases/MidTier.java">MidTier.java</a>，以及<a href="https://github.com/oracle/graal/blob/master/compiler/src/org.graalvm.compiler.core/src/org/graalvm/compiler/core/phases/LowTier.java">LowTier.java</a>。</p> 
</blockquote> 
<p>我们知道，Graal 和 C2 都采用了激进的投机性优化手段（speculative optimization）。</p> 
<p>通常，这些优化都基于某种假设（assumption）。当假设出错的情况下，Java 虚拟机会借助去优化（deoptimization）这项机制，从执行即时编译器生成的机器码切换回解释执行，在必要情况下，它甚至会废弃这份机器码，并在重新收集程序 profile 之后，再进行编译。</p> 
<p>举个以前讲过的例子，类层次分析。在进行虚方法内联时（或者其他与类层次相关的优化），我们可能会发现某个接口仅有一个实现。</p> 
<p>在即时编译过程中，我们可以假设在之后的执行过程中仍旧只有这一个实现，并根据这个假设进行编译优化。当之后加载了接口的另一实现时，我们便会废弃这份机器码。</p> 
<p>Graal 与 C2 相比会更加激进。它从设计上便十分青睐这种基于假设的优化手段。在编译过程中，Graal 支持自定义假设，并且直接与去优化节点相关联。</p> 
<p>当对应的去优化被触发时，Java 虚拟机将负责记录对应的自定义假设。而 Graal 在第二次编译同一方法时，便会知道该自定义假设有误，从而不再对该方法使用相同的激进优化。</p> 
<p>Java 虚拟机的另一个能够大幅度提升性能的特性是 intrinsic 方法，我在之前的篇章中已经详细介绍过了。在 Graal 中，实现高性能的 intrinsic 方法也相对比较简单。Graal 提供了一种替换方法调用的机制，在解析 Java 字节码时会将匹配到的方法调用，替换成对另一个内部方法的调用，或者直接替换为特殊节点。</p> 
<p>举例来说，我们可以把比较两个 byte 数组的方法<code>java.util.Arrays.equals(byte[],byte[])</code>替换成一个特殊节点，用来代表整个数组比较的逻辑。这样一来，当前编译方法所对应的图将被简化，因而其适用于其他优化的可能性也将提升。</p> 
<h2>总结与实践</h2> 
<p>Graal 是一个用 Java 写就的、并能够将 Java 字节码转换成二进制码的即时编译器。它通过 JVMCI 与 Java 虚拟机交互，响应由后者发出的编译请求、完成编译并部署编译结果。</p> 
<p>对 Java 程序而言，Graal 编译结果的性能略优于 OpenJDK 中的 C2；对 Scala 程序而言，它的性能优势可达到 10%（企业版甚至可以达到 20%！）。这背后离不开 Graal 所采用的激进优化方式。</p> 
<hr> 
<p>今天的实践环节，你可以尝试使用附带 Graal 编译器的 JDK。在 Java 10，11 中，你可以通过添加虚拟机参数<code>-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler</code>来启用，或者下载我们部署在<a href="https://www.oracle.com/technetwork/oracle-labs/program-languages/downloads/index.html">Oracle OTN</a>上的基于 Java 8 的版本。</p> 
<blockquote> 
 <p>在刚开始运行的过程中，Graal 编译器本身需要被即时编译，会抢占原本可用于编译应用代码的计算资源。因此，目前 Graal 编译器的启动性能会较差。最后一篇我会介绍解决方案。</p> 
</blockquote> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |7           |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:38:26.930 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=7 
 {executed in 2 msec}
2020-11-19 20:38:26.938 INFO  jdbc.resultsettable Line:610 - 
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>最后这三篇文章，我将介绍 Oracle Labs 的 GraalVM 项目。</p> 
<p>GraalVM 是一个高性能的、支持多种编程语言的执行环境。它既可以在传统的 OpenJDK 上运行，也可以通过 AOT（Ahead-Of-Time）编译成可执行文件单独运行，甚至可以集成至数据库中运行。</p> 
<p>除此之外，它还移除了编程语言之间的边界，并且支持通过即时编译技术，将混杂了不同的编程语言的代码编译到同一段二进制码之中，从而实现不同语言之间的无缝切换。</p> 
<p>今天这一篇，我们就来讲讲 GraalVM 的基石 Graal 编译器。</p> 
<p>在之前的篇章中，特别是介绍即时编译技术的第二部分，我们反反复复提到了 Graal 编译器。这是一个用 Java 写就的即时编译器，它从 Java 9u 开始便被集成自 JDK 中，作为实验性质的即时编译器。</p> 
<p>Graal 编译器可以通过 Java 虚拟机参数<code>-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler</code>启用。当启用时，它将替换掉 HotSpot 中的 C2 编译器，并响应原本由 C2 负责的编译请求。</p> 
<p>在今天的文章中，我将详细跟你介绍一下 Graal 与 Java 虚拟机的交互、Graal 和 C2 的区别以及 Graal 的实现细节。</p><!-- [[[read_end]]] --> 
<h2>Graal 和 Java 虚拟机的交互</h2> 
<p>我们知道，即时编译器是 Java 虚拟机中相对独立的模块，它主要负责接收 Java 字节码，并生成可以直接运行的二进制码。</p> 
<p>具体来说，即时编译器与 Java 虚拟机的交互可以分为如下三个方面。</p> 
<ol> 
 <li>响应编译请求；</li> 
 <li>获取编译所需的元数据（如类、方法、字段）和反映程序执行状态的 profile；</li> 
 <li>将生成的二进制码部署至代码缓存（code cache）里。</li> 
</ol> 
<p>即时编译器通过这三个功能组成了一个响应编译请求、获取编译所需的数据，完成编译并部署的完整编译周期。</p> 
<p>传统情况下，即时编译器是与 Java 虚拟机紧耦合的。也就是说，对即时编译器的更改需要重新编译整个 Java 虚拟机。这对于开发相对活跃的 Graal 来说显然是不可接受的。</p> 
<p>为了让 Java 虚拟机与 Graal 解耦合，我们引入了<a href="http://openjdk.java.net/jeps/243">Java 虚拟机编译器接口</a>（JVM Compiler Interface，JVMCI），将上述三个功能抽象成一个 Java 层面的接口。这样一来，在 Graal 所依赖的 JVMCI 版本不变的情况下，我们仅需要替换 Graal 编译器相关的 jar 包（Java 9 以后的 jmod 文件），便可完成对 Graal 的升级。</p> 
<p>JVMCI 的作用并不局限于完成由 Java 虚拟机发出的编译请求。实际上，Java 程序可以直接调用 Graal，编译并部署指定方法。</p> 
<p>Graal 的单元测试便是基于这项技术。为了测试某项优化是否起作用，原本我们需要反复运行某一测试方法，直至 Graal 收到由 Java 虚拟机发出针对该方法的编译请求，而现在我们可以直接指定编译该方法，并进行测试。我们下一篇将介绍的 Truffle 语言实现框架，同样也是基于这项技术的。</p> 
<h2>Graal 和 C2 的区别</h2> 
<p>Graal 和 C2 最为明显的一个区别是：Graal 是用 Java 写的，而 C2 是用 C++ 写的。相对来说，Graal 更加模块化，也更容易开发与维护，毕竟，连 C2 的作者 Cliff Click 大神都不想重蹈用 C++ 开发 Java 虚拟机的覆辙。</p> 
<p>许多开发者会觉得用 C++ 写的 C2 肯定要比 Graal 快。实际上，在充分预热的情况下，Java 程序中的热点代码早已经通过即时编译转换为二进制码，在执行速度上并不亚于静态编译的 C++ 程序。</p> 
<p>再者，即便是解释执行 Graal，也仅是会减慢编译效率，而并不影响编译结果的性能。</p> 
<p>换句话说，如果 C2 和 Graal 采用相同的优化手段，那么它们的编译结果是一样的。所以，程序达到稳定状态（即不再触发新的即时编译）的性能，也就是峰值性能，将也是一样的。</p> 
<p>由于 Java 语言容易开发维护的优势，我们可以很方便地将 C2 的新优化移植到 Graal 中。反之则不然，比如，在 Graal 中被证实有效的部分逃逸分析（partial escape analysis）至今未被移植到 C2 中。</p> 
<p>Graal 和 C2 另一个优化上的分歧则是方法内联算法。相对来说，Graal 的内联算法对新语法、新语言更加友好，例如 Java 8 的 lambda 表达式以及 Scala 语言。</p> 
<p>我们曾统计过数十个 Java 或 Scala 程序的峰值性能。总体而言，Graal 编译结果的性能要优于 C2。对于 Java 程序来说，Graal 的优势并不明显；对于 Scala 程序来说，Graal 的性能优势达到了 10%。</p> 
<p>大规模使用 Scala 的 Twitter 便在他们的生产环境中部署了 Graal 编译器，并取得了 11% 的性能提升。（<a href="https://downloads.ctfassets.net/oxjq45e8ilak/6eh2A72b4IyWsWOIcig4K0/cbb664566fe86672d92ddfb210623920/Chris_Thalinger_Twitter_s_quest_for_a_wholly_Graal_runtime.pdf">Slides</a>, <a href="https://youtu.be/G-vlQaPMAxg?t=20m15s">Video</a>，该数据基于 GraalVM 社区版。）</p> 
<h2>Graal 的实现</h2> 
<p>Graal 编译器将编译过程分为前端和后端两大部分。前端用于实现平台无关的优化（如方法内联），以及小部分平台相关的优化；而后端则负责大部分的平台相关优化（如寄存器分配），以及机器码的生成。</p> 
<p>在介绍即时编译技术时，我曾提到过，Graal 和 C2 都采用了 Sea-of-Nodes IR。严格来说，这里指的是 Graal 的前端，而后端采用的是另一种非 Sea-of-Nodes 的 IR。通常，我们将前端的 IR 称之为 High-level IR，或者 HIR；后端的 IR 则称之为 Low-level IR，或者 LIR。</p> 
<p>Graal 的前端是由一个个单独的优化阶段（optimization phase）构成的。我们可以将每个优化阶段想象成一个图算法：它会接收一个规则的图，遍历图上的节点并做出优化，并且返回另一个规则的图。前端中的编译阶段除了少数几个关键的之外，其余均可以通过配置选项来开启或关闭。</p> 
<p><img src="https://static001.geekbang.org/resource/image/d9/b8/d9772c569c25eabb7c2e7af53878e3b8.png" alt=""></p> 
<p>Graal 编译器前端的优化阶段（局部）</p> 
<blockquote> 
 <p>感兴趣的同学可以阅读 Graal repo 里配置这些编译优化阶段的源文件<br> <a href="https://github.com/oracle/graal/blob/master/compiler/src/org.graalvm.compiler.core/src/org/graalvm/compiler/core/phases/HighTier.java">HighTier.java</a>，<a href="https://github.com/oracle/graal/blob/master/compiler/src/org.graalvm.compiler.core/src/org/graalvm/compiler/core/phases/MidTier.java">MidTier.java</a>，以及<a href="https://github.com/oracle/graal/blob/master/compiler/src/org.graalvm.compiler.core/src/org/graalvm/compiler/core/phases/LowTier.java">LowTier.java</a>。</p> 
</blockquote> 
<p>我们知道，Graal 和 C2 都采用了激进的投机性优化手段（speculative optimization）。</p> 
<p>通常，这些优化都基于某种假设（assumption）。当假设出错的情况下，Java 虚拟机会借助去优化（deoptimization）这项机制，从执行即时编译器生成的机器码切换回解释执行，在必要情况下，它甚至会废弃这份机器码，并在重新收集程序 profile 之后，再进行编译。</p> 
<p>举个以前讲过的例子，类层次分析。在进行虚方法内联时（或者其他与类层次相关的优化），我们可能会发现某个接口仅有一个实现。</p> 
<p>在即时编译过程中，我们可以假设在之后的执行过程中仍旧只有这一个实现，并根据这个假设进行编译优化。当之后加载了接口的另一实现时，我们便会废弃这份机器码。</p> 
<p>Graal 与 C2 相比会更加激进。它从设计上便十分青睐这种基于假设的优化手段。在编译过程中，Graal 支持自定义假设，并且直接与去优化节点相关联。</p> 
<p>当对应的去优化被触发时，Java 虚拟机将负责记录对应的自定义假设。而 Graal 在第二次编译同一方法时，便会知道该自定义假设有误，从而不再对该方法使用相同的激进优化。</p> 
<p>Java 虚拟机的另一个能够大幅度提升性能的特性是 intrinsic 方法，我在之前的篇章中已经详细介绍过了。在 Graal 中，实现高性能的 intrinsic 方法也相对比较简单。Graal 提供了一种替换方法调用的机制，在解析 Java 字节码时会将匹配到的方法调用，替换成对另一个内部方法的调用，或者直接替换为特殊节点。</p> 
<p>举例来说，我们可以把比较两个 byte 数组的方法<code>java.util.Arrays.equals(byte[],byte[])</code>替换成一个特殊节点，用来代表整个数组比较的逻辑。这样一来，当前编译方法所对应的图将被简化，因而其适用于其他优化的可能性也将提升。</p> 
<h2>总结与实践</h2> 
<p>Graal 是一个用 Java 写就的、并能够将 Java 字节码转换成二进制码的即时编译器。它通过 JVMCI 与 Java 虚拟机交互，响应由后者发出的编译请求、完成编译并部署编译结果。</p> 
<p>对 Java 程序而言，Graal 编译结果的性能略优于 OpenJDK 中的 C2；对 Scala 程序而言，它的性能优势可达到 10%（企业版甚至可以达到 20%！）。这背后离不开 Graal 所采用的激进优化方式。</p> 
<hr> 
<p>今天的实践环节，你可以尝试使用附带 Graal 编译器的 JDK。在 Java 10，11 中，你可以通过添加虚拟机参数<code>-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler</code>来启用，或者下载我们部署在<a href="https://www.oracle.com/technetwork/oracle-labs/program-languages/downloads/index.html">Oracle OTN</a>上的基于 Java 8 的版本。</p> 
<blockquote> 
 <p>在刚开始运行的过程中，Graal 编译器本身需要被即时编译，会抢占原本可用于编译应用代码的计算资源。因此，目前 Graal 编译器的启动性能会较差。最后一篇我会介绍解决方案。</p> 
</blockquote> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |7           |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:38:26.952 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=7 
 {executed in 1 msec}
2020-11-19 20:38:26.955 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------------|-----|----|----|
|7   |1605789254 |1605789254 |1                |zh-hans  |0       |1                             |1      |0      |34丨Graal：用Java编译Java |book |1   |7   |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------------|-----|----|----|

2020-11-19 20:38:26.959 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=7 
 {executed in 1 msec}
2020-11-19 20:38:26.962 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------------|----|----|
|[unread] |1605789254 |1605789254 |1                |zh-hans  |0       |1                             |1      |0      |34丨Graal：用Java编译Java |1   |7   |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------------|----|----|

2020-11-19 20:38:26.968 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605789506, created=1605789506, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='34丨Graal：用Java编译Java', 
type='book', uid=1, vid=7 where nid=7 
 {executed in 2 msec}
2020-11-19 20:38:26.970 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605789506, created=1605789506, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='34丨Graal：用Java编译Java', 
uid=1, vid=7 where nid=7 
 {executed in 1 msec}
2020-11-19 20:38:26.981 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=7 
 {executed in 1 msec}
2020-11-19 20:38:26.984 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |revision_id |
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|7         |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/3839ea98460c8033bcc04caaca95805d?bkt=en-e031c0692dcd5a21b4cb7693111845c799e7a33b95ee208f83d98238dd71076ab1a1fb36cbbfab68&fid=3757516097-778750-511946819806664&time=1605787580&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-zUrwAvN8xp8JybnaLwf9PApzzMA%3D&to=92&size=4240475&sta_dx=4240475&sta_cs=2379&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182978&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=4240475&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-0bed853b34fed20e346cb63060a4d426e2eeb5c8b88abaa22da8d88f66548dd80dc31f58d430af19&sl=76480590&expires=8h&rt=pr&r=759710454&mlogid=7510711450029573311&vbdid=64799653&fin=34%E4%B8%A8Graal%EF%BC%9A%E7%94%A8Java%E7%BC%96%E8%AF%91Java.mp3&bflag=92,34-92&rtype=1&dp-logid=7510711450029573311&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=1fcc15f39be93977ac68f640bb9f6eada1b6ed7493807f0a&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=34%E4%B8%A8Graal%EF%BC%9A%E7%94%A8Java%E7%BC%96%E8%AF%91Java.mp3 |7           |
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:38:26.997 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=7 
 {executed in 1 msec}
2020-11-19 20:38:27.000 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |revision_id |
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/3839ea98460c8033bcc04caaca95805d?bkt=en-e031c0692dcd5a21b4cb7693111845c799e7a33b95ee208f83d98238dd71076ab1a1fb36cbbfab68&fid=3757516097-778750-511946819806664&time=1605787580&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-zUrwAvN8xp8JybnaLwf9PApzzMA%3D&to=92&size=4240475&sta_dx=4240475&sta_cs=2379&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182978&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=4240475&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-0bed853b34fed20e346cb63060a4d426e2eeb5c8b88abaa22da8d88f66548dd80dc31f58d430af19&sl=76480590&expires=8h&rt=pr&r=759710454&mlogid=7510711450029573311&vbdid=64799653&fin=34%E4%B8%A8Graal%EF%BC%9A%E7%94%A8Java%E7%BC%96%E8%AF%91Java.mp3&bflag=92,34-92&rtype=1&dp-logid=7510711450029573311&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=1fcc15f39be93977ac68f640bb9f6eada1b6ed7493807f0a&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=34%E4%B8%A8Graal%EF%BC%9A%E7%94%A8Java%E7%BC%96%E8%AF%91Java.mp3 |7           |
|----------|-------|------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:38:27.009 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=7 
 {executed in 1 msec}
2020-11-19 20:38:27.016 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |delta |field_comment_format |langcode |revision_id |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|7         |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/2f/b7a3625e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>LenX</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-12
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   我们可不可以把 profile 和编译的机器码保存到磁盘，在代码和运行平台不变的情况下，下次启动（或部署多实例）的时候直接装载这部分数据？这算作是一种系统预热的可行性方案吗？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 赞想法！已经有这种做法，但同时需要承担profile不能反映当前执行状态的风险。可以了解一下Alibaba的JWarmup。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/1e/a5/85b05303.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>金龙</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   GraalVM和JVM是什么关系？它在OpenJDK上是怎么运行的？求解惑
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 你可以将GraalVM看成泛指带Graal编译器的虚拟机。<br><br>在OpenJDK 10和11，可以直接UnlockExperimentalOptions UseJVMCICompiler开启。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/be/c6/8a92bd2e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>ZY</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-16
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   GraalVM大概什么时候会发布release版本？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: Soon :)<br><br>如果只是用HotSpot中的Graal编译器，那已经挺成熟了，Twitter已经全面部署了。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   阅过留痕
   <br>最后几篇了，这个专栏马上结束了，回头想想自己都学到了那些内容了呢？
   <br>JVM的各个部分从外到内，由浅入深老师都讲到了，大部分内容是都挺明白了，有些还有待消化，不过下面还要继续的学习，专栏的目标是带我们入门！
   <br>
   <br>本节讲解的Graal先混个脸熟，以后继续深入
   <br>
   <br>1：Graal是一个编译器，是使用java语言编写的编译器，既然是编译器就拥有编译器的各种特点（主要负责接收JAVA字节码，并且声称可以直接运行的二进制码），当然，后来者通常比先来的会多一些特点，否则也没有必要来啦！Graal性能相对来说更好一点、更具模块化、更易维护（相对C2而言）Graal编译器是一个即时编译器，从JDK9就被集成到JDK中了，当然，可能还不成熟时作为一个实验性质的编译器集成到JDK中的，可以有选择的行的启动或者关闭。
   <br>
   <br>2：Graal编译器是GraalVm的基石，编译器是VM的一部分，相对来说比较独立，它和JVM的交互主要有如下三部分，
   <br>2-1）响应变异请求
   <br>2-2）获取编译所需的元数据（如：类、方法、字段）和反应程序执行状态的profile
   <br>2-3）将生成的二进制码不熟至代码缓存里
   <br>
   <br>3：Graal和JVM通过JVMCI来实现解耦，本质是通过java语言层面的接口来实现解耦的
   <br>
   <br>嗯，感觉有些懵懂，专栏快结束了，老师辛苦了，希望老师来点随学随用的分析jvm性能瓶颈和解决方式的例子，当然，这个部分内容网上也比较多，只是希望更系统一点，举几个高频的示例！
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a9/84/c87b51ce.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>xiaobang</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   openjdk里Graal自身的及时编译是调用Graal自身吗？如果这么做会不会出现无穷递归？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 1. 默认情况下，是用C1编译Graal。<br>2. 调用Graal编译Graal并不会造成无穷递归。因为JVM里有解释执行器，能够执行Graal代码。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/47/80/31e03c1b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Nthan89757</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   求证: 同样的代码，使用jdk1.6编译的和使用jdk1.8编译，在同样的jdk1.8的jvm环境运行，性能是否有差异？
   <br>是不是需要看1.6的javap和1.8的javap 出来的字节码是否有差别？
  </div> <!----> <!---->
 </div></li> |0     |full_html            |zh-hans  |7           |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:38:27.026 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=7 
 {executed in 1 msec}
2020-11-19 20:38:27.033 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |delta |field_comment_format |langcode |revision_id |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/2f/b7a3625e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>LenX</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-12
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   我们可不可以把 profile 和编译的机器码保存到磁盘，在代码和运行平台不变的情况下，下次启动（或部署多实例）的时候直接装载这部分数据？这算作是一种系统预热的可行性方案吗？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 赞想法！已经有这种做法，但同时需要承担profile不能反映当前执行状态的风险。可以了解一下Alibaba的JWarmup。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/1e/a5/85b05303.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>金龙</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-08
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   GraalVM和JVM是什么关系？它在OpenJDK上是怎么运行的？求解惑
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 你可以将GraalVM看成泛指带Graal编译器的虚拟机。<br><br>在OpenJDK 10和11，可以直接UnlockExperimentalOptions UseJVMCICompiler开启。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/be/c6/8a92bd2e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>ZY</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-16
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   GraalVM大概什么时候会发布release版本？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: Soon :)<br><br>如果只是用HotSpot中的Graal编译器，那已经挺成熟了，Twitter已经全面部署了。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-14
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   阅过留痕
   <br>最后几篇了，这个专栏马上结束了，回头想想自己都学到了那些内容了呢？
   <br>JVM的各个部分从外到内，由浅入深老师都讲到了，大部分内容是都挺明白了，有些还有待消化，不过下面还要继续的学习，专栏的目标是带我们入门！
   <br>
   <br>本节讲解的Graal先混个脸熟，以后继续深入
   <br>
   <br>1：Graal是一个编译器，是使用java语言编写的编译器，既然是编译器就拥有编译器的各种特点（主要负责接收JAVA字节码，并且声称可以直接运行的二进制码），当然，后来者通常比先来的会多一些特点，否则也没有必要来啦！Graal性能相对来说更好一点、更具模块化、更易维护（相对C2而言）Graal编译器是一个即时编译器，从JDK9就被集成到JDK中了，当然，可能还不成熟时作为一个实验性质的编译器集成到JDK中的，可以有选择的行的启动或者关闭。
   <br>
   <br>2：Graal编译器是GraalVm的基石，编译器是VM的一部分，相对来说比较独立，它和JVM的交互主要有如下三部分，
   <br>2-1）响应变异请求
   <br>2-2）获取编译所需的元数据（如：类、方法、字段）和反应程序执行状态的profile
   <br>2-3）将生成的二进制码不熟至代码缓存里
   <br>
   <br>3：Graal和JVM通过JVMCI来实现解耦，本质是通过java语言层面的接口来实现解耦的
   <br>
   <br>嗯，感觉有些懵懂，专栏快结束了，老师辛苦了，希望老师来点随学随用的分析jvm性能瓶颈和解决方式的例子，当然，这个部分内容网上也比较多，只是希望更系统一点，举几个高频的示例！
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a9/84/c87b51ce.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>xiaobang</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-10
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   openjdk里Graal自身的及时编译是调用Graal自身吗？如果这么做会不会出现无穷递归？
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 1. 默认情况下，是用C1编译Graal。<br>2. 调用Graal编译Graal并不会造成无穷递归。因为JVM里有解释执行器，能够执行Graal代码。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/47/80/31e03c1b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Nthan89757</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-17
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   求证: 同样的代码，使用jdk1.6编译的和使用jdk1.8编译，在同样的jdk1.8的jvm环境运行，性能是否有差异？
   <br>是不是需要看1.6的javap和1.8的javap 出来的字节码是否有差别？
  </div> <!----> <!---->
 </div></li> |0     |full_html            |zh-hans  |7           |
|----------|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:38:27.045 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=7 
 {executed in 1 msec}
2020-11-19 20:38:27.046 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|7         |book   |0     |zh-hans  |7           |https://static001.geekbang.org/resource/image/5d/4f/5d3150591cf3ce11ea015dc0f276544f.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:38:27.056 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=7 
 {executed in 1 msec}
2020-11-19 20:38:27.059 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |7           |https://static001.geekbang.org/resource/image/5d/4f/5d3150591cf3ce11ea015dc0f276544f.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:38:27.067 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=7 
 {executed in 2 msec}
2020-11-19 20:38:27.070 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |7           |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:38:27.078 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=7 
 {executed in 1 msec}
2020-11-19 20:38:27.080 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |7           |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:38:27.090 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='68797280143866' 
 {executed in 2 msec}
2020-11-19 20:38:27.093 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|8         |book   |0     |68797280143866   |zh-hans  |8           |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:38:27.096 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=8 
 {executed in 1 msec}
2020-11-19 20:38:27.098 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|8   |zh-hans  |book |7108d4f7-6a6d-47a3-be7d-16441925f824 |8   |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:38:27.108 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.110 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |68797280143866   |zh-hans  |8           |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:38:27.117 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=8 
 {executed in 2 msec}
2020-11-19 20:38:27.119 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|8   |1   |2     |1            |1  |8  |0  |0  |0  |1   |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:38:27.128 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.130 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------|-------------|-------|------|------------|---------|------------|
|8         |           |             |book   |0     |full_html   |zh-hans  |8           |
|----------|-----------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:38:27.134 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=8 
 {executed in 2 msec}
2020-11-19 20:38:27.137 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------|-------------|-------|------|------------|---------|------------|
|[unread]  |           |             |book   |0     |full_html   |zh-hans  |8           |
|----------|-----------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:38:27.148 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=8 
 {executed in 1 msec}
2020-11-19 20:38:27.151 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title             |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------|-----|----|----|
|8   |1605789254 |1605789254 |1                |zh-hans  |0       |1                             |1      |0      |04-模块三：代码优化 (10讲) |book |1   |8   |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------|-----|----|----|

2020-11-19 20:38:27.156 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=8 
 {executed in 2 msec}
2020-11-19 20:38:27.158 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title             |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------|----|----|
|[unread] |1605789254 |1605789254 |1                |zh-hans  |0       |1                             |1      |0      |04-模块三：代码优化 (10讲) |1   |8   |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------------|----|----|

2020-11-19 20:38:27.164 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605789507, created=1605789507, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='04-模块三：代码优化 (10讲)', 
type='book', uid=1, vid=8 where nid=8 
 {executed in 1 msec}
2020-11-19 20:38:27.167 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605789507, created=1605789507, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='04-模块三：代码优化 
(10讲)', uid=1, vid=8 where nid=8 
 {executed in 1 msec}
2020-11-19 20:38:27.178 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.180 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value |revision_id |
|----------|-------|------|---------|------------------|------------|
|8         |book   |0     |zh-hans  |                  |8           |
|----------|-------|------|---------|------------------|------------|

2020-11-19 20:38:27.189 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.191 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value |revision_id |
|----------|-------|------|---------|------------------|------------|
|[unread]  |book   |0     |zh-hans  |                  |8           |
|----------|-------|------|---------|------------------|------------|

2020-11-19 20:38:27.198 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.202 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------|------|---------------------|---------|------------|
|8         |book   |                    |0     |full_html            |zh-hans  |8           |
|----------|-------|--------------------|------|---------------------|---------|------------|

2020-11-19 20:38:27.211 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.213 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------|------|---------------------|---------|------------|
|[unread]  |book   |                    |0     |full_html            |zh-hans  |8           |
|----------|-------|--------------------|------|---------------------|---------|------------|

2020-11-19 20:38:27.220 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.222 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value |
|----------|-------|------|---------|------------|------------------|
|8         |book   |0     |zh-hans  |8           |                  |
|----------|-------|------|---------|------------|------------------|

2020-11-19 20:38:27.230 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.232 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value |
|----------|-------|------|---------|------------|------------------|
|[unread]  |book   |0     |zh-hans  |8           |                  |
|----------|-------|------|---------|------------|------------------|

2020-11-19 20:38:27.241 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=8 
 {executed in 1 msec}
2020-11-19 20:38:27.243 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |8           |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:38:27.251 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=8 
 {executed in 2 msec}
2020-11-19 20:38:27.253 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |8           |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:38:29.254 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='893104461164599' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:38:29.258 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|21      |893104461164599 |0   |net_content |
|--------|----------------|----|------------|

2020-11-19 20:38:48.355 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='893104461164599' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:38:48.357 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|21      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:38:48.369 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='893104461164599', got=1, name='net_content' where item_id=21 
 {executed in 3 msec}
2020-11-19 20:38:48.381 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='893104461164599' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:38:48.383 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------|
|item_id |fsid            |got |name  |
|--------|----------------|----|------|
|22      |893104461164599 |1   |media |
|--------|----------------|----|------|

2020-11-19 20:38:48.386 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='893104461164599' 
 {executed in 1 msec}
2020-11-19 20:38:48.388 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|9         |book   |0     |893104461164599  |zh-hans  |9           |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:38:48.392 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=9 
 {executed in 2 msec}
2020-11-19 20:38:48.394 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|9   |zh-hans  |book |0721d64b-a8a7-4f52-ae5c-f799429aff93 |9   |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:38:48.402 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=9 
 {executed in 1 msec}
2020-11-19 20:38:48.404 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |893104461164599  |zh-hans  |9           |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:38:48.412 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=9 
 {executed in 1 msec}
2020-11-19 20:38:48.414 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|9   |1   |3     |0            |1  |8  |9  |0  |0  |8   |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:38:48.426 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=9 
 {executed in 3 msec}
2020-11-19 20:38:48.483 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|9         |<p>关于 Java agent，大家可能都听过大名鼎鼎的<code>premain</code>方法。顾名思义，这个方法指的就是在<code>main</code>方法之前执行的方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void premain(String args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("premain");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我在上面这段代码中定义了一个<code>premain</code>方法。这里需要注意的是，Java 虚拟机所能识别的<code>premain</code>方法接收的是字符串类型的参数，而并非类似于<code>main</code>方法的字符串数组。</p> 
<p>为了能够以 Java agent 的方式运行该<code>premain</code>方法，我们需要将其打包成 jar 包，并在其中的 MANIFEST.MF 配置文件中，指定所谓的<code>Premain-class</code>。具体的命令如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # 注意第一条命令会向 manifest.txt 文件写入两行数据，其中包括一行空行
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ echo 'Premain-Class: org.example.MyAgent
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ' &gt; manifest.txt
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jar cvmf manifest.txt myagent.jar org/
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -javaagent:myagent.jar HelloWorld
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       premain
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>除了在命令行中指定 Java agent 之外，我们还可以通过 Attach API 远程加载。具体用法如下面的代码所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.io.IOException;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import com.sun.tools.attach.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class AttachTest {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        throws AttachNotSupportedException, IOException, AgentLoadException, AgentInitializationException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (args.length &lt;= 1) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("Usage: java AttachTest &lt;PID&gt; /PATH/TO/AGENT.jar");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        VirtualMachine vm = VirtualMachine.attach(args[0]);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        vm.loadAgent(args[1]);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>使用 Attach API 远程加载的 Java agent 不会再先于<code>main</code>方法执行，这取决于另一虚拟机调用 Attach API 的时机。并且，它运行的也不再是<code>premain</code>方法，而是名为<code>agentmain</code>的方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent { 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void agentmain(String args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("agentmain");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>相应的，我们需要更新 jar 包中的 manifest 文件，使其包含<code>Agent-Class</code>的配置，例如<code>Agent-Class: org.example.MyAgent</code>。</p><!-- [[[read_end]]] --> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ echo 'Agent-Class: org.example.MyAgent
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ' &gt; manifest.txt
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jar cvmf manifest.txt myagent.jar org/
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java HelloWorld
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jps
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java AttachTest &lt;pid&gt; myagent.jar
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       agentmain
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // 最后一句输出来自于运行 HelloWorld 的 Java 进程
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>Java 虚拟机并不限制 Java agent 的数量。你可以在 java 命令后附上多个<code>-javaagent</code>参数，或者远程 attach 多个 Java agent，Java 虚拟机会按照定义顺序，或者 attach 的顺序逐个执行这些 Java agent。</p> 
<p>在<code>premain</code>方法或者<code>agentmain</code>方法中打印一些字符串并不出奇，我们完全可以将其中的逻辑并入<code>main</code>方法，或者其他监听端口的线程中。除此之外，Java agent 还提供了一套 instrumentation 机制，允许应用程序拦截类加载事件，并且更改该类的字节码。</p> 
<p>接下来，我们来了解一下基于这一机制的字节码注入。</p> 
<h2>字节码注入</h2> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.instrument.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.security.ProtectionDomain;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void premain(String args, Instrumentation instrumentation) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.addTransformer(new MyTransformer());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static class MyTransformer implements ClassFileTransformer {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.printf("Loaded %s: 0x%X%X%X%X\n", className, classfileBuffer[0], classfileBuffer[1],
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        classfileBuffer[2], classfileBuffer[3]);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return null;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我们先来看一个例子。在上面这段代码中，<code>premain</code>方法多出了一个<code>Instrumentation</code>类型的参数，我们可以通过它来注册类加载事件的拦截器。该拦截器需要实现<code>ClassFileTransformer</code>接口，并重写其中的<code>transform</code>方法。</p> 
<p><code>transform</code>方法将接收一个 byte 数组类型的参数，它代表的是正在被加载的类的字节码。在上面这段代码中，我将打印该数组的前四个字节，也就是 Java class 文件的魔数（magic number）0xCAFEBABE。</p> 
<p><code>transform</code>方法将返回一个 byte 数组，代表更新过后的类的字节码。当方法返回之后，Java 虚拟机会使用所返回的 byte 数组，来完成接下来的类加载工作。不过，如果<code>transform</code>方法返回 null 或者抛出异常，那么 Java 虚拟机将使用原来的 byte 数组完成类加载工作。</p> 
<p>基于这一类加载事件的拦截功能，我们可以实现字节码注入（bytecode instrumentation），往正在被加载的类中插入额外的字节码。</p> 
<p>在工具篇中我曾经介绍过字节码工程框架 ASM 的用法。下面我将演示它的<a href="https://search.maven.org/artifact/org.ow2.asm/asm-tree/7.0-beta/jar">tree 包</a>（依赖于<a href="https://search.maven.org/artifact/org.ow2.asm/asm/7.0-beta/jar">基础包</a>），用面向对象的方式注入字节码。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.instrument.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.security.ProtectionDomain;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.tree.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void premain(String args, Instrumentation instrumentation) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.addTransformer(new MyTransformer());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static class MyTransformer implements ClassFileTransformer, Opcodes {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassReader cr = new ClassReader(classfileBuffer);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassNode classNode = new ClassNode(ASM7);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        cr.accept(classNode, ClassReader.SKIP_FRAMES);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (MethodNode methodNode : classNode.methods) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if ("main".equals(methodNode.name)) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        InsnList instrumentation = new InsnList();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.add(new FieldInsnNode(GETSTATIC, "java/lang/System", "out", "Ljava/io/PrintStream;"));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.add(new LdcInsnNode("Hello, Instrumentation!"));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .add(new MethodInsnNode(INVOKEVIRTUAL, "java/io/PrintStream", "println", "(Ljava/lang/String;)V", false));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        methodNode.instructions.insert(instrumentation);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_FRAMES | ClassWriter.COMPUTE_MAXS);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        classNode.accept(cw);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return cw.toByteArray();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>上面这段代码不难理解。我们将使用<code>ClassReader</code>读取所传入的 byte 数组，并将其转换成<code>ClassNode</code>。然后我们将遍历<code>ClassNode</code>中的<code>MethodNode</code>节点，也就是该类中的构造器和方法。</p> 
<p>当遇到名字为<code>"main"</code>的方法时，我们会在方法的入口处注入<code>System.out.println("Hello, Instrumentation!");</code>。运行结果如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -javaagent:myagent.jar -cp .:/PATH/TO/asm-7.0-beta.jar:/PATH/TO/asm-tree-7.0-beta.jar HelloWorld
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, Instrumentation!
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World!
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>Java agent 还提供了另外两个功能<code>redefine</code>和<code>retransform</code>。这两个功能针对的是已加载的类，并要求用户传入所要<code>redefine</code>或者<code>retransform</code>的类实例。</p> 
<p>其中，<code>redefine</code>指的是舍弃原本的字节码，并替换成由用户提供的 byte 数组。该功能比较危险，一般用于修复出错了的字节码。</p> 
<p><code>retransform</code>则将针对所传入的类，重新调用所有已注册的<code>ClassFileTransformer</code>的<code>transform</code>方法。它的应用场景主要有如下两个。</p> 
<p>第一，在执行<code>premain</code>或者<code>agentmain</code>方法前，Java 虚拟机早已加载了不少类，而这些类的加载事件并没有被拦截，因此也没有被注入。使用<code>retransform</code>功能可以注入这些已加载但未注入的类。</p> 
<p>第二，在定义了多个 Java agent，多个注入的情况下，我们可能需要移除其中的部分注入。当调用<code>Instrumentation.removeTransformer</code>去除某个注入类后，我们可以调用<code>retransform</code>功能，重新从原始 byte 数组开始进行注入。</p> 
<p>Java agent 的这些功能都是通过 JVMTI agent，也就是 C agent 来实现的。JVMTI 是一个事件驱动的工具实现接口，通常，我们会在 C agent 加载后的入口方法<code>Agent_OnLoad</code>处注册各个事件的钩子（hook）方法。当 Java 虚拟机触发了这些事件时，便会调用对应的钩子方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT jint JNICALL
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Agent_OnLoad(JavaVM *vm, char *options, void *reserved);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>举个例子，我们可以为 JVMTI 中的<code>ClassFileLoadHook</code>事件设置钩子，从而在 C 层面拦截所有的类加载事件。关于 JVMTI 的其他事件，你可以参考该<a href="https://docs.oracle.com/en/java/javase/11/docs/specs/jvmti.html#EventIndex">链接</a>。</p> 
<h2>基于字节码注入的 profiler</h2> 
<p>我们可以利用字节码注入来实现代码覆盖工具（例如<a href="https://www.jacoco.org/jacoco/">JaCoCo</a>），或者各式各样的 profiler。</p> 
<p>通常，我们会定义一个运行时类，并在某一程序行为的周围，注入对该运行时类中方法的调用，以表示该程序行为正要发生或者已经发生。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.concurrent.ConcurrentHashMap;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.concurrent.atomic.AtomicInteger;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyProfiler {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static ConcurrentHashMap&lt;Class&lt;?&gt;, AtomicInteger&gt; data = new ConcurrentHashMap&lt;&gt;();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void fireAllocationEvent(Class&lt;?&gt; klass) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        data.computeIfAbsent(klass, kls -&gt; new AtomicInteger())
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .incrementAndGet();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void dump() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        data.forEach((kls, counter) -&gt; {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.err.printf("%s: %d\n", kls.getName(), counter.get());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        });
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Runtime.getRuntime().addShutdownHook(new Thread(MyProfiler::dump));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>举个例子，上面这段代码便是一个运行时类。该类维护了一个<code>HashMap</code>，用来统计每个类所新建实例的数目。当程序退出时，我们将逐个打印出每个类的名字，以及其新建实例的数目。</p> 
<p>在 Java agent 中，我们会截获正在加载的类，并且在每条<code>new</code>字节码之后插入对<code>fireAllocationEvent</code>方法的调用，以表示当前正在新建某个类的实例。具体的注入代码如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.instrument.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.security.ProtectionDomain;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.tree.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void premain(String args, Instrumentation instrumentation) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.addTransformer(new MyTransformer());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static class MyTransformer implements ClassFileTransformer, Opcodes {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (className.startsWith("java") ||
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("javax") || 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("jdk") ||
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("sun") ||
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("com/sun") ||
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("org/example")) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // Skip JDK classes and profiler classes
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return null;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassReader cr = new ClassReader(classfileBuffer);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassNode classNode = new ClassNode(ASM7);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        cr.accept(classNode, ClassReader.SKIP_FRAMES);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (MethodNode methodNode : classNode.methods) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (AbstractInsnNode node : methodNode.instructions.toArray()) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (node.getOpcode() == NEW) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        TypeInsnNode typeInsnNode = (TypeInsnNode) node;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        InsnList instrumentation = new InsnList();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.add(new LdcInsnNode(Type.getObjectType(typeInsnNode.desc)));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.add(new MethodInsnNode(INVOKESTATIC, "org/example/MyProfiler", "fireAllocationEvent",
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        "(Ljava/lang/Class;)V", false));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        methodNode.instructions.insert(node, instrumentation);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_FRAMES | ClassWriter.COMPUTE_MAXS);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        classNode.accept(cw);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return cw.toByteArray();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>你或许已经留意到，我们不得不排除对 JDK 类以及该运行时类的注入。这是因为，对这些类的注入很可能造成死循环调用，并最终抛出<code>StackOverflowException</code>异常。</p> 
<p>举个例子，假设我们在<code>PrintStream.println</code>方法入口处注入<code>System.out.println("blahblah")</code>，由于<code>out</code>是<code>PrintStream</code>的实例，因此当执行注入代码时，我们又会调用<code>PrintStream.println</code>方法，从而造成死循环。</p> 
<p>解决这一问题的关键在于设置一个线程私有的标识位，用以区分应用代码的上下文以及注入代码的上下文。当即将执行注入代码时，我们将根据标识位判断是否已经位于注入代码的上下文之中。如果不是，则设置标识位并正常执行注入代码；如果是，则直接返回，不再执行注入代码。</p> 
<p>字节码注入的另一个技术难点则是命名空间。举个例子，不少应用程序都依赖于字节码工程库 ASM。当我们的注入逻辑依赖于 ASM 时，便有可能出现注入使用最新版本的 ASM，而应用程序使用较低版本的 ASM 的问题。</p> 
<p>JDK 本身也使用了 ASM 库，如用来生成 Lambda 表达式的适配器类。JDK 的做法是重命名整个 ASM 库，为所有类的包名添加<code>jdk.internal</code>前缀。我们显然不好直接更改 ASM 的包名，因此需要借助自定义类加载器来隔离命名空间。</p> 
<p>除了上述技术难点之外，基于字节码注入的工具还有另一个问题，那便是观察者效应（observer effect）对所收集的数据造成的影响。</p> 
<p>举个利用字节码注入收集每个方法的运行时间的例子。假设某个方法调用了另一个方法，而这两个方法都被注入了，那么统计被调用者运行时间的注入代码所耗费的时间，将不可避免地被计入至调用者方法的运行时间之中。</p> 
<p>再举一个统计新建对象数目的例子。我们知道，即时编译器中的逃逸分析可能会优化掉新建对象操作，但它不会消除相应的统计操作，比如上述例子中对<code>fireAllocationEvent</code>方法的调用。在这种情况下，我们将统计没有实际发生的新建对象操作。</p> 
<p>另一种情况则是，我们所注入的对<code>fireAllocationEvent</code>方法的调用，将影响到方法内联的决策。如果该新建对象的构造器调用恰好因此没有被内联，从而造成对象逃逸。在这种情况下，原本能够被逃逸分析优化掉的新建对象操作将无法优化，我们也将统计到原本不会发生的新建对象操作。</p> 
<p>总而言之，当使用字节码注入开发 profiler 时，需要辩证地看待所收集的数据。它仅能表示在被注入的情况下程序的执行状态，而非没有注入情况下的程序执行状态。</p> 
<h2>面向方面编程</h2> 
<p>说到字节码注入，就不得不提面向方面编程（Aspect-Oriented Programming，AOP）。面向方面编程的核心理念是定义切入点（pointcut）以及通知（advice）。程序控制流中所有匹配该切入点的连接点（joinpoint）都将执行这段通知代码。</p> 
<p>举个例子，我们定义一个指代所有方法入口的切入点，并指定在该切入点执行的“打印该方法的名字”这一通知。那么每个具体的方法入口便是一个连接点。</p> 
<p>面向方面编程的其中一种实现方式便是字节码注入，比如<a href="https://www.eclipse.org/aspectj/">AspectJ</a>。</p> 
<p>在前面的例子中，我们也相当于使用了面向方面编程，在所有的<code>new</code>字节码之后执行了下面这样一段通知代码。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       `MyProfiler.fireAllocationEvent(&lt;Target&gt;.class)`
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我曾经参与开发过一个应用了面向方面编程思想的字节码注入框架<a href="https://disl.ow2.org/">DiSL</a>。它支持用注解来定义切入点，用普通 Java 方法来定义通知。例如，在方法入口处打印所在的方法名，可以简单表示为如下代码：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @Before(marker = BodyMarker.class)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       static void onMethodEntry(MethodStaticContext msc) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(msc.thisMethodFullName());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>如果有同学对这个工具感兴趣，或者有什么需求或者建议，欢迎你在留言中提出。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了 Java agent 以及字节码注入。</p> 
<p>我们可以通过 Java agent 的类加载拦截功能，修改某个类所对应的 byte 数组，并利用这个修改过后的 byte 数组完成接下来的类加载。</p> 
<p>基于字节码注入的 profiler，可以统计程序运行过程中某些行为的出现次数。如果需要收集 Java 核心类库的数据，那么我们需要小心避免无限递归调用。另外，我们还需通过自定义类加载器来解决命名空间的问题。</p> 
<p>由于字节码注入会产生观察者效应，因此基于该技术的 profiler 所收集到的数据并不能反映程序的真实运行状态。它所反映的是程序在被注入的情况下的执行状态。</p> 
<hr> 
<p>今天的实践环节，请你思考如何注入方法出口。除了正常执行路径之外，你还需考虑异常执行路径。</p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |9           |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:38:48.512 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=9 
 {executed in 5 msec}
2020-11-19 20:38:48.571 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>关于 Java agent，大家可能都听过大名鼎鼎的<code>premain</code>方法。顾名思义，这个方法指的就是在<code>main</code>方法之前执行的方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void premain(String args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("premain");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我在上面这段代码中定义了一个<code>premain</code>方法。这里需要注意的是，Java 虚拟机所能识别的<code>premain</code>方法接收的是字符串类型的参数，而并非类似于<code>main</code>方法的字符串数组。</p> 
<p>为了能够以 Java agent 的方式运行该<code>premain</code>方法，我们需要将其打包成 jar 包，并在其中的 MANIFEST.MF 配置文件中，指定所谓的<code>Premain-class</code>。具体的命令如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # 注意第一条命令会向 manifest.txt 文件写入两行数据，其中包括一行空行
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ echo 'Premain-Class: org.example.MyAgent
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ' &gt; manifest.txt
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jar cvmf manifest.txt myagent.jar org/
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -javaagent:myagent.jar HelloWorld
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       premain
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>除了在命令行中指定 Java agent 之外，我们还可以通过 Attach API 远程加载。具体用法如下面的代码所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.io.IOException;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import com.sun.tools.attach.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class AttachTest {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        throws AttachNotSupportedException, IOException, AgentLoadException, AgentInitializationException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (args.length &lt;= 1) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("Usage: java AttachTest &lt;PID&gt; /PATH/TO/AGENT.jar");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        VirtualMachine vm = VirtualMachine.attach(args[0]);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        vm.loadAgent(args[1]);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>使用 Attach API 远程加载的 Java agent 不会再先于<code>main</code>方法执行，这取决于另一虚拟机调用 Attach API 的时机。并且，它运行的也不再是<code>premain</code>方法，而是名为<code>agentmain</code>的方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent { 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void agentmain(String args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("agentmain");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>相应的，我们需要更新 jar 包中的 manifest 文件，使其包含<code>Agent-Class</code>的配置，例如<code>Agent-Class: org.example.MyAgent</code>。</p><!-- [[[read_end]]] --> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ echo 'Agent-Class: org.example.MyAgent
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ' &gt; manifest.txt
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jar cvmf manifest.txt myagent.jar org/
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java HelloWorld
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jps
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java AttachTest &lt;pid&gt; myagent.jar
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       agentmain
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // 最后一句输出来自于运行 HelloWorld 的 Java 进程
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>Java 虚拟机并不限制 Java agent 的数量。你可以在 java 命令后附上多个<code>-javaagent</code>参数，或者远程 attach 多个 Java agent，Java 虚拟机会按照定义顺序，或者 attach 的顺序逐个执行这些 Java agent。</p> 
<p>在<code>premain</code>方法或者<code>agentmain</code>方法中打印一些字符串并不出奇，我们完全可以将其中的逻辑并入<code>main</code>方法，或者其他监听端口的线程中。除此之外，Java agent 还提供了一套 instrumentation 机制，允许应用程序拦截类加载事件，并且更改该类的字节码。</p> 
<p>接下来，我们来了解一下基于这一机制的字节码注入。</p> 
<h2>字节码注入</h2> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.instrument.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.security.ProtectionDomain;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void premain(String args, Instrumentation instrumentation) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.addTransformer(new MyTransformer());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static class MyTransformer implements ClassFileTransformer {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.printf("Loaded %s: 0x%X%X%X%X\n", className, classfileBuffer[0], classfileBuffer[1],
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        classfileBuffer[2], classfileBuffer[3]);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return null;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我们先来看一个例子。在上面这段代码中，<code>premain</code>方法多出了一个<code>Instrumentation</code>类型的参数，我们可以通过它来注册类加载事件的拦截器。该拦截器需要实现<code>ClassFileTransformer</code>接口，并重写其中的<code>transform</code>方法。</p> 
<p><code>transform</code>方法将接收一个 byte 数组类型的参数，它代表的是正在被加载的类的字节码。在上面这段代码中，我将打印该数组的前四个字节，也就是 Java class 文件的魔数（magic number）0xCAFEBABE。</p> 
<p><code>transform</code>方法将返回一个 byte 数组，代表更新过后的类的字节码。当方法返回之后，Java 虚拟机会使用所返回的 byte 数组，来完成接下来的类加载工作。不过，如果<code>transform</code>方法返回 null 或者抛出异常，那么 Java 虚拟机将使用原来的 byte 数组完成类加载工作。</p> 
<p>基于这一类加载事件的拦截功能，我们可以实现字节码注入（bytecode instrumentation），往正在被加载的类中插入额外的字节码。</p> 
<p>在工具篇中我曾经介绍过字节码工程框架 ASM 的用法。下面我将演示它的<a href="https://search.maven.org/artifact/org.ow2.asm/asm-tree/7.0-beta/jar">tree 包</a>（依赖于<a href="https://search.maven.org/artifact/org.ow2.asm/asm/7.0-beta/jar">基础包</a>），用面向对象的方式注入字节码。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.instrument.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.security.ProtectionDomain;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.tree.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void premain(String args, Instrumentation instrumentation) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.addTransformer(new MyTransformer());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static class MyTransformer implements ClassFileTransformer, Opcodes {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassReader cr = new ClassReader(classfileBuffer);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassNode classNode = new ClassNode(ASM7);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        cr.accept(classNode, ClassReader.SKIP_FRAMES);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (MethodNode methodNode : classNode.methods) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if ("main".equals(methodNode.name)) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        InsnList instrumentation = new InsnList();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.add(new FieldInsnNode(GETSTATIC, "java/lang/System", "out", "Ljava/io/PrintStream;"));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.add(new LdcInsnNode("Hello, Instrumentation!"));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .add(new MethodInsnNode(INVOKEVIRTUAL, "java/io/PrintStream", "println", "(Ljava/lang/String;)V", false));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        methodNode.instructions.insert(instrumentation);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_FRAMES | ClassWriter.COMPUTE_MAXS);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        classNode.accept(cw);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return cw.toByteArray();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>上面这段代码不难理解。我们将使用<code>ClassReader</code>读取所传入的 byte 数组，并将其转换成<code>ClassNode</code>。然后我们将遍历<code>ClassNode</code>中的<code>MethodNode</code>节点，也就是该类中的构造器和方法。</p> 
<p>当遇到名字为<code>"main"</code>的方法时，我们会在方法的入口处注入<code>System.out.println("Hello, Instrumentation!");</code>。运行结果如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -javaagent:myagent.jar -cp .:/PATH/TO/asm-7.0-beta.jar:/PATH/TO/asm-tree-7.0-beta.jar HelloWorld
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, Instrumentation!
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World!
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>Java agent 还提供了另外两个功能<code>redefine</code>和<code>retransform</code>。这两个功能针对的是已加载的类，并要求用户传入所要<code>redefine</code>或者<code>retransform</code>的类实例。</p> 
<p>其中，<code>redefine</code>指的是舍弃原本的字节码，并替换成由用户提供的 byte 数组。该功能比较危险，一般用于修复出错了的字节码。</p> 
<p><code>retransform</code>则将针对所传入的类，重新调用所有已注册的<code>ClassFileTransformer</code>的<code>transform</code>方法。它的应用场景主要有如下两个。</p> 
<p>第一，在执行<code>premain</code>或者<code>agentmain</code>方法前，Java 虚拟机早已加载了不少类，而这些类的加载事件并没有被拦截，因此也没有被注入。使用<code>retransform</code>功能可以注入这些已加载但未注入的类。</p> 
<p>第二，在定义了多个 Java agent，多个注入的情况下，我们可能需要移除其中的部分注入。当调用<code>Instrumentation.removeTransformer</code>去除某个注入类后，我们可以调用<code>retransform</code>功能，重新从原始 byte 数组开始进行注入。</p> 
<p>Java agent 的这些功能都是通过 JVMTI agent，也就是 C agent 来实现的。JVMTI 是一个事件驱动的工具实现接口，通常，我们会在 C agent 加载后的入口方法<code>Agent_OnLoad</code>处注册各个事件的钩子（hook）方法。当 Java 虚拟机触发了这些事件时，便会调用对应的钩子方法。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT jint JNICALL
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Agent_OnLoad(JavaVM *vm, char *options, void *reserved);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>举个例子，我们可以为 JVMTI 中的<code>ClassFileLoadHook</code>事件设置钩子，从而在 C 层面拦截所有的类加载事件。关于 JVMTI 的其他事件，你可以参考该<a href="https://docs.oracle.com/en/java/javase/11/docs/specs/jvmti.html#EventIndex">链接</a>。</p> 
<h2>基于字节码注入的 profiler</h2> 
<p>我们可以利用字节码注入来实现代码覆盖工具（例如<a href="https://www.jacoco.org/jacoco/">JaCoCo</a>），或者各式各样的 profiler。</p> 
<p>通常，我们会定义一个运行时类，并在某一程序行为的周围，注入对该运行时类中方法的调用，以表示该程序行为正要发生或者已经发生。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.concurrent.ConcurrentHashMap;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.concurrent.atomic.AtomicInteger;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyProfiler {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static ConcurrentHashMap&lt;Class&lt;?&gt;, AtomicInteger&gt; data = new ConcurrentHashMap&lt;&gt;();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void fireAllocationEvent(Class&lt;?&gt; klass) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        data.computeIfAbsent(klass, kls -&gt; new AtomicInteger())
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        .incrementAndGet();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void dump() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        data.forEach((kls, counter) -&gt; {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.err.printf("%s: %d\n", kls.getName(), counter.get());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        });
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Runtime.getRuntime().addShutdownHook(new Thread(MyProfiler::dump));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>举个例子，上面这段代码便是一个运行时类。该类维护了一个<code>HashMap</code>，用来统计每个类所新建实例的数目。当程序退出时，我们将逐个打印出每个类的名字，以及其新建实例的数目。</p> 
<p>在 Java agent 中，我们会截获正在加载的类，并且在每条<code>new</code>字节码之后插入对<code>fireAllocationEvent</code>方法的调用，以表示当前正在新建某个类的实例。具体的注入代码如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.instrument.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.security.ProtectionDomain;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import org.objectweb.asm.tree.*;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class MyAgent {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void premain(String args, Instrumentation instrumentation) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.addTransformer(new MyTransformer());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static class MyTransformer implements ClassFileTransformer, Opcodes {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (className.startsWith("java") ||
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("javax") || 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("jdk") ||
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("sun") ||
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("com/sun") ||
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        className.startsWith("org/example")) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // Skip JDK classes and profiler classes
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return null;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassReader cr = new ClassReader(classfileBuffer);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassNode classNode = new ClassNode(ASM7);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        cr.accept(classNode, ClassReader.SKIP_FRAMES);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (MethodNode methodNode : classNode.methods) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (AbstractInsnNode node : methodNode.instructions.toArray()) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if (node.getOpcode() == NEW) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        TypeInsnNode typeInsnNode = (TypeInsnNode) node;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        InsnList instrumentation = new InsnList();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.add(new LdcInsnNode(Type.getObjectType(typeInsnNode.desc)));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        instrumentation.add(new MethodInsnNode(INVOKESTATIC, "org/example/MyProfiler", "fireAllocationEvent",
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        "(Ljava/lang/Class;)V", false));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        methodNode.instructions.insert(node, instrumentation);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_FRAMES | ClassWriter.COMPUTE_MAXS);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        classNode.accept(cw);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return cw.toByteArray();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>你或许已经留意到，我们不得不排除对 JDK 类以及该运行时类的注入。这是因为，对这些类的注入很可能造成死循环调用，并最终抛出<code>StackOverflowException</code>异常。</p> 
<p>举个例子，假设我们在<code>PrintStream.println</code>方法入口处注入<code>System.out.println("blahblah")</code>，由于<code>out</code>是<code>PrintStream</code>的实例，因此当执行注入代码时，我们又会调用<code>PrintStream.println</code>方法，从而造成死循环。</p> 
<p>解决这一问题的关键在于设置一个线程私有的标识位，用以区分应用代码的上下文以及注入代码的上下文。当即将执行注入代码时，我们将根据标识位判断是否已经位于注入代码的上下文之中。如果不是，则设置标识位并正常执行注入代码；如果是，则直接返回，不再执行注入代码。</p> 
<p>字节码注入的另一个技术难点则是命名空间。举个例子，不少应用程序都依赖于字节码工程库 ASM。当我们的注入逻辑依赖于 ASM 时，便有可能出现注入使用最新版本的 ASM，而应用程序使用较低版本的 ASM 的问题。</p> 
<p>JDK 本身也使用了 ASM 库，如用来生成 Lambda 表达式的适配器类。JDK 的做法是重命名整个 ASM 库，为所有类的包名添加<code>jdk.internal</code>前缀。我们显然不好直接更改 ASM 的包名，因此需要借助自定义类加载器来隔离命名空间。</p> 
<p>除了上述技术难点之外，基于字节码注入的工具还有另一个问题，那便是观察者效应（observer effect）对所收集的数据造成的影响。</p> 
<p>举个利用字节码注入收集每个方法的运行时间的例子。假设某个方法调用了另一个方法，而这两个方法都被注入了，那么统计被调用者运行时间的注入代码所耗费的时间，将不可避免地被计入至调用者方法的运行时间之中。</p> 
<p>再举一个统计新建对象数目的例子。我们知道，即时编译器中的逃逸分析可能会优化掉新建对象操作，但它不会消除相应的统计操作，比如上述例子中对<code>fireAllocationEvent</code>方法的调用。在这种情况下，我们将统计没有实际发生的新建对象操作。</p> 
<p>另一种情况则是，我们所注入的对<code>fireAllocationEvent</code>方法的调用，将影响到方法内联的决策。如果该新建对象的构造器调用恰好因此没有被内联，从而造成对象逃逸。在这种情况下，原本能够被逃逸分析优化掉的新建对象操作将无法优化，我们也将统计到原本不会发生的新建对象操作。</p> 
<p>总而言之，当使用字节码注入开发 profiler 时，需要辩证地看待所收集的数据。它仅能表示在被注入的情况下程序的执行状态，而非没有注入情况下的程序执行状态。</p> 
<h2>面向方面编程</h2> 
<p>说到字节码注入，就不得不提面向方面编程（Aspect-Oriented Programming，AOP）。面向方面编程的核心理念是定义切入点（pointcut）以及通知（advice）。程序控制流中所有匹配该切入点的连接点（joinpoint）都将执行这段通知代码。</p> 
<p>举个例子，我们定义一个指代所有方法入口的切入点，并指定在该切入点执行的“打印该方法的名字”这一通知。那么每个具体的方法入口便是一个连接点。</p> 
<p>面向方面编程的其中一种实现方式便是字节码注入，比如<a href="https://www.eclipse.org/aspectj/">AspectJ</a>。</p> 
<p>在前面的例子中，我们也相当于使用了面向方面编程，在所有的<code>new</code>字节码之后执行了下面这样一段通知代码。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       `MyProfiler.fireAllocationEvent(&lt;Target&gt;.class)`
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我曾经参与开发过一个应用了面向方面编程思想的字节码注入框架<a href="https://disl.ow2.org/">DiSL</a>。它支持用注解来定义切入点，用普通 Java 方法来定义通知。例如，在方法入口处打印所在的方法名，可以简单表示为如下代码：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @Before(marker = BodyMarker.class)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       static void onMethodEntry(MethodStaticContext msc) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(msc.thisMethodFullName());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>如果有同学对这个工具感兴趣，或者有什么需求或者建议，欢迎你在留言中提出。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了 Java agent 以及字节码注入。</p> 
<p>我们可以通过 Java agent 的类加载拦截功能，修改某个类所对应的 byte 数组，并利用这个修改过后的 byte 数组完成接下来的类加载。</p> 
<p>基于字节码注入的 profiler，可以统计程序运行过程中某些行为的出现次数。如果需要收集 Java 核心类库的数据，那么我们需要小心避免无限递归调用。另外，我们还需通过自定义类加载器来解决命名空间的问题。</p> 
<p>由于字节码注入会产生观察者效应，因此基于该技术的 profiler 所收集到的数据并不能反映程序的真实运行状态。它所反映的是程序在被注入的情况下的执行状态。</p> 
<hr> 
<p>今天的实践环节，请你思考如何注入方法出口。除了正常执行路径之外，你还需考虑异常执行路径。</p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |9           |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:38:48.632 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=9 
 {executed in 2 msec}
2020-11-19 20:38:48.635 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title              |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------|-----|----|----|
|9   |1605789256 |1605789256 |1                |zh-hans  |0       |1                             |1      |0      |33丨JavaAgent与字节码注入 |book |1   |9   |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------|-----|----|----|

2020-11-19 20:38:48.639 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=9 
 {executed in 1 msec}
2020-11-19 20:38:48.643 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title              |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------|----|----|
|[unread] |1605789256 |1605789256 |1                |zh-hans  |0       |1                             |1      |0      |33丨JavaAgent与字节码注入 |1   |9   |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------|----|----|

2020-11-19 20:38:48.650 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605789528, created=1605789528, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='33丨JavaAgent与字节码注入', 
type='book', uid=1, vid=9 where nid=9 
 {executed in 2 msec}
2020-11-19 20:38:48.653 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605789528, created=1605789528, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='33丨JavaAgent与字节码注入', 
uid=1, vid=9 where nid=9 
 {executed in 1 msec}
2020-11-19 20:38:48.667 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=9 
 {executed in 2 msec}
2020-11-19 20:38:48.670 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |revision_id |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|9         |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/db19598adc436fb16e930ec3fdb2e37d?bkt=en-c58a217c5b5bf7b2e91381d224e24b09cf87eeddf1c469fd710077908c52983204fe337bec21c40a&fid=3757516097-778750-987978065903771&time=1605787600&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-A0o1FqaABhHn75GzN3nr3NHhcJs%3D&to=92&size=5033343&sta_dx=5033343&sta_cs=4321&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182977&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5033343&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-16310cbe901495a4202ec754401760a7cd27483ca591f3df8e1b8059309238f81cd64a44c3b0baa6&sl=76480590&expires=8h&rt=pr&r=700803584&mlogid=7510716638530989077&vbdid=64799653&fin=33%E4%B8%A8JavaAgent%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%B3%A8%E5%85%A5.mp3&bflag=92,34-92&rtype=1&dp-logid=7510716638530989077&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=16c8192e22ea32f51088e4f00a4d826e05d25e5ea0bd0d3a&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=33%E4%B8%A8JavaAgent%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%B3%A8%E5%85%A5.mp3 |9           |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:38:48.680 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=9 
 {executed in 1 msec}
2020-11-19 20:38:48.683 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |revision_id |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/db19598adc436fb16e930ec3fdb2e37d?bkt=en-c58a217c5b5bf7b2e91381d224e24b09cf87eeddf1c469fd710077908c52983204fe337bec21c40a&fid=3757516097-778750-987978065903771&time=1605787600&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-A0o1FqaABhHn75GzN3nr3NHhcJs%3D&to=92&size=5033343&sta_dx=5033343&sta_cs=4321&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182977&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=5033343&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-16310cbe901495a4202ec754401760a7cd27483ca591f3df8e1b8059309238f81cd64a44c3b0baa6&sl=76480590&expires=8h&rt=pr&r=700803584&mlogid=7510716638530989077&vbdid=64799653&fin=33%E4%B8%A8JavaAgent%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%B3%A8%E5%85%A5.mp3&bflag=92,34-92&rtype=1&dp-logid=7510716638530989077&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=16c8192e22ea32f51088e4f00a4d826e05d25e5ea0bd0d3a&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=33%E4%B8%A8JavaAgent%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%B3%A8%E5%85%A5.mp3 |9           |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:38:48.693 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=9 
 {executed in 2 msec}
2020-11-19 20:38:48.702 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |delta |field_comment_format |langcode |revision_id |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|9         |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-13
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   阅过留痕
   <br>
   <br>1：Java agent 是啥玩意？
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个概念老师没有详细讲解，我的理解是Java语言的一个特性，这个特性能够实现Java字节码的注入
   <br>
   <br>2：Java字节码的注入有什么用处呢？
   <br>在平时编程几乎没有使用到这方面的功能，应该是在一些框架的设计的时候才使用吧！比如：专栏中提到的面相切面编程。
   <br>
   <br>3：Java agent 本质上是通过 c agent 来实现的，那 c agent 本质上是怎么实现的呢？
   <br>C agent是一个事件驱动的工具实现接口，通常我们会在 C agent 加载后的入口方案 Agent_OnLoad处注册各个事件的钩子方法。当Java虚拟机触发了这些事件时，便会调用对应的钩子方法
   <br>
   <br>4：留个话头
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;写代码实现某些功能，我的理解有三个时间段
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第一个：源码阶段，最常用的，也是编程的主要活动时间
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第二个：字节码阶段，有些功能可能会在加载字节码时修改或者添加某些字节码，某些框架做的事情
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第三个：运行阶段，某些工具，在程序运行时修改代码，实现运行时功能分支的控制
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/07/8c/51401220.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小美</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   用attach的方式注入字节码的时候遇到了99线升高的性能问题，看一些资料说 class redefinition 的时候会阻塞线程。请问能详细讲下吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 你是在做redefine时出问题，还是没触发时便已出问题？<br><br>class redefinition需要爬每个线程的Java栈，检查有没有用到被redefine的类的方法，因此会stop-the-world。另外，redefine后，JIT’ed代码会被抛弃，重新解释执行</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/db/708f5fd6.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>feng</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   第一个实验做的不严谨，第一，木有定义HelloWord类，第二，没有执行编译操作，不知道是有意为之，还是不小心把步骤漏掉了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-06
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   出方法时需要注入的字节码除了返回，还有几种情况，如果没有catch块，就拦截throw，如果有，但是catch块里面可能有很多层，只是遍历inst应该是不可以的
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 其实不用管有没有catch块，有没有throw，直接给所有代码罩一个catch any的异常处理就行了</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>奇奇</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-29
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   ASM7 GETSTATIC这些常量是哪里来的？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/db/708f5fd6.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>feng</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   还有个问题想请教下，每次启动的时候都会打印如下信息，objc[2614]: Class JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_31.jdk/Contents/Home/bin/java (0x102f6f4c0) and /Library/Java/JavaVirtualMachines/jdk1.8.0_31.jdk/Contents/Home/jre/lib/libinstrument.dylib (0x104f384e0). One of the two will be used. Which one is undefined.
   <br>
   <br>请问怎么可以消除，谢谢
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-06
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   我看到了jvmti可以回调异常事件，但是java.lang.instrument包下没有处理这个事件的，只能在load时回调，处理异常究竟是怎么做的？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: Instrumentation包并没有所有JVMTI功能</p>
  </div>
 </div></li> |0     |full_html            |zh-hans  |9           |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:38:48.718 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=9 
 {executed in 2 msec}
2020-11-19 20:38:48.726 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |delta |field_comment_format |langcode |revision_id |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-13
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   阅过留痕
   <br>
   <br>1：Java agent 是啥玩意？
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个概念老师没有详细讲解，我的理解是Java语言的一个特性，这个特性能够实现Java字节码的注入
   <br>
   <br>2：Java字节码的注入有什么用处呢？
   <br>在平时编程几乎没有使用到这方面的功能，应该是在一些框架的设计的时候才使用吧！比如：专栏中提到的面相切面编程。
   <br>
   <br>3：Java agent 本质上是通过 c agent 来实现的，那 c agent 本质上是怎么实现的呢？
   <br>C agent是一个事件驱动的工具实现接口，通常我们会在 C agent 加载后的入口方案 Agent_OnLoad处注册各个事件的钩子方法。当Java虚拟机触发了这些事件时，便会调用对应的钩子方法
   <br>
   <br>4：留个话头
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;写代码实现某些功能，我的理解有三个时间段
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第一个：源码阶段，最常用的，也是编程的主要活动时间
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第二个：字节码阶段，有些功能可能会在加载字节码时修改或者添加某些字节码，某些框架做的事情
   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第三个：运行阶段，某些工具，在程序运行时修改代码，实现运行时功能分支的控制
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/07/8c/51401220.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>小美</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-19
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   用attach的方式注入字节码的时候遇到了99线升高的性能问题，看一些资料说 class redefinition 的时候会阻塞线程。请问能详细讲下吗？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 你是在做redefine时出问题，还是没触发时便已出问题？<br><br>class redefinition需要爬每个线程的Java栈，检查有没有用到被redefine的类的方法，因此会stop-the-world。另外，redefine后，JIT’ed代码会被抛弃，重新解释执行</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/db/708f5fd6.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>feng</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   第一个实验做的不严谨，第一，木有定义HelloWord类，第二，没有执行编译操作，不知道是有意为之，还是不小心把步骤漏掉了
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-06
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   出方法时需要注入的字节码除了返回，还有几种情况，如果没有catch块，就拦截throw，如果有，但是catch块里面可能有很多层，只是遍历inst应该是不可以的
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 其实不用管有没有catch块，有没有throw，直接给所有代码罩一个catch any的异常处理就行了</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>奇奇</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-29
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   ASM7 GETSTATIC这些常量是哪里来的？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/db/708f5fd6.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>feng</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-07
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   还有个问题想请教下，每次启动的时候都会打印如下信息，objc[2614]: Class JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_31.jdk/Contents/Home/bin/java (0x102f6f4c0) and /Library/Java/JavaVirtualMachines/jdk1.8.0_31.jdk/Contents/Home/jre/lib/libinstrument.dylib (0x104f384e0). One of the two will be used. Which one is undefined.
   <br>
   <br>请问怎么可以消除，谢谢
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-06
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   我看到了jvmti可以回调异常事件，但是java.lang.instrument包下没有处理这个事件的，只能在load时回调，处理异常究竟是怎么做的？
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: Instrumentation包并没有所有JVMTI功能</p>
  </div>
 </div></li> |0     |full_html            |zh-hans  |9           |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:38:48.740 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=9 
 {executed in 1 msec}
2020-11-19 20:38:48.743 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|9         |book   |0     |zh-hans  |9           |https://static001.geekbang.org/resource/image/ed/0d/edcb5d3dab5810f2acf4a6a4e274220d.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:38:48.752 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=9 
 {executed in 1 msec}
2020-11-19 20:38:48.754 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |9           |https://static001.geekbang.org/resource/image/ed/0d/edcb5d3dab5810f2acf4a6a4e274220d.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:38:48.762 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=9 
 {executed in 1 msec}
2020-11-19 20:38:48.764 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |9           |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:38:48.772 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=9 
 {executed in 1 msec}
2020-11-19 20:38:48.774 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |9           |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:38:48.822 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='134607645122528' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:38:48.824 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|23      |134607645122528 |0   |net_content |
|--------|----------------|----|------------|

2020-11-19 20:39:06.004 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='134607645122528' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:39:06.007 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|23      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:39:06.018 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='134607645122528', got=1, name='net_content' where item_id=23 
 {executed in 1 msec}
2020-11-19 20:39:06.028 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='134607645122528' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:39:06.030 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------|
|item_id |fsid            |got |name  |
|--------|----------------|----|------|
|24      |134607645122528 |1   |media |
|--------|----------------|----|------|

2020-11-19 20:39:06.034 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='134607645122528' 
 {executed in 1 msec}
2020-11-19 20:39:06.037 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|10        |book   |0     |134607645122528  |zh-hans  |10          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:39:06.041 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=10 
 {executed in 1 msec}
2020-11-19 20:39:06.043 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|10  |zh-hans  |book |da6683d7-fa6a-4e6f-ab18-10c9439ac4b3 |10  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:39:06.053 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=10 
 {executed in 1 msec}
2020-11-19 20:39:06.055 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |134607645122528  |zh-hans  |10          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:39:06.063 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=10 
 {executed in 1 msec}
2020-11-19 20:39:06.066 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|10  |1   |3     |0            |1  |8  |10 |0  |0  |8   |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:39:06.078 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=10 
 {executed in 4 msec}
2020-11-19 20:39:06.129 INFO  jdbc.resultsettable Line:610 - 
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|10        |<p>我们经常会遇见 Java 语言较难表达，甚至是无法表达的应用场景。比如我们希望使用汇编语言（如 X86_64 的 SIMD 指令）来提升关键代码的性能；再比如，我们希望调用 Java 核心类库无法提供的，某个体系架构或者操作系统特有的功能。</p>
<p>在这种情况下，我们往往会牺牲可移植性，在 Java 代码中调用 C/C++ 代码（下面简述为 C 代码），并在其中实现所需功能。这种跨语言的调用，便需要借助 Java 虚拟机的 Java Native Interface（JNI）机制。</p>
<p>关于 JNI 的例子，你应该特别熟悉 Java 中标记为<code>native</code>的、没有方法体的方法（下面统称为 native 方法）。当在 Java 代码中调用这些 native 方法时，Java 虚拟机将通过 JNI，调用至对应的 C 函数（下面将 native 方法对应的 C 实现统称为 C 函数）中。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Object {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native int hashCode();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>举个例子，<code>Object.hashCode</code>方法便是一个 native 方法。它对应的 C 函数将计算对象的哈希值，并缓存在对象头、栈上锁记录（轻型锁）或对象监视锁（重型锁所使用的 monitor）中，以确保该值在对象的生命周期之内不会变更。</p>
<h2>native 方法的链接</h2>
<p>在调用 native 方法前，Java 虚拟机需要将该 native 方法链接至对应的 C 函数上。</p><!-- [[[read_end]]] -->
<p>链接方式主要有两种。第一种是让 Java 虚拟机自动查找符合默认命名规范的 C 函数，并且链接起来。</p>
<p>事实上，我们并不需要记住所谓的命名规范，而是采用<code>javac -h</code>命令，便可以根据 Java 程序中的 native 方法声明，自动生成包含符合命名规范的 C 函数的头文件。</p>
<p>举个例子，在下面这段代码中，<code>Foo</code>类有三个 native 方法，分别为静态方法<code>foo</code>以及两个重载的实例方法<code>bar</code>。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Foo {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static native void foo();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native void bar(int i, long j);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native void bar(String s, Object o);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>通过执行<code>javac -h . org/example/Foo.java</code>命令，我们将在当前文件夹（对应<code>-h</code>后面跟着的<code>.</code>）生成名为<code>org_example_Foo.h</code>的头文件。其内容如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /* DO NOT EDIT THIS FILE - it is machine generated */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include &lt;jni.h&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /* Header for class org_example_Foo */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #ifndef _Included_org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #define _Included_org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #ifdef __cplusplus
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       extern "C" {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #endif
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /*
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Class: org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Method: foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Signature: ()V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jclass);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /*
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Class: org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Method: bar
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Signature: (IJ)V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__IJ
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jobject, jint, jlong);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /*
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Class: org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Method: bar
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Signature: (Ljava/lang/String;Ljava/lang/Object;)V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jobject, jstring, jobject);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #ifdef __cplusplus
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #endif
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #endif
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>这里我简单讲解一下该命名规范。</p>
<p>首先，native 方法对应的 C 函数都需要以<code>Java_</code>为前缀，之后跟着完整的包名和方法名。由于 C 函数名不支持<code>/</code>字符，因此我们需要将<code>/</code>转换为<code>_</code>，而原本方法名中的<code>_</code>符号，则需要转换为<code>_1</code>。</p>
<p>举个例子，<code>org.example</code>包下<code>Foo</code>类的<code>foo</code>方法，Java 虚拟机会将其自动链接至名为<code>Java_org_example_Foo_foo</code>的 C 函数中。</p>
<p>当某个类出现重载的 native 方法时，Java 虚拟机还会将参数类型纳入自动链接对象的考虑范围之中。具体的做法便是在前面 C 函数名的基础上，追加<code>__</code>以及方法描述符作为后缀。</p>
<p>方法描述符的特殊符号同样会被替换掉，如引用类型所使用的<code>;</code>会被替换为<code>_2</code>，数组类型所使用的<code>[</code>会被替换为<code>_3</code>。</p>
<p>基于此命名规范，你可以手动拼凑上述代码中，<code>Foo</code>类的两个<code>bar</code>方法所能自动链接的 C 函数名，并用<code>javac -h</code>命令所生成的结果来验证一下。</p>
<p>第二种链接方式则是在 C 代码中主动链接。</p>
<p>这种链接方式对 C 函数名没有要求。通常我们会使用一个名为<code>registerNatives</code>的 native 方法，并按照第一种链接方式定义所能自动链接的 C 函数。在该 C 函数中，我们将手动链接该类的其他 native 方法。</p>
<p>举个例子，<code>Object</code>类便拥有一个<code>registerNatives</code>方法，所对应的 C 代码如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // 注：Object 类的 registerNatives 方法的实现位于 java.base 模块里的 C 代码中
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       static JNINativeMethod methods[] = {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"hashCode", "()I", (void *)&amp;JVM_IHashCode},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"wait", "(J)V", (void *)&amp;JVM_MonitorWait},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"notify", "()V", (void *)&amp;JVM_MonitorNotify},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"notifyAll", "()V", (void *)&amp;JVM_MonitorNotifyAll},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"clone", "()Ljava/lang/Object;", (void *)&amp;JVM_Clone},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       };
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java_java_lang_Object_registerNatives(JNIEnv *env, jclass cls)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (*env)-&gt;RegisterNatives(env, cls,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        methods, sizeof(methods)/sizeof(methods[0]));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们可以看到，上面这段代码中的 C 函数将调用<code>RegisterNatives</code> API，注册<code>Object</code>类中其他 native 方法所要链接的 C 函数。并且，这些 C 函数的名字并不符合默认命名规则。</p>
<p>当使用第二种方式进行链接时，我们需要在其他 native 方法被调用之前完成链接工作。因此，我们往往会在类的初始化方法里调用该<code>registerNatives</code>方法。具体示例如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Object {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static native void registerNatives();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        registerNatives();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>下面我们采用第一种链接方式，并且实现其中的<code>bar(String, Object)</code>方法。如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // foo.c
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include &lt;stdio.h&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include "org_example_Foo.h"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *env, jobject thisObject, jstring str, jobject obj) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        printf("Hello, World\n");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>然后，我们可以通过 gcc 命令将其编译成为动态链接库：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # 该命令仅适用于 macOS
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ gcc -I$JAVA_HOME/include -I$JAVA_HOME/include/darwin -o libfoo.dylib -shared foo.c
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>这里需要注意的是，动态链接库的名字须以<code>lib</code>为前缀，以<code>.dylib</code>(或 Linux 上的<code>.so</code>）为扩展名。在 Java 程序中，我们可以通过<code>System.loadLibrary("foo")</code>方法来加载<code>libfoo.dylib</code>，如下述代码所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Foo {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static native void foo();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native void bar(int i, long j);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native void bar(String s, Object o);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int i = 0xDEADBEEF;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        try {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.loadLibrary("foo");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        } catch (UnsatisfiedLinkError e) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        e.printStackTrace();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.exit(1);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Foo().bar("", "");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>如果<code>libfoo.dylib</code>不在当前路径下，我们可以在启动 Java 虚拟机时配置<code>java.library.path</code>参数，使其指向包含<code>libfoo.dylib</code>的文件夹。具体命令如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -Djava.library.path=/PATH/TO/DIR/CONTAINING/libfoo.dylib org.example.Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>JNI 的 API</h2>
<p>在 C 代码中，我们也可以使用 Java 的语言特性，如 instanceof 测试等。这些功能都是通过特殊的 JNI 函数（<a href="https://docs.oracle.com/en/java/javase/11/docs/specs/jni/functions.html">JNI Functions</a>）来实现的。</p>
<p>Java 虚拟机会将所有 JNI 函数的函数指针聚合到一个名为<code>JNIEnv</code>的数据结构之中。</p>
<p>这是一个线程私有的数据结构。Java 虚拟机会为每个线程创建一个<code>JNIEnv</code>，并规定 C 代码不能将当前线程的<code>JNIEnv</code>共享给其他线程，否则 JNI 函数的正确性将无法保证。</p>
<p>这么设计的原因主要有两个。一是给 JNI 函数提供一个单独命名空间。二是允许 Java 虚拟机通过更改函数指针替换 JNI 函数的具体实现，例如从附带参数类型检测的慢速版本，切换至不做参数类型检测的快速版本。</p>
<p>在 HotSpot 虚拟机中，<code>JNIEnv</code>被内嵌至 Java 线程的数据结构之中。部分虚拟机代码甚至会从<code>JNIEnv</code>的地址倒推出 Java 线程的地址。因此，如果在其他线程中使用当前线程的<code>JNIEnv</code>，会使这部分代码错误识别当前线程。</p>
<p>JNI 会将 Java 层面的基本类型以及引用类型映射为另一套可供 C 代码使用的数据结构。其中，基本类型的对应关系如下表所示：</p>
<p><img src="https://static001.geekbang.org/resource/image/cb/ca/cb2c806532449f2c1edfe821990ac9ca.png" alt=""></p>
<p>引用类型对应的数据结构之间也存在着继承关系，具体如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       jobject
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       |- jclass (java.lang.Class objects)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       |- jstring (java.lang.String objects)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       |- jthrowable (java.lang.Throwable objects)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       |- jarray (arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jobjectArray (object arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jbooleanArray (boolean arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jbyteArray (byte arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jcharArray (char arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jshortArray (short arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jintArray (int arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jlongArray (long arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jfloatArray (float arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jdoubleArray (double arrays)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们回头看看<code>Foo</code>类 3 个 native 方法对应的 C 函数的参数。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jclass);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__IJ
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jobject, jint, jlong);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2 (JNIEnv *, jobject, jstring, jobject);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>静态 native 方法<code>foo</code>将接收两个参数，分别为存放 JNI 函数的<code>JNIEnv</code>指针，以及一个<code>jclass</code>参数，用来指代定义该 native 方法的类，即<code>Foo</code>类。</p>
<p>两个实例 native 方法<code>bar</code>的第二个参数则是<code>jobject</code>类型的，用来指代该 native 方法的调用者，也就是<code>Foo</code>类的实例。</p>
<p>如果 native 方法声明了参数，那么对应的 C 函数将接收这些参数。在我们的例子中，第一个<code>bar</code>方法声明了 int 型和 long 型的参数，对应的 C 函数则接收 jint 和 jlong 类型的参数；第二个<code>bar</code>方法声明了 String 类型和 Object 类型的参数，对应的 C 函数则接收 jstring 和 jobject 类型的参数。</p>
<p>下面，我们继续修改上一小节中的<code>foo.c</code>，并在 C 代码中获取<code>Foo</code>类实例的<code>i</code>字段。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // foo.c
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include &lt;stdio.h&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include "org_example_Foo.h"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *env, jobject thisObject, jstring str, jobject obj) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jclass cls = (*env)-&gt;GetObjectClass(env, thisObject);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jfieldID fieldID = (*env)-&gt;GetFieldID(env, cls, "i", "I");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jint value = (*env)-&gt;GetIntField(env, thisObject, fieldID);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        printf("Hello, World 0x%x\n", value);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们可以看到，在 JNI 中访问字段类似于反射 API：我们首先需要通过类实例获得<code>FieldID</code>，然后再通过<code>FieldID</code>获得某个实例中该字段的值。不过，与 Java 代码相比，上述代码貌似不用处理异常。事实果真如此吗？</p>
<p>下面我就尝试获取了不存在的字段<code>j</code>，运行结果如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java org.example.Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World 0x5
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Exception in thread "main" java.lang.NoSuchFieldError: j
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at org.example.Foo.bar(Native Method)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at org.example.Foo.main(Foo.java:20)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们可以看到，<code>printf</code>语句照常执行并打印出<code>Hello, World 0x5</code>，但这个数值明显是错误的。当从 C 函数返回至 main 方法时，Java 虚拟机又会抛出<code>NoSuchFieldError</code>异常。</p>
<p>实际上，当调用 JNI 函数时，Java 虚拟机便已生成异常实例，并缓存在内存中的某个位置。与 Java 编程不一样的是，它并不会显式地跳转至异常处理器或者调用者中，而是继续执行接下来的 C 代码。</p>
<p>因此，当从可能触发异常的 JNI 函数返回时，我们需要通过 JNI 函数<code>ExceptionOccurred</code>检查是否发生了异常，并且作出相应的处理。如果无须抛出该异常，那么我们需要通过 JNI 函数<code>ExceptionClear</code>显式地清空已缓存的异常。</p>
<p>具体示例如下所示（为了控制代码篇幅，我仅在第一个<code>GetFieldID</code>后检查异常以及清空异常）：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // foo.c
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include &lt;stdio.h&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include "org_example_Foo.h"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *env, jobject thisObject, jstring str, jobject obj) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jclass cls = (*env)-&gt;GetObjectClass(env, thisObject);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jfieldID fieldID = (*env)-&gt;GetFieldID(env, cls, "j", "I");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if((*env)-&gt;ExceptionOccurred(env)) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        printf("Exception!\n");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (*env)-&gt;ExceptionClear(env);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        fieldID = (*env)-&gt;GetFieldID(env, cls, "i", "I");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jint value = (*env)-&gt;GetIntField(env, thisObject, fieldID);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // we should put an exception guard here as well.
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        printf("Hello, World 0x%x\n", value);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>局部引用与全局引用</h2>
<p>在 C 代码中，我们可以访问所传入的引用类型参数，也可以通过 JNI 函数创建新的 Java 对象。</p>
<p>这些 Java 对象显然也会受到垃圾回收器的影响。因此，Java 虚拟机需要一种机制，来告知垃圾回收算法，不要回收这些 C 代码中可能引用到的 Java 对象。</p>
<p>这种机制便是 JNI 的局部引用（Local Reference）和全局引用（Global Reference）。垃圾回收算法会将被这两种引用指向的对象标记为不可回收。</p>
<p>事实上，无论是传入的引用类型参数，还是通过 JNI 函数（除<code>NewGlobalRef</code>及<code>NewWeakGlobalRef</code>之外）返回的引用类型对象，都属于局部引用。</p>
<p>不过，一旦从 C 函数中返回至 Java 方法之中，那么局部引用将失效。也就是说，垃圾回收器在标记垃圾时不再考虑这些局部引用。</p>
<p>这就意味着，我们不能缓存局部引用，以供另一 C 线程或下一次 native 方法调用时使用。</p>
<p>对于这种应用场景，我们需要借助 JNI 函数<code>NewGlobalRef</code>，将该局部引用转换为全局引用，以确保其指向的 Java 对象不会被垃圾回收。</p>
<p>相应的，我们还可以通过 JNI 函数<code>DeleteGlobalRef</code>来消除全局引用，以便回收被全局引用指向的 Java 对象。</p>
<p>此外，当 C 函数运行时间极其长时，我们也应该考虑通过 JNI 函数<code>DeleteLocalRef</code>，消除不再使用的局部引用，以便回收被引用的 Java 对象。</p>
<p>另一方面，由于垃圾回收器可能会移动对象在内存中的位置，因此 Java 虚拟机需要另一种机制，来保证局部引用或者全局引用将正确地指向移动过后的对象。</p>
<p>HotSpot 虚拟机是通过句柄（handle）来完成上述需求的。这里句柄指的是内存中 Java 对象的指针的指针。当发生垃圾回收时，如果 Java 对象被移动了，那么句柄指向的指针值也将发生变动，但句柄本身保持不变。</p>
<p>实际上，无论是局部引用还是全局引用，都是句柄。其中，局部引用所对应的句柄有两种存储方式，一是在本地方法栈帧中，主要用于存放 C 函数所接收的来自 Java 层面的引用类型参数；另一种则是线程私有的句柄块，主要用于存放 C 函数运行过程中创建的局部引用。</p>
<p>当从 C 函数返回至 Java 方法时，本地方法栈帧中的句柄将会被自动清除。而线程私有句柄块则需要由 Java 虚拟机显式清理。</p>
<p>进入 C 函数时对引用类型参数的句柄化，和调整参数位置（C 调用和 Java 调用传参的方式不一样），以及从 C 函数返回时清理线程私有句柄块，共同造就了 JNI 调用的额外性能开销（具体可参考该 stackoverflow 上的<a href="https://stackoverflow.com/questions/24746776/what-does-a-jvm-have-to-do-when-calling-a-native-method/24747484#24747484">回答</a>）。</p>
<h2>总结与实践</h2>
<p>今天我介绍了 JNI 的运行机制。</p>
<p>Java 中的 native 方法的链接方式主要有两种。一是按照 JNI 的默认规范命名所要链接的 C 函数，并依赖于 Java 虚拟机自动链接。另一种则是在 C 代码中主动链接。</p>
<p>JNI 提供了一系列 API 来允许 C 代码使用 Java 语言特性。这些 API 不仅使用了特殊的数据结构来表示 Java 类，还拥有特殊的异常处理模式。</p>
<p>JNI 中的引用可分为局部引用和全局引用。这两者都可以阻止垃圾回收器回收被引用的 Java 对象。不同的是，局部引用在 native 方法调用返回之后便会失效。传入参数以及大部分 JNI API 函数的返回值都属于局部引用。</p>
<hr>
<p>今天的实践环节，请阅读<a href="https://www.ibm.com/developerworks/java/library/j-jni/index.html">该文档</a>中的 Performance pitfalls 以及 Correctness pitfalls 两节。</p>
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |10          |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:39:06.159 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=10 
 {executed in 3 msec}
2020-11-19 20:39:06.236 INFO  jdbc.resultsettable Line:610 - 
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>我们经常会遇见 Java 语言较难表达，甚至是无法表达的应用场景。比如我们希望使用汇编语言（如 X86_64 的 SIMD 指令）来提升关键代码的性能；再比如，我们希望调用 Java 核心类库无法提供的，某个体系架构或者操作系统特有的功能。</p>
<p>在这种情况下，我们往往会牺牲可移植性，在 Java 代码中调用 C/C++ 代码（下面简述为 C 代码），并在其中实现所需功能。这种跨语言的调用，便需要借助 Java 虚拟机的 Java Native Interface（JNI）机制。</p>
<p>关于 JNI 的例子，你应该特别熟悉 Java 中标记为<code>native</code>的、没有方法体的方法（下面统称为 native 方法）。当在 Java 代码中调用这些 native 方法时，Java 虚拟机将通过 JNI，调用至对应的 C 函数（下面将 native 方法对应的 C 实现统称为 C 函数）中。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Object {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native int hashCode();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>举个例子，<code>Object.hashCode</code>方法便是一个 native 方法。它对应的 C 函数将计算对象的哈希值，并缓存在对象头、栈上锁记录（轻型锁）或对象监视锁（重型锁所使用的 monitor）中，以确保该值在对象的生命周期之内不会变更。</p>
<h2>native 方法的链接</h2>
<p>在调用 native 方法前，Java 虚拟机需要将该 native 方法链接至对应的 C 函数上。</p><!-- [[[read_end]]] -->
<p>链接方式主要有两种。第一种是让 Java 虚拟机自动查找符合默认命名规范的 C 函数，并且链接起来。</p>
<p>事实上，我们并不需要记住所谓的命名规范，而是采用<code>javac -h</code>命令，便可以根据 Java 程序中的 native 方法声明，自动生成包含符合命名规范的 C 函数的头文件。</p>
<p>举个例子，在下面这段代码中，<code>Foo</code>类有三个 native 方法，分别为静态方法<code>foo</code>以及两个重载的实例方法<code>bar</code>。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Foo {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static native void foo();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native void bar(int i, long j);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native void bar(String s, Object o);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>通过执行<code>javac -h . org/example/Foo.java</code>命令，我们将在当前文件夹（对应<code>-h</code>后面跟着的<code>.</code>）生成名为<code>org_example_Foo.h</code>的头文件。其内容如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /* DO NOT EDIT THIS FILE - it is machine generated */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include &lt;jni.h&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /* Header for class org_example_Foo */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #ifndef _Included_org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #define _Included_org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #ifdef __cplusplus
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       extern "C" {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #endif
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /*
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Class: org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Method: foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Signature: ()V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jclass);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /*
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Class: org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Method: bar
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Signature: (IJ)V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__IJ
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jobject, jint, jlong);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /*
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Class: org_example_Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Method: bar
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        * Signature: (Ljava/lang/String;Ljava/lang/Object;)V
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        */
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jobject, jstring, jobject);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #ifdef __cplusplus
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #endif
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #endif
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>这里我简单讲解一下该命名规范。</p>
<p>首先，native 方法对应的 C 函数都需要以<code>Java_</code>为前缀，之后跟着完整的包名和方法名。由于 C 函数名不支持<code>/</code>字符，因此我们需要将<code>/</code>转换为<code>_</code>，而原本方法名中的<code>_</code>符号，则需要转换为<code>_1</code>。</p>
<p>举个例子，<code>org.example</code>包下<code>Foo</code>类的<code>foo</code>方法，Java 虚拟机会将其自动链接至名为<code>Java_org_example_Foo_foo</code>的 C 函数中。</p>
<p>当某个类出现重载的 native 方法时，Java 虚拟机还会将参数类型纳入自动链接对象的考虑范围之中。具体的做法便是在前面 C 函数名的基础上，追加<code>__</code>以及方法描述符作为后缀。</p>
<p>方法描述符的特殊符号同样会被替换掉，如引用类型所使用的<code>;</code>会被替换为<code>_2</code>，数组类型所使用的<code>[</code>会被替换为<code>_3</code>。</p>
<p>基于此命名规范，你可以手动拼凑上述代码中，<code>Foo</code>类的两个<code>bar</code>方法所能自动链接的 C 函数名，并用<code>javac -h</code>命令所生成的结果来验证一下。</p>
<p>第二种链接方式则是在 C 代码中主动链接。</p>
<p>这种链接方式对 C 函数名没有要求。通常我们会使用一个名为<code>registerNatives</code>的 native 方法，并按照第一种链接方式定义所能自动链接的 C 函数。在该 C 函数中，我们将手动链接该类的其他 native 方法。</p>
<p>举个例子，<code>Object</code>类便拥有一个<code>registerNatives</code>方法，所对应的 C 代码如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // 注：Object 类的 registerNatives 方法的实现位于 java.base 模块里的 C 代码中
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       static JNINativeMethod methods[] = {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"hashCode", "()I", (void *)&amp;JVM_IHashCode},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"wait", "(J)V", (void *)&amp;JVM_MonitorWait},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"notify", "()V", (void *)&amp;JVM_MonitorNotify},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"notifyAll", "()V", (void *)&amp;JVM_MonitorNotifyAll},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        {"clone", "()Ljava/lang/Object;", (void *)&amp;JVM_Clone},
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       };
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java_java_lang_Object_registerNatives(JNIEnv *env, jclass cls)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (*env)-&gt;RegisterNatives(env, cls,
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        methods, sizeof(methods)/sizeof(methods[0]));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们可以看到，上面这段代码中的 C 函数将调用<code>RegisterNatives</code> API，注册<code>Object</code>类中其他 native 方法所要链接的 C 函数。并且，这些 C 函数的名字并不符合默认命名规则。</p>
<p>当使用第二种方式进行链接时，我们需要在其他 native 方法被调用之前完成链接工作。因此，我们往往会在类的初始化方法里调用该<code>registerNatives</code>方法。具体示例如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Object {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private static native void registerNatives();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        static {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        registerNatives();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>下面我们采用第一种链接方式，并且实现其中的<code>bar(String, Object)</code>方法。如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // foo.c
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include &lt;stdio.h&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include "org_example_Foo.h"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *env, jobject thisObject, jstring str, jobject obj) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        printf("Hello, World\n");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>然后，我们可以通过 gcc 命令将其编译成为动态链接库：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # 该命令仅适用于 macOS
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ gcc -I$JAVA_HOME/include -I$JAVA_HOME/include/darwin -o libfoo.dylib -shared foo.c
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>这里需要注意的是，动态链接库的名字须以<code>lib</code>为前缀，以<code>.dylib</code>(或 Linux 上的<code>.so</code>）为扩展名。在 Java 程序中，我们可以通过<code>System.loadLibrary("foo")</code>方法来加载<code>libfoo.dylib</code>，如下述代码所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       package org.example;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Foo {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static native void foo();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native void bar(int i, long j);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public native void bar(String s, Object o);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        int i = 0xDEADBEEF;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        try {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.loadLibrary("foo");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        } catch (UnsatisfiedLinkError e) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        e.printStackTrace();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.exit(1);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Foo().bar("", "");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>如果<code>libfoo.dylib</code>不在当前路径下，我们可以在启动 Java 虚拟机时配置<code>java.library.path</code>参数，使其指向包含<code>libfoo.dylib</code>的文件夹。具体命令如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -Djava.library.path=/PATH/TO/DIR/CONTAINING/libfoo.dylib org.example.Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>JNI 的 API</h2>
<p>在 C 代码中，我们也可以使用 Java 的语言特性，如 instanceof 测试等。这些功能都是通过特殊的 JNI 函数（<a href="https://docs.oracle.com/en/java/javase/11/docs/specs/jni/functions.html">JNI Functions</a>）来实现的。</p>
<p>Java 虚拟机会将所有 JNI 函数的函数指针聚合到一个名为<code>JNIEnv</code>的数据结构之中。</p>
<p>这是一个线程私有的数据结构。Java 虚拟机会为每个线程创建一个<code>JNIEnv</code>，并规定 C 代码不能将当前线程的<code>JNIEnv</code>共享给其他线程，否则 JNI 函数的正确性将无法保证。</p>
<p>这么设计的原因主要有两个。一是给 JNI 函数提供一个单独命名空间。二是允许 Java 虚拟机通过更改函数指针替换 JNI 函数的具体实现，例如从附带参数类型检测的慢速版本，切换至不做参数类型检测的快速版本。</p>
<p>在 HotSpot 虚拟机中，<code>JNIEnv</code>被内嵌至 Java 线程的数据结构之中。部分虚拟机代码甚至会从<code>JNIEnv</code>的地址倒推出 Java 线程的地址。因此，如果在其他线程中使用当前线程的<code>JNIEnv</code>，会使这部分代码错误识别当前线程。</p>
<p>JNI 会将 Java 层面的基本类型以及引用类型映射为另一套可供 C 代码使用的数据结构。其中，基本类型的对应关系如下表所示：</p>
<p><img src="https://static001.geekbang.org/resource/image/cb/ca/cb2c806532449f2c1edfe821990ac9ca.png" alt=""></p>
<p>引用类型对应的数据结构之间也存在着继承关系，具体如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       jobject
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       |- jclass (java.lang.Class objects)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       |- jstring (java.lang.String objects)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       |- jthrowable (java.lang.Throwable objects)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       |- jarray (arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jobjectArray (object arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jbooleanArray (boolean arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jbyteArray (byte arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jcharArray (char arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jshortArray (short arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jintArray (int arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jlongArray (long arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jfloatArray (float arrays)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        |- jdoubleArray (double arrays)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们回头看看<code>Foo</code>类 3 个 native 方法对应的 C 函数的参数。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jclass);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__IJ
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *, jobject, jint, jlong);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2 (JNIEnv *, jobject, jstring, jobject);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>静态 native 方法<code>foo</code>将接收两个参数，分别为存放 JNI 函数的<code>JNIEnv</code>指针，以及一个<code>jclass</code>参数，用来指代定义该 native 方法的类，即<code>Foo</code>类。</p>
<p>两个实例 native 方法<code>bar</code>的第二个参数则是<code>jobject</code>类型的，用来指代该 native 方法的调用者，也就是<code>Foo</code>类的实例。</p>
<p>如果 native 方法声明了参数，那么对应的 C 函数将接收这些参数。在我们的例子中，第一个<code>bar</code>方法声明了 int 型和 long 型的参数，对应的 C 函数则接收 jint 和 jlong 类型的参数；第二个<code>bar</code>方法声明了 String 类型和 Object 类型的参数，对应的 C 函数则接收 jstring 和 jobject 类型的参数。</p>
<p>下面，我们继续修改上一小节中的<code>foo.c</code>，并在 C 代码中获取<code>Foo</code>类实例的<code>i</code>字段。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // foo.c
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include &lt;stdio.h&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include "org_example_Foo.h"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *env, jobject thisObject, jstring str, jobject obj) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jclass cls = (*env)-&gt;GetObjectClass(env, thisObject);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jfieldID fieldID = (*env)-&gt;GetFieldID(env, cls, "i", "I");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jint value = (*env)-&gt;GetIntField(env, thisObject, fieldID);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        printf("Hello, World 0x%x\n", value);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们可以看到，在 JNI 中访问字段类似于反射 API：我们首先需要通过类实例获得<code>FieldID</code>，然后再通过<code>FieldID</code>获得某个实例中该字段的值。不过，与 Java 代码相比，上述代码貌似不用处理异常。事实果真如此吗？</p>
<p>下面我就尝试获取了不存在的字段<code>j</code>，运行结果如下所示：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java org.example.Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Hello, World 0x5
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Exception in thread "main" java.lang.NoSuchFieldError: j
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at org.example.Foo.bar(Native Method)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at org.example.Foo.main(Foo.java:20)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们可以看到，<code>printf</code>语句照常执行并打印出<code>Hello, World 0x5</code>，但这个数值明显是错误的。当从 C 函数返回至 main 方法时，Java 虚拟机又会抛出<code>NoSuchFieldError</code>异常。</p>
<p>实际上，当调用 JNI 函数时，Java 虚拟机便已生成异常实例，并缓存在内存中的某个位置。与 Java 编程不一样的是，它并不会显式地跳转至异常处理器或者调用者中，而是继续执行接下来的 C 代码。</p>
<p>因此，当从可能触发异常的 JNI 函数返回时，我们需要通过 JNI 函数<code>ExceptionOccurred</code>检查是否发生了异常，并且作出相应的处理。如果无须抛出该异常，那么我们需要通过 JNI 函数<code>ExceptionClear</code>显式地清空已缓存的异常。</p>
<p>具体示例如下所示（为了控制代码篇幅，我仅在第一个<code>GetFieldID</code>后检查异常以及清空异常）：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // foo.c
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include &lt;stdio.h&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       #include "org_example_Foo.h"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNIEXPORT void JNICALL Java_org_example_Foo_bar__Ljava_lang_String_2Ljava_lang_Object_2
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (JNIEnv *env, jobject thisObject, jstring str, jobject obj) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jclass cls = (*env)-&gt;GetObjectClass(env, thisObject);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jfieldID fieldID = (*env)-&gt;GetFieldID(env, cls, "j", "I");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        if((*env)-&gt;ExceptionOccurred(env)) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        printf("Exception!\n");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        (*env)-&gt;ExceptionClear(env);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        fieldID = (*env)-&gt;GetFieldID(env, cls, "i", "I");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        jint value = (*env)-&gt;GetIntField(env, thisObject, fieldID);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        // we should put an exception guard here as well.
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        printf("Hello, World 0x%x\n", value);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>局部引用与全局引用</h2>
<p>在 C 代码中，我们可以访问所传入的引用类型参数，也可以通过 JNI 函数创建新的 Java 对象。</p>
<p>这些 Java 对象显然也会受到垃圾回收器的影响。因此，Java 虚拟机需要一种机制，来告知垃圾回收算法，不要回收这些 C 代码中可能引用到的 Java 对象。</p>
<p>这种机制便是 JNI 的局部引用（Local Reference）和全局引用（Global Reference）。垃圾回收算法会将被这两种引用指向的对象标记为不可回收。</p>
<p>事实上，无论是传入的引用类型参数，还是通过 JNI 函数（除<code>NewGlobalRef</code>及<code>NewWeakGlobalRef</code>之外）返回的引用类型对象，都属于局部引用。</p>
<p>不过，一旦从 C 函数中返回至 Java 方法之中，那么局部引用将失效。也就是说，垃圾回收器在标记垃圾时不再考虑这些局部引用。</p>
<p>这就意味着，我们不能缓存局部引用，以供另一 C 线程或下一次 native 方法调用时使用。</p>
<p>对于这种应用场景，我们需要借助 JNI 函数<code>NewGlobalRef</code>，将该局部引用转换为全局引用，以确保其指向的 Java 对象不会被垃圾回收。</p>
<p>相应的，我们还可以通过 JNI 函数<code>DeleteGlobalRef</code>来消除全局引用，以便回收被全局引用指向的 Java 对象。</p>
<p>此外，当 C 函数运行时间极其长时，我们也应该考虑通过 JNI 函数<code>DeleteLocalRef</code>，消除不再使用的局部引用，以便回收被引用的 Java 对象。</p>
<p>另一方面，由于垃圾回收器可能会移动对象在内存中的位置，因此 Java 虚拟机需要另一种机制，来保证局部引用或者全局引用将正确地指向移动过后的对象。</p>
<p>HotSpot 虚拟机是通过句柄（handle）来完成上述需求的。这里句柄指的是内存中 Java 对象的指针的指针。当发生垃圾回收时，如果 Java 对象被移动了，那么句柄指向的指针值也将发生变动，但句柄本身保持不变。</p>
<p>实际上，无论是局部引用还是全局引用，都是句柄。其中，局部引用所对应的句柄有两种存储方式，一是在本地方法栈帧中，主要用于存放 C 函数所接收的来自 Java 层面的引用类型参数；另一种则是线程私有的句柄块，主要用于存放 C 函数运行过程中创建的局部引用。</p>
<p>当从 C 函数返回至 Java 方法时，本地方法栈帧中的句柄将会被自动清除。而线程私有句柄块则需要由 Java 虚拟机显式清理。</p>
<p>进入 C 函数时对引用类型参数的句柄化，和调整参数位置（C 调用和 Java 调用传参的方式不一样），以及从 C 函数返回时清理线程私有句柄块，共同造就了 JNI 调用的额外性能开销（具体可参考该 stackoverflow 上的<a href="https://stackoverflow.com/questions/24746776/what-does-a-jvm-have-to-do-when-calling-a-native-method/24747484#24747484">回答</a>）。</p>
<h2>总结与实践</h2>
<p>今天我介绍了 JNI 的运行机制。</p>
<p>Java 中的 native 方法的链接方式主要有两种。一是按照 JNI 的默认规范命名所要链接的 C 函数，并依赖于 Java 虚拟机自动链接。另一种则是在 C 代码中主动链接。</p>
<p>JNI 提供了一系列 API 来允许 C 代码使用 Java 语言特性。这些 API 不仅使用了特殊的数据结构来表示 Java 类，还拥有特殊的异常处理模式。</p>
<p>JNI 中的引用可分为局部引用和全局引用。这两者都可以阻止垃圾回收器回收被引用的 Java 对象。不同的是，局部引用在 native 方法调用返回之后便会失效。传入参数以及大部分 JNI API 函数的返回值都属于局部引用。</p>
<hr>
<p>今天的实践环节，请阅读<a href="https://www.ibm.com/developerworks/java/library/j-jni/index.html">该文档</a>中的 Performance pitfalls 以及 Correctness pitfalls 两节。</p>
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |10          |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:39:06.269 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=10 
 {executed in 2 msec}
2020-11-19 20:39:06.271 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title       |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|-----|----|----|
|10  |1605789257 |1605789257 |1                |zh-hans  |0       |1                             |1      |0      |32丨JNI的运行机制 |book |1   |10  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|-----|----|----|

2020-11-19 20:39:06.276 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=10 
 {executed in 1 msec}
2020-11-19 20:39:06.279 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title       |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|----|----|
|[unread] |1605789257 |1605789257 |1                |zh-hans  |0       |1                             |1      |0      |32丨JNI的运行机制 |1   |10  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|------------|----|----|

2020-11-19 20:39:06.286 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605789546, created=1605789546, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='32丨JNI的运行机制', type='book', 
uid=1, vid=10 where nid=10 
 {executed in 1 msec}
2020-11-19 20:39:06.289 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605789546, created=1605789546, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='32丨JNI的运行机制', 
uid=1, vid=10 where nid=10 
 {executed in 1 msec}
2020-11-19 20:39:06.302 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=10 
 {executed in 2 msec}
2020-11-19 20:39:06.305 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |revision_id |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|10        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/721e33a94b641714099ed68d2f98d1fe?bkt=en-038bee77e919b76a88c4b51b016c49af15205b3a1f17acfad8ec21a256e5b5783749fa33c07d9776&fid=3757516097-778750-900544601759937&time=1605787618&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-ktsYzKgn3hE2Cecfo23w7Wvuzo4%3D&to=92&size=6192971&sta_dx=6192971&sta_cs=4333&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182976&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=6192971&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-60c1b5eb5a043665985dbd6b52e7510b8f5de7a5a4eb32109058854d200a6952ad29b2d4b85ef05b&sl=76480590&expires=8h&rt=pr&r=318236857&mlogid=7510721559050165452&vbdid=64799653&fin=32%E4%B8%A8JNI%E7%9A%84%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6.mp3&bflag=92,34-92&rtype=1&dp-logid=7510721559050165452&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=50dc2888c529211b15bebaebe7ff04bc067f6586629ce5bc&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=32%E4%B8%A8JNI%E7%9A%84%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6.mp3 |10          |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:39:06.315 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=10 
 {executed in 1 msec}
2020-11-19 20:39:06.319 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |revision_id |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/721e33a94b641714099ed68d2f98d1fe?bkt=en-038bee77e919b76a88c4b51b016c49af15205b3a1f17acfad8ec21a256e5b5783749fa33c07d9776&fid=3757516097-778750-900544601759937&time=1605787618&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-ktsYzKgn3hE2Cecfo23w7Wvuzo4%3D&to=92&size=6192971&sta_dx=6192971&sta_cs=4333&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182976&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=6192971&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-60c1b5eb5a043665985dbd6b52e7510b8f5de7a5a4eb32109058854d200a6952ad29b2d4b85ef05b&sl=76480590&expires=8h&rt=pr&r=318236857&mlogid=7510721559050165452&vbdid=64799653&fin=32%E4%B8%A8JNI%E7%9A%84%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6.mp3&bflag=92,34-92&rtype=1&dp-logid=7510721559050165452&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=50dc2888c529211b15bebaebe7ff04bc067f6586629ce5bc&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=32%E4%B8%A8JNI%E7%9A%84%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6.mp3 |10          |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:39:06.327 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=10 
 {executed in 1 msec}
2020-11-19 20:39:06.335 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |delta |field_comment_format |langcode |revision_id |
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|10        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/22/7b/be15e8a2.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>libbylg</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-03
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   据说JNI的性能很差，请问这个是否是事实，如果有这个问题，那么是否有提高性能的方法
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/4b/19/6f037647.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>东方</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-05
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师: A类的方法a()调用C++ ，fork一个进程后，在子进程回调A#a()。a()打印了类的id，前后两个进程打印id是一样的。我的问题是，fork进程后，JVM还是同一个实例？
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/08/96/231fdd9e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>未知</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-28
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   在《深入理解jvm》第二版一书中，2.3.3章节讲述对象访问定位时提到，Hotspot是使用直接指针而不是句柄去访问对象的。是否是Java内部访问时使用的直接指针而native时使用的句柄？？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/10/e2/28c09cf5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>平淡</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-28
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   请问这个JNIENV的参数，是当前执行native函数线程的JNIENV吗？线程的JNIENV是什么时候赋值的呢，找了好久也没找到，谢谢！
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>javaadu</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   （1）JNI中也需要考虑对异常的处理
   <br>（2）JNI中通过句柄引用java对象，
   <br>（3）垃圾回收器会忽略jni中的局部引用和全局引用
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-05
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   HotSpot 虚拟机是通过句柄（handle）来完成上述需求的。
   <br>
   <br>句柄是不是只是移动对象时使用，如果每次访问引用都要读内存两次，那性能影响严重
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: JNI里每次访问都要通过句柄，理论上你可以解引用拿到oop，但是不安全，一旦垃圾回收在你用oop时移动了对象，你就会操作一个实际上已经失效了的oop</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-05
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   $ java -Djava.library.path=/PATH/TO/DIR/CONTAINING/libfoo.dylib org.example.Foo
   <br>Hello, World
   <br>这个地方应该是只写路径，不要把文件名加上
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 多谢指出！</p>
  </div>
 </div></li> |0     |full_html            |zh-hans  |10          |
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:39:06.350 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=10 
 {executed in 1 msec}
2020-11-19 20:39:06.357 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |delta |field_comment_format |langcode |revision_id |
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/22/7b/be15e8a2.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>libbylg</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-03
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">4</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   据说JNI的性能很差，请问这个是否是事实，如果有这个问题，那么是否有提高性能的方法
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/4b/19/6f037647.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>东方</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-04-05
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   老师: A类的方法a()调用C++ ，fork一个进程后，在子进程回调A#a()。a()打印了类的id，前后两个进程打印id是一样的。我的问题是，fork进程后，JVM还是同一个实例？
   <br>
   <br>
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/14/08/96/231fdd9e.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>未知</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-28
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   在《深入理解jvm》第二版一书中，2.3.3章节讲述对象访问定位时提到，Hotspot是使用直接指针而不是句柄去访问对象的。是否是Java内部访问时使用的直接指针而native时使用的句柄？？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/10/e2/28c09cf5.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>平淡</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-11-28
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   请问这个JNIENV的参数，是当前执行native函数线程的JNIENV吗？线程的JNIENV是什么时候赋值的呢，找了好久也没找到，谢谢！
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>javaadu</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-23
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   （1）JNI中也需要考虑对异常的处理
   <br>（2）JNI中通过句柄引用java对象，
   <br>（3）垃圾回收器会忽略jni中的局部引用和全局引用
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-05
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   HotSpot 虚拟机是通过句柄（handle）来完成上述需求的。
   <br>
   <br>句柄是不是只是移动对象时使用，如果每次访问引用都要读内存两次，那性能影响严重
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: JNI里每次访问都要通过句柄，理论上你可以解引用拿到oop，但是不安全，一旦垃圾回收在你用oop时移动了对象，你就会操作一个实际上已经失效了的oop</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Scott</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-05
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   $ java -Djava.library.path=/PATH/TO/DIR/CONTAINING/libfoo.dylib org.example.Foo
   <br>Hello, World
   <br>这个地方应该是只写路径，不要把文件名加上
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 多谢指出！</p>
  </div>
 </div></li> |0     |full_html            |zh-hans  |10          |
|----------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:39:06.370 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=10 
 {executed in 1 msec}
2020-11-19 20:39:06.371 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|10        |book   |0     |zh-hans  |10          |https://static001.geekbang.org/resource/image/ce/83/ce606579058e7c27e0bf4ee97d8db683.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:39:06.381 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=10 
 {executed in 1 msec}
2020-11-19 20:39:06.384 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |10          |https://static001.geekbang.org/resource/image/ce/83/ce606579058e7c27e0bf4ee97d8db683.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:39:06.392 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=10 
 {executed in 1 msec}
2020-11-19 20:39:06.394 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |10          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:39:06.403 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=10 
 {executed in 1 msec}
2020-11-19 20:39:06.405 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |10          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:39:06.414 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='426171526198410' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:39:06.416 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|25      |426171526198410 |0   |net_content |
|--------|----------------|----|------------|

2020-11-19 20:40:49.312 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='426171526198410' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:40:49.314 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|25      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:40:49.322 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='426171526198410', got=1, name='net_content' where item_id=25 
 {executed in 1 msec}
2020-11-19 20:40:49.334 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='426171526198410' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:40:49.336 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------|
|item_id |fsid            |got |name  |
|--------|----------------|----|------|
|26      |426171526198410 |1   |media |
|--------|----------------|----|------|

2020-11-19 20:40:49.339 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='426171526198410' 
 {executed in 1 msec}
2020-11-19 20:40:49.341 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|11        |book   |0     |426171526198410  |zh-hans  |11          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:40:49.346 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=11 
 {executed in 2 msec}
2020-11-19 20:40:49.348 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|11  |zh-hans  |book |410752a0-defa-4810-9d74-6a025fb502c0 |11  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:40:49.357 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=11 
 {executed in 1 msec}
2020-11-19 20:40:49.359 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |426171526198410  |zh-hans  |11          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:40:49.368 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=11 
 {executed in 1 msec}
2020-11-19 20:40:49.370 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|11  |1   |3     |0            |1  |8  |11 |0  |0  |8   |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:40:49.381 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=11 
 {executed in 3 msec}
2020-11-19 20:40:49.397 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|11        |<p>今天我们来继续了解 Java 虚拟机的监控及诊断工具。</p> 
<h2>eclipse MAT</h2> 
<p>在上一篇中，我介绍了<code>jmap</code>工具，它支持导出 Java 虚拟机堆的二进制快照。eclipse 的<a href="https://www.eclipse.org/mat/">MAT 工具</a>便是其中一个能够解析这类二进制快照的工具。</p> 
<p>MAT 本身也能够获取堆的二进制快照。该功能将借助<code>jps</code>列出当前正在运行的 Java 进程，以供选择并获取快照。由于<code>jps</code>会将自己列入其中，因此你会在列表中发现一个已经结束运行的<code>jps</code>进程。</p> 
<p><img src="https://static001.geekbang.org/resource/image/c9/7e/c9072149fb112312cbc217acc2660c7e.png" alt=""></p> 
<p>MAT 获取二进制快照的方式有三种，一是使用 Attach API，二是新建一个 Java 虚拟机来运行 Attach API，三是使用<code>jmap</code>工具。</p> 
<p>这三种本质上都是在使用 Attach API。不过，在目标进程启用了<code>DisableAttachMechanism</code>参数时，前两者将不在选取列表中显示，后者将在运行时报错。</p> 
<p>当加载完堆快照之后，MAT 的主界面将展示一张饼状图，其中列举占据的 Retained heap 最多的几个对象。</p> 
<p><img src="https://static001.geekbang.org/resource/image/da/bf/da2e5894d0be535b6daa5084beb33ebf.png" alt=""></p> 
<p>这里讲一下 MAT 计算对象占据内存的<a href="https://help.eclipse.org/mars/topic/org.eclipse.mat.ui.help/concepts/shallowretainedheap.html?cp=46_2_1">两种方式</a>。第一种是 Shallow heap，指的是对象自身所占据的内存。第二种是 Retained heap，指的是当对象不再被引用时，垃圾回收器所能回收的总内存，包括对象自身所占据的内存，以及仅能够通过该对象引用到的其他对象所占据的内存。上面的饼状图便是基于 Retained heap 的。</p><!-- [[[read_end]]] --> 
<p>MAT 包括了两个比较重要的视图，分别是直方图（histogram）和支配树（dominator tree）。</p> 
<p><img src="https://static001.geekbang.org/resource/image/bb/05/bbb59ca4d86c227dac23f30c360c9405.png" alt=""></p> 
<p>MAT 的直方图和<code>jmap</code>的<code>-histo</code>子命令一样，都能够展示各个类的实例数目以及这些实例的 Shallow heap 总和。但是，MAT 的直方图还能够计算 Retained heap，并支持基于实例数目或 Retained heap 的排序方式（默认为 Shallow heap）。此外，MAT 还可以将直方图中的类按照超类、类加载器或者包名分组。</p> 
<p>当选中某个类时，MAT 界面左上角的 Inspector 窗口将展示该类的 Class 实例的相关信息，如类加载器等。（下图中的<code>ClassLoader @ 0x0</code>指的便是启动类加载器。）</p> 
<p><img src="https://static001.geekbang.org/resource/image/dd/ab/dde7022060fad3945944fb7e4c9926ab.png" alt=""></p> 
<p>支配树的概念源自图论。在一则流图（flow diagram）中，如果从入口节点到 b 节点的所有路径都要经过 a 节点，那么 a 支配（dominate）b。</p> 
<p>在 a 支配 b，且 a 不同于 b 的情况下（即 a 严格支配 b），如果从 a 节点到 b 节点的所有路径中不存在支配 b 的其他节点，那么 a 直接支配（immediate dominate）b。这里的支配树指的便是由节点的直接支配节点所组成的树状结构。</p> 
<p>我们可以将堆中所有的对象看成一张对象图，每个对象是一个图节点，而 GC Roots 则是对象图的入口，对象之间的引用关系则构成了对象图中的有向边。这样一来，我们便能够构造出该对象图所对应的支配树。</p> 
<p>MAT 将按照每个对象 Retained heap 的大小排列该支配树。如下图所示：</p> 
<p><img src="https://static001.geekbang.org/resource/image/0d/a6/0d4ea7f00d500db8a978ff0183a840a6.png" alt=""></p> 
<p>根据 Retained heap 的定义，只要能够回收上图右侧的表中的第一个对象，那么垃圾回收器便能够释放出 13.6MB 内存。</p> 
<p>需要注意的是，对象的引用型字段未必对应支配树中的父子节点关系。假设对象 a 拥有两个引用型字段，分别指向 b 和 c。而 b 和 c 各自拥有一个引用型字段，但都指向 d。如果没有其他引用指向 b、c 或 d，那么 a 直接支配 b、c 和 d，而 b（或 c）和 d 之间不存在支配关系。</p> 
<p>当在支配树视图中选中某一对象时，我们还可以通过 Path To GC Roots 功能，反向列出该对象到 GC Roots 的引用路径。如下图所示：</p> 
<p><img src="https://static001.geekbang.org/resource/image/e0/e7/e04d55d955832bf681aba16dcffc2ee7.png" alt=""></p> 
<p>MAT 还将自动匹配内存泄漏中的常见模式，并汇报潜在的内存泄漏问题。具体可参考该<a href="https://help.eclipse.org/mars/topic/org.eclipse.mat.ui.help/tasks/runningleaksuspectreport.html?cp=46_3_1">帮助文档</a>以及<a href="http://memoryanalyzer.blogspot.com/2008/05/automated-heap-dump-analysis-finding.html">这篇博客</a>。</p> 
<h2>Java Mission Control</h2> 
<blockquote> 
 <p>注意：自 Java 11 开始，本节介绍的 JFR 已经开源。但在之前的 Java 版本，JFR 属于 Commercial Feature，需要通过 Java 虚拟机参数<code>-XX:+UnlockCommercialFeatures</code>开启。</p> 
 <p>我个人不清楚也不能回答关于 Java 11 之前的版本是否仍需要商务许可（Commercial License）的问题。请另行咨询后再使用，或者直接使用 Java 11。</p> 
 <p><a href="http://jdk.java.net/jmc/">Java Mission Control</a>（JMC）是 Java 虚拟机平台上的性能监控工具。它包含一个 GUI 客户端，以及众多用来收集 Java 虚拟机性能数据的插件，如 JMX Console（能够访问用来存放虚拟机各个子系统运行数据的<a href="https://en.wikipedia.org/wiki/Java_Management_Extensions#Managed_beans">MXBeans</a>），以及虚拟机内置的高效 profiling 工具 Java Flight Recorder（JFR）。</p> 
</blockquote> 
<p>JFR 的性能开销很小，在默认配置下平均低于 1%。与其他工具相比，JFR 能够直接访问虚拟机内的数据，并且不会影响虚拟机的优化。因此，它非常适用于生产环境下满负荷运行的 Java 程序。</p> 
<p>当启用时，JFR 将记录运行过程中发生的一系列事件。其中包括 Java 层面的事件，如线程事件、锁事件，以及 Java 虚拟机内部的事件，如新建对象、垃圾回收和即时编译事件。</p> 
<p>按照发生时机以及持续时间来划分，JFR 的事件共有四种类型，它们分别为以下四种。</p> 
<ol> 
 <li>瞬时事件（Instant Event），用户关心的是它们发生与否，例如异常、线程启动事件。</li> 
 <li>持续事件（Duration Event），用户关心的是它们的持续时间，例如垃圾回收事件。</li> 
 <li>计时事件（Timed Event），是时长超出指定阈值的持续事件。</li> 
 <li>取样事件（Sample Event），是周期性取样的事件。<br> 取样事件的其中一个常见例子便是方法抽样（Method Sampling），即每隔一段时间统计各个线程的栈轨迹。如果在这些抽样取得的栈轨迹中存在一个反复出现的方法，那么我们可以推测该方法是热点方法。</li> 
</ol> 
<p>JFR 的取样事件要比其他工具更加精确。以方法抽样为例，其他工具通常基于 JVMTI（<a href="https://docs.oracle.com/en/java/javase/11/docs/specs/jvmti.html">Java Virtual Machine Tool Interface</a>）的<code>GetAllStackTraces</code> API。该 API 依赖于安全点机制，其获得的栈轨迹总是在安全点上，由此得出的结论未必精确。JFR 则不然，它不依赖于安全点机制，因此其结果相对来说更加精确。</p> 
<p>JFR 的启用方式主要有三种。</p> 
<p>第一种是在运行目标 Java 程序时添加<code>-XX:StartFlightRecording=</code>参数。关于该参数的配置详情，你可以参考<a href="https://docs.oracle.com/en/java/javase/11/tools/java.html">该帮助文档</a>（请在页面中搜索<code>StartFlightRecording</code>）。</p> 
<p>下面我列举三种常见的配置方式。</p> 
<ul> 
 <li>在下面这条命令中，JFR 将会在 Java 虚拟机启动 5s 后（对应<code>delay=5s</code>）收集数据，持续 20s（对应<code>duration=20s</code>）。当收集完毕后，JFR 会将收集得到的数据保存至指定的文件中（对应<code>filename=myrecording.jfr</code>）。</li> 
</ul> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # Time fixed
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -XX:StartFlightRecording=delay=5s,duration=20s,filename=myrecording.jfr,settings=profile MyApp
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<blockquote> 
 <p><code>settings=profile</code>指定了 JFR 所收集的事件类型。默认情况下，JFR 将加载配置文件<code>$JDK/lib/jfr/default.jfc</code>，并识别其中所包含的事件类型。当使用了<code>settings=profile</code>配置时，JFR 将加载配置文件<code>$JDK/lib/jfr/profile.jfc</code>。该配置文件所包含的事件类型要多于默认的<code>default.jfc</code>，因此性能开销也要大一些（约为 2%）。</p> 
 <p><code>default.jfc</code>以及<code>profile.jfc</code>均为 XML 文件。后面我会介绍如何利用 JMC 来进行修改。</p> 
</blockquote> 
<ul> 
 <li>在下面这条命令中，JFR 将在 Java 虚拟机启动之后持续收集数据，直至进程退出。在进程退出时（对应<code>dumponexit=true</code>），JFR 会将收集得到的数据保存至指定的文件中。</li> 
</ul> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # Continuous, dump on exit
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -XX:StartFlightRecording=dumponexit=true,filename=myrecording.jfr MyApp
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<ul> 
 <li>在下面这条命令中，JFR 将在 Java 虚拟机启动之后持续收集数据，直至进程退出。该命令不会主动保存 JFR 收集得到的数据。</li> 
</ul> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # Continuous, dump on demand
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -XX:StartFlightRecording=maxage=10m,maxsize=100m,name=SomeLabel MyApp
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Started recording 1.
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Use jcmd 38502 JFR.dump name=SomeLabel filename=FILEPATH to copy recording data to file.
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>由于 JFR 将持续收集数据，如果不加以限制，那么 JFR 可能会填满硬盘的所有空间。因此，我们有必要对这种模式下所收集的数据进行限制。</p> 
<p>在这条命令中，<code>maxage=10m</code>指的是仅保留 10 分钟以内的事件，<code>maxsize=100m</code>指的是仅保留 100MB 以内的事件。一旦所收集的事件达到其中任意一个限制，JFR 便会开始清除不合规格的事件。</p> 
<p>然而，为了保持较小的性能开销，JFR 并不会频繁地校验这两个限制。因此，在实践过程中你往往会发现指定文件的大小超出限制，或者文件中所存储事件的时间超出限制。具体解释请参考<a href="https://community.oracle.com/thread/3514679">这篇帖子</a>。</p> 
<p>前面提到，该命令不会主动保存 JFR 收集得到的数据。用户需要运行<code>jcmd &lt;PID&gt; JFR.dump</code>命令方能保存。</p> 
<p>这便是 JFR 的第二种启用方式，即通过<code>jcmd</code>来让 JFR 开始收集数据、停止收集数据，或者保存所收集的数据，对应的子命令分别为<code>JFR.start</code>，<code>JFR.stop</code>，以及<code>JFR.dump</code>。</p> 
<p><code>JFR.start</code>子命令所接收的配置及格式和<code>-XX:StartFlightRecording=</code>参数的类似。这些配置包括<code>delay</code>、<code>duration</code>、<code>settings</code>、<code>maxage</code>、<code>maxsize</code>以及<code>name</code>。前几个参数我们都已经介绍过了，最后一个参数<code>name</code>就是一个标签，当同一进程中存在多个 JFR 数据收集操作时，我们可以通过该标签来辨别。</p> 
<p>在启动目标进程时，我们不再添加<code>-XX:StartFlightRecording=</code>参数。在目标进程运行过程中，我们可以运行<code>JFR.start</code>子命令远程启用目标进程的 JFR 功能。具体用法如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jcmd &lt;PID&gt; JFR.start settings=profile maxage=10m maxsize=150m name=SomeLabel
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>上述命令运行过后，目标进程中的 JFR 已经开始收集数据。此时，我们可以通过下述命令来导出已经收集到的数据：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jcmd &lt;PID&gt; JFR.dump name=SomeLabel filename=myrecording.jfr
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>最后，我们可以通过下述命令关闭目标进程中的 JFR：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jcmd &lt;PID&gt; JFR.stop name=SomeLabel
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>关于<code>JFR.start</code>、<code>JFR.dump</code>和<code>JFR.stop</code>的其他用法，你可以参考<a href="https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/comline.htm#JFRRT185">该帮助文档</a>。</p> 
<p>第三种启用 JFR 的方式则是 JMC 中的 JFR 插件。</p> 
<p><img src="https://static001.geekbang.org/resource/image/39/16/395900f606fd93570196a6dcbac75e16.png" alt=""></p> 
<p>在 JMC GUI 客户端左侧的 JVM 浏览器中，我们可以看到所有正在运行的 Java 程序。当点击右键弹出菜单中的<code>Start Flight Recording...</code>时，JMC 便会弹出另一个窗口，用来配置 JFR 的启动参数，如下图所示：</p> 
<p><img src="https://static001.geekbang.org/resource/image/31/6a/31f86bc1cafc569f51e0364d716cab6a.png" alt=""></p> 
<p>这里的配置参数与前两种启动 JFR 的方式并无二致，同样也包括标签名、收集数据的持续时间、缓存事件的时间及空间限制，以及配置所要监控事件的<code>Event settings</code>。<br> （这里对应前两种启动方式的<code>settings=default|profile</code>）</p> 
<blockquote> 
 <p>JMC 提供了两个选择：Continuous 和 Profiling，分别对应<code>$JDK/lib/jfr/</code>里的<code>default.jfc</code>和<code>profile.jfc</code>。</p> 
</blockquote> 
<p>我们可以通过 JMC 的<code>Flight Recording Template Manager</code>导入这些 jfc 文件，并在 GUI 界面上进行更改。更改完毕后，我们可以导出为新的 jfc 文件，以便在服务器端使用。</p> 
<p>当收集完成时，JMC 会自动打开所生成的 jfr 文件，并在主界面中列举目标进程在收集数据的这段时间内的潜在问题。例如，<code>Parallel Threads</code>一节，便汇报了没有完整利用 CPU 资源的问题。</p> 
<p><img src="https://static001.geekbang.org/resource/image/5a/7c/5a4302c29947518250e2b697aecc8d7c.png" alt=""></p> 
<p>客户端的左边则罗列了 Java 虚拟机的各个子系统。JMC 将根据 JFR 所收集到的每个子系统的事件来进行可视化，转换成图或者表。</p> 
<p><img src="https://static001.geekbang.org/resource/image/db/ff/dbc36a8713af058c79df2878379276ff.png" alt=""></p> 
<p>这里我简单地介绍其中两个。</p> 
<p>垃圾回收子系统所对应的选项卡展示了 JFR 所收集到的 GC 事件，以及基于这些 GC 事件的数据生成的堆已用空间的分布图，Metaspace 大小的分布图，最长暂停以及总暂停的直方分布图。</p> 
<p><img src="https://static001.geekbang.org/resource/image/56/0c/56f9fb2932ffb63ffa29e95dc779100c.png" alt=""></p> 
<p>即时编译子系统所对应的选项卡则展示了方法编译时间的直方图，以及按编译时间排序的编译任务表。</p> 
<p>后者可能出现同方法名同方法描述符的编译任务。其原因主要有两个，一是不同编译层次的即时编译，如 3 层的 C1 编译以及 4 层的 C2 编译。二是去优化后的重新编译。</p> 
<p><img src="https://static001.geekbang.org/resource/image/6e/c8/6e7e41a6f8945a2b65d67c18ea5293c8.png" alt=""></p> 
<p>JMC 的图表总体而言都不难理解。你可以逐个探索，我在这里便不详细展开了。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了两个 GUI 工具：eclipse MAT 以及 JMC。</p> 
<p>eclipse MAT 可用于分析由<code>jmap</code>命令导出的 Java 堆快照。它包括两个相对比较重要的视图，分别为直方图和支配树。直方图展示了各个类的实例数目以及这些实例的 Shallow heap 或 Retained heap 的总和。支配树则展示了快照中每个对象所直接支配的对象。</p> 
<p>Java Mission Control 是 Java 虚拟机平台上的性能监控工具。Java Flight Recorder 是 JMC 的其中一个组件，能够以极低的性能开销收集 Java 虚拟机的性能数据。</p> 
<p>JFR 的启用方式有三种，分别为在命令行中使用<code>-XX:StartFlightRecording=</code>参数，使用<code>jcmd</code>的<code>JFR.*</code>子命令，以及 JMC 的 JFR 插件。JMC 能够加载 JFR 的输出结果，并且生成各种信息丰富的图表。</p> 
<hr> 
<p>今天的实践环节，请你试用 JMC 中的 MBean Server 功能，并通过 JMC 的帮助文档（<code>Help-&gt;Java Mission Control Help</code>），以及<a href="https://docs.oracle.com/javase/tutorial/jmx/mbeans/index.html">该教程</a>来了解该功能的具体含义。</p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/7f/2a68f0f2b5de35f29b045fe82923ac7f.png" alt=""></p> 
<p>由于篇幅的限制，我就不再介绍<a href="https://visualvm.github.io/index.html">VisualVM</a> 以及<a href="https://github.com/AdoptOpenJDK/jitwatch">JITWatch</a> 了。感兴趣的同学可自行下载研究。</p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |11          |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:40:49.413 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=11 
 {executed in 4 msec}
2020-11-19 20:40:49.429 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>今天我们来继续了解 Java 虚拟机的监控及诊断工具。</p> 
<h2>eclipse MAT</h2> 
<p>在上一篇中，我介绍了<code>jmap</code>工具，它支持导出 Java 虚拟机堆的二进制快照。eclipse 的<a href="https://www.eclipse.org/mat/">MAT 工具</a>便是其中一个能够解析这类二进制快照的工具。</p> 
<p>MAT 本身也能够获取堆的二进制快照。该功能将借助<code>jps</code>列出当前正在运行的 Java 进程，以供选择并获取快照。由于<code>jps</code>会将自己列入其中，因此你会在列表中发现一个已经结束运行的<code>jps</code>进程。</p> 
<p><img src="https://static001.geekbang.org/resource/image/c9/7e/c9072149fb112312cbc217acc2660c7e.png" alt=""></p> 
<p>MAT 获取二进制快照的方式有三种，一是使用 Attach API，二是新建一个 Java 虚拟机来运行 Attach API，三是使用<code>jmap</code>工具。</p> 
<p>这三种本质上都是在使用 Attach API。不过，在目标进程启用了<code>DisableAttachMechanism</code>参数时，前两者将不在选取列表中显示，后者将在运行时报错。</p> 
<p>当加载完堆快照之后，MAT 的主界面将展示一张饼状图，其中列举占据的 Retained heap 最多的几个对象。</p> 
<p><img src="https://static001.geekbang.org/resource/image/da/bf/da2e5894d0be535b6daa5084beb33ebf.png" alt=""></p> 
<p>这里讲一下 MAT 计算对象占据内存的<a href="https://help.eclipse.org/mars/topic/org.eclipse.mat.ui.help/concepts/shallowretainedheap.html?cp=46_2_1">两种方式</a>。第一种是 Shallow heap，指的是对象自身所占据的内存。第二种是 Retained heap，指的是当对象不再被引用时，垃圾回收器所能回收的总内存，包括对象自身所占据的内存，以及仅能够通过该对象引用到的其他对象所占据的内存。上面的饼状图便是基于 Retained heap 的。</p><!-- [[[read_end]]] --> 
<p>MAT 包括了两个比较重要的视图，分别是直方图（histogram）和支配树（dominator tree）。</p> 
<p><img src="https://static001.geekbang.org/resource/image/bb/05/bbb59ca4d86c227dac23f30c360c9405.png" alt=""></p> 
<p>MAT 的直方图和<code>jmap</code>的<code>-histo</code>子命令一样，都能够展示各个类的实例数目以及这些实例的 Shallow heap 总和。但是，MAT 的直方图还能够计算 Retained heap，并支持基于实例数目或 Retained heap 的排序方式（默认为 Shallow heap）。此外，MAT 还可以将直方图中的类按照超类、类加载器或者包名分组。</p> 
<p>当选中某个类时，MAT 界面左上角的 Inspector 窗口将展示该类的 Class 实例的相关信息，如类加载器等。（下图中的<code>ClassLoader @ 0x0</code>指的便是启动类加载器。）</p> 
<p><img src="https://static001.geekbang.org/resource/image/dd/ab/dde7022060fad3945944fb7e4c9926ab.png" alt=""></p> 
<p>支配树的概念源自图论。在一则流图（flow diagram）中，如果从入口节点到 b 节点的所有路径都要经过 a 节点，那么 a 支配（dominate）b。</p> 
<p>在 a 支配 b，且 a 不同于 b 的情况下（即 a 严格支配 b），如果从 a 节点到 b 节点的所有路径中不存在支配 b 的其他节点，那么 a 直接支配（immediate dominate）b。这里的支配树指的便是由节点的直接支配节点所组成的树状结构。</p> 
<p>我们可以将堆中所有的对象看成一张对象图，每个对象是一个图节点，而 GC Roots 则是对象图的入口，对象之间的引用关系则构成了对象图中的有向边。这样一来，我们便能够构造出该对象图所对应的支配树。</p> 
<p>MAT 将按照每个对象 Retained heap 的大小排列该支配树。如下图所示：</p> 
<p><img src="https://static001.geekbang.org/resource/image/0d/a6/0d4ea7f00d500db8a978ff0183a840a6.png" alt=""></p> 
<p>根据 Retained heap 的定义，只要能够回收上图右侧的表中的第一个对象，那么垃圾回收器便能够释放出 13.6MB 内存。</p> 
<p>需要注意的是，对象的引用型字段未必对应支配树中的父子节点关系。假设对象 a 拥有两个引用型字段，分别指向 b 和 c。而 b 和 c 各自拥有一个引用型字段，但都指向 d。如果没有其他引用指向 b、c 或 d，那么 a 直接支配 b、c 和 d，而 b（或 c）和 d 之间不存在支配关系。</p> 
<p>当在支配树视图中选中某一对象时，我们还可以通过 Path To GC Roots 功能，反向列出该对象到 GC Roots 的引用路径。如下图所示：</p> 
<p><img src="https://static001.geekbang.org/resource/image/e0/e7/e04d55d955832bf681aba16dcffc2ee7.png" alt=""></p> 
<p>MAT 还将自动匹配内存泄漏中的常见模式，并汇报潜在的内存泄漏问题。具体可参考该<a href="https://help.eclipse.org/mars/topic/org.eclipse.mat.ui.help/tasks/runningleaksuspectreport.html?cp=46_3_1">帮助文档</a>以及<a href="http://memoryanalyzer.blogspot.com/2008/05/automated-heap-dump-analysis-finding.html">这篇博客</a>。</p> 
<h2>Java Mission Control</h2> 
<blockquote> 
 <p>注意：自 Java 11 开始，本节介绍的 JFR 已经开源。但在之前的 Java 版本，JFR 属于 Commercial Feature，需要通过 Java 虚拟机参数<code>-XX:+UnlockCommercialFeatures</code>开启。</p> 
 <p>我个人不清楚也不能回答关于 Java 11 之前的版本是否仍需要商务许可（Commercial License）的问题。请另行咨询后再使用，或者直接使用 Java 11。</p> 
 <p><a href="http://jdk.java.net/jmc/">Java Mission Control</a>（JMC）是 Java 虚拟机平台上的性能监控工具。它包含一个 GUI 客户端，以及众多用来收集 Java 虚拟机性能数据的插件，如 JMX Console（能够访问用来存放虚拟机各个子系统运行数据的<a href="https://en.wikipedia.org/wiki/Java_Management_Extensions#Managed_beans">MXBeans</a>），以及虚拟机内置的高效 profiling 工具 Java Flight Recorder（JFR）。</p> 
</blockquote> 
<p>JFR 的性能开销很小，在默认配置下平均低于 1%。与其他工具相比，JFR 能够直接访问虚拟机内的数据，并且不会影响虚拟机的优化。因此，它非常适用于生产环境下满负荷运行的 Java 程序。</p> 
<p>当启用时，JFR 将记录运行过程中发生的一系列事件。其中包括 Java 层面的事件，如线程事件、锁事件，以及 Java 虚拟机内部的事件，如新建对象、垃圾回收和即时编译事件。</p> 
<p>按照发生时机以及持续时间来划分，JFR 的事件共有四种类型，它们分别为以下四种。</p> 
<ol> 
 <li>瞬时事件（Instant Event），用户关心的是它们发生与否，例如异常、线程启动事件。</li> 
 <li>持续事件（Duration Event），用户关心的是它们的持续时间，例如垃圾回收事件。</li> 
 <li>计时事件（Timed Event），是时长超出指定阈值的持续事件。</li> 
 <li>取样事件（Sample Event），是周期性取样的事件。<br> 取样事件的其中一个常见例子便是方法抽样（Method Sampling），即每隔一段时间统计各个线程的栈轨迹。如果在这些抽样取得的栈轨迹中存在一个反复出现的方法，那么我们可以推测该方法是热点方法。</li> 
</ol> 
<p>JFR 的取样事件要比其他工具更加精确。以方法抽样为例，其他工具通常基于 JVMTI（<a href="https://docs.oracle.com/en/java/javase/11/docs/specs/jvmti.html">Java Virtual Machine Tool Interface</a>）的<code>GetAllStackTraces</code> API。该 API 依赖于安全点机制，其获得的栈轨迹总是在安全点上，由此得出的结论未必精确。JFR 则不然，它不依赖于安全点机制，因此其结果相对来说更加精确。</p> 
<p>JFR 的启用方式主要有三种。</p> 
<p>第一种是在运行目标 Java 程序时添加<code>-XX:StartFlightRecording=</code>参数。关于该参数的配置详情，你可以参考<a href="https://docs.oracle.com/en/java/javase/11/tools/java.html">该帮助文档</a>（请在页面中搜索<code>StartFlightRecording</code>）。</p> 
<p>下面我列举三种常见的配置方式。</p> 
<ul> 
 <li>在下面这条命令中，JFR 将会在 Java 虚拟机启动 5s 后（对应<code>delay=5s</code>）收集数据，持续 20s（对应<code>duration=20s</code>）。当收集完毕后，JFR 会将收集得到的数据保存至指定的文件中（对应<code>filename=myrecording.jfr</code>）。</li> 
</ul> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # Time fixed
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -XX:StartFlightRecording=delay=5s,duration=20s,filename=myrecording.jfr,settings=profile MyApp
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<blockquote> 
 <p><code>settings=profile</code>指定了 JFR 所收集的事件类型。默认情况下，JFR 将加载配置文件<code>$JDK/lib/jfr/default.jfc</code>，并识别其中所包含的事件类型。当使用了<code>settings=profile</code>配置时，JFR 将加载配置文件<code>$JDK/lib/jfr/profile.jfc</code>。该配置文件所包含的事件类型要多于默认的<code>default.jfc</code>，因此性能开销也要大一些（约为 2%）。</p> 
 <p><code>default.jfc</code>以及<code>profile.jfc</code>均为 XML 文件。后面我会介绍如何利用 JMC 来进行修改。</p> 
</blockquote> 
<ul> 
 <li>在下面这条命令中，JFR 将在 Java 虚拟机启动之后持续收集数据，直至进程退出。在进程退出时（对应<code>dumponexit=true</code>），JFR 会将收集得到的数据保存至指定的文件中。</li> 
</ul> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # Continuous, dump on exit
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -XX:StartFlightRecording=dumponexit=true,filename=myrecording.jfr MyApp
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<ul> 
 <li>在下面这条命令中，JFR 将在 Java 虚拟机启动之后持续收集数据，直至进程退出。该命令不会主动保存 JFR 收集得到的数据。</li> 
</ul> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # Continuous, dump on demand
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -XX:StartFlightRecording=maxage=10m,maxsize=100m,name=SomeLabel MyApp
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Started recording 1.
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Use jcmd 38502 JFR.dump name=SomeLabel filename=FILEPATH to copy recording data to file.
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>由于 JFR 将持续收集数据，如果不加以限制，那么 JFR 可能会填满硬盘的所有空间。因此，我们有必要对这种模式下所收集的数据进行限制。</p> 
<p>在这条命令中，<code>maxage=10m</code>指的是仅保留 10 分钟以内的事件，<code>maxsize=100m</code>指的是仅保留 100MB 以内的事件。一旦所收集的事件达到其中任意一个限制，JFR 便会开始清除不合规格的事件。</p> 
<p>然而，为了保持较小的性能开销，JFR 并不会频繁地校验这两个限制。因此，在实践过程中你往往会发现指定文件的大小超出限制，或者文件中所存储事件的时间超出限制。具体解释请参考<a href="https://community.oracle.com/thread/3514679">这篇帖子</a>。</p> 
<p>前面提到，该命令不会主动保存 JFR 收集得到的数据。用户需要运行<code>jcmd &lt;PID&gt; JFR.dump</code>命令方能保存。</p> 
<p>这便是 JFR 的第二种启用方式，即通过<code>jcmd</code>来让 JFR 开始收集数据、停止收集数据，或者保存所收集的数据，对应的子命令分别为<code>JFR.start</code>，<code>JFR.stop</code>，以及<code>JFR.dump</code>。</p> 
<p><code>JFR.start</code>子命令所接收的配置及格式和<code>-XX:StartFlightRecording=</code>参数的类似。这些配置包括<code>delay</code>、<code>duration</code>、<code>settings</code>、<code>maxage</code>、<code>maxsize</code>以及<code>name</code>。前几个参数我们都已经介绍过了，最后一个参数<code>name</code>就是一个标签，当同一进程中存在多个 JFR 数据收集操作时，我们可以通过该标签来辨别。</p> 
<p>在启动目标进程时，我们不再添加<code>-XX:StartFlightRecording=</code>参数。在目标进程运行过程中，我们可以运行<code>JFR.start</code>子命令远程启用目标进程的 JFR 功能。具体用法如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jcmd &lt;PID&gt; JFR.start settings=profile maxage=10m maxsize=150m name=SomeLabel
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>上述命令运行过后，目标进程中的 JFR 已经开始收集数据。此时，我们可以通过下述命令来导出已经收集到的数据：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jcmd &lt;PID&gt; JFR.dump name=SomeLabel filename=myrecording.jfr
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>最后，我们可以通过下述命令关闭目标进程中的 JFR：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jcmd &lt;PID&gt; JFR.stop name=SomeLabel
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>关于<code>JFR.start</code>、<code>JFR.dump</code>和<code>JFR.stop</code>的其他用法，你可以参考<a href="https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/comline.htm#JFRRT185">该帮助文档</a>。</p> 
<p>第三种启用 JFR 的方式则是 JMC 中的 JFR 插件。</p> 
<p><img src="https://static001.geekbang.org/resource/image/39/16/395900f606fd93570196a6dcbac75e16.png" alt=""></p> 
<p>在 JMC GUI 客户端左侧的 JVM 浏览器中，我们可以看到所有正在运行的 Java 程序。当点击右键弹出菜单中的<code>Start Flight Recording...</code>时，JMC 便会弹出另一个窗口，用来配置 JFR 的启动参数，如下图所示：</p> 
<p><img src="https://static001.geekbang.org/resource/image/31/6a/31f86bc1cafc569f51e0364d716cab6a.png" alt=""></p> 
<p>这里的配置参数与前两种启动 JFR 的方式并无二致，同样也包括标签名、收集数据的持续时间、缓存事件的时间及空间限制，以及配置所要监控事件的<code>Event settings</code>。<br> （这里对应前两种启动方式的<code>settings=default|profile</code>）</p> 
<blockquote> 
 <p>JMC 提供了两个选择：Continuous 和 Profiling，分别对应<code>$JDK/lib/jfr/</code>里的<code>default.jfc</code>和<code>profile.jfc</code>。</p> 
</blockquote> 
<p>我们可以通过 JMC 的<code>Flight Recording Template Manager</code>导入这些 jfc 文件，并在 GUI 界面上进行更改。更改完毕后，我们可以导出为新的 jfc 文件，以便在服务器端使用。</p> 
<p>当收集完成时，JMC 会自动打开所生成的 jfr 文件，并在主界面中列举目标进程在收集数据的这段时间内的潜在问题。例如，<code>Parallel Threads</code>一节，便汇报了没有完整利用 CPU 资源的问题。</p> 
<p><img src="https://static001.geekbang.org/resource/image/5a/7c/5a4302c29947518250e2b697aecc8d7c.png" alt=""></p> 
<p>客户端的左边则罗列了 Java 虚拟机的各个子系统。JMC 将根据 JFR 所收集到的每个子系统的事件来进行可视化，转换成图或者表。</p> 
<p><img src="https://static001.geekbang.org/resource/image/db/ff/dbc36a8713af058c79df2878379276ff.png" alt=""></p> 
<p>这里我简单地介绍其中两个。</p> 
<p>垃圾回收子系统所对应的选项卡展示了 JFR 所收集到的 GC 事件，以及基于这些 GC 事件的数据生成的堆已用空间的分布图，Metaspace 大小的分布图，最长暂停以及总暂停的直方分布图。</p> 
<p><img src="https://static001.geekbang.org/resource/image/56/0c/56f9fb2932ffb63ffa29e95dc779100c.png" alt=""></p> 
<p>即时编译子系统所对应的选项卡则展示了方法编译时间的直方图，以及按编译时间排序的编译任务表。</p> 
<p>后者可能出现同方法名同方法描述符的编译任务。其原因主要有两个，一是不同编译层次的即时编译，如 3 层的 C1 编译以及 4 层的 C2 编译。二是去优化后的重新编译。</p> 
<p><img src="https://static001.geekbang.org/resource/image/6e/c8/6e7e41a6f8945a2b65d67c18ea5293c8.png" alt=""></p> 
<p>JMC 的图表总体而言都不难理解。你可以逐个探索，我在这里便不详细展开了。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了两个 GUI 工具：eclipse MAT 以及 JMC。</p> 
<p>eclipse MAT 可用于分析由<code>jmap</code>命令导出的 Java 堆快照。它包括两个相对比较重要的视图，分别为直方图和支配树。直方图展示了各个类的实例数目以及这些实例的 Shallow heap 或 Retained heap 的总和。支配树则展示了快照中每个对象所直接支配的对象。</p> 
<p>Java Mission Control 是 Java 虚拟机平台上的性能监控工具。Java Flight Recorder 是 JMC 的其中一个组件，能够以极低的性能开销收集 Java 虚拟机的性能数据。</p> 
<p>JFR 的启用方式有三种，分别为在命令行中使用<code>-XX:StartFlightRecording=</code>参数，使用<code>jcmd</code>的<code>JFR.*</code>子命令，以及 JMC 的 JFR 插件。JMC 能够加载 JFR 的输出结果，并且生成各种信息丰富的图表。</p> 
<hr> 
<p>今天的实践环节，请你试用 JMC 中的 MBean Server 功能，并通过 JMC 的帮助文档（<code>Help-&gt;Java Mission Control Help</code>），以及<a href="https://docs.oracle.com/javase/tutorial/jmx/mbeans/index.html">该教程</a>来了解该功能的具体含义。</p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/7f/2a68f0f2b5de35f29b045fe82923ac7f.png" alt=""></p> 
<p>由于篇幅的限制，我就不再介绍<a href="https://visualvm.github.io/index.html">VisualVM</a> 以及<a href="https://github.com/AdoptOpenJDK/jitwatch">JITWatch</a> 了。感兴趣的同学可自行下载研究。</p> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |11          |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:40:49.454 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=11 
 {executed in 1 msec}
2020-11-19 20:40:49.456 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                    |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|
|11  |1605789257 |1605789257 |1                |zh-hans  |0       |1                             |1      |0      |31丨Java虚拟机的监控及诊断工具（GUI篇） |book |1   |11  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|

2020-11-19 20:40:49.460 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=11 
 {executed in 1 msec}
2020-11-19 20:40:49.463 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                    |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|
|[unread] |1605789257 |1605789257 |1                |zh-hans  |0       |1                             |1      |0      |31丨Java虚拟机的监控及诊断工具（GUI篇） |1   |11  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|

2020-11-19 20:40:49.470 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605789649, created=1605789649, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='31丨Java虚拟机的监控及诊断工具（GUI篇）', 
type='book', uid=1, vid=11 where nid=11 
 {executed in 1 msec}
2020-11-19 20:40:49.474 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605789649, created=1605789649, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='31丨Java虚拟机的监控及诊断工具（GUI篇）', 
uid=1, vid=11 where nid=11 
 {executed in 1 msec}
2020-11-19 20:40:49.489 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=11 
 {executed in 1 msec}
2020-11-19 20:40:49.493 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |revision_id |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|11        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/093e396423e5ea88310e9ebda07f737a?bkt=en-1df98aeb722e81f554d013409c7ad2311a5738bd3402630b021769025eda55949c343229fbc0fe54&fid=3757516097-778750-935237851304538&time=1605787721&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-LQO%2BKCJ7MV3T7E6ZZqNdz87M8PA%3D&to=92&size=6439567&sta_dx=6439567&sta_cs=4347&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182976&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=6439567&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-21af6b90c2f2389b0c4e7086fcd4f0b5a0137ef57ec221c955c17b248f96281b507558f7cbf265b4&sl=76480590&expires=8h&rt=pr&r=443308252&mlogid=7510749276293279592&vbdid=64799653&fin=31%E4%B8%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%EF%BC%88GUI%E7%AF%87%EF%BC%89.mp3&bflag=92,34-92&rtype=1&dp-logid=7510749276293279592&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=648eaef5c3fa81d1c70fe19c5b3aedabdd416d5c1f13f87b&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=31%E4%B8%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%EF%BC%88GUI%E7%AF%87%EF%BC%89.mp3 |11          |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:40:49.505 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=11 
 {executed in 1 msec}
2020-11-19 20:40:49.509 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |revision_id |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/093e396423e5ea88310e9ebda07f737a?bkt=en-1df98aeb722e81f554d013409c7ad2311a5738bd3402630b021769025eda55949c343229fbc0fe54&fid=3757516097-778750-935237851304538&time=1605787721&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-LQO%2BKCJ7MV3T7E6ZZqNdz87M8PA%3D&to=92&size=6439567&sta_dx=6439567&sta_cs=4347&sta_ft=mp3&sta_ct=7&sta_mt=0&fm2=MH%2CQingdao%2CAnywhere%2C%2Cshanghai%2Ccnc&ctime=1567182976&mtime=1605787492&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=6439567&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-21af6b90c2f2389b0c4e7086fcd4f0b5a0137ef57ec221c955c17b248f96281b507558f7cbf265b4&sl=76480590&expires=8h&rt=pr&r=443308252&mlogid=7510749276293279592&vbdid=64799653&fin=31%E4%B8%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%EF%BC%88GUI%E7%AF%87%EF%BC%89.mp3&bflag=92,34-92&rtype=1&dp-logid=7510749276293279592&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=648eaef5c3fa81d1c70fe19c5b3aedabdd416d5c1f13f87b&hflag=30&adg=c_0f3c8fb981bae1fdae375754a6f1d609&reqlabel=778750_l_eeb31e180410b8be0e62f686c2b42c5d_-1_43d73532db4f9890a29565ef474ca519&ibp=1&by=themis&filename=31%E4%B8%A8Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%EF%BC%88GUI%E7%AF%87%EF%BC%89.mp3 |11          |
|----------|-------|------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 20:40:49.519 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=11 
 {executed in 1 msec}
2020-11-19 20:40:49.525 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|11        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/d4/c4/be9f44bb.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>阿武</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   国庆也推送，大写的服。👍👍
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Maxwell</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   能否分享下实际工作中发生内存泄露，使用MAT分析和定位的案例呢？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIKVicSvNf6OFvv4m3ibfsYCIUxic41kODPa9cuGUJjPcBtryLBDljalIVUiaJKlkGEJtOMZ03XSFlx1w/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>fuyu</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   要是能举几个例子结合工具排查就更好了。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-06
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   JVM GUI监控和检测工具
   <br>1:MAT
   <br>2:JMC
   <br>这两个没怎么用过，回头下载、安装、使用下，国庆回家了，雨迪老师还在匀速的前进，是不是课程是提前编写好，录制好，然后定时放出？无论怎么非常感谢，跟着老师确实学习了不少东西，最后两天补上拉下的课程。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 提前一周写好的。极客的小编辛苦些，需要加班较稿。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>qpm</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-02
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   MAT是一个非常有用的工具，已经用它成功排查过内存泄露的问题。
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/21/c7/966b6b85.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>遇见未来</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师您好，openjdk可以用JFR嘛，配置了好久没成功，如果不能有没有类似的工具推荐，谢谢😁
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: Java 11开始才进OpenJDK的</p>
  </div>
 </div></li> |0     |full_html            |zh-hans  |11          |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:40:49.540 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=11 
 {executed in 1 msec}
2020-11-19 20:40:49.546 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/d4/c4/be9f44bb.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>阿武</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">3</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   国庆也推送，大写的服。👍👍
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Maxwell</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-12-21
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   能否分享下实际工作中发生内存泄露，使用MAT分析和定位的案例呢？
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIKVicSvNf6OFvv4m3ibfsYCIUxic41kODPa9cuGUJjPcBtryLBDljalIVUiaJKlkGEJtOMZ03XSFlx1w/132" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>fuyu</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-01
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">2</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   要是能举几个例子结合工具排查就更好了。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>godtrue</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-06
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0">
   JVM GUI监控和检测工具
   <br>1:MAT
   <br>2:JMC
   <br>这两个没怎么用过，回头下载、安装、使用下，国庆回家了，雨迪老师还在匀速的前进，是不是课程是提前编写好，录制好，然后定时放出？无论怎么非常感谢，跟着老师确实学习了不少东西，最后两天补上拉下的课程。
  </div> 
  <div class="_2r3UB1GX_0">
   <span>展开</span><i class="iconfont"></i>
  </div> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: 提前一周写好的。极客的小编辛苦些，需要加班较稿。</p>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>qpm</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-02
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class="">1</span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   MAT是一个非常有用的工具，已经用它成功排查过内存泄露的问题。
  </div> <!----> <!---->
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/12/21/c7/966b6b85.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>遇见未来</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2018-10-26
    </div>
   </div> 
   <div class="_2eMTs2JE_0">
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!----> <!---->
   </div>
  </div> 
  <div class="_3M6kV3zb_0 _3D2NkqD6_0">
   老师您好，openjdk可以用JFR嘛，配置了好久没成功，如果不能有没有类似的工具推荐，谢谢😁
  </div> <!----> 
  <div class="_2xNIY4NG_0">
   <p class="_33BLbmw4_0">作者回复: Java 11开始才进OpenJDK的</p>
  </div>
 </div></li> |0     |full_html            |zh-hans  |11          |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 20:40:49.558 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=11 
 {executed in 1 msec}
2020-11-19 20:40:49.560 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|11        |book   |0     |zh-hans  |11          |https://static001.geekbang.org/resource/image/63/9d/6385fadb955342b24fbd9f98011be59d.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:40:49.574 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=11 
 {executed in 2 msec}
2020-11-19 20:40:49.576 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |11          |https://static001.geekbang.org/resource/image/63/9d/6385fadb955342b24fbd9f98011be59d.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 20:40:49.587 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=11 
 {executed in 2 msec}
2020-11-19 20:40:49.589 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |11          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:40:49.602 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=11 
 {executed in 2 msec}
2020-11-19 20:40:49.604 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |11          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 20:40:49.678 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='914709796431524' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 20:40:49.681 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------------|
|item_id |fsid            |got |name        |
|--------|----------------|----|------------|
|27      |914709796431524 |0   |net_content |
|--------|----------------|----|------------|

2020-11-19 20:41:13.252 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='914709796431524' 
and bookchecke0_.name='net_content' 
 {executed in 2 msec}
2020-11-19 20:41:13.255 INFO  jdbc.resultsettable Line:610 - 
|--------|---------|---------|---------|
|item_id |fsid     |got      |name     |
|--------|---------|---------|---------|
|27      |[unread] |[unread] |[unread] |
|--------|---------|---------|---------|

2020-11-19 20:41:13.309 INFO  jdbc.sqltiming Line:373 - update book_check set fsid='914709796431524', got=1, name='net_content' where item_id=27 
 {executed in 1 msec}
2020-11-19 20:41:13.320 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='914709796431524' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 20:41:13.322 INFO  jdbc.resultsettable Line:610 - 
|--------|----------------|----|------|
|item_id |fsid            |got |name  |
|--------|----------------|----|------|
|28      |914709796431524 |1   |media |
|--------|----------------|----|------|

2020-11-19 20:41:13.326 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='914709796431524' 
 {executed in 1 msec}
2020-11-19 20:41:13.328 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|12        |book   |0     |914709796431524  |zh-hans  |12          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:41:13.331 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=12 
 {executed in 1 msec}
2020-11-19 20:41:13.333 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|12  |zh-hans  |book |f67c9aec-0ac5-45af-bb2e-b4503af01655 |12  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 20:41:13.342 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=12 
 {executed in 1 msec}
2020-11-19 20:41:13.345 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |914709796431524  |zh-hans  |12          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 20:41:13.353 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=12 
 {executed in 1 msec}
2020-11-19 20:41:13.355 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|12  |1   |3     |0            |1  |8  |12 |0  |0  |8   |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 20:41:13.367 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=12 
 {executed in 4 msec}
2020-11-19 20:41:13.423 INFO  jdbc.resultsettable Line:610 - 
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|12        |<p>今天，我们来一起了解一下 JDK 中用于监控及诊断工具。本篇中我将使用刚刚发布的 Java 11 版本的工具进行示范。</p> 
<h2>jps</h2> 
<p>你可能用过<code>ps</code>命令，打印所有正在运行的进程的相关信息。JDK 中的<code>jps</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jps.html">帮助文档</a>）沿用了同样的概念：它将打印所有正在运行的 Java 进程的相关信息。</p> 
<p>在默认情况下，<code>jps</code>的输出信息包括 Java 进程的进程 ID 以及主类名。我们还可以通过追加参数，来打印额外的信息。例如，<code>-l</code>将打印模块名以及包名；<code>-v</code>将打印传递给 Java 虚拟机的参数（如<code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</code>）；<code>-m</code>将打印传递给主类的参数。</p> 
<p>具体的示例如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jps -mlv
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       18331 org.example.Foo Hello World
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       18332 jdk.jcmd/sun.tools.jps.Jps -mlv -Dapplication.home=/Library/Java/JavaVirtualMachines/jdk-11.jdk/Contents/Home -Xms8m -Djdk.module.main=jdk.jcmd
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre><!-- [[[read_end]]] --> 
<p>需要注意的是，如果某 Java 进程关闭了默认开启的<code>UsePerfData</code>参数（即使用参数<code>-XX:-UsePerfData</code>），那么<code>jps</code>命令（以及下面介绍的<code>jstat</code>）将无法探知该 Java 进程。</p> 
<p>当获得 Java 进程的进程 ID 之后，我们便可以调用接下来介绍的各项监控及诊断工具了。</p> 
<h2>jstat</h2> 
<p><code>jstat</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jstat.html">帮助文档</a>）可用来打印目标 Java 进程的性能数据。它包括多条子命令，如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstat -options
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -class
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -compiler
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gc
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gccapacity
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gccause
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcmetacapacity
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcnew
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcnewcapacity
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcold
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcoldcapacity
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcutil
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -printcompilation
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>在这些子命令中，<code>-class</code>将打印类加载相关的数据，<code>-compiler</code>和<code>-printcompilation</code>将打印即时编译相关的数据。剩下的都是以<code>-gc</code>为前缀的子命令，它们将打印垃圾回收相关的数据。</p> 
<p>默认情况下，<code>jstat</code>只会打印一次性能数据。我们可以将它配置为每隔一段时间打印一次，直至目标 Java 进程终止，或者达到我们所配置的最大打印次数。具体示例如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # Usage: jstat -outputOptions [-t] [-hlines] VMID [interval [count]]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstat -gc 22126 1s 4
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT CGC CGCT GCT 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       17472,0 17472,0 0,0 0,0 139904,0 47146,4 349568,0 21321,0 30020,0 28001,8 4864,0 4673,4 22 0,080 3 0,270 0 0,000 0,350
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       17472,0 17472,0 420,6 0,0 139904,0 11178,4 349568,0 21321,0 30020,0 28090,1 4864,0 4674,2 28 0,084 3 0,270 0 0,000 0,354
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       17472,0 17472,0 0,0 403,9 139904,0 139538,4 349568,0 21323,4 30020,0 28137,2 4864,0 4674,2 34 0,088 4 0,359 0 0,000 0,446
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       17472,0 17472,0 0,0 0,0 139904,0 0,0 349568,0 21326,1 30020,0 28093,6 4864,0 4673,4 38 0,091 5 0,445 0 0,000 0,536
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<blockquote> 
 <p>当监控本地环境的 Java 进程时，VMID 可以简单理解为 PID。如果需要监控远程环境的 Java 进程，你可以参考 jstat 的帮助文档。</p> 
</blockquote> 
<p>在上面这个示例中，22126 进程是一个使用了 CMS 垃圾回收器的 Java 进程。我们利用<code>jstat</code>的<code>-gc</code>子命令，来打印该进程垃圾回收相关的数据。命令最后的<code>1s 4</code>表示每隔 1 秒打印一次，共打印 4 次。</p> 
<p>在<code>-gc</code>子命令的输出中，前四列分别为两个 Survivor 区的容量（Capacity）和已使用量（Utility）。我们可以看到，这两个 Survivor 区的容量相等，而且始终有一个 Survivor 区的内存使用量为 0。</p> 
<p>当使用默认的 G1 GC 时，输出结果则有另一些特征：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstat -gc 22208 1s
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT CGC CGCT GCT 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       0,0 16384,0 0,0 16384,0 210944,0 192512,0 133120,0 5332,5 28848,0 26886,4 4864,0 4620,5 19 0,067 1 0,016 2 0,002 0,084
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       0,0 16384,0 0,0 16384,0 210944,0 83968,0 133120,0 5749,9 29104,0 27132,8 4864,0 4621,0 21 0,078 1 0,016 2 0,002 0,095
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       0,0 0,0 0,0 0,0 71680,0 18432,0 45056,0 20285,1 29872,0 27952,4 4864,0 4671,6 23 0,089 2 0,063 2 0,002 0,153
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       0,0 2048,0 0,0 2048,0 69632,0 28672,0 45056,0 18608,1 30128,0 28030,4 4864,0 4672,4 32 0,093 2 0,063 2 0,002 0,158
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>在上面这个示例中，<code>jstat</code>每隔 1s 便会打印垃圾回收的信息，并且不断重复下去。</p> 
<p>你可能已经留意到，<code>S0C</code>和<code>S0U</code>始终为 0，而且另一个 Survivor 区的容量（S1C）可能会下降至 0。</p> 
<p>这是因为，当使用 G1 GC 时，Java 虚拟机不再设置 Eden 区、Survivor 区，老年代区的内存边界，而是将堆划分为若干个等长内存区域。</p> 
<p>每个内存区域都可以作为 Eden 区、Survivor 区以及老年代区中的任一种，并且可以在不同区域类型之间来回切换。（<a href="https://www.oracle.com/technetwork/tutorials/tutorials-1876574.html">参考链接</a>）</p> 
<p>换句话说，逻辑上我们只有一个 Survivor 区。当需要迁移 Survivor 区中的数据时（即 Copying GC），我们只需另外申请一个或多个内存区域，作为新的 Survivor 区。</p> 
<p>因此，Java 虚拟机决定在使用 G1 GC 时，将所有 Survivor 内存区域的总容量以及已使用量存放至 S1C 和 S1U 中，而 S0C 和 S0U 则被设置为 0。</p> 
<p>当发生垃圾回收时，Java 虚拟机可能出现 Survivor 内存区域内的对象<strong>全</strong>被回收或晋升的现象。</p> 
<p>在这种情况下，Java 虚拟机会将这块内存区域回收，并标记为可分配的状态。这样子做的结果是，堆中可能完全没有 Survivor 内存区域，因而相应的 S1C 和 S1U 将会是 0。</p> 
<p><code>jstat</code>还有一个非常有用的参数<code>-t</code>，它将在每行数据之前打印目标 Java 进程的启动时间。例如，在下面这个示例中，第一列代表该 Java 进程已经启动了 10.7 秒。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstat -gc -t 22407
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Timestamp S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT CGC CGCT GCT 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        10,7 0,0 0,0 0,0 0,0 55296,0 45056,0 34816,0 20267,8 30128,0 27975,3 4864,0 4671,6 33 0,086 3 0,111 2 0,001 0,198
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我们可以比较 Java 进程的启动时间以及总 GC 时间（GCT 列），或者两次测量的间隔时间以及总 GC 时间的增量，来得出 GC 时间占运行时间的比例。</p> 
<p>如果该比例超过 20%，则说明目前堆的压力较大；如果该比例超过 90%，则说明堆里几乎没有可用空间，随时都可能抛出 OOM 异常。</p> 
<p><code>jstat</code>还可以用来判断是否出现内存泄漏。在长时间运行的 Java 程序中，我们可以运行<code>jstat</code>命令连续获取多行性能数据，并取这几行数据中 OU 列（即已占用的老年代内存）的最小值。</p> 
<p>然后，我们每隔一段较长的时间重复一次上述操作，来获得多组 OU 最小值。如果这些值呈上涨趋势，则说明该 Java 程序的老年代内存已使用量在不断上涨，这意味着无法回收的对象在不断增加，因此很有可能存在内存泄漏。</p> 
<blockquote> 
 <p>上面没有涉及的列（或者其他子命令的输出），你可以查阅帮助文档了解具体含义。至于文档中漏掉的 CGC 和 CGCT，它们分别代表并发 GC Stop-The-World 的次数和时间。</p> 
</blockquote> 
<h2>jmap</h2> 
<p>在这种情况下，我们便可以请<code>jmap</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jmap.html">帮助文档</a>）出马，分析 Java 虚拟机堆中的对象。</p> 
<p><code>jmap</code>同样包括多条子命令。</p> 
<ol> 
 <li><code>-clstats</code>，该子命令将打印被加载类的信息。</li> 
 <li><code>-finalizerinfo</code>，该子命令将打印所有待 finalize 的对象。</li> 
 <li><code>-histo</code>，该子命令将统计各个类的实例数目以及占用内存，并按照内存使用量从多至少的顺序排列。此外，<code>-histo:live</code>只统计堆中的存活对象。</li> 
 <li><code>-dump</code>，该子命令将导出 Java 虚拟机堆的快照。同样，<code>-dump:live</code>只保存堆中的存活对象。</li> 
</ol> 
<p>我们通常会利用<code>jmap -dump:live,format=b,file=filename.bin</code>命令，将堆中所有存活对象导出至一个文件之中。</p> 
<p>这里<code>format=b</code>将使<code>jmap</code>导出与<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr008.html">hprof</a>（在 Java 9 中已被移除）、<code>-XX:+HeapDumpAfterFullGC</code>、<code>-XX:+HeapDumpOnOutOfMemoryError</code>格式一致的文件。这种格式的文件可以被其他 GUI 工具查看，具体我会在下一篇中进行演示。</p> 
<p>下面我贴了一段<code>-histo</code>子命令的输出：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jmap -histo 22574
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        num #instances #bytes class name (module)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -------------------------------------------------------
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: 500004 20000160 org.python.core.PyComplex
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        2: 570866 18267712 org.python.core.PyFloat
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3: 360295 18027024 [B (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: 339394 11429680 [Lorg.python.core.PyObject;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        5: 308637 11194264 [Ljava.lang.Object; (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        6: 301378 9291664 [I (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        7: 225103 9004120 java.math.BigInteger (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8: 507362 8117792 org.python.core.PySequence$1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        9: 285009 6840216 org.python.core.PyLong
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        10: 282908 6789792 java.lang.String (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       2281: 1 16 traceback$py
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       2282: 1 16 unicodedata$py
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Total 5151277 167944400
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>由于<code>jmap</code>将访问堆中的所有对象，为了保证在此过程中不被应用线程干扰，<code>jmap</code>需要借助安全点机制，让所有线程停留在不改变堆中数据的状态。</p> 
<p>也就是说，由<code>jmap</code>导出的堆快照必定是安全点位置的。这可能导致基于该堆快照的分析结果存在偏差。举个例子，假设在编译生成的机器码中，某些对象的生命周期在两个安全点之间，那么<code>:live</code>选项将无法探知到这些对象。</p> 
<p>另外，如果某个线程长时间无法跑到安全点，<code>jmap</code>将一直等下去。上一小节的<code>jstat</code>则不同。这是因为垃圾回收器会主动将<code>jstat</code>所需要的摘要数据保存至固定位置之中，而<code>jstat</code>只需直接读取即可。</p> 
<p>关于这种长时间等待的情况，你可以通过下面这段程序来复现：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // 暂停时间较长，约为二三十秒，可酌情调整。
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // CTRL+C 的 SIGINT 信号无法停止，需要 SIGKILL。
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       static double sum = 0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 0; i &lt; 0x77777777; i++) { // counted loop
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        sum += Math.log(i); // Math.log is an intrinsic
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p><code>jmap</code>（以及接下来的<code>jinfo</code>、<code>jstack</code>和<code>jcmd</code>）依赖于 Java 虚拟机的<a href="https://docs.oracle.com/en/java/javase/11/docs/api/jdk.attach/com/sun/tools/attach/package-summary.html">Attach API</a>，因此只能监控本地 Java 进程。</p> 
<p>一旦开启 Java 虚拟机参数<code>DisableAttachMechanism</code>（即使用参数<code>-XX:+DisableAttachMechanism</code>），基于 Attach API 的命令将无法执行。反过来说，如果你不想被其他进程监控，那么你需要开启该参数。</p> 
<h2>jinfo</h2> 
<p><code>jinfo</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jinfo.html">帮助文档</a>）可用来查看目标 Java 进程的参数，如传递给 Java 虚拟机的<code>-X</code>（即输出中的 jvm_args）、<code>-XX</code>参数（即输出中的 VM Flags），以及可在 Java 层面通过<code>System.getProperty</code>获取的<code>-D</code>参数（即输出中的 System Properties）。</p> 
<p>具体的示例如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jinfo 31185
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java System Properties:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       gopherProxySet=false
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       awt.toolkit=sun.lwawt.macosx.LWCToolkit
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java.specification.version=11
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       sun.cpu.isalist=
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       sun.jnu.encoding=UTF-8
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM Flags:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -XX:CICompilerCount=4 -XX:ConcGCThreads=3 -XX:G1ConcRefinementThreads=10 -XX:G1HeapRegionSize=2097152 -XX:GCDrainStackTargetSize=64 -XX:InitialHeapSize=536870912 -XX:MarkStackSize=4194304 -XX:MaxHeapSize=8589934592 -XX:MaxNewSize=5152702464 -XX:MinHeapDeltaBytes=2097152 -XX:NonNMethodCodeHeapSize=5835340 -XX:NonProfiledCodeHeapSize=122911450 -XX:ProfiledCodeHeapSize=122911450 -XX:ReservedCodeCacheSize=251658240 -XX:+SegmentedCodeCache -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM Arguments:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       jvm_args: -Xlog:gc -Xmx1024m
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java_command: org.example.Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java_class_path (initial): .
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Launcher Type: SUN_STANDARD
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p><code>jinfo</code>还可以用来修改目标 Java 进程的“manageable”虚拟机参数。</p> 
<p>举个例子，我们可以使用<code>jinfo -flag +HeapDumpAfterFullGC &lt;PID&gt;</code>命令，开启<code>&lt;PID&gt;</code>所指定的 Java 进程的<code>HeapDumpAfterFullGC</code>参数。</p> 
<p>你可以通过下述命令查看其他 "manageable" 虚拟机参数：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -XX:+PrintFlagsFinal -version | grep manageable 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        intx CMSAbortablePrecleanWaitMillis = 100 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        intx CMSTriggerInterval = -1 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        intx CMSWaitDuration = 2000 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool HeapDumpAfterFullGC = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool HeapDumpBeforeFullGC = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool HeapDumpOnOutOfMemoryError = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ccstr HeapDumpPath = {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        uintx MaxHeapFreeRatio = 70 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        uintx MinHeapFreeRatio = 40 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool PrintClassHistogram = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool PrintConcurrentLocks = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java version "11" 2018-09-25
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java(TM) SE Runtime Environment 18.9 (build 11+28)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11+28, mixed mode)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<h2>jstack</h2> 
<p><code>jstack</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jstack.html">帮助文档</a>）可以用来打印目标 Java 进程中各个线程的栈轨迹，以及这些线程所持有的锁。</p> 
<p><code>jstack</code>的其中一个应用场景便是死锁检测。这里我用<code>jstack</code>获取一个已经死锁了的 Java 程序的栈信息。具体输出如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstack 31634
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-0" #12 prio=5 os_prio=31 cpu=1.32ms elapsed=34.24s tid=0x00007fb08601c800 nid=0x5d03 waiting for monitor entry [0x000070000bc7e000]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        java.lang.Thread.State: BLOCKED (on object monitor)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock.foo(DeadLock.java:18)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - waiting to lock &lt;0x000000061ff904c0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - locked &lt;0x000000061ff904b0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock$$Lambda$1/0x0000000800060840.run(Unknown Source)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at java.lang.Thread.run(java.base@11/Thread.java:834)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-1" #13 prio=5 os_prio=31 cpu=1.43ms elapsed=34.24s tid=0x00007fb08601f800 nid=0x5f03 waiting for monitor entry [0x000070000bd81000]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        java.lang.Thread.State: BLOCKED (on object monitor)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock.bar(DeadLock.java:33)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - waiting to lock &lt;0x000000061ff904b0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - locked &lt;0x000000061ff904c0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock$$Lambda$2/0x0000000800063040.run(Unknown Source)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at java.lang.Thread.run(java.base@11/Thread.java:834)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNI global refs: 6, weak refs: 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Found one Java-level deadlock:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       =============================
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-0":
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        waiting to lock monitor 0x00007fb083015900 (object 0x000000061ff904c0, a java.lang.Object),
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        which is held by "Thread-1"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-1":
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        waiting to lock monitor 0x00007fb083015800 (object 0x000000061ff904b0, a java.lang.Object),
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        which is held by "Thread-0"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java stack information for the threads listed above:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ===================================================
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-0":
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock.foo(DeadLock.java:18)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - waiting to lock &lt;0x000000061ff904c0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - locked &lt;0x000000061ff904b0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock$$Lambda$1/0x0000000800060840.run(Unknown Source)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at java.lang.Thread.run(java.base@11/Thread.java:834)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-1":
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock.bar(DeadLock.java:33)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - waiting to lock &lt;0x000000061ff904b0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - locked &lt;0x000000061ff904c0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock$$Lambda$2/0x0000000800063040.run(Unknown Source)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at java.lang.Thread.run(java.base@11/Thread.java:834)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Found 1 deadlock.
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我们可以看到，<code>jstack</code>不仅会打印线程的栈轨迹、线程状态（BLOCKED）、持有的锁（locked …）以及正在请求的锁（waiting to lock …），而且还会分析出具体的死锁。</p> 
<h2>jcmd</h2> 
<p>你还可以直接使用<code>jcmd</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jcmd.html">帮助文档</a>），来替代前面除了<code>jstat</code>之外的所有命令。具体的替换规则你可以参考下表。</p> 
<p>至于<code>jstat</code>的功能，虽然<code>jcmd</code>复制了<code>jstat</code>的部分代码，并支持通过<code>PerfCounter.print</code>子命令来打印所有的 Performance Counter，但是它没有保留<code>jstat</code>的输出格式，也没有重复打印的功能。因此，感兴趣的同学可以自行整理。</p> 
<p>另外，我们将在下一篇中介绍<code>jcmd</code>中 Java Flight Recorder 相关的子命令。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了 JDK 中用于监控及诊断的命令行工具。我们再来回顾一下。</p> 
<ol> 
 <li><code>jps</code>将打印所有正在运行的 Java 进程。</li> 
 <li><code>jstat</code>允许用户查看目标 Java 进程的类加载、即时编译以及垃圾回收相关的信息。它常用于检测垃圾回收问题以及内存泄漏问题。</li> 
 <li><code>jmap</code>允许用户统计目标 Java 进程的堆中存放的 Java 对象，并将它们导出成二进制文件。</li> 
 <li><code>jinfo</code>将打印目标 Java 进程的配置参数，并能够改动其中 manageabe 的参数。</li> 
 <li><code>jstack</code>将打印目标 Java 进程中各个线程的栈轨迹、线程状态、锁状况等信息。它还将自动检测死锁。</li> 
 <li><code>jcmd</code>则是一把瑞士军刀，可以用来实现前面除了<code>jstat</code>之外所有命令的功能。</li> 
</ol> 
<hr> 
<p>今天的实践环节，你可以探索<code>jcmd</code>中的下述功能，看看有没有适合你项目的监控项：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.CodeHeap_Analytics
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.codecache
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.codelist
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.directives_add
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.directives_clear
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.directives_print
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.directives_remove
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.queue
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.class_histogram
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.class_stats
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.finalizer_info
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.heap_dump
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.heap_info
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.run
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.run_finalization
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.class_hierarchy
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.classloader_stats
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.classloaders
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.command_line
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.dynlibs
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.flags
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.info
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.log
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.metaspace
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.native_memory
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.print_touched_methods
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.set_flag
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.stringtable
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.symboltable
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.system_properties
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.systemdictionary
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.unlock_commercial_features
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.uptime
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.version
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |12          |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:41:13.450 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=12 
 {executed in 4 msec}
2020-11-19 20:41:13.532 INFO  jdbc.resultsettable Line:610 - 
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>今天，我们来一起了解一下 JDK 中用于监控及诊断工具。本篇中我将使用刚刚发布的 Java 11 版本的工具进行示范。</p> 
<h2>jps</h2> 
<p>你可能用过<code>ps</code>命令，打印所有正在运行的进程的相关信息。JDK 中的<code>jps</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jps.html">帮助文档</a>）沿用了同样的概念：它将打印所有正在运行的 Java 进程的相关信息。</p> 
<p>在默认情况下，<code>jps</code>的输出信息包括 Java 进程的进程 ID 以及主类名。我们还可以通过追加参数，来打印额外的信息。例如，<code>-l</code>将打印模块名以及包名；<code>-v</code>将打印传递给 Java 虚拟机的参数（如<code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</code>）；<code>-m</code>将打印传递给主类的参数。</p> 
<p>具体的示例如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jps -mlv
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       18331 org.example.Foo Hello World
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       18332 jdk.jcmd/sun.tools.jps.Jps -mlv -Dapplication.home=/Library/Java/JavaVirtualMachines/jdk-11.jdk/Contents/Home -Xms8m -Djdk.module.main=jdk.jcmd
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre><!-- [[[read_end]]] --> 
<p>需要注意的是，如果某 Java 进程关闭了默认开启的<code>UsePerfData</code>参数（即使用参数<code>-XX:-UsePerfData</code>），那么<code>jps</code>命令（以及下面介绍的<code>jstat</code>）将无法探知该 Java 进程。</p> 
<p>当获得 Java 进程的进程 ID 之后，我们便可以调用接下来介绍的各项监控及诊断工具了。</p> 
<h2>jstat</h2> 
<p><code>jstat</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jstat.html">帮助文档</a>）可用来打印目标 Java 进程的性能数据。它包括多条子命令，如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstat -options
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -class
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -compiler
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gc
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gccapacity
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gccause
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcmetacapacity
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcnew
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcnewcapacity
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcold
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcoldcapacity
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -gcutil
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -printcompilation
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>在这些子命令中，<code>-class</code>将打印类加载相关的数据，<code>-compiler</code>和<code>-printcompilation</code>将打印即时编译相关的数据。剩下的都是以<code>-gc</code>为前缀的子命令，它们将打印垃圾回收相关的数据。</p> 
<p>默认情况下，<code>jstat</code>只会打印一次性能数据。我们可以将它配置为每隔一段时间打印一次，直至目标 Java 进程终止，或者达到我们所配置的最大打印次数。具体示例如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       # Usage: jstat -outputOptions [-t] [-hlines] VMID [interval [count]]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstat -gc 22126 1s 4
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT CGC CGCT GCT 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       17472,0 17472,0 0,0 0,0 139904,0 47146,4 349568,0 21321,0 30020,0 28001,8 4864,0 4673,4 22 0,080 3 0,270 0 0,000 0,350
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       17472,0 17472,0 420,6 0,0 139904,0 11178,4 349568,0 21321,0 30020,0 28090,1 4864,0 4674,2 28 0,084 3 0,270 0 0,000 0,354
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       17472,0 17472,0 0,0 403,9 139904,0 139538,4 349568,0 21323,4 30020,0 28137,2 4864,0 4674,2 34 0,088 4 0,359 0 0,000 0,446
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       17472,0 17472,0 0,0 0,0 139904,0 0,0 349568,0 21326,1 30020,0 28093,6 4864,0 4673,4 38 0,091 5 0,445 0 0,000 0,536
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<blockquote> 
 <p>当监控本地环境的 Java 进程时，VMID 可以简单理解为 PID。如果需要监控远程环境的 Java 进程，你可以参考 jstat 的帮助文档。</p> 
</blockquote> 
<p>在上面这个示例中，22126 进程是一个使用了 CMS 垃圾回收器的 Java 进程。我们利用<code>jstat</code>的<code>-gc</code>子命令，来打印该进程垃圾回收相关的数据。命令最后的<code>1s 4</code>表示每隔 1 秒打印一次，共打印 4 次。</p> 
<p>在<code>-gc</code>子命令的输出中，前四列分别为两个 Survivor 区的容量（Capacity）和已使用量（Utility）。我们可以看到，这两个 Survivor 区的容量相等，而且始终有一个 Survivor 区的内存使用量为 0。</p> 
<p>当使用默认的 G1 GC 时，输出结果则有另一些特征：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstat -gc 22208 1s
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT CGC CGCT GCT 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       0,0 16384,0 0,0 16384,0 210944,0 192512,0 133120,0 5332,5 28848,0 26886,4 4864,0 4620,5 19 0,067 1 0,016 2 0,002 0,084
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       0,0 16384,0 0,0 16384,0 210944,0 83968,0 133120,0 5749,9 29104,0 27132,8 4864,0 4621,0 21 0,078 1 0,016 2 0,002 0,095
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       0,0 0,0 0,0 0,0 71680,0 18432,0 45056,0 20285,1 29872,0 27952,4 4864,0 4671,6 23 0,089 2 0,063 2 0,002 0,153
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       0,0 2048,0 0,0 2048,0 69632,0 28672,0 45056,0 18608,1 30128,0 28030,4 4864,0 4672,4 32 0,093 2 0,063 2 0,002 0,158
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>在上面这个示例中，<code>jstat</code>每隔 1s 便会打印垃圾回收的信息，并且不断重复下去。</p> 
<p>你可能已经留意到，<code>S0C</code>和<code>S0U</code>始终为 0，而且另一个 Survivor 区的容量（S1C）可能会下降至 0。</p> 
<p>这是因为，当使用 G1 GC 时，Java 虚拟机不再设置 Eden 区、Survivor 区，老年代区的内存边界，而是将堆划分为若干个等长内存区域。</p> 
<p>每个内存区域都可以作为 Eden 区、Survivor 区以及老年代区中的任一种，并且可以在不同区域类型之间来回切换。（<a href="https://www.oracle.com/technetwork/tutorials/tutorials-1876574.html">参考链接</a>）</p> 
<p>换句话说，逻辑上我们只有一个 Survivor 区。当需要迁移 Survivor 区中的数据时（即 Copying GC），我们只需另外申请一个或多个内存区域，作为新的 Survivor 区。</p> 
<p>因此，Java 虚拟机决定在使用 G1 GC 时，将所有 Survivor 内存区域的总容量以及已使用量存放至 S1C 和 S1U 中，而 S0C 和 S0U 则被设置为 0。</p> 
<p>当发生垃圾回收时，Java 虚拟机可能出现 Survivor 内存区域内的对象<strong>全</strong>被回收或晋升的现象。</p> 
<p>在这种情况下，Java 虚拟机会将这块内存区域回收，并标记为可分配的状态。这样子做的结果是，堆中可能完全没有 Survivor 内存区域，因而相应的 S1C 和 S1U 将会是 0。</p> 
<p><code>jstat</code>还有一个非常有用的参数<code>-t</code>，它将在每行数据之前打印目标 Java 进程的启动时间。例如，在下面这个示例中，第一列代表该 Java 进程已经启动了 10.7 秒。</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstat -gc -t 22407
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Timestamp S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT CGC CGCT GCT 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        10,7 0,0 0,0 0,0 0,0 55296,0 45056,0 34816,0 20267,8 30128,0 27975,3 4864,0 4671,6 33 0,086 3 0,111 2 0,001 0,198
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我们可以比较 Java 进程的启动时间以及总 GC 时间（GCT 列），或者两次测量的间隔时间以及总 GC 时间的增量，来得出 GC 时间占运行时间的比例。</p> 
<p>如果该比例超过 20%，则说明目前堆的压力较大；如果该比例超过 90%，则说明堆里几乎没有可用空间，随时都可能抛出 OOM 异常。</p> 
<p><code>jstat</code>还可以用来判断是否出现内存泄漏。在长时间运行的 Java 程序中，我们可以运行<code>jstat</code>命令连续获取多行性能数据，并取这几行数据中 OU 列（即已占用的老年代内存）的最小值。</p> 
<p>然后，我们每隔一段较长的时间重复一次上述操作，来获得多组 OU 最小值。如果这些值呈上涨趋势，则说明该 Java 程序的老年代内存已使用量在不断上涨，这意味着无法回收的对象在不断增加，因此很有可能存在内存泄漏。</p> 
<blockquote> 
 <p>上面没有涉及的列（或者其他子命令的输出），你可以查阅帮助文档了解具体含义。至于文档中漏掉的 CGC 和 CGCT，它们分别代表并发 GC Stop-The-World 的次数和时间。</p> 
</blockquote> 
<h2>jmap</h2> 
<p>在这种情况下，我们便可以请<code>jmap</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jmap.html">帮助文档</a>）出马，分析 Java 虚拟机堆中的对象。</p> 
<p><code>jmap</code>同样包括多条子命令。</p> 
<ol> 
 <li><code>-clstats</code>，该子命令将打印被加载类的信息。</li> 
 <li><code>-finalizerinfo</code>，该子命令将打印所有待 finalize 的对象。</li> 
 <li><code>-histo</code>，该子命令将统计各个类的实例数目以及占用内存，并按照内存使用量从多至少的顺序排列。此外，<code>-histo:live</code>只统计堆中的存活对象。</li> 
 <li><code>-dump</code>，该子命令将导出 Java 虚拟机堆的快照。同样，<code>-dump:live</code>只保存堆中的存活对象。</li> 
</ol> 
<p>我们通常会利用<code>jmap -dump:live,format=b,file=filename.bin</code>命令，将堆中所有存活对象导出至一个文件之中。</p> 
<p>这里<code>format=b</code>将使<code>jmap</code>导出与<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr008.html">hprof</a>（在 Java 9 中已被移除）、<code>-XX:+HeapDumpAfterFullGC</code>、<code>-XX:+HeapDumpOnOutOfMemoryError</code>格式一致的文件。这种格式的文件可以被其他 GUI 工具查看，具体我会在下一篇中进行演示。</p> 
<p>下面我贴了一段<code>-histo</code>子命令的输出：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jmap -histo 22574
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        num #instances #bytes class name (module)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -------------------------------------------------------
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        1: 500004 20000160 org.python.core.PyComplex
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        2: 570866 18267712 org.python.core.PyFloat
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        3: 360295 18027024 [B (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        4: 339394 11429680 [Lorg.python.core.PyObject;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        5: 308637 11194264 [Ljava.lang.Object; (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        6: 301378 9291664 [I (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        7: 225103 9004120 java.math.BigInteger (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        8: 507362 8117792 org.python.core.PySequence$1
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        9: 285009 6840216 org.python.core.PyLong
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        10: 282908 6789792 java.lang.String (java.base@11)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       2281: 1 16 traceback$py
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       2282: 1 16 unicodedata$py
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Total 5151277 167944400
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>由于<code>jmap</code>将访问堆中的所有对象，为了保证在此过程中不被应用线程干扰，<code>jmap</code>需要借助安全点机制，让所有线程停留在不改变堆中数据的状态。</p> 
<p>也就是说，由<code>jmap</code>导出的堆快照必定是安全点位置的。这可能导致基于该堆快照的分析结果存在偏差。举个例子，假设在编译生成的机器码中，某些对象的生命周期在两个安全点之间，那么<code>:live</code>选项将无法探知到这些对象。</p> 
<p>另外，如果某个线程长时间无法跑到安全点，<code>jmap</code>将一直等下去。上一小节的<code>jstat</code>则不同。这是因为垃圾回收器会主动将<code>jstat</code>所需要的摘要数据保存至固定位置之中，而<code>jstat</code>只需直接读取即可。</p> 
<p>关于这种长时间等待的情况，你可以通过下面这段程序来复现：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // 暂停时间较长，约为二三十秒，可酌情调整。
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       // CTRL+C 的 SIGINT 信号无法停止，需要 SIGKILL。
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       static double sum = 0;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public static void main(String[] args) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        for (int i = 0; i &lt; 0x77777777; i++) { // counted loop
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        sum += Math.log(i); // Math.log is an intrinsic
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p><code>jmap</code>（以及接下来的<code>jinfo</code>、<code>jstack</code>和<code>jcmd</code>）依赖于 Java 虚拟机的<a href="https://docs.oracle.com/en/java/javase/11/docs/api/jdk.attach/com/sun/tools/attach/package-summary.html">Attach API</a>，因此只能监控本地 Java 进程。</p> 
<p>一旦开启 Java 虚拟机参数<code>DisableAttachMechanism</code>（即使用参数<code>-XX:+DisableAttachMechanism</code>），基于 Attach API 的命令将无法执行。反过来说，如果你不想被其他进程监控，那么你需要开启该参数。</p> 
<h2>jinfo</h2> 
<p><code>jinfo</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jinfo.html">帮助文档</a>）可用来查看目标 Java 进程的参数，如传递给 Java 虚拟机的<code>-X</code>（即输出中的 jvm_args）、<code>-XX</code>参数（即输出中的 VM Flags），以及可在 Java 层面通过<code>System.getProperty</code>获取的<code>-D</code>参数（即输出中的 System Properties）。</p> 
<p>具体的示例如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jinfo 31185
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java System Properties:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       gopherProxySet=false
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       awt.toolkit=sun.lwawt.macosx.LWCToolkit
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java.specification.version=11
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       sun.cpu.isalist=
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       sun.jnu.encoding=UTF-8
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM Flags:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       -XX:CICompilerCount=4 -XX:ConcGCThreads=3 -XX:G1ConcRefinementThreads=10 -XX:G1HeapRegionSize=2097152 -XX:GCDrainStackTargetSize=64 -XX:InitialHeapSize=536870912 -XX:MarkStackSize=4194304 -XX:MaxHeapSize=8589934592 -XX:MaxNewSize=5152702464 -XX:MinHeapDeltaBytes=2097152 -XX:NonNMethodCodeHeapSize=5835340 -XX:NonProfiledCodeHeapSize=122911450 -XX:ProfiledCodeHeapSize=122911450 -XX:ReservedCodeCacheSize=251658240 -XX:+SegmentedCodeCache -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM Arguments:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       jvm_args: -Xlog:gc -Xmx1024m
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java_command: org.example.Foo
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java_class_path (initial): .
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Launcher Type: SUN_STANDARD
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p><code>jinfo</code>还可以用来修改目标 Java 进程的“manageable”虚拟机参数。</p> 
<p>举个例子，我们可以使用<code>jinfo -flag +HeapDumpAfterFullGC &lt;PID&gt;</code>命令，开启<code>&lt;PID&gt;</code>所指定的 Java 进程的<code>HeapDumpAfterFullGC</code>参数。</p> 
<p>你可以通过下述命令查看其他 "manageable" 虚拟机参数：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ java -XX:+PrintFlagsFinal -version | grep manageable 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        intx CMSAbortablePrecleanWaitMillis = 100 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        intx CMSTriggerInterval = -1 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        intx CMSWaitDuration = 2000 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool HeapDumpAfterFullGC = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool HeapDumpBeforeFullGC = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool HeapDumpOnOutOfMemoryError = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ccstr HeapDumpPath = {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        uintx MaxHeapFreeRatio = 70 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        uintx MinHeapFreeRatio = 40 {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool PrintClassHistogram = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bool PrintConcurrentLocks = false {manageable} {default}
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java version "11" 2018-09-25
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java(TM) SE Runtime Environment 18.9 (build 11+28)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11+28, mixed mode)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<h2>jstack</h2> 
<p><code>jstack</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jstack.html">帮助文档</a>）可以用来打印目标 Java 进程中各个线程的栈轨迹，以及这些线程所持有的锁。</p> 
<p><code>jstack</code>的其中一个应用场景便是死锁检测。这里我用<code>jstack</code>获取一个已经死锁了的 Java 程序的栈信息。具体输出如下所示：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       $ jstack 31634
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-0" #12 prio=5 os_prio=31 cpu=1.32ms elapsed=34.24s tid=0x00007fb08601c800 nid=0x5d03 waiting for monitor entry [0x000070000bc7e000]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        java.lang.Thread.State: BLOCKED (on object monitor)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock.foo(DeadLock.java:18)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - waiting to lock &lt;0x000000061ff904c0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - locked &lt;0x000000061ff904b0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock$$Lambda$1/0x0000000800060840.run(Unknown Source)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at java.lang.Thread.run(java.base@11/Thread.java:834)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-1" #13 prio=5 os_prio=31 cpu=1.43ms elapsed=34.24s tid=0x00007fb08601f800 nid=0x5f03 waiting for monitor entry [0x000070000bd81000]
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        java.lang.Thread.State: BLOCKED (on object monitor)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock.bar(DeadLock.java:33)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - waiting to lock &lt;0x000000061ff904b0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - locked &lt;0x000000061ff904c0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock$$Lambda$2/0x0000000800063040.run(Unknown Source)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at java.lang.Thread.run(java.base@11/Thread.java:834)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       JNI global refs: 6, weak refs: 0
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Found one Java-level deadlock:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       =============================
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-0":
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        waiting to lock monitor 0x00007fb083015900 (object 0x000000061ff904c0, a java.lang.Object),
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        which is held by "Thread-1"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-1":
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        waiting to lock monitor 0x00007fb083015800 (object 0x000000061ff904b0, a java.lang.Object),
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        which is held by "Thread-0"
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Java stack information for the threads listed above:
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       ===================================================
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-0":
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock.foo(DeadLock.java:18)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - waiting to lock &lt;0x000000061ff904c0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - locked &lt;0x000000061ff904b0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock$$Lambda$1/0x0000000800060840.run(Unknown Source)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at java.lang.Thread.run(java.base@11/Thread.java:834)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       "Thread-1":
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock.bar(DeadLock.java:33)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - waiting to lock &lt;0x000000061ff904b0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        - locked &lt;0x000000061ff904c0&gt; (a java.lang.Object)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at DeadLock$$Lambda$2/0x0000000800063040.run(Unknown Source)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        at java.lang.Thread.run(java.base@11/Thread.java:834)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Found 1 deadlock.
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p>我们可以看到，<code>jstack</code>不仅会打印线程的栈轨迹、线程状态（BLOCKED）、持有的锁（locked …）以及正在请求的锁（waiting to lock …），而且还会分析出具体的死锁。</p> 
<h2>jcmd</h2> 
<p>你还可以直接使用<code>jcmd</code>命令（<a href="https://docs.oracle.com/en/java/javase/11/tools/jcmd.html">帮助文档</a>），来替代前面除了<code>jstat</code>之外的所有命令。具体的替换规则你可以参考下表。</p> 
<p>至于<code>jstat</code>的功能，虽然<code>jcmd</code>复制了<code>jstat</code>的部分代码，并支持通过<code>PerfCounter.print</code>子命令来打印所有的 Performance Counter，但是它没有保留<code>jstat</code>的输出格式，也没有重复打印的功能。因此，感兴趣的同学可以自行整理。</p> 
<p>另外，我们将在下一篇中介绍<code>jcmd</code>中 Java Flight Recorder 相关的子命令。</p> 
<h2>总结与实践</h2> 
<p>今天我介绍了 JDK 中用于监控及诊断的命令行工具。我们再来回顾一下。</p> 
<ol> 
 <li><code>jps</code>将打印所有正在运行的 Java 进程。</li> 
 <li><code>jstat</code>允许用户查看目标 Java 进程的类加载、即时编译以及垃圾回收相关的信息。它常用于检测垃圾回收问题以及内存泄漏问题。</li> 
 <li><code>jmap</code>允许用户统计目标 Java 进程的堆中存放的 Java 对象，并将它们导出成二进制文件。</li> 
 <li><code>jinfo</code>将打印目标 Java 进程的配置参数，并能够改动其中 manageabe 的参数。</li> 
 <li><code>jstack</code>将打印目标 Java 进程中各个线程的栈轨迹、线程状态、锁状况等信息。它还将自动检测死锁。</li> 
 <li><code>jcmd</code>则是一把瑞士军刀，可以用来实现前面除了<code>jstat</code>之外所有命令的功能。</li> 
</ol> 
<hr> 
<p>今天的实践环节，你可以探索<code>jcmd</code>中的下述功能，看看有没有适合你项目的监控项：</p> 
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.CodeHeap_Analytics
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.codecache
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.codelist
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.directives_add
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.directives_clear
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.directives_print
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.directives_remove
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Compiler.queue
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.class_histogram
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.class_stats
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.finalizer_info
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.heap_dump
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.heap_info
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.run
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       GC.run_finalization
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.class_hierarchy
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.classloader_stats
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.classloaders
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.command_line
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.dynlibs
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.flags
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.info
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.log
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.metaspace
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.native_memory
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.print_touched_methods
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.set_flag
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.stringtable
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.symboltable
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.system_properties
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.systemdictionary
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.unlock_commercial_features
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.uptime
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       VM.version
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre> 
<p><img src="https://static001.geekbang.org/resource/image/2a/d5/2a62e58cbdf56a5dc40748567d346fd5.jpg" alt=""></p> |             |book   |0     |full_html   |zh-hans  |12          |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 20:41:13.571 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=12 
 {executed in 1 msec}
2020-11-19 20:41:13.574 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                    |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|
|12  |1605789257 |1605789257 |1                |zh-hans  |0       |1                             |1      |0      |30丨Java虚拟机的监控及诊断工具（命令行篇） |book |1   |12  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|-----|----|----|

2020-11-19 20:41:13.579 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=12 
 {executed in 1 msec}
2020-11-19 20:41:13.582 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                    |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|
|[unread] |1605789257 |1605789257 |1                |zh-hans  |0       |1                             |1      |0      |30丨Java虚拟机的监控及诊断工具（命令行篇） |1   |12  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|-------------------------|----|----|

2020-11-19 20:41:13.593 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605789673, created=1605789673, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='30丨Java虚拟机的监控及诊断工具（命令行篇）', 
type='book', uid=1, vid=12 where nid=12 
 {executed in 2 msec}
2020-11-19 20:41:13.598 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605789673, created=1605789673, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='30丨Java虚拟机的监控及诊断工具（命令行篇）', 
uid=1, vid=12 where nid=12 
 {executed in 2 msec}
