2020-11-19 17:55:36.291 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605779736, created=1605779736, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='12丨唯有套路得人心：谈谈JavaEE的那些模式', 
uid=1, vid=37 where nid=37 
 {executed in 0 msec}
2020-11-19 17:55:36.300 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=37 
 {executed in 1 msec}
2020-11-19 17:55:36.300 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |revision_id |
|----------|-------|------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|37        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/b162d78c140278c67f716192e0ad763b?bkt=en-07c9b0a504a37060db41da44d85860aae2ee4f517c0aae0e368e6b5eac9f7adc4ea4cd15f5fb4a4b&fid=3757516097-778750-652598925955165&time=1605756132&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-bZNHE87HprCsTwFpDEZfD0vERSo%3D&to=92&size=14304021&sta_dx=14304021&sta_cs=3873&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414495&mtime=1605754778&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=14304021&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-9bae22f3779cdcda823180f19e1ba39c35ddffd614fbd516bcd4c6139eec954d5729d3ae93e53236&sl=76480590&expires=8h&rt=pr&r=683399320&mlogid=7502269529331065997&vbdid=2247232042&fin=12%E4%B8%A8%E5%94%AF%E6%9C%89%E5%A5%97%E8%B7%AF%E5%BE%97%E4%BA%BA%E5%BF%83%EF%BC%9A%E8%B0%88%E8%B0%88JavaEE%E7%9A%84%E9%82%A3%E4%BA%9B%E6%A8%A1%E5%BC%8F.m4a&bflag=92,34-92&rtype=1&dp-logid=7502269529331065997&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=5eee304bbb22b9c2acd18ff8009f13c8a0a90b7ac7ecc952305a5e1275657320&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=12%E4%B8%A8%E5%94%AF%E6%9C%89%E5%A5%97%E8%B7%AF%E5%BE%97%E4%BA%BA%E5%BF%83%EF%BC%9A%E8%B0%88%E8%B0%88JavaEE%E7%9A%84%E9%82%A3%E4%BA%9B%E6%A8%A1%E5%BC%8F.m4a |37          |
|----------|-------|------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 17:55:36.305 INFO  jdbc.sqltiming Line:373 - update node__field_media set bundle='book', delta=0, langcode='zh-hans', field_media_value='https://qdall01.baidupcs.com/file/b162d78c140278c67f716192e0ad763b?bkt=en-07c9b0a504a37060db41da44d85860aae2ee4f517c0aae0e368e6b5eac9f7adc4ea4cd15f5fb4a4b&fid=3757516097-778750-1074285291837031&time=1605779734&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-2qNLwrksNabSK4Nbxc9AW8odom4%3D&to=92&size=14304021&sta_dx=14304021&sta_cs=3878&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414495&mtime=1605778300&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=14304021&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-9bae22f3779cdcda823180f19e1ba39c35ddffd614fbd516bcd4c6139eec954d5729d3ae93e53236&sl=76480590&expires=8h&rt=pr&r=447182992&mlogid=7508605160983499541&vbdid=2247232042&fin=12%E4%B8%A8%E5%94%AF%E6%9C%89%E5%A5%97%E8%B7%AF%E5%BE%97%E4%BA%BA%E5%BF%83%EF%BC%9A%E8%B0%88%E8%B0%88JavaEE%E7%9A%84%E9%82%A3%E4%BA%9B%E6%A8%A1%E5%BC%8F.m4a&bflag=92,34-92&rtype=1&dp-logid=7508605160983499541&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=5f2aaa70d2fd14de1734d8ca037459b2dee29e29dea88820&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=12%E4%B8%A8%E5%94%AF%E6%9C%89%E5%A5%97%E8%B7%AF%E5%BE%97%E4%BA%BA%E5%BF%83%EF%BC%9A%E8%B0%88%E8%B0%88JavaEE%E7%9A%84%E9%82%A3%E4%BA%9B%E6%A8%A1%E5%BC%8F.m4a', 
revision_id=37 where entity_id=37 
 {executed in 0 msec}
2020-11-19 17:55:36.307 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=37 
 {executed in 0 msec}
2020-11-19 17:55:36.308 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |revision_id |
|----------|-------|------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/b162d78c140278c67f716192e0ad763b?bkt=en-07c9b0a504a37060db41da44d85860aae2ee4f517c0aae0e368e6b5eac9f7adc4ea4cd15f5fb4a4b&fid=3757516097-778750-652598925955165&time=1605756132&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-bZNHE87HprCsTwFpDEZfD0vERSo%3D&to=92&size=14304021&sta_dx=14304021&sta_cs=3873&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414495&mtime=1605754778&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=14304021&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-9bae22f3779cdcda823180f19e1ba39c35ddffd614fbd516bcd4c6139eec954d5729d3ae93e53236&sl=76480590&expires=8h&rt=pr&r=683399320&mlogid=7502269529331065997&vbdid=2247232042&fin=12%E4%B8%A8%E5%94%AF%E6%9C%89%E5%A5%97%E8%B7%AF%E5%BE%97%E4%BA%BA%E5%BF%83%EF%BC%9A%E8%B0%88%E8%B0%88JavaEE%E7%9A%84%E9%82%A3%E4%BA%9B%E6%A8%A1%E5%BC%8F.m4a&bflag=92,34-92&rtype=1&dp-logid=7502269529331065997&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=5eee304bbb22b9c2acd18ff8009f13c8a0a90b7ac7ecc952305a5e1275657320&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=12%E4%B8%A8%E5%94%AF%E6%9C%89%E5%A5%97%E8%B7%AF%E5%BE%97%E4%BA%BA%E5%BF%83%EF%BC%9A%E8%B0%88%E8%B0%88JavaEE%E7%9A%84%E9%82%A3%E4%BA%9B%E6%A8%A1%E5%BC%8F.m4a |37          |
|----------|-------|------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 17:55:36.313 INFO  jdbc.sqltiming Line:373 - update node_revision__field_media set bundle='book', delta=0, langcode='zh-hans', field_media_value='https://qdall01.baidupcs.com/file/b162d78c140278c67f716192e0ad763b?bkt=en-07c9b0a504a37060db41da44d85860aae2ee4f517c0aae0e368e6b5eac9f7adc4ea4cd15f5fb4a4b&fid=3757516097-778750-1074285291837031&time=1605779734&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-2qNLwrksNabSK4Nbxc9AW8odom4%3D&to=92&size=14304021&sta_dx=14304021&sta_cs=3878&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414495&mtime=1605778300&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=14304021&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-9bae22f3779cdcda823180f19e1ba39c35ddffd614fbd516bcd4c6139eec954d5729d3ae93e53236&sl=76480590&expires=8h&rt=pr&r=447182992&mlogid=7508605160983499541&vbdid=2247232042&fin=12%E4%B8%A8%E5%94%AF%E6%9C%89%E5%A5%97%E8%B7%AF%E5%BE%97%E4%BA%BA%E5%BF%83%EF%BC%9A%E8%B0%88%E8%B0%88JavaEE%E7%9A%84%E9%82%A3%E4%BA%9B%E6%A8%A1%E5%BC%8F.m4a&bflag=92,34-92&rtype=1&dp-logid=7508605160983499541&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=5f2aaa70d2fd14de1734d8ca037459b2dee29e29dea88820&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=12%E4%B8%A8%E5%94%AF%E6%9C%89%E5%A5%97%E8%B7%AF%E5%BE%97%E4%BA%BA%E5%BF%83%EF%BC%9A%E8%B0%88%E8%B0%88JavaEE%E7%9A%84%E9%82%A3%E4%BA%9B%E6%A8%A1%E5%BC%8F.m4a', 
revision_id=37 where entity_id=37 
 {executed in 0 msec}
2020-11-19 17:55:36.316 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=37 
 {executed in 0 msec}
2020-11-19 17:55:36.316 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------|------|---------------------|---------|------------|
|37        |book   |                    |0     |full_html            |zh-hans  |37          |
|----------|-------|--------------------|------|---------------------|---------|------------|

2020-11-19 17:55:36.321 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=37 
 {executed in 0 msec}
2020-11-19 17:55:36.322 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------|------|---------------------|---------|------------|
|[unread]  |book   |                    |0     |full_html            |zh-hans  |37          |
|----------|-------|--------------------|------|---------------------|---------|------------|

2020-11-19 17:55:36.327 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=37 
 {executed in 0 msec}
2020-11-19 17:55:36.327 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|37        |book   |0     |zh-hans  |37          |https://static001.geekbang.org/resource/image/57/21/57002ada154c047e8ff5668351ddaf21.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 17:55:36.332 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=37 
 {executed in 0 msec}
2020-11-19 17:55:36.333 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |37          |https://static001.geekbang.org/resource/image/57/21/57002ada154c047e8ff5668351ddaf21.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 17:55:36.338 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=37 
 {executed in 1 msec}
2020-11-19 17:55:36.338 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |37          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 17:55:36.343 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=37 
 {executed in 0 msec}
2020-11-19 17:55:36.344 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |37          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 17:55:36.349 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='806919862409703' 
and bookchecke0_.name='net_content' 
 {executed in 0 msec}
2020-11-19 17:55:36.349 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

2020-11-19 17:56:12.831 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='806919862409703' 
and bookchecke0_.name='net_content' 
 {executed in 0 msec}
2020-11-19 17:56:12.831 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

2020-11-19 17:56:12.832 INFO  jdbc.sqltiming Line:373 - insert into book_check (fsid, got, name) values ('806919862409703', 1, 'net_content') 
 {executed in 0 msec}
2020-11-19 17:56:12.833 INFO  jdbc.sqltiming Line:373 - getGeneratedKeys on query: insert into book_check (fsid, got, name) values ('806919862409703', 
1, 'net_content') 
 {executed in 0 msec}
2020-11-19 17:56:12.833 INFO  jdbc.resultsettable Line:610 - 
|--------------|
|generated_key |
|--------------|
|63            |
|--------------|

2020-11-19 17:56:12.853 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='806919862409703' 
and bookchecke0_.name='media' 
 {executed in 0 msec}
2020-11-19 17:56:12.853 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

2020-11-19 17:56:13.277 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='806919862409703' 
and bookchecke0_.name='media' 
 {executed in 0 msec}
2020-11-19 17:56:13.278 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

2020-11-19 17:56:13.279 INFO  jdbc.sqltiming Line:373 - insert into book_check (fsid, got, name) values ('806919862409703', 1, 'media') 
 {executed in 0 msec}
2020-11-19 17:56:13.280 INFO  jdbc.sqltiming Line:373 - getGeneratedKeys on query: insert into book_check (fsid, got, name) values ('806919862409703', 
1, 'media') 
 {executed in 0 msec}
2020-11-19 17:56:13.281 INFO  jdbc.resultsettable Line:610 - 
|--------------|
|generated_key |
|--------------|
|64            |
|--------------|

2020-11-19 17:56:13.300 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='806919862409703' 
 {executed in 1 msec}
2020-11-19 17:56:13.300 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|38        |book   |0     |806919862409703  |zh-hans  |38          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 17:56:13.301 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=38 
 {executed in 0 msec}
2020-11-19 17:56:13.301 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|38  |zh-hans  |book |4e5bf0e5-20e8-4d8e-b152-4146d62b8fb1 |38  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 17:56:13.307 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=38 
 {executed in 1 msec}
2020-11-19 17:56:13.307 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |806919862409703  |zh-hans  |38          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 17:56:13.313 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=38 
 {executed in 0 msec}
2020-11-19 17:56:13.314 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|38  |1   |3     |0            |1  |35 |38 |0  |0  |35  |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 17:56:13.320 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=38 
 {executed in 1 msec}
2020-11-19 17:56:13.328 INFO  jdbc.resultsettable Line:610 - 
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|38        |<p>你好，我是四火。</p>
<p>今天我们要接触一个和 MVC 密切相关的，能带来思维模式改变的编程范型——面向切面编程（AOP，Aspect Oriented Programming）。</p>
<h2>“给我一把锤子，满世界都是钉子”</h2>
<p>我记得曾经有这样一个相当流行的观点，是说，编程语言只需要学习一门就够了，学那么多也没有用，因为技术是一通百通的，别的编程语言可以说是大同小异。我相信至今抱有这种观点的程序员也不在少数。</p>
<p>可惜，事实远没有那么美好。这个观点主要有两处值得商榷：</p>
<ul> 
 <li>其一，不同的技术，在一定程度上确实是相通的，可是，技术之间的关联性，远不是“一通百通”这四个简简单单的字能够解释的。妄想仅仅凭借精通一门编程语言，就能够自动打通其它所有编程语言的任督二脉，这是不现实的。</li> 
 <li>其二，通常来说，说编程语言大同小异其实是很不客观的。编程语言经过了长时间的发展演化，如今已经发展出非常多的类型，用作编程语言分类标准之一的编程范型也可谓是百花齐放。</li> 
</ul>
<p>因此我们要学习多种编程语言，特别是那些能带来新的思维模式的编程语言。现在，把这个观点泛化到普遍的软件技术上，也一样适用。我们都知道要“一切从实际出发”，都知道要“具体问题具体分析”，可是，<strong>在眼界还不够开阔的时候，特别是职业生涯的早期，程序员在武器库里的武器还非常有限的时候，依然无法避免“给我一把锤子，满世界都是钉子”，在技术选择的时候眼光相对局限。</strong></p><!-- [[[read_end]]] -->
<p>所以我们要学习全栈技术，尤其是要学习这些不一样，但一定层面上和已掌握知识相通的典型技术。今天我们要学习的这项在 MVC 框架中广泛使用的技术，是和面向对象编程一类层面的编程范型，叫做面向切面编程。</p>
<p>互联网有许多功能，如果使用传统的基于单个请求处理流程的方式来编码，代码就会非常繁琐，而使用 AOP 的方式，代码可以得到很大程度上的简化。希望通过今天的学习，你的武器库里，能够多一把重型机枪。</p>
<h2>AOP 的概念</h2>
<p><strong>面向切面编程是一种通过横切关注点（Cross-cutting Concerns）分离来增强代码模块性的方法，它能够在不修改业务主体代码的情况下，对它添加额外的行为。</strong></p>
<p>不好理解吗？没关系，我们来对它做进一步的说明。</p>
<p>首先需要明确的是，AOP 的目标是增强代码模块性，也就是说，本质上它是一种“解耦”的方法，在这方面它和我们之前介绍的分层等方法是类似的，可是，它分离代码的角度与我们传统、自然的模块设计思路截然不同。</p>
<p>我们来看下面这样一个例子，对于图书馆系统来说，有许多业务流程，其中借书和还书是最典型的两条。对于这些业务流程来说，从图书系统接收到请求开始，需要完成若干个步骤，但这些步骤都有一些“共性”，比如鉴权，比如事务控制：</p>
<p><img src="https://static001.geekbang.org/resource/image/f1/2c/f17118dd2cb4f0132c76fd152a3c062c.png" alt=""></p>
<p>那么，如果我们按照自然的思考方式，我们会把代码按照流程分解成一个一个的步骤，在每个步骤完成的前后添加这些“共性”逻辑。可是这样，这些逻辑就会散落在代码各处了，即便我们把它们按照重复代码抽取的原则，抽出来放到单独的方法中，这样的方法的“调用”还是散落在各处，无论是对软件工程上的可维护性，还是代码阅读时对于业务流程的专注度，都是不利的。</p>
<p>藉由 AOP 则可以有效地解决这些问题，对于图中横向的业务流程，我们能够保持它们独立不变，而把鉴权、事务这样的公共功能，彻底拿出去，放到单独的地方，这样整个业务流程就变得纯粹和干净，没有任何代码残留的痕迹，就好像武林高手彻底隐形了一般，但是，功能却没有任何丢失。就好比面条一般顺下来的业务流程，水平地切了几刀，每一刀，都是一个 AOP 的功能实现。</p>
<p>我们可能在 Java 的世界中谈论 AOP 比较多，但请注意，它并不是 Java 范畴的概念，它不依赖于任何框架，也和编程语言本身无关。</p>
<h2>Spring 中的应用</h2>
<p><a href="https://spring.io/">Spring</a> 作为一个应用程序框架，提供了对于 AOP 功能上完整的支持，下面让我们通过例子来学习。还记得我们在 <a href="https://time.geekbang.org/column/article/141679">[第 08 讲]</a> 中举例介绍的将图书借出的方法吗？</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookService {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public Book lendOut(String bookId, String userId, Date date) { ... (0) }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>现在，我们要给很多的业务方法以 AOP 的方式添加功能，而 lendOut 就是其中之一。定义一个 TransactionAspect 类：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class TransactionAspect {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void doBefore(JoinPoint jp) { ... (1) }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void doAfter(JoinPoint jp) { ... (2) }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void doThrowing(JoinPoint jp, Throwable ex) { ... (3) }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void doAround(ProceedingJoinPoint pjp) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ... (4)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        pjp.proceed();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ... (5)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>你看，我给每一处可以实现的代码都用数字做了标记。我们希望在 doBefore 方法中添加事务开始逻辑，doAfter 方法中添加事务结束的提交逻辑，doThrowing 方法中添加事务失败的回滚逻辑，而在 doAround 方法中业务执行前后添加日志打印逻辑，其中的 pjp.proceed() 方法表示对原方法的调用。</p>
<p>接着，我们需要写一些 XML 配置，目的就是把原方法和 AOP 的切面功能连接起来。配置片段如下：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;bean id="bookService" class="xxx.BookService"&gt;&lt;/bean&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;bean id="transactionAspect" class="xxx.TransactionAspect"&gt;&lt;/bean&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;aop:config&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:pointcut expression="execution(* xxx.BookService.*(..))" id="transactionPointcut"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:aspect ref="transactionAspect"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:before method="doBefore" pointcut-ref="transactionPointcut"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:after-returning method="doAfter" pointcut-ref="transactionPointcut"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:after-throwing method="doThrowing" pointcut-ref="transactionPointcut" throwing="ex"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:around method="doAround" pointcut-ref="transactionPointcut"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;/aop:aspect&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/aop:config&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>在这段配置中，前两行分别是对 BookService 和 TransactionAspect 这两个 Bean 的声明，接下来在 aop:config 中，我们定义了 pointcut 的切面匹配表达式，表示要捕获 BookService 的所有方法，并在 aop:aspect 标签内定义了我们希望实施的 AOP 功能。</p>
<p>在实际执行的过程中，如果没有异常抛出，上述这些逻辑的执行顺序将是：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       (1) → (4) → (0) → (5) → (2)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>实现原理</h2>
<p>讲了 AOP 怎样配置，怎么表现，现在我要来讲讲它的实现原理了。通过这部分内容，希望你可以搞清楚，为什么不需要对代码做任何改动，就可以在业务逻辑的流水中切一刀，插入我们想要执行的其它逻辑呢？</p>
<p>对于常见的实现，我们根据其作用的不同时间阶段进行分类，有这样两种：</p>
<p><strong>编译期间的静态织入，又称为编译时增强。</strong>织入（Weaving），指的是将切面代码和源业务代码链接起来的过程。<a href="https://www.eclipse.org/aspectj/">AspectJ</a> 就是这样一个面向切面的 Java 语言扩展，称呼其为语言的“扩展”，就是因为它扩展了 Java 语言的语法，需要特定的编译器来把 AspectJ 的代码编译成 JVM 可识别的 class 文件。</p>
<p><strong>运行期间的动态代理，又称为运行时增强。</strong>这种方式是在程序运行时，依靠预先创建或运行时创建的代理类来完成切面功能的。比如 JDK 基于接口的动态代理技术，或 <a href="https://github.com/cglib/cglib/wiki">CGLib</a> 基于类的代理对象生成技术就属于这一种。</p>
<p>Spring AOP 默认支持的是后者——运行期间的动态代理。至于具体实现，通常来说，我们应该优先考虑使用 JDK 的动态代理技术；但是如果目标类没有实现接口，我们只能退而求其次，使用 CGLib。</p>
<p>动态代理的方式由于在运行时完成代理类或代理对象的创建，需要用到 Java 的拦截、反射和字节码生成等技术，因此运行时的性能表现往往没有静态织入好，功能也有较多限制，但是由于使用起来简便（不需要语言扩展，不需要特殊的编译器等），它的实际应用更为广泛。</p>
<h2>控制反转 IoC</h2>
<p>通过 AOP 我们知道，某些问题如果我们换个角度来解决，会很大程度地简化代码。现在，让我们来了解在 Spring 中另一个经常和面向切面编程一起出现的概念——控制反转。控制反转是一种设计思想，也是通过“换个角度”来解决问题的。</p>
<p>控制反转，IoC，即 Inversion of Control，言下之意，指的是把原有的控制方向掉转过来了。在我们常规的程序流程中，对象是由主程序流程创建的，例如，在业务流程中使用 new 关键字来创建依赖对象。</p>
<p>但是，当我们使用 Spring 框架的时候，<strong>Spring 把对象创建的工作接管过来，它作为对象容器，来负责对象的查找、匹配、创建、装配，依赖管理，等等。而主程序流程，则不用关心对象是怎么来的，只需要使用对象就可以了。</strong>我们还是拿 BookService 举例子：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookService {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Autowired
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private BookDao bookDao;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Autowired
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private LoanDao loanDao;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public Book lendOut(String bookId, String userId, Date date) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bookDao.update( ... );
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        loanDao.insert( ... );
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>比如 BookService 的借出方法，假如它的实现中，我们希望：</p>
<ul> 
 <li>调用数据访问对象 bookDao 的方法来更新被借书的状态；</li> 
 <li>调用借阅行为的访问对象 loanDao 来增加一条借阅记录。</li> 
</ul>
<p>在这种情况下，我们可以通过 @Autowired 注解，让容器将实际的数据访问对象注入进来，主程序流程不用关心“下一层”的数据访问对象到底是怎么创建的，怎么初始化的，甚至是怎么注入进来的，而是直接用就可以了，因为这些对象都已经被 Spring 管理起来了。</p>
<p>如果这些注入的对象之间还存在依赖关系，初始化它们的顺序就至关重要了，可是在这种情况下，Service 层依然不用关心，因为 Spring 已经根据代码或配置中声明的依赖关系自动确定了。总之，Service 层的业务代码，只管调用其下的数据访问层的方法就好了。</p>
<p>读到这里，你可能会回想起前文 AOP 的内容，和 IoC 似乎有一个共同的特点：都是<strong>为了尽可能保证主流程的纯粹和简洁</strong>，而将这些不影响主流程的逻辑拿出去，只不过这两种技术，“拿出去”的是不同的逻辑。值得注意的是，对象之间的依赖关系，各层之间的依赖关系，并没有因为 IoC 而发生任何的改变。</p>
<p><strong>IoC 在实现上包含两种方式，一种叫做依赖查找（DL，Dependency Lookup），另一种叫做依赖注入（DI，Dependency Injection）。</strong>二者缺一不可，Spring 容器做到了两者，就如同上面的例子，容器需要先查找到 bookDao 和 loanDao 所对应的对象，再把它们注入进来。当然，我们平时听到的更多是第二种。</p>
<p>有了一个大致的感受，那么 IoC 到底能带来什么好处呢？我觉得主要有这样两个方面：</p>
<ul> 
 <li><strong>资源统一配置管理。</strong>这个方面很好，但并不是 IoC 最大的优势，因为，如果你不把资源交给容器管理，而是自己建立一个资源管理类来管理某项资源，一样可以得到“统一管理”的所有优势。</li> 
 <li><strong>业务代码不再包含依赖资源的访问逻辑，因此资源访问和业务流程的代码解耦开了。</strong>我觉得这里的“解耦”才是 IoC 最核心的优势，它让各层之间的依赖关系变得松散。就如同上面的代码例子一样，如果哪一天我想把它依赖的 bookDao 和 loanDao 替换掉（比如，我想为 Service 层做测试），Service 一行代码都不用改，它压根都不需要知道。</li> 
</ul>
<h2>总结思考</h2>
<p>今天我们一起学习了面向切面编程，从学习概念，熟悉配置，到了解实现原理，希望你对于 AOP 已经有了一个清晰的认识，在未来设计和开发系统的时候，无论技术怎样演进，框架怎么变化，始终知道什么时候需要它，并能够把它从你的武器库中拿出来使用。</p>
<p>现在我来提两个问题，我们一起讨论吧：</p>
<ul> 
 <li>你过去的项目中有没有应用 AOP 的例子，能说说吗？</li> 
 <li>我介绍了 AOP 的优点，但却没有提到它的缺点，但其实任何技术都是有两面性的，你觉得 AOP 的缺点都有哪些呢？</li> 
</ul>
<h2>选修课堂：实践 AOP 的运行时动态代理</h2>
<p>我们学习了 AOP 的实现原理，知道其中一种办法是通过 JDK 的动态代理技术来实现的。现在，我们就来写一点代码，用它实现一个小例子。</p>
<p>首先，请你准备好一个项目文件夹，我们会在其中创建一系列文件。你可以使用 Eclipse 来管理项目，也可以自己建立一个独立的文件夹，这都没有关系。</p>
<p>现在建立 BookService.java，这次我们把 BookService 定义为一个接口，包含 lendOut 方法，同时也创建它的实现 BookServiceImpl：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.text.MessageFormat;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.Date;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       interface BookService {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        void lendOut(String bookId, String userId, Date date);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class BookServiceImpl implements BookService {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void lendOut(String bookId, String userId, Date date) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(MessageFormat.format("{0}: The book {1} is lent to {2}.", date, bookId, userId));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>然后，我们建立一个 ServiceInvocationHandler.java，在这里我们可以定义代理对象在对原对象的方法调用前后，添加的额外逻辑：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.reflect.InvocationHandler;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.reflect.Method;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class ServiceInvocationHandler implements InvocationHandler {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private Object target;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public ServiceInvocationHandler(Object target) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        this.target = target;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("Before...");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Object result = method.invoke(this.target, args);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("After...");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return result;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>接着，我们建立一个 Client.java 类，作为程序的起点，通过动态代理的方式来调用源代码中的 lendOut 方法：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.reflect.Proxy;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.Date;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Client {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        BookService bookService = (BookService) Proxy.newProxyInstance(
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        BookService.class.getClassLoader(),
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Class[]{ BookService.class },
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new ServiceInvocationHandler(new BookServiceImpl())
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        );
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bookService.lendOut("123", "456", new Date());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>你看，我们创建了一个动态代理对象，并赋给 bookService，这个代理对象实际是会调用 BookServiceImpl 的，但调用的前后打印了额外的日志。并且，这个代理对象也实现自 BookService 接口，因此，对于 BookService 的使用者来说，它实际并不知道调用到的是 BookServiceImpl 还是它的代理对象。请看图示：</p>
<p><img src="https://static001.geekbang.org/resource/image/c3/9e/c39ca70be876a106e90e73d6946d849e.png" alt=""></p>
<p>好，现在我们把这些代码编译一下：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       javac BookService.java ServiceInvocationHandler.java Client.java
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>你应该能看到它们的 class 文件分别生成了。</p>
<p>最后，执行 Client 的 main 方法，就能看到相应的执行结果，它显示 lendBook 方法前后的 AOP 的逻辑被实际执行了：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java Client
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Before...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       8/10/19 11:42 AM: The book 123 is lent to 456.
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       After...
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>扩展阅读</h2>
<ul> 
 <li>Spring 官方文档中<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#aop">关于 AOP 的教程</a>，如果你希望看到中文版，那么互联网上有不少对于这部分的翻译，只不过对应的 Spring 版本不同，内容大致是一样的，比如<a href="https://blog.csdn.net/wengcheng_k/article/details/79952358">这一篇</a>。</li> 
 <li><a href="https://www.baeldung.com/spring-aop-vs-aspectj">Comparing Spring AOP and AspectJ</a>，这是一篇关于静态织入和动态代理这两种 AOP 方式比较的文章。</li> 
 <li>对于 AspectJ，如果想一瞥其扩展的语法语义，维基百科的<a href="https://en.wikipedia.org/wiki/AspectJ">词条</a>就足矣；如果想了解某些细节，请参阅<a href="https://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html">官方文档</a>。</li> 
</ul>
<p><img src="https://static001.geekbang.org/resource/image/11/8b/1181246bbd51ce348d5729696d1dc28b.jpg" alt="unpreview"></p> |             |book   |0     |full_html   |zh-hans  |38          |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 17:56:13.338 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=38 
 {executed in 1 msec}
2020-11-19 17:56:13.346 INFO  jdbc.resultsettable Line:610 - 
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>你好，我是四火。</p>
<p>今天我们要接触一个和 MVC 密切相关的，能带来思维模式改变的编程范型——面向切面编程（AOP，Aspect Oriented Programming）。</p>
<h2>“给我一把锤子，满世界都是钉子”</h2>
<p>我记得曾经有这样一个相当流行的观点，是说，编程语言只需要学习一门就够了，学那么多也没有用，因为技术是一通百通的，别的编程语言可以说是大同小异。我相信至今抱有这种观点的程序员也不在少数。</p>
<p>可惜，事实远没有那么美好。这个观点主要有两处值得商榷：</p>
<ul> 
 <li>其一，不同的技术，在一定程度上确实是相通的，可是，技术之间的关联性，远不是“一通百通”这四个简简单单的字能够解释的。妄想仅仅凭借精通一门编程语言，就能够自动打通其它所有编程语言的任督二脉，这是不现实的。</li> 
 <li>其二，通常来说，说编程语言大同小异其实是很不客观的。编程语言经过了长时间的发展演化，如今已经发展出非常多的类型，用作编程语言分类标准之一的编程范型也可谓是百花齐放。</li> 
</ul>
<p>因此我们要学习多种编程语言，特别是那些能带来新的思维模式的编程语言。现在，把这个观点泛化到普遍的软件技术上，也一样适用。我们都知道要“一切从实际出发”，都知道要“具体问题具体分析”，可是，<strong>在眼界还不够开阔的时候，特别是职业生涯的早期，程序员在武器库里的武器还非常有限的时候，依然无法避免“给我一把锤子，满世界都是钉子”，在技术选择的时候眼光相对局限。</strong></p><!-- [[[read_end]]] -->
<p>所以我们要学习全栈技术，尤其是要学习这些不一样，但一定层面上和已掌握知识相通的典型技术。今天我们要学习的这项在 MVC 框架中广泛使用的技术，是和面向对象编程一类层面的编程范型，叫做面向切面编程。</p>
<p>互联网有许多功能，如果使用传统的基于单个请求处理流程的方式来编码，代码就会非常繁琐，而使用 AOP 的方式，代码可以得到很大程度上的简化。希望通过今天的学习，你的武器库里，能够多一把重型机枪。</p>
<h2>AOP 的概念</h2>
<p><strong>面向切面编程是一种通过横切关注点（Cross-cutting Concerns）分离来增强代码模块性的方法，它能够在不修改业务主体代码的情况下，对它添加额外的行为。</strong></p>
<p>不好理解吗？没关系，我们来对它做进一步的说明。</p>
<p>首先需要明确的是，AOP 的目标是增强代码模块性，也就是说，本质上它是一种“解耦”的方法，在这方面它和我们之前介绍的分层等方法是类似的，可是，它分离代码的角度与我们传统、自然的模块设计思路截然不同。</p>
<p>我们来看下面这样一个例子，对于图书馆系统来说，有许多业务流程，其中借书和还书是最典型的两条。对于这些业务流程来说，从图书系统接收到请求开始，需要完成若干个步骤，但这些步骤都有一些“共性”，比如鉴权，比如事务控制：</p>
<p><img src="https://static001.geekbang.org/resource/image/f1/2c/f17118dd2cb4f0132c76fd152a3c062c.png" alt=""></p>
<p>那么，如果我们按照自然的思考方式，我们会把代码按照流程分解成一个一个的步骤，在每个步骤完成的前后添加这些“共性”逻辑。可是这样，这些逻辑就会散落在代码各处了，即便我们把它们按照重复代码抽取的原则，抽出来放到单独的方法中，这样的方法的“调用”还是散落在各处，无论是对软件工程上的可维护性，还是代码阅读时对于业务流程的专注度，都是不利的。</p>
<p>藉由 AOP 则可以有效地解决这些问题，对于图中横向的业务流程，我们能够保持它们独立不变，而把鉴权、事务这样的公共功能，彻底拿出去，放到单独的地方，这样整个业务流程就变得纯粹和干净，没有任何代码残留的痕迹，就好像武林高手彻底隐形了一般，但是，功能却没有任何丢失。就好比面条一般顺下来的业务流程，水平地切了几刀，每一刀，都是一个 AOP 的功能实现。</p>
<p>我们可能在 Java 的世界中谈论 AOP 比较多，但请注意，它并不是 Java 范畴的概念，它不依赖于任何框架，也和编程语言本身无关。</p>
<h2>Spring 中的应用</h2>
<p><a href="https://spring.io/">Spring</a> 作为一个应用程序框架，提供了对于 AOP 功能上完整的支持，下面让我们通过例子来学习。还记得我们在 <a href="https://time.geekbang.org/column/article/141679">[第 08 讲]</a> 中举例介绍的将图书借出的方法吗？</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookService {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public Book lendOut(String bookId, String userId, Date date) { ... (0) }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>现在，我们要给很多的业务方法以 AOP 的方式添加功能，而 lendOut 就是其中之一。定义一个 TransactionAspect 类：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class TransactionAspect {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void doBefore(JoinPoint jp) { ... (1) }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void doAfter(JoinPoint jp) { ... (2) }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void doThrowing(JoinPoint jp, Throwable ex) { ... (3) }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void doAround(ProceedingJoinPoint pjp) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ... (4)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        pjp.proceed();
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ... (5)
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>你看，我给每一处可以实现的代码都用数字做了标记。我们希望在 doBefore 方法中添加事务开始逻辑，doAfter 方法中添加事务结束的提交逻辑，doThrowing 方法中添加事务失败的回滚逻辑，而在 doAround 方法中业务执行前后添加日志打印逻辑，其中的 pjp.proceed() 方法表示对原方法的调用。</p>
<p>接着，我们需要写一些 XML 配置，目的就是把原方法和 AOP 的切面功能连接起来。配置片段如下：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;bean id="bookService" class="xxx.BookService"&gt;&lt;/bean&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;bean id="transactionAspect" class="xxx.TransactionAspect"&gt;&lt;/bean&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;aop:config&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:pointcut expression="execution(* xxx.BookService.*(..))" id="transactionPointcut"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:aspect ref="transactionAspect"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:before method="doBefore" pointcut-ref="transactionPointcut"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:after-returning method="doAfter" pointcut-ref="transactionPointcut"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:after-throwing method="doThrowing" pointcut-ref="transactionPointcut" throwing="ex"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;aop:around method="doAround" pointcut-ref="transactionPointcut"/&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;/aop:aspect&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/aop:config&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>在这段配置中，前两行分别是对 BookService 和 TransactionAspect 这两个 Bean 的声明，接下来在 aop:config 中，我们定义了 pointcut 的切面匹配表达式，表示要捕获 BookService 的所有方法，并在 aop:aspect 标签内定义了我们希望实施的 AOP 功能。</p>
<p>在实际执行的过程中，如果没有异常抛出，上述这些逻辑的执行顺序将是：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       (1) → (4) → (0) → (5) → (2)
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>实现原理</h2>
<p>讲了 AOP 怎样配置，怎么表现，现在我要来讲讲它的实现原理了。通过这部分内容，希望你可以搞清楚，为什么不需要对代码做任何改动，就可以在业务逻辑的流水中切一刀，插入我们想要执行的其它逻辑呢？</p>
<p>对于常见的实现，我们根据其作用的不同时间阶段进行分类，有这样两种：</p>
<p><strong>编译期间的静态织入，又称为编译时增强。</strong>织入（Weaving），指的是将切面代码和源业务代码链接起来的过程。<a href="https://www.eclipse.org/aspectj/">AspectJ</a> 就是这样一个面向切面的 Java 语言扩展，称呼其为语言的“扩展”，就是因为它扩展了 Java 语言的语法，需要特定的编译器来把 AspectJ 的代码编译成 JVM 可识别的 class 文件。</p>
<p><strong>运行期间的动态代理，又称为运行时增强。</strong>这种方式是在程序运行时，依靠预先创建或运行时创建的代理类来完成切面功能的。比如 JDK 基于接口的动态代理技术，或 <a href="https://github.com/cglib/cglib/wiki">CGLib</a> 基于类的代理对象生成技术就属于这一种。</p>
<p>Spring AOP 默认支持的是后者——运行期间的动态代理。至于具体实现，通常来说，我们应该优先考虑使用 JDK 的动态代理技术；但是如果目标类没有实现接口，我们只能退而求其次，使用 CGLib。</p>
<p>动态代理的方式由于在运行时完成代理类或代理对象的创建，需要用到 Java 的拦截、反射和字节码生成等技术，因此运行时的性能表现往往没有静态织入好，功能也有较多限制，但是由于使用起来简便（不需要语言扩展，不需要特殊的编译器等），它的实际应用更为广泛。</p>
<h2>控制反转 IoC</h2>
<p>通过 AOP 我们知道，某些问题如果我们换个角度来解决，会很大程度地简化代码。现在，让我们来了解在 Spring 中另一个经常和面向切面编程一起出现的概念——控制反转。控制反转是一种设计思想，也是通过“换个角度”来解决问题的。</p>
<p>控制反转，IoC，即 Inversion of Control，言下之意，指的是把原有的控制方向掉转过来了。在我们常规的程序流程中，对象是由主程序流程创建的，例如，在业务流程中使用 new 关键字来创建依赖对象。</p>
<p>但是，当我们使用 Spring 框架的时候，<strong>Spring 把对象创建的工作接管过来，它作为对象容器，来负责对象的查找、匹配、创建、装配，依赖管理，等等。而主程序流程，则不用关心对象是怎么来的，只需要使用对象就可以了。</strong>我们还是拿 BookService 举例子：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookService {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Autowired
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private BookDao bookDao;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Autowired
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private LoanDao loanDao;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public Book lendOut(String bookId, String userId, Date date) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bookDao.update( ... );
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        loanDao.insert( ... );
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>比如 BookService 的借出方法，假如它的实现中，我们希望：</p>
<ul> 
 <li>调用数据访问对象 bookDao 的方法来更新被借书的状态；</li> 
 <li>调用借阅行为的访问对象 loanDao 来增加一条借阅记录。</li> 
</ul>
<p>在这种情况下，我们可以通过 @Autowired 注解，让容器将实际的数据访问对象注入进来，主程序流程不用关心“下一层”的数据访问对象到底是怎么创建的，怎么初始化的，甚至是怎么注入进来的，而是直接用就可以了，因为这些对象都已经被 Spring 管理起来了。</p>
<p>如果这些注入的对象之间还存在依赖关系，初始化它们的顺序就至关重要了，可是在这种情况下，Service 层依然不用关心，因为 Spring 已经根据代码或配置中声明的依赖关系自动确定了。总之，Service 层的业务代码，只管调用其下的数据访问层的方法就好了。</p>
<p>读到这里，你可能会回想起前文 AOP 的内容，和 IoC 似乎有一个共同的特点：都是<strong>为了尽可能保证主流程的纯粹和简洁</strong>，而将这些不影响主流程的逻辑拿出去，只不过这两种技术，“拿出去”的是不同的逻辑。值得注意的是，对象之间的依赖关系，各层之间的依赖关系，并没有因为 IoC 而发生任何的改变。</p>
<p><strong>IoC 在实现上包含两种方式，一种叫做依赖查找（DL，Dependency Lookup），另一种叫做依赖注入（DI，Dependency Injection）。</strong>二者缺一不可，Spring 容器做到了两者，就如同上面的例子，容器需要先查找到 bookDao 和 loanDao 所对应的对象，再把它们注入进来。当然，我们平时听到的更多是第二种。</p>
<p>有了一个大致的感受，那么 IoC 到底能带来什么好处呢？我觉得主要有这样两个方面：</p>
<ul> 
 <li><strong>资源统一配置管理。</strong>这个方面很好，但并不是 IoC 最大的优势，因为，如果你不把资源交给容器管理，而是自己建立一个资源管理类来管理某项资源，一样可以得到“统一管理”的所有优势。</li> 
 <li><strong>业务代码不再包含依赖资源的访问逻辑，因此资源访问和业务流程的代码解耦开了。</strong>我觉得这里的“解耦”才是 IoC 最核心的优势，它让各层之间的依赖关系变得松散。就如同上面的代码例子一样，如果哪一天我想把它依赖的 bookDao 和 loanDao 替换掉（比如，我想为 Service 层做测试），Service 一行代码都不用改，它压根都不需要知道。</li> 
</ul>
<h2>总结思考</h2>
<p>今天我们一起学习了面向切面编程，从学习概念，熟悉配置，到了解实现原理，希望你对于 AOP 已经有了一个清晰的认识，在未来设计和开发系统的时候，无论技术怎样演进，框架怎么变化，始终知道什么时候需要它，并能够把它从你的武器库中拿出来使用。</p>
<p>现在我来提两个问题，我们一起讨论吧：</p>
<ul> 
 <li>你过去的项目中有没有应用 AOP 的例子，能说说吗？</li> 
 <li>我介绍了 AOP 的优点，但却没有提到它的缺点，但其实任何技术都是有两面性的，你觉得 AOP 的缺点都有哪些呢？</li> 
</ul>
<h2>选修课堂：实践 AOP 的运行时动态代理</h2>
<p>我们学习了 AOP 的实现原理，知道其中一种办法是通过 JDK 的动态代理技术来实现的。现在，我们就来写一点代码，用它实现一个小例子。</p>
<p>首先，请你准备好一个项目文件夹，我们会在其中创建一系列文件。你可以使用 Eclipse 来管理项目，也可以自己建立一个独立的文件夹，这都没有关系。</p>
<p>现在建立 BookService.java，这次我们把 BookService 定义为一个接口，包含 lendOut 方法，同时也创建它的实现 BookServiceImpl：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.text.MessageFormat;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.Date;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       interface BookService {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        void lendOut(String bookId, String userId, Date date);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class BookServiceImpl implements BookService {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void lendOut(String bookId, String userId, Date date) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println(MessageFormat.format("{0}: The book {1} is lent to {2}.", date, bookId, userId));
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>然后，我们建立一个 ServiceInvocationHandler.java，在这里我们可以定义代理对象在对原对象的方法调用前后，添加的额外逻辑：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.reflect.InvocationHandler;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.reflect.Method;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       class ServiceInvocationHandler implements InvocationHandler {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private Object target;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public ServiceInvocationHandler(Object target) {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        this.target = target;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("Before...");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        Object result = method.invoke(this.target, args);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        System.out.println("After...");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return result;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>接着，我们建立一个 Client.java 类，作为程序的起点，通过动态代理的方式来调用源代码中的 lendOut 方法：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.lang.reflect.Proxy;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.util.Date;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class Client {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public static void main(String[] args) throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        BookService bookService = (BookService) Proxy.newProxyInstance(
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        BookService.class.getClassLoader(),
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new Class[]{ BookService.class },
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        new ServiceInvocationHandler(new BookServiceImpl())
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        );
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        bookService.lendOut("123", "456", new Date());
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>你看，我们创建了一个动态代理对象，并赋给 bookService，这个代理对象实际是会调用 BookServiceImpl 的，但调用的前后打印了额外的日志。并且，这个代理对象也实现自 BookService 接口，因此，对于 BookService 的使用者来说，它实际并不知道调用到的是 BookServiceImpl 还是它的代理对象。请看图示：</p>
<p><img src="https://static001.geekbang.org/resource/image/c3/9e/c39ca70be876a106e90e73d6946d849e.png" alt=""></p>
<p>好，现在我们把这些代码编译一下：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       javac BookService.java ServiceInvocationHandler.java Client.java
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>你应该能看到它们的 class 文件分别生成了。</p>
<p>最后，执行 Client 的 main 方法，就能看到相应的执行结果，它显示 lendBook 方法前后的 AOP 的逻辑被实际执行了：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       java Client
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Before...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       8/10/19 11:42 AM: The book 123 is lent to 456.
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       After...
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>扩展阅读</h2>
<ul> 
 <li>Spring 官方文档中<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#aop">关于 AOP 的教程</a>，如果你希望看到中文版，那么互联网上有不少对于这部分的翻译，只不过对应的 Spring 版本不同，内容大致是一样的，比如<a href="https://blog.csdn.net/wengcheng_k/article/details/79952358">这一篇</a>。</li> 
 <li><a href="https://www.baeldung.com/spring-aop-vs-aspectj">Comparing Spring AOP and AspectJ</a>，这是一篇关于静态织入和动态代理这两种 AOP 方式比较的文章。</li> 
 <li>对于 AspectJ，如果想一瞥其扩展的语法语义，维基百科的<a href="https://en.wikipedia.org/wiki/AspectJ">词条</a>就足矣；如果想了解某些细节，请参阅<a href="https://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html">官方文档</a>。</li> 
</ul>
<p><img src="https://static001.geekbang.org/resource/image/11/8b/1181246bbd51ce348d5729696d1dc28b.jpg" alt="unpreview"></p> |             |book   |0     |full_html   |zh-hans  |38          |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 17:56:13.358 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=38 
 {executed in 1 msec}
2020-11-19 17:56:13.358 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title          |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|-----|----|----|
|38  |1605756170 |1605756170 |1                |zh-hans  |0       |1                             |1      |0      |11丨剑走偏锋：面向切面编程 |book |1   |38  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|-----|----|----|

2020-11-19 17:56:13.359 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=38 
 {executed in 0 msec}
2020-11-19 17:56:13.359 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title          |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|----|----|
|[unread] |1605756170 |1605756170 |1                |zh-hans  |0       |1                             |1      |0      |11丨剑走偏锋：面向切面编程 |1   |38  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|---------------|----|----|

2020-11-19 17:56:13.365 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605779773, created=1605779773, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='11丨剑走偏锋：面向切面编程', type='book', 
uid=1, vid=38 where nid=38 
 {executed in 1 msec}
2020-11-19 17:56:13.365 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605779773, created=1605779773, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='11丨剑走偏锋：面向切面编程', 
uid=1, vid=38 where nid=38 
 {executed in 0 msec}
2020-11-19 17:56:13.374 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=38 
 {executed in 0 msec}
2020-11-19 17:56:13.375 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |revision_id |
|----------|-------|------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|38        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/7c7f9770c56208046b2d4cab40c27aed?bkt=en-038bee77e919b76a0c384fd3d0db9910318319c91076626f25f47e8a14d653c9c2ed30c47896832c&fid=3757516097-778750-781094517826930&time=1605756169&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-z5F1IGzqEeq4o1Yj4ZqvmqYo8Os%3D&to=92&size=12939652&sta_dx=12939652&sta_cs=3868&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414486&mtime=1605754779&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=12939652&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-40b167508497573ed1bc084ed48df4758e0dde3f5e5ad865b6bb6eb304c7d13399c62dabadde1654&sl=76480590&expires=8h&rt=pr&r=260776873&mlogid=7502279444894909358&vbdid=2247232042&fin=11%E4%B8%A8%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B.m4a&bflag=92,34-92&rtype=1&dp-logid=7502279444894909358&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=12146e4ffd7df3c96ce0bb4474c9a675289b64a25f677fc1&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=11%E4%B8%A8%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B.m4a |38          |
|----------|-------|------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 17:56:13.380 INFO  jdbc.sqltiming Line:373 - update node__field_media set bundle='book', delta=0, langcode='zh-hans', field_media_value='https://qdall01.baidupcs.com/file/7c7f9770c56208046b2d4cab40c27aed?bkt=en-038bee77e919b76a0c384fd3d0db9910318319c91076626f25f47e8a14d653c9c2ed30c47896832c&fid=3757516097-778750-675448893296050&time=1605779771&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-9qoJC1gz78XYTF9gcaGKdj1SdXQ%3D&to=92&size=12939652&sta_dx=12939652&sta_cs=3873&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414486&mtime=1605778300&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=12939652&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-40b167508497573ed1bc084ed48df4758e0dde3f5e5ad865b6bb6eb304c7d13399c62dabadde1654&sl=76480590&expires=8h&rt=pr&r=976458929&mlogid=7508615091011843505&vbdid=2247232042&fin=11%E4%B8%A8%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B.m4a&bflag=92,34-92&rtype=1&dp-logid=7508615091011843505&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=648eaef5c3fa81d1b7732bb0cde1becc3edc3400df5c51eb&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=11%E4%B8%A8%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B.m4a', 
revision_id=38 where entity_id=38 
 {executed in 1 msec}
2020-11-19 17:56:13.382 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=38 
 {executed in 0 msec}
2020-11-19 17:56:13.383 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |revision_id |
|----------|-------|------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/7c7f9770c56208046b2d4cab40c27aed?bkt=en-038bee77e919b76a0c384fd3d0db9910318319c91076626f25f47e8a14d653c9c2ed30c47896832c&fid=3757516097-778750-781094517826930&time=1605756169&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-z5F1IGzqEeq4o1Yj4ZqvmqYo8Os%3D&to=92&size=12939652&sta_dx=12939652&sta_cs=3868&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414486&mtime=1605754779&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=12939652&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-40b167508497573ed1bc084ed48df4758e0dde3f5e5ad865b6bb6eb304c7d13399c62dabadde1654&sl=76480590&expires=8h&rt=pr&r=260776873&mlogid=7502279444894909358&vbdid=2247232042&fin=11%E4%B8%A8%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B.m4a&bflag=92,34-92&rtype=1&dp-logid=7502279444894909358&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=12146e4ffd7df3c96ce0bb4474c9a675289b64a25f677fc1&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=11%E4%B8%A8%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B.m4a |38          |
|----------|-------|------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 17:56:13.388 INFO  jdbc.sqltiming Line:373 - update node_revision__field_media set bundle='book', delta=0, langcode='zh-hans', field_media_value='https://qdall01.baidupcs.com/file/7c7f9770c56208046b2d4cab40c27aed?bkt=en-038bee77e919b76a0c384fd3d0db9910318319c91076626f25f47e8a14d653c9c2ed30c47896832c&fid=3757516097-778750-675448893296050&time=1605779771&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-9qoJC1gz78XYTF9gcaGKdj1SdXQ%3D&to=92&size=12939652&sta_dx=12939652&sta_cs=3873&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414486&mtime=1605778300&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=12939652&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-40b167508497573ed1bc084ed48df4758e0dde3f5e5ad865b6bb6eb304c7d13399c62dabadde1654&sl=76480590&expires=8h&rt=pr&r=976458929&mlogid=7508615091011843505&vbdid=2247232042&fin=11%E4%B8%A8%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B.m4a&bflag=92,34-92&rtype=1&dp-logid=7508615091011843505&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=648eaef5c3fa81d1b7732bb0cde1becc3edc3400df5c51eb&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=11%E4%B8%A8%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%EF%BC%9A%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B.m4a', 
revision_id=38 where entity_id=38 
 {executed in 0 msec}
2020-11-19 17:56:13.391 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=38 
 {executed in 0 msec}
2020-11-19 17:56:13.392 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |delta |field_comment_format |langcode |revision_id |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|38        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/18/28/d9/78dfd983.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>sky</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-10-05
    </div>
   </div> <!---->
  </div> 
  <div>
   <div class="_3M6kV3zb_0">
    iOS里用的runtime的一些方法也是aop了
   </div> 
   <div class="_2r3UB1GX_0">
    <span>展开</span><i class="iconfont"></i>
   </div> <!----> 
   <div class="_1w8H0ktn_0 _2A421P4G_0">
    <div class="_2jsFl-X0_0">
     <i class="iconfont"></i> <span></span>
    </div> 
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!---->
   </div>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/5a/55/411f95a8.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>我叫徐小晋</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-10-05
    </div>
   </div> <!---->
  </div> 
  <div>
   <div class="_3M6kV3zb_0">
    老师您好。SpringBoot中分层，model层,dao层，service层，controller层。上层通过@Autowired来使用下层的方法，这个就是文中说到的Ioc吗？
   </div> 
   <div class="_2r3UB1GX_0">
    <span>展开</span><i class="iconfont"></i>
   </div> <!----> 
   <div class="_1w8H0ktn_0 _2A421P4G_0">
    <div class="_2jsFl-X0_0">
     <i class="iconfont"></i> <span></span>
    </div> 
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!---->
   </div>
  </div>
 </div></li> |0     |full_html            |zh-hans  |38          |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 17:56:13.397 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=38 
 {executed in 0 msec}
2020-11-19 17:56:13.398 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |delta |field_comment_format |langcode |revision_id |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/18/28/d9/78dfd983.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>sky</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-10-05
    </div>
   </div> <!---->
  </div> 
  <div>
   <div class="_3M6kV3zb_0">
    iOS里用的runtime的一些方法也是aop了
   </div> 
   <div class="_2r3UB1GX_0">
    <span>展开</span><i class="iconfont"></i>
   </div> <!----> 
   <div class="_1w8H0ktn_0 _2A421P4G_0">
    <div class="_2jsFl-X0_0">
     <i class="iconfont"></i> <span></span>
    </div> 
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!---->
   </div>
  </div>
 </div></li>
<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/11/5a/55/411f95a8.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>我叫徐小晋</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-10-05
    </div>
   </div> <!---->
  </div> 
  <div>
   <div class="_3M6kV3zb_0">
    老师您好。SpringBoot中分层，model层,dao层，service层，controller层。上层通过@Autowired来使用下层的方法，这个就是文中说到的Ioc吗？
   </div> 
   <div class="_2r3UB1GX_0">
    <span>展开</span><i class="iconfont"></i>
   </div> <!----> 
   <div class="_1w8H0ktn_0 _2A421P4G_0">
    <div class="_2jsFl-X0_0">
     <i class="iconfont"></i> <span></span>
    </div> 
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!---->
   </div>
  </div>
 </div></li> |0     |full_html            |zh-hans  |38          |
|----------|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 17:56:13.403 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=38 
 {executed in 0 msec}
2020-11-19 17:56:13.403 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|38        |book   |0     |zh-hans  |38          |https://static001.geekbang.org/resource/image/01/92/01a86d15c9fa1160536712acae462892.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 17:56:13.409 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=38 
 {executed in 1 msec}
2020-11-19 17:56:13.409 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |38          |https://static001.geekbang.org/resource/image/01/92/01a86d15c9fa1160536712acae462892.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 17:56:13.414 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=38 
 {executed in 0 msec}
2020-11-19 17:56:13.415 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |38          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 17:56:13.420 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=38 
 {executed in 0 msec}
2020-11-19 17:56:13.420 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |38          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 17:56:13.426 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='36253398013312' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 17:56:13.426 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

2020-11-19 17:56:50.480 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='36253398013312' 
and bookchecke0_.name='net_content' 
 {executed in 0 msec}
2020-11-19 17:56:50.481 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

2020-11-19 17:56:50.483 INFO  jdbc.sqltiming Line:373 - insert into book_check (fsid, got, name) values ('36253398013312', 1, 'net_content') 
 {executed in 0 msec}
2020-11-19 17:56:50.483 INFO  jdbc.sqltiming Line:373 - getGeneratedKeys on query: insert into book_check (fsid, got, name) values ('36253398013312', 
1, 'net_content') 
 {executed in 0 msec}
2020-11-19 17:56:50.484 INFO  jdbc.resultsettable Line:610 - 
|--------------|
|generated_key |
|--------------|
|65            |
|--------------|

2020-11-19 17:56:50.507 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='36253398013312' 
and bookchecke0_.name='media' 
 {executed in 0 msec}
2020-11-19 17:56:50.508 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

2020-11-19 17:56:50.924 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='36253398013312' 
and bookchecke0_.name='media' 
 {executed in 1 msec}
2020-11-19 17:56:50.924 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

2020-11-19 17:56:50.926 INFO  jdbc.sqltiming Line:373 - insert into book_check (fsid, got, name) values ('36253398013312', 1, 'media') 
 {executed in 0 msec}
2020-11-19 17:56:50.927 INFO  jdbc.sqltiming Line:373 - getGeneratedKeys on query: insert into book_check (fsid, got, name) values ('36253398013312', 
1, 'media') 
 {executed in 0 msec}
2020-11-19 17:56:50.928 INFO  jdbc.resultsettable Line:610 - 
|--------------|
|generated_key |
|--------------|
|66            |
|--------------|

2020-11-19 17:56:50.950 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_7_, bookfieldf0_.bundle as bundle2_7_, bookfieldf0_.delta 
as delta3_7_, bookfieldf0_.field_fsid_value as field_fs4_7_, bookfieldf0_.langcode as langcode5_7_, 
bookfieldf0_.revision_id as revision6_7_ from node__field_fsid bookfieldf0_ where bookfieldf0_.field_fsid_value='36253398013312' 
 {executed in 0 msec}
2020-11-19 17:56:50.950 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|39        |book   |0     |36253398013312   |zh-hans  |39          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 17:56:50.951 INFO  jdbc.sqltiming Line:373 - select nodeentity0_.nid as nid1_3_, nodeentity0_.langcode as langcode2_3_, nodeentity0_.type 
as type3_3_, nodeentity0_.uuid as uuid4_3_, nodeentity0_.vid as vid5_3_ from node nodeentity0_ 
where nodeentity0_.nid=39 
 {executed in 0 msec}
2020-11-19 17:56:50.951 INFO  jdbc.resultsettable Line:610 - 
|----|---------|-----|-------------------------------------|----|
|nid |langcode |type |uuid                                 |vid |
|----|---------|-----|-------------------------------------|----|
|39  |zh-hans  |book |788a1498-74f4-49ea-86f0-be5db7ee2985 |39  |
|----|---------|-----|-------------------------------------|----|

2020-11-19 17:56:50.957 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_16_0_, nodefieldf0_.bundle as bundle2_16_0_, nodefieldf0_.delta 
as delta3_16_0_, nodefieldf0_.field_fsid_value as field_fs4_16_0_, nodefieldf0_.langcode as 
langcode5_16_0_, nodefieldf0_.revision_id as revision6_16_0_ from node_revision__field_fsid 
nodefieldf0_ where nodefieldf0_.entity_id=39 
 {executed in 1 msec}
2020-11-19 17:56:50.957 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------|---------|------------|
|entity_id |bundle |delta |field_fsid_value |langcode |revision_id |
|----------|-------|------|-----------------|---------|------------|
|[unread]  |book   |0     |36253398013312   |zh-hans  |39          |
|----------|-------|------|-----------------|---------|------------|

2020-11-19 17:56:50.962 INFO  jdbc.sqltiming Line:373 - select bookentity0_.nid as nid1_1_, bookentity0_.bid as bid2_1_, bookentity0_.depth as depth3_1_, 
bookentity0_.has_children as has_chil4_1_, bookentity0_.p1 as p5_1_, bookentity0_.p2 as p6_1_, 
bookentity0_.p3 as p7_1_, bookentity0_.p4 as p8_1_, bookentity0_.p5 as p9_1_, bookentity0_.pid 
as pid10_1_, bookentity0_.weight as weight11_1_ from book bookentity0_ where bookentity0_.nid=39 
 {executed in 0 msec}
2020-11-19 17:56:50.963 INFO  jdbc.resultsettable Line:610 - 
|----|----|------|-------------|---|---|---|---|---|----|-------|
|nid |bid |depth |has_children |p1 |p2 |p3 |p4 |p5 |pid |weight |
|----|----|------|-------------|---|---|---|---|---|----|-------|
|39  |1   |3     |0            |1  |35 |39 |0  |0  |35  |0      |
|----|----|------|-------------|---|---|---|---|---|----|-------|

2020-11-19 17:56:50.969 INFO  jdbc.sqltiming Line:373 - select nodebodyen0_.entity_id as entity_i1_4_, nodebodyen0_.body_value as body_val2_4_, nodebodyen0_.body_summary 
as body_sum3_4_, nodebodyen0_.bundle as bundle4_4_, nodebodyen0_.delta as delta5_4_, nodebodyen0_.body_format 
as body_for6_4_, nodebodyen0_.langcode as langcode7_4_, nodebodyen0_.revision_id as revision8_4_ 
from node__body nodebodyen0_ where nodebodyen0_.entity_id=39 
 {executed in 1 msec}
2020-11-19 17:56:50.977 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|39        |<p>你好，我是四火。</p>
<p>今天我们继续学习 MVC 架构，主要内容就是 MVC 架构的第三部分——控制器（Controller）。</p>
<p>控制器用于接收请求，校验参数，调用 Model 层获取业务数据，构造和绑定上下文，并转给 View 层去渲染。也就是说，控制器是 MVC 的大脑，它知道接下去该让谁去做什么事。控制器层是大多数 MVC 框架特别愿意做文章的地方，我相信你可能耳闻、了解，甚至熟练使用过一些 MVC 框架了。</p>
<p>那么与其去抽象地学习这一层的重要概念、原理，或是单纯地学习这些框架在这一层略显乏味的具体配置，我想我们今天“不走寻常路”一次，把这两者结合起来——<strong>我们来比较 Servlet、Struts 和 Sprint MVC 这三种常见的技术和 MVC 框架，在控制器层的工作路数，以及和业务代码整合配置的方式，看看任这些框架形式千变万化，到底有哪些其实是不变的“套路”呢？</strong></p>
<p>随着请求到达控制器，让我们顺着接下去的请求处理流程，看看控制器会通过怎样的步骤，履行完它的职责，并最终转到相应的视图吧。</p>
<h2>1. 路径映射和视图指向</h2>
<p>我们不妨把 MVC 架构的控制器想象成一个黑盒。当 HTTP 请求从客户端送达的时候，这个黑盒要完成一系列使命，那么它就有一个入口路由和一个出口路由：</p><!-- [[[read_end]]] -->
<ul> 
 <li><strong>入口路由就是路径映射，根据配置的规则，以及请求 URI 的路径，找到具体接收和处理这个请求的控制器逻辑；</strong></li> 
 <li><strong>出口路由就是视图指向，根据配置的规则，以及控制器处理完毕后返回的信息，找到需要渲染的视图页面。</strong></li> 
</ul>
<p>这两件事情，我们当然可以使用原始的 if-else 来完成，但是一般的 MVC 都提供了更清晰和独立的解决方案。</p>
<p>我们还是从老朋友 Servlet 开始讲起，在 Tomcat 的 web.xml 中，我们可以配置这样的路径映射：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;servlet&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-name&gt;BookServlet&lt;/servlet-name&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-class&gt;com.xxx.xxx.BookServlet&lt;/servlet-class&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/servlet&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;servlet-mapping&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-name&gt;BookServlet&lt;/servlet-name&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;url-pattern&gt;/books&lt;/url-pattern&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/servlet-mapping&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>你看，对于路径映射，一旦请求是 /books 这种形式的，就会被转到 BookServlet 里去处理。而对于视图指向，Servlet 是通过代码完成的，比如：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       request.getRequestDispatcher("/book.jsp").forward(request, response);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>但是，Servlet 路径映射的表达式匹配不够灵活，而且配置过于冗长；而视图指向更是完全通过代码调用来完成，视图的位置信息完全耦合在控制器主代码逻辑中，而且也并没有体现出配置的集中、清晰的管理优势。于是现今的 MVC 框架都提供了一套自己的映射匹配逻辑，例如 <a href="https://struts.apache.org/index.html">Struts 2</a>：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;action name="books" class="xxx.xxx.BookAction"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;result name="success" type="dispatcher"&gt;/success.jsp&lt;/result&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;result name="input" ... /&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/action&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>其中，name=“books” 这样的配置就会将 /books 的请求转给 BookAction。至于接下来的两个 result 标签，是根据控制器返回的视图名来配对具体的视图页面，也就是说，一旦 BookAction 处理完毕，通过返回的视图名字，请求可以被转发给相应的视图。</p>
<p>这个路径映射的配置是简单一些了，可是都需要放在一个其它位置的、单独的 XML 中配置。不过，Java 5 开始支持注解，因此许多 MVC 框架都开始支持使用注解来让这样的配置变得更加轻量，也就是将路径映射和它所属的控制器代码放在一起。见下面 Struts 的例子：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookAction extends ActionSupport {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Action(value="/books", results={
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Result(name="success",location="/book.jsp")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        })
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public String get() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return "success";
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>代码依然很好理解，当以 /books 为路径的 GET 请求到来时，会被转给 BookAction 的 get 方法。在控制器的活干完之后，根据返回的名称 success，下一步请求就会转到视图 /book.jsp 中去。</p>
<p>你看，对于路径映射和视图指向，为了不把这样的信息和主流程代码耦合在一起，上面讲了两种实现方法，它们各有优劣：</p>
<ul> 
 <li>放到配置文件中，好处是所有的映射都在一个文件里，方便管理。但是对于任何一个控制器逻辑，要寻找它对应的配置信息，需要去别的位置（即上文的 XML 中）寻找。<strong>这是一种代码横向分层解耦的方式，即分层方式和业务模块无关，或者说二者是“正交”的</strong>，这种方式我在 [第 11 讲] 讲解 IoC（控制反转）时会继续介绍。</li> 
 <li>使用注解，和控制器逻辑放在一起，好处是映射本身是和具体的控制器逻辑放在一起，当然，它们并非代码层面的耦合，而是通过注解的方式分离开。坏处是，如果需要考察所有的映射配置，那么就没有一个统一的文件可供概览。<strong>这是一种代码纵向分层解耦的方式，也就是说，配置是跟着业务模块走的</strong>。</li> 
</ul>
<p>无论使用以上哪一种方法，本质上都逃不过需要显式配置的命运。但无论哪种方法，其实都已经够简单了，可历史总是惊人的相似，总有帮“难伺候”的程序员，还是嫌麻烦！于是就有人想出了一个“终极偷懒”的办法——免掉配置。</p>
<p>这就需要利用 <strong>CoC 原则（Convention over Configuration，即规约优于配置）</strong>。比如，在使用 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Spring MVC</a> 这个 MVC 框架时，声明了 ControllerClassNameHandlerMapping 以后，对于这样没有配置任何映射信息的方法，会根据 Controller 类名的规约来完成映射：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BooksController extends AbstractController {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        protected ModelAndView handleRequestInternal() throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>在使用 /books 去访问的时候，请求就会被自动转交给定义好的控制器逻辑。</p>
<p>你看，规约优于配置看起来可以省掉很多工作对不对？没错！但是任何技术都有两面性，<strong>CoC 虽然省掉了一部分实际的配置工作，却没有改变映射匹配的流程本身，也不能省掉任何为了理解规约背后的“隐性知识”的学习成本</strong>。而且，规约往往只方便于解决最常见的配置，也就意味着，<strong>当需要更灵活的配置时，我们还是会被迫退化回显式配置</strong>。</p>
<h2>2. 请求参数绑定</h2>
<p>请求被送到了指定的控制器方法，接下去，需要从 HTTP 请求中把参数取出来，绑定到控制器这一层，以便使用。<strong>整个控制器的流程中，有两次重要的数据绑定，这是第一次，是为了控制器而绑定请求数据</strong>，后面在视图上下文构造这一步中还有一次绑定，那是为了视图而进行的。</p>
<p>和路径映射的配置一样，最先被考虑的方式，一定是用编程的方法实现的。比如在 Servlet 中，可以这样做：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       request.getParameter("name")
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>这并没有什么稀奇的对不对，想想我们前面学习的处理方法，参数应该能通过某种配置方式自动注入到控制器的对象属性或者方法参数中吧？一点都没错，并且，Struts 和 Spring MVC 各有各的做法，二者加起来，就恰巧印证了这句话。</p>
<p>还记得前面 Struts 的那个例子吗？给 BookAction 设置一个和参数同名的属性，并辅以规则的 get/set 方法，就能将请求中的参数自动注入。更强大的地方在于，如果这个属性是个复杂对象，只要参数按照规约命名了，那么它也能够被正确处理：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookAction extends ActionSupport {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private Page page;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void setPage { ... }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public Page getPage { ... }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>在这种设定下，如果 URI 是：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /books?page.pageSize=1&amp;page.pageNo=2&amp;page.orderBy=desc
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>那么，pageSize、pageNo 和 orderBy 这三个值就会被设置到一个 Page 对象中，而这个 Page 对象则会被自动注入到 BookAction 的实例中去。</p>
<p>再来看看 Spring MVC 使用注解的方式来处理，和 URL 的结构放在一起观察，这种方式显然更为形象直观：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @RequestMapping("/{category}/books")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public ModelAndView get(@PathVariable("category") String category, @RequestParam("author") String author){ ... }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>在这种配置下，如果 URI 是：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /comic/books?author=Jim
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>那么，分类 comic 就会作为方法参数 category 的值传入，而作者 Jim 就会作为方法参数 author 的值传入。</p>
<h2>3. 参数验证</h2>
<p>参数验证的操作因为和请求对象密切相关，因此通常都是在控制器层完成的。在参数验证没有通过的情况下，往往会执行异常流程，转到错误页面，返回失败请求。Struts 提供了一个将参数验证解耦到配置文件的办法，请看下面的例子：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;validators&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;field name="name"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;field-validator type="requiredstring"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;param name="trim"&gt;true&lt;/param&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;message&gt; 书名不得为空 &lt;/message&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;/field-validator&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;field-validator type="stringlength"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;param name="maxLength"&gt;100&lt;/param&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;param name="minLength"&gt;1&lt;/param&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;message&gt; 书名的长度必须在 1~100 之间 &lt;/message&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;/field-validator&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;/field&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/validators&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>这就是一个非常简单的参数验证的规则，对于属性 name 定义了两条规则，一条是不得为空，另一条是长度必须在 1~100 之间，否则将返回错误信息。</p>
<p>类似的，Struts 也提供了基于注解的参数验证方式，上面的例子，如果使用注解来实现，就需要将注解加在自动注入参数的 set 方法处。代码见下：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @RequiredFieldValidator(trim = true, message = " 书名不得为空.")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @StringLengthFieldValidator(minLength = "1", maxLength = "100", message = " 书名的长度必须在 1~100 之间 ")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       void setName(String name) { ... }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>4. 视图上下文绑定</h2>
<p>在控制器中，我们经常需要将数据传入视图层，它可能会携带用户传入的参数，也可能会携带在控制器中查询模型得到的数据，而这个传入方式，就是<strong>将数据绑定到视图的上下文中。这就是我刚刚提到过的控制器层两大绑定中的第二个</strong>。</p>
<p>如果是使用 Servlet，那么我们一般可以用 setAttribute 的方法将参数设置到 request 对象中，这样在视图层就可以相应地使用 getAttribute 方法把该参数的值取出来。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       request.setAttribute("page", xxx);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>对于 Struts 来说，它的方法和前面说的请求参数绑定统一了，即可以将想传递的值放到 Action 的对象属性中，这种方式绑定的属性，和请求参数自动绑定的属性没有什么区别，在视图层都可以直接从上下文中取出来。</p>
<p>接着前面 BookAction 的例子，绑定了一个 Page 对象，那么在视图层中就可以使用 OGNL（Object-Graph Navigation Language，对象导航图语言）表达式直接取得：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;p&gt; 第 ${page.pageNo} 页 &lt;/p&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>对于 Spring MVC，则是需要在控制器方法中传入一个类型为 Model 的对象，同时将需要绑定的对象通过调用 addAttribute 来完成绑定，这个过程和 Servlet 是类似的。</p>
<h2>总结思考</h2>
<p>今天我们学习了 MVC 架构中的控制器层，整个控制器的逻辑比较密集，从请求抵达，到转出到视图层去渲染，控制器的逻辑通常包括下面这几步，但是，严格说起来，下面这些步骤的任何一步，根据实际情况，都是可以省略的。</p>
<p><img src="https://static001.geekbang.org/resource/image/0a/34/0a0f9ad88c34ab5922e57e2b55ff6834.png" alt=""></p>
<p>我们对比了在原生 Servlet、Struts 框架和 Spring MVC 框架下，上面各个步骤的实现，希望你能够感悟到其中的“套路”。</p>
<p>是的，具体某一个框架的配置使用，是很容易学习和掌握的，这当然很好，但那只是死的知识，而这也只是机械记忆。而当我们去思考同一个框架中实现同一个特性的不同方法，或者是不同框架实现同一个特性的不同方法时，我们就会慢慢体会到技术的有趣之处。</p>
<p>因为我们会去思考，这些不同的“玩法”比较起来，各有什么优缺点，在实际应用中应该怎么去权衡和选择，甚至去想，如果让我去设计一个类似的特性，都有哪些办法可以实现。</p>
<p>好，下面我们就来检验一下今天所学的知识，请思考下面这样两个问题：</p>
<ul> 
 <li>我们提到了 MVC 框架中，两种常见的配置方式，一种是将配置放在横向解耦的单独一层，另一种是将配置和业务模块放在一起。你更喜欢哪一种，为什么？</li> 
 <li>在上面的图中，我列出了控制器层常见的六大步骤。那么，回想你经历过的项目，是将怎样的代码逻辑放在了控制器层呢？</li> 
</ul>
<p>对于今天学习的内容，对于思考题，以及通过比较学习“套路”的方式，如果你有想法，不妨和我在留言区一起讨论吧。</p>
<h2>选修课堂：动手实现一个简单的 MVC 系统</h2>
<p>这一章我们一直在学习 MVC，不动手实践是不行的。我们要使用 Servlet + JSP + JavaBean 这种相对原始的方法来实现一个最简单的 MVC 系统。</p>
<p>还记得我们在 <a href="https://time.geekbang.org/column/article/140196">[第 07 讲]</a> 中动手跑起来的 Tomcat 吗？现在请打开 Tomcat 的安装目录，设置好环境变量 CATALINA_HOME，以便于我们后面使用正确的 Tomcat 路径。以我的电脑为例：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       export CATALINA_HOME=/usr/local/Cellar/tomcat/9.0.22/libexec
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们打开 ${CATALINA_HOME}/webapps/ROOT/WEB-INF/web.xml，在 这个结束标签前，添加如下子标签：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;servlet&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-name&gt;BookServlet&lt;/servlet-name&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-class&gt;BookServlet&lt;/servlet-class&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/servlet&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;servlet-mapping&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-name&gt;BookServlet&lt;/servlet-name&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;url-pattern&gt;/books&lt;/url-pattern&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;url-pattern&gt;/books/*&lt;/url-pattern&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/servlet-mapping&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>注意这里配置了两个 URL 映射，/books 和 /books/{bookId} 两种类型的请求会全部映射到我们将建立的 Servlet 中。</p>
<p>在配置好 Servlet 的映射之后，进入 ${CATALINA_HOME}/webapps/ROOT/WEB-INF，并创建一个名为 classes 的文件夹，接着在这个文件夹下建立一个名为 BookServlet.java 的文件，并编辑它：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.io.IOException;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import javax.servlet.ServletException;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import javax.servlet.http.HttpServlet;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import javax.servlet.http.HttpServletRequest;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import javax.servlet.http.HttpServletResponse;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookServlet extends HttpServlet {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        String category = request.getParameter("category");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        request.setAttribute("categoryName", category);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        request.getRequestDispatcher("/book.jsp").forward(request, response);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>嗯，其实代码逻辑很简单，把 URL 中的 category 参数的值取出来，给一个新名字 categoryName 并传给 book.jsp。</p>
<p>好，接下来我们就要把上面的 Java 源文件编译成 class 文件了，执行：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       javac BookServlet.java -classpath ${CATALINA_HOME}/lib/servlet-api.jar
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>其中 servlet-api.jar 是 Tomcat 中存放的编译运行 Servlet 所必须的类库。这样，你应该能看到在 classes 目录下生成了 BookServlet.class 文件。</p>
<p>接着，在 ${CATALINA_HOME}/webapps/ROOT 下建立 book.jsp，并写入：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;jsp:useBean id="date" class="java.util.Date" /&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Category name: &lt;%=request.getAttribute("categoryName") %&gt;, date: ${date.getYear()+1900}-${date.getMonth()+1}-${date.getDate()}
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>第一行表示创建并使用一个 Date 类型的 JavaBean，第二行在显示结果的时候，category 使用了 JSP 特有的 scriptlet 的表达式，而日期则使用了 OGNL 表达式。注意 Date 对象返回的年份是以 1900 年为基准的偏移量，因此需要加上 1900；而返回的月份是从 0 开始往后排的，因此需要加上修正值 1。</p>
<p>好了，大功告成，我们快来执行 Tomcat 看看结果吧！启动 Tomcat：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       catalina run
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>打开浏览器，访问：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       http://localhost:8080/books?category=art
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>如果你看到类似如下字样，那么，恭喜你，成功了！现在，你可以回想一下刚才的实现，这些代码该怎样对应到 MVC 各个部分呢？</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Category name: art, date: 2019-8-5
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>扩展阅读</h2>
<ul> 
 <li>对于 <a href="https://struts.apache.org/index.html">Struts</a> 和 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Spring MVC</a>，文中已经给出了官方链接，如果你想阅读简洁的中文版教程，可以看看这个 <a href="https://doc.yonyoucloud.com/doc/wiki/project/struts-2/architecture.html">Struts 2 教程</a>和这个 <a href="https://www.w3cschool.cn/wkspring/9pf81ha5.html">Spring MVC 教程</a>。</li> 
 <li>文中提到了使用 ControllerClassNameHandlerMapping 来贯彻“规约优于配置”的思想，达到对具体的映射免配置的目的，如果你感兴趣的话，<a href="https://www.tutorialspoint.com/springmvc/springmvc_controllerclassnamehandlermapping">Spring MVC - Controller Class Name Handler Mapping Example</a> 这篇文章有很好的介绍。</li> 
 <li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-ognl/index.html">OGNL 语言介绍与实践</a>，文中提到了 OGNL 表达式，感兴趣的话这篇文章是很好的入门。</li> 
</ul>
<p><img src="https://static001.geekbang.org/resource/image/11/8b/1181246bbd51ce348d5729696d1dc28b.jpg" alt="unpreview"></p> |             |book   |0     |full_html   |zh-hans  |39          |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 17:56:50.981 INFO  jdbc.sqltiming Line:373 - select nodebodyre0_.entity_id as entity_i1_13_0_, nodebodyre0_.body_value as body_val2_13_0_, 
nodebodyre0_.body_summary as body_sum3_13_0_, nodebodyre0_.bundle as bundle4_13_0_, nodebodyre0_.delta 
as delta5_13_0_, nodebodyre0_.body_format as body_for6_13_0_, nodebodyre0_.langcode as langcode7_13_0_, 
nodebodyre0_.revision_id as revision8_13_0_ from node_revision__body nodebodyre0_ where nodebodyre0_.entity_id=39 
 {executed in 1 msec}
2020-11-19 17:56:50.990 INFO  jdbc.resultsettable Line:610 - 
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|entity_id |body_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |body_summary |bundle |delta |body_format |langcode |revision_id |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|
|[unread]  |<p>你好，我是四火。</p>
<p>今天我们继续学习 MVC 架构，主要内容就是 MVC 架构的第三部分——控制器（Controller）。</p>
<p>控制器用于接收请求，校验参数，调用 Model 层获取业务数据，构造和绑定上下文，并转给 View 层去渲染。也就是说，控制器是 MVC 的大脑，它知道接下去该让谁去做什么事。控制器层是大多数 MVC 框架特别愿意做文章的地方，我相信你可能耳闻、了解，甚至熟练使用过一些 MVC 框架了。</p>
<p>那么与其去抽象地学习这一层的重要概念、原理，或是单纯地学习这些框架在这一层略显乏味的具体配置，我想我们今天“不走寻常路”一次，把这两者结合起来——<strong>我们来比较 Servlet、Struts 和 Sprint MVC 这三种常见的技术和 MVC 框架，在控制器层的工作路数，以及和业务代码整合配置的方式，看看任这些框架形式千变万化，到底有哪些其实是不变的“套路”呢？</strong></p>
<p>随着请求到达控制器，让我们顺着接下去的请求处理流程，看看控制器会通过怎样的步骤，履行完它的职责，并最终转到相应的视图吧。</p>
<h2>1. 路径映射和视图指向</h2>
<p>我们不妨把 MVC 架构的控制器想象成一个黑盒。当 HTTP 请求从客户端送达的时候，这个黑盒要完成一系列使命，那么它就有一个入口路由和一个出口路由：</p><!-- [[[read_end]]] -->
<ul> 
 <li><strong>入口路由就是路径映射，根据配置的规则，以及请求 URI 的路径，找到具体接收和处理这个请求的控制器逻辑；</strong></li> 
 <li><strong>出口路由就是视图指向，根据配置的规则，以及控制器处理完毕后返回的信息，找到需要渲染的视图页面。</strong></li> 
</ul>
<p>这两件事情，我们当然可以使用原始的 if-else 来完成，但是一般的 MVC 都提供了更清晰和独立的解决方案。</p>
<p>我们还是从老朋友 Servlet 开始讲起，在 Tomcat 的 web.xml 中，我们可以配置这样的路径映射：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;servlet&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-name&gt;BookServlet&lt;/servlet-name&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-class&gt;com.xxx.xxx.BookServlet&lt;/servlet-class&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/servlet&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;servlet-mapping&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-name&gt;BookServlet&lt;/servlet-name&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;url-pattern&gt;/books&lt;/url-pattern&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/servlet-mapping&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>你看，对于路径映射，一旦请求是 /books 这种形式的，就会被转到 BookServlet 里去处理。而对于视图指向，Servlet 是通过代码完成的，比如：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       request.getRequestDispatcher("/book.jsp").forward(request, response);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>但是，Servlet 路径映射的表达式匹配不够灵活，而且配置过于冗长；而视图指向更是完全通过代码调用来完成，视图的位置信息完全耦合在控制器主代码逻辑中，而且也并没有体现出配置的集中、清晰的管理优势。于是现今的 MVC 框架都提供了一套自己的映射匹配逻辑，例如 <a href="https://struts.apache.org/index.html">Struts 2</a>：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;action name="books" class="xxx.xxx.BookAction"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;result name="success" type="dispatcher"&gt;/success.jsp&lt;/result&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;result name="input" ... /&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/action&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>其中，name=“books” 这样的配置就会将 /books 的请求转给 BookAction。至于接下来的两个 result 标签，是根据控制器返回的视图名来配对具体的视图页面，也就是说，一旦 BookAction 处理完毕，通过返回的视图名字，请求可以被转发给相应的视图。</p>
<p>这个路径映射的配置是简单一些了，可是都需要放在一个其它位置的、单独的 XML 中配置。不过，Java 5 开始支持注解，因此许多 MVC 框架都开始支持使用注解来让这样的配置变得更加轻量，也就是将路径映射和它所属的控制器代码放在一起。见下面 Struts 的例子：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookAction extends ActionSupport {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Action(value="/books", results={
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Result(name="success",location="/book.jsp")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        })
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public String get() {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        return "success";
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>代码依然很好理解，当以 /books 为路径的 GET 请求到来时，会被转给 BookAction 的 get 方法。在控制器的活干完之后，根据返回的名称 success，下一步请求就会转到视图 /book.jsp 中去。</p>
<p>你看，对于路径映射和视图指向，为了不把这样的信息和主流程代码耦合在一起，上面讲了两种实现方法，它们各有优劣：</p>
<ul> 
 <li>放到配置文件中，好处是所有的映射都在一个文件里，方便管理。但是对于任何一个控制器逻辑，要寻找它对应的配置信息，需要去别的位置（即上文的 XML 中）寻找。<strong>这是一种代码横向分层解耦的方式，即分层方式和业务模块无关，或者说二者是“正交”的</strong>，这种方式我在 [第 11 讲] 讲解 IoC（控制反转）时会继续介绍。</li> 
 <li>使用注解，和控制器逻辑放在一起，好处是映射本身是和具体的控制器逻辑放在一起，当然，它们并非代码层面的耦合，而是通过注解的方式分离开。坏处是，如果需要考察所有的映射配置，那么就没有一个统一的文件可供概览。<strong>这是一种代码纵向分层解耦的方式，也就是说，配置是跟着业务模块走的</strong>。</li> 
</ul>
<p>无论使用以上哪一种方法，本质上都逃不过需要显式配置的命运。但无论哪种方法，其实都已经够简单了，可历史总是惊人的相似，总有帮“难伺候”的程序员，还是嫌麻烦！于是就有人想出了一个“终极偷懒”的办法——免掉配置。</p>
<p>这就需要利用 <strong>CoC 原则（Convention over Configuration，即规约优于配置）</strong>。比如，在使用 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Spring MVC</a> 这个 MVC 框架时，声明了 ControllerClassNameHandlerMapping 以后，对于这样没有配置任何映射信息的方法，会根据 Controller 类名的规约来完成映射：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BooksController extends AbstractController {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        @Override
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        protected ModelAndView handleRequestInternal() throws Exception {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        ...
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>在使用 /books 去访问的时候，请求就会被自动转交给定义好的控制器逻辑。</p>
<p>你看，规约优于配置看起来可以省掉很多工作对不对？没错！但是任何技术都有两面性，<strong>CoC 虽然省掉了一部分实际的配置工作，却没有改变映射匹配的流程本身，也不能省掉任何为了理解规约背后的“隐性知识”的学习成本</strong>。而且，规约往往只方便于解决最常见的配置，也就意味着，<strong>当需要更灵活的配置时，我们还是会被迫退化回显式配置</strong>。</p>
<h2>2. 请求参数绑定</h2>
<p>请求被送到了指定的控制器方法，接下去，需要从 HTTP 请求中把参数取出来，绑定到控制器这一层，以便使用。<strong>整个控制器的流程中，有两次重要的数据绑定，这是第一次，是为了控制器而绑定请求数据</strong>，后面在视图上下文构造这一步中还有一次绑定，那是为了视图而进行的。</p>
<p>和路径映射的配置一样，最先被考虑的方式，一定是用编程的方法实现的。比如在 Servlet 中，可以这样做：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       request.getParameter("name")
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>这并没有什么稀奇的对不对，想想我们前面学习的处理方法，参数应该能通过某种配置方式自动注入到控制器的对象属性或者方法参数中吧？一点都没错，并且，Struts 和 Spring MVC 各有各的做法，二者加起来，就恰巧印证了这句话。</p>
<p>还记得前面 Struts 的那个例子吗？给 BookAction 设置一个和参数同名的属性，并辅以规则的 get/set 方法，就能将请求中的参数自动注入。更强大的地方在于，如果这个属性是个复杂对象，只要参数按照规约命名了，那么它也能够被正确处理：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookAction extends ActionSupport {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        private Page page;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public void setPage { ... }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        public Page getPage { ... }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>在这种设定下，如果 URI 是：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /books?page.pageSize=1&amp;page.pageNo=2&amp;page.orderBy=desc
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>那么，pageSize、pageNo 和 orderBy 这三个值就会被设置到一个 Page 对象中，而这个 Page 对象则会被自动注入到 BookAction 的实例中去。</p>
<p>再来看看 Spring MVC 使用注解的方式来处理，和 URL 的结构放在一起观察，这种方式显然更为形象直观：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @RequestMapping("/{category}/books")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public ModelAndView get(@PathVariable("category") String category, @RequestParam("author") String author){ ... }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>在这种配置下，如果 URI 是：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       /comic/books?author=Jim
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>那么，分类 comic 就会作为方法参数 category 的值传入，而作者 Jim 就会作为方法参数 author 的值传入。</p>
<h2>3. 参数验证</h2>
<p>参数验证的操作因为和请求对象密切相关，因此通常都是在控制器层完成的。在参数验证没有通过的情况下，往往会执行异常流程，转到错误页面，返回失败请求。Struts 提供了一个将参数验证解耦到配置文件的办法，请看下面的例子：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;validators&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;field name="name"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;field-validator type="requiredstring"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;param name="trim"&gt;true&lt;/param&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;message&gt; 书名不得为空 &lt;/message&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;/field-validator&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;field-validator type="stringlength"&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;param name="maxLength"&gt;100&lt;/param&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;param name="minLength"&gt;1&lt;/param&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;message&gt; 书名的长度必须在 1~100 之间 &lt;/message&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;/field-validator&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;/field&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/validators&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>这就是一个非常简单的参数验证的规则，对于属性 name 定义了两条规则，一条是不得为空，另一条是长度必须在 1~100 之间，否则将返回错误信息。</p>
<p>类似的，Struts 也提供了基于注解的参数验证方式，上面的例子，如果使用注解来实现，就需要将注解加在自动注入参数的 set 方法处。代码见下：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @RequiredFieldValidator(trim = true, message = " 书名不得为空.")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       @StringLengthFieldValidator(minLength = "1", maxLength = "100", message = " 书名的长度必须在 1~100 之间 ")
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       void setName(String name) { ... }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>4. 视图上下文绑定</h2>
<p>在控制器中，我们经常需要将数据传入视图层，它可能会携带用户传入的参数，也可能会携带在控制器中查询模型得到的数据，而这个传入方式，就是<strong>将数据绑定到视图的上下文中。这就是我刚刚提到过的控制器层两大绑定中的第二个</strong>。</p>
<p>如果是使用 Servlet，那么我们一般可以用 setAttribute 的方法将参数设置到 request 对象中，这样在视图层就可以相应地使用 getAttribute 方法把该参数的值取出来。</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       request.setAttribute("page", xxx);
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>对于 Struts 来说，它的方法和前面说的请求参数绑定统一了，即可以将想传递的值放到 Action 的对象属性中，这种方式绑定的属性，和请求参数自动绑定的属性没有什么区别，在视图层都可以直接从上下文中取出来。</p>
<p>接着前面 BookAction 的例子，绑定了一个 Page 对象，那么在视图层中就可以使用 OGNL（Object-Graph Navigation Language，对象导航图语言）表达式直接取得：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;p&gt; 第 ${page.pageNo} 页 &lt;/p&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>对于 Spring MVC，则是需要在控制器方法中传入一个类型为 Model 的对象，同时将需要绑定的对象通过调用 addAttribute 来完成绑定，这个过程和 Servlet 是类似的。</p>
<h2>总结思考</h2>
<p>今天我们学习了 MVC 架构中的控制器层，整个控制器的逻辑比较密集，从请求抵达，到转出到视图层去渲染，控制器的逻辑通常包括下面这几步，但是，严格说起来，下面这些步骤的任何一步，根据实际情况，都是可以省略的。</p>
<p><img src="https://static001.geekbang.org/resource/image/0a/34/0a0f9ad88c34ab5922e57e2b55ff6834.png" alt=""></p>
<p>我们对比了在原生 Servlet、Struts 框架和 Spring MVC 框架下，上面各个步骤的实现，希望你能够感悟到其中的“套路”。</p>
<p>是的，具体某一个框架的配置使用，是很容易学习和掌握的，这当然很好，但那只是死的知识，而这也只是机械记忆。而当我们去思考同一个框架中实现同一个特性的不同方法，或者是不同框架实现同一个特性的不同方法时，我们就会慢慢体会到技术的有趣之处。</p>
<p>因为我们会去思考，这些不同的“玩法”比较起来，各有什么优缺点，在实际应用中应该怎么去权衡和选择，甚至去想，如果让我去设计一个类似的特性，都有哪些办法可以实现。</p>
<p>好，下面我们就来检验一下今天所学的知识，请思考下面这样两个问题：</p>
<ul> 
 <li>我们提到了 MVC 框架中，两种常见的配置方式，一种是将配置放在横向解耦的单独一层，另一种是将配置和业务模块放在一起。你更喜欢哪一种，为什么？</li> 
 <li>在上面的图中，我列出了控制器层常见的六大步骤。那么，回想你经历过的项目，是将怎样的代码逻辑放在了控制器层呢？</li> 
</ul>
<p>对于今天学习的内容，对于思考题，以及通过比较学习“套路”的方式，如果你有想法，不妨和我在留言区一起讨论吧。</p>
<h2>选修课堂：动手实现一个简单的 MVC 系统</h2>
<p>这一章我们一直在学习 MVC，不动手实践是不行的。我们要使用 Servlet + JSP + JavaBean 这种相对原始的方法来实现一个最简单的 MVC 系统。</p>
<p>还记得我们在 <a href="https://time.geekbang.org/column/article/140196">[第 07 讲]</a> 中动手跑起来的 Tomcat 吗？现在请打开 Tomcat 的安装目录，设置好环境变量 CATALINA_HOME，以便于我们后面使用正确的 Tomcat 路径。以我的电脑为例：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       export CATALINA_HOME=/usr/local/Cellar/tomcat/9.0.22/libexec
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>我们打开 ${CATALINA_HOME}/webapps/ROOT/WEB-INF/web.xml，在 这个结束标签前，添加如下子标签：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;servlet&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-name&gt;BookServlet&lt;/servlet-name&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-class&gt;BookServlet&lt;/servlet-class&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/servlet&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;servlet-mapping&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;servlet-name&gt;BookServlet&lt;/servlet-name&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;url-pattern&gt;/books&lt;/url-pattern&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        &lt;url-pattern&gt;/books/*&lt;/url-pattern&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;/servlet-mapping&gt;
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>注意这里配置了两个 URL 映射，/books 和 /books/{bookId} 两种类型的请求会全部映射到我们将建立的 Servlet 中。</p>
<p>在配置好 Servlet 的映射之后，进入 ${CATALINA_HOME}/webapps/ROOT/WEB-INF，并创建一个名为 classes 的文件夹，接着在这个文件夹下建立一个名为 BookServlet.java 的文件，并编辑它：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import java.io.IOException;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import javax.servlet.ServletException;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import javax.servlet.http.HttpServlet;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import javax.servlet.http.HttpServletRequest;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       import javax.servlet.http.HttpServletResponse;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line"> 
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       public class BookServlet extends HttpServlet {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        String category = request.getParameter("category");
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        request.setAttribute("categoryName", category);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        request.getRequestDispatcher("/book.jsp").forward(request, response);
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
        }
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       }
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>嗯，其实代码逻辑很简单，把 URL 中的 category 参数的值取出来，给一个新名字 categoryName 并传给 book.jsp。</p>
<p>好，接下来我们就要把上面的 Java 源文件编译成 class 文件了，执行：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       javac BookServlet.java -classpath ${CATALINA_HOME}/lib/servlet-api.jar
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>其中 servlet-api.jar 是 Tomcat 中存放的编译运行 Servlet 所必须的类库。这样，你应该能看到在 classes 目录下生成了 BookServlet.class 文件。</p>
<p>接着，在 ${CATALINA_HOME}/webapps/ROOT 下建立 book.jsp，并写入：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       &lt;jsp:useBean id="date" class="java.util.Date" /&gt;
      </div></td>
    </tr>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Category name: &lt;%=request.getAttribute("categoryName") %&gt;, date: ${date.getYear()+1900}-${date.getMonth()+1}-${date.getDate()}
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>第一行表示创建并使用一个 Date 类型的 JavaBean，第二行在显示结果的时候，category 使用了 JSP 特有的 scriptlet 的表达式，而日期则使用了 OGNL 表达式。注意 Date 对象返回的年份是以 1900 年为基准的偏移量，因此需要加上 1900；而返回的月份是从 0 开始往后排的，因此需要加上修正值 1。</p>
<p>好了，大功告成，我们快来执行 Tomcat 看看结果吧！启动 Tomcat：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       catalina run
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>打开浏览器，访问：</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       http://localhost:8080/books?category=art
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<p>如果你看到类似如下字样，那么，恭喜你，成功了！现在，你可以回想一下刚才的实现，这些代码该怎样对应到 MVC 各个部分呢？</p>
<pre style="position: relative;"><code>
  <table class="hljs-ln">
   <tbody>
    <tr>
     <td class="hljs-ln-numbers">
      <div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td>
     <td class="hljs-ln-code">
      <div class="hljs-ln-line">
       Category name: art, date: 2019-8-5
      </div></td>
    </tr>
   </tbody>
  </table></code>
 <div class="richcontent-pre-copy">
  <span class="iconfont"></span>复制代码
 </div></pre>
<h2>扩展阅读</h2>
<ul> 
 <li>对于 <a href="https://struts.apache.org/index.html">Struts</a> 和 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Spring MVC</a>，文中已经给出了官方链接，如果你想阅读简洁的中文版教程，可以看看这个 <a href="https://doc.yonyoucloud.com/doc/wiki/project/struts-2/architecture.html">Struts 2 教程</a>和这个 <a href="https://www.w3cschool.cn/wkspring/9pf81ha5.html">Spring MVC 教程</a>。</li> 
 <li>文中提到了使用 ControllerClassNameHandlerMapping 来贯彻“规约优于配置”的思想，达到对具体的映射免配置的目的，如果你感兴趣的话，<a href="https://www.tutorialspoint.com/springmvc/springmvc_controllerclassnamehandlermapping">Spring MVC - Controller Class Name Handler Mapping Example</a> 这篇文章有很好的介绍。</li> 
 <li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-ognl/index.html">OGNL 语言介绍与实践</a>，文中提到了 OGNL 表达式，感兴趣的话这篇文章是很好的入门。</li> 
</ul>
<p><img src="https://static001.geekbang.org/resource/image/11/8b/1181246bbd51ce348d5729696d1dc28b.jpg" alt="unpreview"></p> |             |book   |0     |full_html   |zh-hans  |39          |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|-------|------|------------|---------|------------|

2020-11-19 17:56:51.003 INFO  jdbc.sqltiming Line:373 - select nodefiledd0_.nid as nid1_10_, nodefiledd0_.changed as changed2_10_, nodefiledd0_.created 
as created3_10_, nodefiledd0_.default_langcode as default_4_10_, nodefiledd0_.langcode as langcode5_10_, 
nodefiledd0_.promote as promote6_10_, nodefiledd0_.revision_translation_affected as revision7_10_, 
nodefiledd0_.status as status8_10_, nodefiledd0_.sticky as sticky9_10_, nodefiledd0_.title 
as title10_10_, nodefiledd0_.type as type11_10_, nodefiledd0_.uid as uid12_10_, nodefiledd0_.vid 
as vid13_10_ from node_field_data nodefiledd0_ where nodefiledd0_.nid=39 
 {executed in 1 msec}
2020-11-19 17:56:51.003 INFO  jdbc.resultsettable Line:610 - 
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|----------------------------|-----|----|----|
|nid |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                       |type |uid |vid |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|----------------------------|-----|----|----|
|39  |1605756208 |1605756208 |1                |zh-hans  |0       |1                             |1      |0      |10丨MVC架构解析：控制器（Controller）篇 |book |1   |39  |
|----|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|----------------------------|-----|----|----|

2020-11-19 17:56:51.008 INFO  jdbc.sqltiming Line:373 - select nodefieldr0_.nid as nid1_11_0_, nodefieldr0_.changed as changed2_11_0_, nodefieldr0_.created 
as created3_11_0_, nodefieldr0_.default_langcode as default_4_11_0_, nodefieldr0_.langcode 
as langcode5_11_0_, nodefieldr0_.promote as promote6_11_0_, nodefieldr0_.revision_translation_affected 
as revision7_11_0_, nodefieldr0_.status as status8_11_0_, nodefieldr0_.sticky as sticky9_11_0_, 
nodefieldr0_.title as title10_11_0_, nodefieldr0_.uid as uid11_11_0_, nodefieldr0_.vid as vid12_11_0_ 
from node_field_revision nodefieldr0_ where nodefieldr0_.nid=39 
 {executed in 1 msec}
2020-11-19 17:56:51.009 INFO  jdbc.resultsettable Line:610 - 
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|----------------------------|----|----|
|nid      |changed    |created    |default_langcode |langcode |promote |revision_translation_affected |status |sticky |title                       |uid |vid |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|----------------------------|----|----|
|[unread] |1605756208 |1605756208 |1                |zh-hans  |0       |1                             |1      |0      |10丨MVC架构解析：控制器（Controller）篇 |1   |39  |
|---------|-----------|-----------|-----------------|---------|--------|------------------------------|-------|-------|----------------------------|----|----|

2020-11-19 17:56:51.014 INFO  jdbc.sqltiming Line:373 - update node_field_data set changed=1605779811, created=1605779811, default_langcode=1, langcode='zh-hans', 
promote=0, revision_translation_affected=1, status=1, sticky=0, title='10丨MVC架构解析：控制器（Controller）篇', 
type='book', uid=1, vid=39 where nid=39 
 {executed in 0 msec}
2020-11-19 17:56:51.015 INFO  jdbc.sqltiming Line:373 - update node_field_revision set changed=1605779811, created=1605779811, default_langcode=1, 
langcode='zh-hans', promote=0, revision_translation_affected=1, status=1, sticky=0, title='10丨MVC架构解析：控制器（Controller）篇', 
uid=1, vid=39 where nid=39 
 {executed in 0 msec}
2020-11-19 17:56:51.023 INFO  jdbc.sqltiming Line:373 - select bookfieldm0_.entity_id as entity_i1_8_, bookfieldm0_.bundle as bundle2_8_, bookfieldm0_.delta 
as delta3_8_, bookfieldm0_.langcode as langcode4_8_, bookfieldm0_.field_media_value as field_me5_8_, 
bookfieldm0_.revision_id as revision6_8_ from node__field_media bookfieldm0_ where bookfieldm0_.entity_id=39 
 {executed in 0 msec}
2020-11-19 17:56:51.024 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |revision_id |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|39        |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/8178f19a2912fcd55770d808effb6dec?bkt=en-26dcfdb4e5ee1a4930298e6fc2810c3c42b19417ea8173f4eeee2f07305a4be7cd0add1b242845e9&fid=3757516097-778750-30241195742902&time=1605756206&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-hjGn3QtTblRUYG6jT9cvdKxy3h4%3D&to=92&size=13623314&sta_dx=13623314&sta_cs=3859&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414486&mtime=1605754778&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=13623314&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-5ecdc0debc6326d9d2a6072b8c2b5a1e20fd8fd140e30610018152d07dab6094e1d1a3f4c4ce3390&sl=76480590&expires=8h&rt=pr&r=959203110&mlogid=7502289557144965213&vbdid=2247232042&fin=10%E4%B8%A8MVC%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Controller%EF%BC%89%E7%AF%87.m4a&bflag=92,34-92&rtype=1&dp-logid=7502289557144965213&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=9feb8afe5adad8c3eaa7ef7e3cb3942ab75c1c6980981ac3&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=10%E4%B8%A8MVC%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Controller%EF%BC%89%E7%AF%87.m4a |39          |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 17:56:51.029 INFO  jdbc.sqltiming Line:373 - update node__field_media set bundle='book', delta=0, langcode='zh-hans', field_media_value='https://qdall01.baidupcs.com/file/8178f19a2912fcd55770d808effb6dec?bkt=en-26dcfdb4e5ee1a4930298e6fc2810c3c42b19417ea8173f4eeee2f07305a4be7cd0add1b242845e9&fid=3757516097-778750-692024956521631&time=1605779808&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-uNgXhfYt7mrusi9rxFrvcwxqBaA%3D&to=92&size=13623314&sta_dx=13623314&sta_cs=3864&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414486&mtime=1605778299&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=13623314&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-5ecdc0debc6326d9d2a6072b8c2b5a1e20fd8fd140e30610018152d07dab6094e1d1a3f4c4ce3390&sl=76480590&expires=8h&rt=pr&r=184613383&mlogid=7508625197783973314&vbdid=2247232042&fin=10%E4%B8%A8MVC%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Controller%EF%BC%89%E7%AF%87.m4a&bflag=92,34-92&rtype=1&dp-logid=7508625197783973314&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=34c17094e7d5a0c90eb5f62652fc409071210c2bffed00c8&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=10%E4%B8%A8MVC%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Controller%EF%BC%89%E7%AF%87.m4a', 
revision_id=39 where entity_id=39 
 {executed in 0 msec}
2020-11-19 17:56:51.033 INFO  jdbc.sqltiming Line:373 - select nodefieldm0_.entity_id as entity_i1_17_0_, nodefieldm0_.bundle as bundle2_17_0_, nodefieldm0_.delta 
as delta3_17_0_, nodefieldm0_.langcode as langcode4_17_0_, nodefieldm0_.field_media_value as 
field_me5_17_0_, nodefieldm0_.revision_id as revision6_17_0_ from node_revision__field_media 
nodefieldm0_ where nodefieldm0_.entity_id=39 
 {executed in 0 msec}
2020-11-19 17:56:51.034 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|entity_id |bundle |delta |langcode |field_media_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |revision_id |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[unread]  |book   |0     |zh-hans  |https://qdall01.baidupcs.com/file/8178f19a2912fcd55770d808effb6dec?bkt=en-26dcfdb4e5ee1a4930298e6fc2810c3c42b19417ea8173f4eeee2f07305a4be7cd0add1b242845e9&fid=3757516097-778750-30241195742902&time=1605756206&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-hjGn3QtTblRUYG6jT9cvdKxy3h4%3D&to=92&size=13623314&sta_dx=13623314&sta_cs=3859&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414486&mtime=1605754778&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=13623314&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-5ecdc0debc6326d9d2a6072b8c2b5a1e20fd8fd140e30610018152d07dab6094e1d1a3f4c4ce3390&sl=76480590&expires=8h&rt=pr&r=959203110&mlogid=7502289557144965213&vbdid=2247232042&fin=10%E4%B8%A8MVC%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Controller%EF%BC%89%E7%AF%87.m4a&bflag=92,34-92&rtype=1&dp-logid=7502289557144965213&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=9feb8afe5adad8c3eaa7ef7e3cb3942ab75c1c6980981ac3&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=10%E4%B8%A8MVC%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Controller%EF%BC%89%E7%AF%87.m4a |39          |
|----------|-------|------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|

2020-11-19 17:56:51.039 INFO  jdbc.sqltiming Line:373 - update node_revision__field_media set bundle='book', delta=0, langcode='zh-hans', field_media_value='https://qdall01.baidupcs.com/file/8178f19a2912fcd55770d808effb6dec?bkt=en-26dcfdb4e5ee1a4930298e6fc2810c3c42b19417ea8173f4eeee2f07305a4be7cd0add1b242845e9&fid=3757516097-778750-692024956521631&time=1605779808&sign=FDTAXUGERLQlBHSKfWqir-DCb740ccc5511e5e8fedcff06b081203-uNgXhfYt7mrusi9rxFrvcwxqBaA%3D&to=92&size=13623314&sta_dx=13623314&sta_cs=3864&sta_ft=m4a&sta_ct=7&sta_mt=0&fm2=MH%2CYangquan%2CAnywhere%2C%2Cshanghai%2Cct&ctime=1570414486&mtime=1605778299&resv0=-1&resv1=0&resv2=rlim&resv3=2&resv4=13623314&vuk=3757516097&iv=0&htype=&randtype=em&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-5ecdc0debc6326d9d2a6072b8c2b5a1e20fd8fd140e30610018152d07dab6094e1d1a3f4c4ce3390&sl=76480590&expires=8h&rt=pr&r=184613383&mlogid=7508625197783973314&vbdid=2247232042&fin=10%E4%B8%A8MVC%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Controller%EF%BC%89%E7%AF%87.m4a&bflag=92,34-92&rtype=1&dp-logid=7508625197783973314&dp-callid=0.1.1&hps=1&tsl=80&csl=80&fsl=-1&csign=yVzLQPCt4DblfMLqd2BCjd2RnqQ%3D&so=0&ut=6&uter=0&serv=0&uc=1458616558&ti=34c17094e7d5a0c90eb5f62652fc409071210c2bffed00c8&hflag=30&adg=c_15d187590626c675056c89c8026cfc17&reqlabel=778750_l_1bf9445f27094ab64c9f1cb0bdf7ccfa_-1_dd2c452b8e51a0c74130d7cf32c48a2d&ibp=1&by=themis&filename=10%E4%B8%A8MVC%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Controller%EF%BC%89%E7%AF%87.m4a', 
revision_id=39 where entity_id=39 
 {executed in 1 msec}
2020-11-19 17:56:51.043 INFO  jdbc.sqltiming Line:373 - select bookfieldc0_.entity_id as entity_i1_5_, bookfieldc0_.bundle as bundle2_5_, bookfieldc0_.field_comment_value 
as field_co3_5_, bookfieldc0_.delta as delta4_5_, bookfieldc0_.field_comment_format as field_co5_5_, 
bookfieldc0_.langcode as langcode6_5_, bookfieldc0_.revision_id as revision7_5_ from node__field_comment 
bookfieldc0_ where bookfieldc0_.entity_id=39 
 {executed in 0 msec}
2020-11-19 17:56:51.044 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|39        |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/59/1d/c7de1a9b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Kada</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-10-03
    </div>
   </div> <!---->
  </div> 
  <div>
   <div class="_3M6kV3zb_0">
    Django使用配置文件，Flask使用装饰器。
   </div> 
   <div class="_2r3UB1GX_0">
    <span>展开</span><i class="iconfont"></i>
   </div> <!----> 
   <div class="_1w8H0ktn_0 _2A421P4G_0">
    <div class="_2jsFl-X0_0">
     <i class="iconfont"></i> <span></span>
    </div> 
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!---->
   </div>
  </div>
 </div></li> |0     |full_html            |zh-hans  |39          |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 17:56:51.049 INFO  jdbc.sqltiming Line:373 - select nodefieldc0_.entity_id as entity_i1_14_0_, nodefieldc0_.bundle as bundle2_14_0_, nodefieldc0_.field_comment_value 
as field_co3_14_0_, nodefieldc0_.delta as delta4_14_0_, nodefieldc0_.field_comment_format as 
field_co5_14_0_, nodefieldc0_.langcode as langcode6_14_0_, nodefieldc0_.revision_id as revision7_14_0_ 
from node_revision__field_comment nodefieldc0_ where nodefieldc0_.entity_id=39 
 {executed in 0 msec}
2020-11-19 17:56:51.050 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|entity_id |bundle |field_comment_value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |delta |field_comment_format |langcode |revision_id |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|
|[unread]  |book   |<li class="reJj6Thl_0"><img src="https://static001.geekbang.org/account/avatar/00/10/59/1d/c7de1a9b.jpg" class="_2273kGdT_0"> 
 <div class="_2CG0SquK_0">
  <div class="_304R4gla_0">
   <div>
    <div class="_18Dng5rT_0">
     <span>Kada</span> <!---->
    </div> 
    <div class="_1H1Z49Dr_0">
     2019-10-03
    </div>
   </div> <!---->
  </div> 
  <div>
   <div class="_3M6kV3zb_0">
    Django使用配置文件，Flask使用装饰器。
   </div> 
   <div class="_2r3UB1GX_0">
    <span>展开</span><i class="iconfont"></i>
   </div> <!----> 
   <div class="_1w8H0ktn_0 _2A421P4G_0">
    <div class="_2jsFl-X0_0">
     <i class="iconfont"></i> <span></span>
    </div> 
    <div class="_2P4B1Hdm_0">
     <i class="iconfont"></i> <span class=""></span>
    </div> <!---->
   </div>
  </div>
 </div></li> |0     |full_html            |zh-hans  |39          |
|----------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------|---------|------------|

2020-11-19 17:56:51.055 INFO  jdbc.sqltiming Line:373 - select bookfieldt0_.entity_id as entity_i1_9_, bookfieldt0_.bundle as bundle2_9_, bookfieldt0_.delta 
as delta3_9_, bookfieldt0_.langcode as langcode4_9_, bookfieldt0_.revision_id as revision5_9_, 
bookfieldt0_.field_thumb_value as field_th6_9_ from node__field_thumb bookfieldt0_ where bookfieldt0_.entity_id=39 
 {executed in 0 msec}
2020-11-19 17:56:51.055 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|39        |book   |0     |zh-hans  |39          |https://static001.geekbang.org/resource/image/ec/e4/eca17dc7649c338b6f53015e6a38fde4.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 17:56:51.061 INFO  jdbc.sqltiming Line:373 - select nodefieldt0_.entity_id as entity_i1_18_0_, nodefieldt0_.bundle as bundle2_18_0_, nodefieldt0_.delta 
as delta3_18_0_, nodefieldt0_.langcode as langcode4_18_0_, nodefieldt0_.revision_id as revision5_18_0_, 
nodefieldt0_.field_thumb_value as field_th6_18_0_ from node_revision__field_thumb nodefieldt0_ 
where nodefieldt0_.entity_id=39 
 {executed in 1 msec}
2020-11-19 17:56:51.061 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|entity_id |bundle |delta |langcode |revision_id |field_thumb_value                                                                        |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|
|[unread]  |book   |0     |zh-hans  |39          |https://static001.geekbang.org/resource/image/ec/e4/eca17dc7649c338b6f53015e6a38fde4.jpg |
|----------|-------|------|---------|------------|-----------------------------------------------------------------------------------------|

2020-11-19 17:56:51.067 INFO  jdbc.sqltiming Line:373 - select bookfieldf0_.entity_id as entity_i1_6_0_, bookfieldf0_.bundle as bundle2_6_0_, bookfieldf0_.delta 
as delta3_6_0_, bookfieldf0_.field_fenlei_target_id as field_fe4_6_0_, bookfieldf0_.langcode 
as langcode5_6_0_, bookfieldf0_.revision_id as revision6_6_0_ from node__field_fenlei bookfieldf0_ 
where bookfieldf0_.entity_id=39 
 {executed in 1 msec}
2020-11-19 17:56:51.067 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |39          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 17:56:51.073 INFO  jdbc.sqltiming Line:373 - select nodefieldf0_.entity_id as entity_i1_15_0_, nodefieldf0_.bundle as bundle2_15_0_, nodefieldf0_.delta 
as delta3_15_0_, nodefieldf0_.field_fenlei_target_id as field_fe4_15_0_, nodefieldf0_.langcode 
as langcode5_15_0_, nodefieldf0_.revision_id as revision6_15_0_ from node_revision__field_fenlei 
nodefieldf0_ where nodefieldf0_.entity_id=39 
 {executed in 1 msec}
2020-11-19 17:56:51.073 INFO  jdbc.resultsettable Line:610 - 
|----------|-------|------|-----------------------|---------|------------|
|entity_id |bundle |delta |field_fenlei_target_id |langcode |revision_id |
|----------|-------|------|-----------------------|---------|------------|
|[unread]  |book   |0     |1                      |zh-hans  |39          |
|----------|-------|------|-----------------------|---------|------------|

2020-11-19 17:56:51.079 INFO  jdbc.sqltiming Line:373 - select bookchecke0_.item_id as item_id1_2_, bookchecke0_.fsid as fsid2_2_, bookchecke0_.got 
as got3_2_, bookchecke0_.name as name4_2_ from book_check bookchecke0_ where bookchecke0_.fsid='162849410279807' 
and bookchecke0_.name='net_content' 
 {executed in 1 msec}
2020-11-19 17:56:51.079 INFO  jdbc.resultsettable Line:610 - 
|--------|-----|----|-----|
|item_id |fsid |got |name |
|--------|-----|----|-----|
|--------|-----|----|-----|

